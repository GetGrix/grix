(function(we,u){typeof exports=="object"&&typeof module<"u"?u(exports,require("react")):typeof define=="function"&&define.amd?define(["exports","react"],u):(we=typeof globalThis<"u"?globalThis:we||self,u(we.GrixUI={},we.React))})(this,function(we,u){"use strict";var zs=Object.defineProperty;var Ds=(we,u,_e)=>u in we?zs(we,u,{enumerable:!0,configurable:!0,writable:!0,value:_e}):we[u]=_e;var ie=(we,u,_e)=>Ds(we,typeof u!="symbol"?u+"":u,_e);var _e={exports:{}},nt={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bt;function Yt(){if(bt)return nt;bt=1;var i=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function s(n,r,o){var c=null;if(o!==void 0&&(c=""+o),r.key!==void 0&&(c=""+r.key),"key"in r){o={};for(var a in r)a!=="key"&&(o[a]=r[a])}else o=r;return r=o.ref,{$$typeof:i,type:n,key:c,ref:r!==void 0?r:null,props:o}}return nt.Fragment=t,nt.jsx=s,nt.jsxs=s,nt}var it={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vt;function Xt(){return vt||(vt=1,process.env.NODE_ENV!=="production"&&function(){function i(b){if(b==null)return null;if(typeof b=="function")return b.$$typeof===L?null:b.displayName||b.name||null;if(typeof b=="string")return b;switch(b){case U:return"Fragment";case y:return"Profiler";case l:return"StrictMode";case v:return"Suspense";case X:return"SuspenseList";case V:return"Activity"}if(typeof b=="object")switch(typeof b.tag=="number"&&console.error("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),b.$$typeof){case D:return"Portal";case q:return(b.displayName||"Context")+".Provider";case f:return(b._context.displayName||"Context")+".Consumer";case T:var Z=b.render;return b=b.displayName,b||(b=Z.displayName||Z.name||"",b=b!==""?"ForwardRef("+b+")":"ForwardRef"),b;case G:return Z=b.displayName||null,Z!==null?Z:i(b.type)||"Memo";case F:Z=b._payload,b=b._init;try{return i(b(Z))}catch{}}return null}function t(b){return""+b}function s(b){try{t(b);var Z=!1}catch{Z=!0}if(Z){Z=console;var de=Z.error,fe=typeof Symbol=="function"&&Symbol.toStringTag&&b[Symbol.toStringTag]||b.constructor.name||"Object";return de.call(Z,"The provided key is an unsupported type %s. This value must be coerced to a string before using it here.",fe),t(b)}}function n(b){if(b===U)return"<>";if(typeof b=="object"&&b!==null&&b.$$typeof===F)return"<...>";try{var Z=i(b);return Z?"<"+Z+">":"<...>"}catch{return"<...>"}}function r(){var b=ee.A;return b===null?null:b.getOwner()}function o(){return Error("react-stack-top-frame")}function c(b){if(g.call(b,"key")){var Z=Object.getOwnPropertyDescriptor(b,"key").get;if(Z&&Z.isReactWarning)return!1}return b.key!==void 0}function a(b,Z){function de(){xe||(xe=!0,console.error("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://react.dev/link/special-props)",Z))}de.isReactWarning=!0,Object.defineProperty(b,"key",{get:de,configurable:!0})}function d(){var b=i(this.type);return Fe[b]||(Fe[b]=!0,console.error("Accessing element.ref was removed in React 19. ref is now a regular prop. It will be removed from the JSX Element type in a future release.")),b=this.props.ref,b!==void 0?b:null}function h(b,Z,de,fe,Oe,K,ke,Re){return de=K.ref,b={$$typeof:m,type:b,key:Z,props:K,_owner:Oe},(de!==void 0?de:null)!==null?Object.defineProperty(b,"ref",{enumerable:!1,get:d}):Object.defineProperty(b,"ref",{enumerable:!1,value:null}),b._store={},Object.defineProperty(b._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:0}),Object.defineProperty(b,"_debugInfo",{configurable:!1,enumerable:!1,writable:!0,value:null}),Object.defineProperty(b,"_debugStack",{configurable:!1,enumerable:!1,writable:!0,value:ke}),Object.defineProperty(b,"_debugTask",{configurable:!1,enumerable:!1,writable:!0,value:Re}),Object.freeze&&(Object.freeze(b.props),Object.freeze(b)),b}function j(b,Z,de,fe,Oe,K,ke,Re){var oe=Z.children;if(oe!==void 0)if(fe)if(w(oe)){for(fe=0;fe<oe.length;fe++)z(oe[fe]);Object.freeze&&Object.freeze(oe)}else console.error("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else z(oe);if(g.call(Z,"key")){oe=i(b);var re=Object.keys(Z).filter(function(ye){return ye!=="key"});fe=0<re.length?"{key: someKey, "+re.join(": ..., ")+": ...}":"{key: someKey}",ce[oe+fe]||(re=0<re.length?"{"+re.join(": ..., ")+": ...}":"{}",console.error(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,fe,oe,re,oe),ce[oe+fe]=!0)}if(oe=null,de!==void 0&&(s(de),oe=""+de),c(Z)&&(s(Z.key),oe=""+Z.key),"key"in Z){de={};for(var me in Z)me!=="key"&&(de[me]=Z[me])}else de=Z;return oe&&a(de,typeof b=="function"?b.displayName||b.name||"Unknown":b),h(b,oe,K,Oe,r(),de,ke,Re)}function z(b){typeof b=="object"&&b!==null&&b.$$typeof===m&&b._store&&(b._store.validated=1)}var E=u,m=Symbol.for("react.transitional.element"),D=Symbol.for("react.portal"),U=Symbol.for("react.fragment"),l=Symbol.for("react.strict_mode"),y=Symbol.for("react.profiler"),f=Symbol.for("react.consumer"),q=Symbol.for("react.context"),T=Symbol.for("react.forward_ref"),v=Symbol.for("react.suspense"),X=Symbol.for("react.suspense_list"),G=Symbol.for("react.memo"),F=Symbol.for("react.lazy"),V=Symbol.for("react.activity"),L=Symbol.for("react.client.reference"),ee=E.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,g=Object.prototype.hasOwnProperty,w=Array.isArray,ne=console.createTask?console.createTask:function(){return null};E={"react-stack-bottom-frame":function(b){return b()}};var xe,Fe={},ge=E["react-stack-bottom-frame"].bind(E,o)(),$=ne(n(o)),ce={};it.Fragment=U,it.jsx=function(b,Z,de,fe,Oe){var K=1e4>ee.recentlyCreatedOwnerStacks++;return j(b,Z,de,!1,fe,Oe,K?Error("react-stack-top-frame"):ge,K?ne(n(b)):$)},it.jsxs=function(b,Z,de,fe,Oe){var K=1e4>ee.recentlyCreatedOwnerStacks++;return j(b,Z,de,!0,fe,Oe,K?Error("react-stack-top-frame"):ge,K?ne(n(b)):$)}}()),it}var jt;function Ut(){return jt||(jt=1,process.env.NODE_ENV==="production"?_e.exports=Yt():_e.exports=Xt()),_e.exports}var e=Ut();const Je={distance(i,t){const s=t.x-i.x,n=t.y-i.y;return Math.sqrt(s*s+n*n)},slope(i,t){const s=t.x-i.x,n=t.y-i.y;return Math.abs(s)<Number.EPSILON?s===0||s>0?1/0:-1/0:n/s},angle(i,t){const s=t.x-i.x,n=t.y-i.y;return Math.atan2(n,s)},magnitude(i){return Math.sqrt(i.x*i.x+i.y*i.y)},normalize(i){const t=this.magnitude(i);return t===0?{x:0,y:0}:{x:i.x/t,y:i.y/t}},snapToGrid(i,t){return{x:Math.round(i.x/t)*t,y:Math.round(i.y/t)*t}},calculateArea(i){return Math.abs(i.properties.width*i.properties.height)},boundsContainPoint(i,t){return t.x>=i.x&&t.x<=i.x+i.width&&t.y>=i.y&&t.y<=i.y+i.height},boundsIntersect(i,t){return!(i.x+i.width<t.x||t.x+t.width<i.x||i.y+i.height<t.y||t.y+t.height<i.y)},gcd(i,t){for(i=Math.abs(i),t=Math.abs(t);t!==0;){const s=t;t=i%t,i=s}return i},simplifyFraction(i,t){if(t===0)return[i,1];const s=this.gcd(i,t);return[i/s,t/s]},worldToScreen(i,t,s){const n=s.width/2,r=s.height/2,o=(i.x-t.center.x)*t.zoom,c=(i.y-t.center.y)*t.zoom;return{x:n+o,y:r-c}},screenToWorld(i,t,s){const n=s.width/2,r=s.height/2,o=(i.x-n)/t.zoom,c=(r-i.y)/t.zoom;return{x:t.center.x+o,y:t.center.y+c}}},Qe={detectCapabilities(){const i="ontouchstart"in window||navigator.maxTouchPoints>0,t=i&&navigator.maxTouchPoints>1,s=!0,n=window.matchMedia("(hover: hover)").matches;return{hasTouch:i,hasPencil:t,hasKeyboard:s,hasHover:n,maxTouchPoints:navigator.maxTouchPoints||0,supportsPressure:"force"in Touch.prototype,supportsTilt:"altitudeAngle"in Touch.prototype}},normalizePointerEvent(i){let t="mouse";return i.pointerType==="touch"?t="touch":i.pointerType==="pen"&&(t="pen"),{type:t,pressure:i.pressure||0,tiltX:i.tiltX||0,tiltY:i.tiltY||0,x:i.clientX,y:i.clientY,timestamp:i.timeStamp,isPrimary:i.isPrimary,pointerId:i.pointerId}},getTouchTargetSize(i){switch(i){case"pen":return 32;case"touch":return 44;case"mouse":return 24;default:return 44}}};class Ht{constructor(){this.listeners=new Map}on(t,s){this.listeners.has(t)||this.listeners.set(t,[]),this.listeners.get(t).push(s)}off(t,s){const n=this.listeners.get(t);if(n){const r=n.indexOf(s);r>-1&&n.splice(r,1)}}emit(t,s){const n=this.listeners.get(t);n&&n.forEach(r=>{try{r(s)}catch(o){console.error(`Error in event handler for ${t}:`,o)}})}clear(){this.listeners.clear()}getEvents(){return Array.from(this.listeners.keys())}getListenerCount(t){var s;return((s=this.listeners.get(t))==null?void 0:s.length)||0}}const wt=i=>{let t;const s=new Set,n=(h,j)=>{const z=typeof h=="function"?h(t):h;if(!Object.is(z,t)){const E=t;t=j??(typeof z!="object"||z===null)?z:Object.assign({},t,z),s.forEach(m=>m(t,E))}},r=()=>t,a={setState:n,getState:r,getInitialState:()=>d,subscribe:h=>(s.add(h),()=>s.delete(h))},d=t=i(n,r,a);return a},Vt=i=>i?wt(i):wt,Zt=i=>i;function Kt(i,t=Zt){const s=u.useSyncExternalStore(i.subscribe,()=>t(i.getState()),()=>t(i.getInitialState()));return u.useDebugValue(s),s}const St=i=>{const t=Vt(i),s=n=>Kt(t,n);return Object.assign(s,t),s},pt=i=>i?St(i):St,Ze=class Ze{constructor(){ie(this,"STORAGE_KEY","grix-app-state");ie(this,"VERSION_KEY","grix-version");ie(this,"SESSION_KEY","grix-session");ie(this,"CURRENT_VERSION","1.0.0");ie(this,"options",{autoSave:!0,saveInterval:2e3,maxStorageSize:10*1024*1024,compressionEnabled:!0});ie(this,"autoSaveTimer",null);ie(this,"pendingSave",!1);ie(this,"sessionId");this.sessionId=this.generateSessionId(),this.initializeStorage(),this.setupAutoSave(),this.setupStorageEventListener()}static getInstance(){return Ze.instance||(Ze.instance=new Ze),Ze.instance}initializeStorage(){try{const t=localStorage.getItem(this.VERSION_KEY);t?t!==this.CURRENT_VERSION?(this.migrateStorage(t,this.CURRENT_VERSION),localStorage.setItem(this.VERSION_KEY,this.CURRENT_VERSION),console.log(`🔄 Grix: Storage migrated from ${t} to ${this.CURRENT_VERSION}`)):console.log("✅ Grix: Storage ready (version "+this.CURRENT_VERSION+")"):(localStorage.setItem(this.VERSION_KEY,this.CURRENT_VERSION),localStorage.setItem(this.SESSION_KEY,this.sessionId),console.log("🎯 Grix: Storage initialized for first time"))}catch(t){console.warn("⚠️ Grix: Storage initialization failed:",t)}}async saveState(t){try{const s=this.loadState(),n={objects:t.objects??(s==null?void 0:s.objects)??[],selectedObjects:t.selectedObjects??(s==null?void 0:s.selectedObjects)??[],viewport:t.viewport??(s==null?void 0:s.viewport)??{zoom:20,center:{x:0,y:0}},visualizationSettings:t.visualizationSettings??(s==null?void 0:s.visualizationSettings)??{},activeTool:t.activeTool??(s==null?void 0:s.activeTool)??null,version:this.CURRENT_VERSION,timestamp:Date.now(),sessionId:this.sessionId},r=JSON.stringify(n);return r.length>this.options.maxStorageSize?(console.warn("⚠️ Grix: State too large for storage, compressing..."),!1):(localStorage.setItem(this.STORAGE_KEY,r),console.log("💾 Grix: State saved successfully"),!0)}catch(s){return console.error("❌ Grix: Failed to save state:",s),!1}}loadState(){try{const t=localStorage.getItem(this.STORAGE_KEY);if(!t)return console.log("📭 Grix: No saved state found"),null;const s=JSON.parse(t);return this.validateState(s)?(console.log("📂 Grix: State loaded successfully"),s):(console.warn("⚠️ Grix: Invalid state structure, ignoring saved state"),null)}catch(t){return console.error("❌ Grix: Failed to load state:",t),null}}clearState(){try{return localStorage.removeItem(this.STORAGE_KEY),console.log("🗑️ Grix: State cleared successfully"),!0}catch(t){return console.error("❌ Grix: Failed to clear state:",t),!1}}getStorageInfo(){try{const t=localStorage.getItem(this.STORAGE_KEY),s=t?new Blob([t]).size:0;let n=0;for(let o in localStorage)localStorage.hasOwnProperty(o)&&(n+=localStorage[o].length+o.length);const r=this.loadState();return{isAvailable:typeof Storage<"u",usedSpace:n,totalSpace:5*1024*1024,stateSize:s,lastSaved:(r==null?void 0:r.timestamp)??null}}catch{return{isAvailable:!1,usedSpace:0,totalSpace:0,stateSize:0,lastSaved:null}}}configure(t){this.options={...this.options,...t},t.autoSave!==void 0&&(t.autoSave?this.setupAutoSave():this.stopAutoSave())}saveNow(t){return this.pendingSave=!1,this.saveState(t)}scheduleSave(){this.options.autoSave&&(this.pendingSave=!0)}exportState(){const t=this.loadState();if(!t)return null;const s={...t,exportedAt:new Date().toISOString(),exportVersion:this.CURRENT_VERSION};return JSON.stringify(s,null,2)}async importState(t){try{const s=JSON.parse(t);if(!this.validateState(s))throw new Error("Invalid state structure");return await this.saveState(s)}catch(s){return console.error("❌ Grix: Failed to import state:",s),!1}}generateSessionId(){return"session_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}validateState(t){return t&&typeof t=="object"&&Array.isArray(t.objects)&&Array.isArray(t.selectedObjects)&&t.viewport&&typeof t.viewport.zoom=="number"&&t.viewport.center&&typeof t.viewport.center.x=="number"&&typeof t.viewport.center.y=="number"}setupAutoSave(){this.autoSaveTimer&&clearInterval(this.autoSaveTimer),this.options.autoSave&&(this.autoSaveTimer=setInterval(()=>{this.pendingSave&&this.triggerAutoSave()},this.options.saveInterval))}stopAutoSave(){this.autoSaveTimer&&(clearInterval(this.autoSaveTimer),this.autoSaveTimer=null)}triggerAutoSave(){window.dispatchEvent(new CustomEvent("grix:auto-save-requested")),this.pendingSave=!1}setupStorageEventListener(){window.addEventListener("storage",t=>{t.key===this.STORAGE_KEY&&(console.log("🔄 Grix: State updated by another tab"),window.dispatchEvent(new CustomEvent("grix:state-updated-externally")))})}migrateStorage(t,s){console.log(`🔄 Grix: Migrating storage from ${t} to ${s}`);const n=this.loadState();n&&(n.version=s,this.saveState(n))}};ie(Ze,"instance");let ft=Ze;const ae=ft.getInstance(),Me=pt((i,t)=>({viewport:{center:{x:0,y:0},zoom:20,bounds:{x:-10,y:-10,width:20,height:20}},objects:[],selectedObjects:[],snapToGrid:!0,gridDensity:"fine",canvasSize:{width:800,height:600},setViewport:s=>{i(n=>({viewport:{...n.viewport,...s}})),ae.scheduleSave()},addObject:s=>{i(n=>({objects:[...n.objects,s]})),ae.scheduleSave()},removeObject:s=>{i(n=>({objects:n.objects.filter(r=>r.id!==s),selectedObjects:n.selectedObjects.filter(r=>r!==s)})),ae.scheduleSave()},updateObject:(s,n)=>{i(r=>({objects:r.objects.map(o=>o.id===s?{...o,...n}:o)})),ae.scheduleSave()},selectObject:(s,n=!1)=>{i(r=>n?{selectedObjects:r.selectedObjects.includes(s)?r.selectedObjects.filter(c=>c!==s):[...r.selectedObjects,s]}:{selectedObjects:[s]})},clearSelection:()=>{i({selectedObjects:[]})},setSnapToGrid:s=>{i({snapToGrid:s})},setGridDensity:s=>{i({gridDensity:s})},setCanvasSize:s=>{i({canvasSize:s})},getObject:s=>t().objects.find(n=>n.id===s),getAllObjects:()=>t().objects,getSelectedObjects:()=>{const s=t();return s.objects.filter(n=>s.selectedObjects.includes(n.id))},screenToWorld:s=>{const{viewport:n,canvasSize:r}=t();return Je.screenToWorld(s,n,r)},worldToScreen:s=>{const{viewport:n,canvasSize:r}=t();return Je.worldToScreen(s,n,r)},bringToFront:s=>{i(n=>{const r=Math.max(...n.objects.map(o=>o.zIndex||0));return{objects:n.objects.map(o=>o.id===s?{...o,zIndex:r+1}:o)}})},sendToBack:s=>{i(n=>{const r=Math.min(...n.objects.map(o=>o.zIndex||0));return{objects:n.objects.map(o=>o.id===s?{...o,zIndex:r-1}:o)}})},bringForward:s=>{i(n=>{const r=n.objects.find(a=>a.id===s);if(!r)return n;const o=n.objects.filter(a=>(a.zIndex||0)>(r.zIndex||0));if(o.length===0)return n;const c=Math.min(...o.map(a=>a.zIndex||0));return{objects:n.objects.map(a=>a.id===s?{...a,zIndex:c+.1}:a)}})},sendBackward:s=>{i(n=>{const r=n.objects.find(a=>a.id===s);if(!r)return n;const o=n.objects.filter(a=>(a.zIndex||0)<(r.zIndex||0));if(o.length===0)return n;const c=Math.max(...o.map(a=>a.zIndex||0));return{objects:n.objects.map(a=>a.id===s?{...a,zIndex:c-.1}:a)}})},clearObjects:()=>{i({objects:[],selectedObjects:[]}),ae.scheduleSave()},loadState:()=>{const s=ae.loadState();s&&i({objects:s.objects,selectedObjects:s.selectedObjects,viewport:s.viewport})},saveState:()=>{const s=t();ae.saveState({objects:s.objects,selectedObjects:s.selectedObjects,viewport:s.viewport})}})),Jt=()=>({addObject:i=>Me.getState().addObject(i),removeObject:i=>Me.getState().removeObject(i),updateObject:(i,t)=>Me.getState().updateObject(i,t),getObject:i=>Me.getState().getObject(i),getAllObjects:()=>Me.getState().getAllObjects(),screenToWorld:i=>Me.getState().screenToWorld(i),worldToScreen:i=>Me.getState().worldToScreen(i)}),Qt=()=>({getState:()=>{const i=Me.getState();return{viewport:i.viewport,objects:i.objects,selectedObjects:i.selectedObjects,snapToGrid:i.snapToGrid,gridDensity:i.gridDensity}},setState:i=>{Me.setState(i)},subscribe:i=>Me.subscribe(t=>{i({viewport:t.viewport,objects:t.objects,selectedObjects:t.selectedObjects,snapToGrid:t.snapToGrid,gridDensity:t.gridDensity})})}),Ct=u.createContext(null);function rt(){const i=u.useContext(Ct);if(!i)throw new Error("usePluginManager must be used within PluginManagerProvider");return i}function Et({children:i}){const[t]=u.useState(()=>new Ht),[s]=u.useState(()=>new Map),[n]=u.useState(()=>new Map),[r,o]=u.useState(null),c=u.useRef(),a=u.useRef(),d=u.useRef();c.current||(c.current=Jt()),a.current||(a.current=Qt()),d.current||(d.current={distance:Je.distance,slope:Je.slope,snapToGrid:Je.snapToGrid,calculateArea:Je.calculateArea});const h=c.current,j=a.current,z=d.current,E=l=>{if(s.has(l.id)){console.warn(`Plugin ${l.id} is already registered`);return}const y={canvas:h,events:t,state:j,math:z};s.set(l.id,l),n.set(l.id,y);try{l.init(y),console.log(`Plugin ${l.id} initialized successfully`)}catch(f){console.error(`Failed to initialize plugin ${l.id}:`,f),s.delete(l.id),n.delete(l.id)}},m=l=>{var f;const y=s.get(l);if(y){try{(f=y.destroy)==null||f.call(y)}catch(q){console.error(`Error destroying plugin ${l}:`,q)}s.delete(l),n.delete(l),r===l&&o(null)}},D=()=>Array.from(s.values());u.useEffect(()=>{t.emit("tool:changed",{previous:null,current:r})},[r,t]),u.useEffect(()=>{const l=T=>v=>{var G,F,V,L,ee,g;const X=r?s.get(r):null;if(X)try{switch(T){case"pointer:down":(G=X.onPointerDown)==null||G.call(X,v);break;case"pointer:move":(F=X.onPointerMove)==null||F.call(X,v);break;case"pointer:up":(V=X.onPointerUp)==null||V.call(X,v);break}}catch(w){console.error(`Error in plugin ${r} handling ${T}:`,w)}else{const w=j.getState().selectedObjects;try{let ne;if(w.length===1){const xe=h.getObject(w[0]);(xe==null?void 0:xe.type)==="ray"?ne=s.get("ray-tool"):(xe==null?void 0:xe.type)==="rectangle"?ne=s.get("rectangle-tool"):(xe==null?void 0:xe.type)==="circle"?ne=s.get("circle-tool"):(xe==null?void 0:xe.type)==="triangle"?ne=s.get("triangle-tool"):(xe==null?void 0:xe.type)==="function"&&(ne=s.get("function-tool"))}if(ne)switch(T){case"pointer:down":(L=ne.onPointerDown)==null||L.call(ne,v);break;case"pointer:move":(ee=ne.onPointerMove)==null||ee.call(ne,v);break;case"pointer:up":(g=ne.onPointerUp)==null||g.call(ne,v);break}}catch(ne){console.error(`Error in tool handling ${T} for manipulation:`,ne)}}},y=l("pointer:down"),f=l("pointer:move"),q=l("pointer:up");return t.on("pointer:down",y),t.on("pointer:move",f),t.on("pointer:up",q),()=>{t.off("pointer:down",y),t.off("pointer:move",f),t.off("pointer:up",q)}},[r,s,t,j,h]);const U={eventBus:t,registerPlugin:E,unregisterPlugin:m,getActivePlugins:D,activeTool:r,setActiveTool:o};return e.jsx(Ct.Provider,{value:U,children:i})}function es(){const{eventBus:i}=rt();return{handlePointerDown:r=>{i.emit("pointer:down",r)},handlePointerMove:r=>{i.emit("pointer:move",r)},handlePointerUp:r=>{i.emit("pointer:up",r)}}}function Mt(i,t,s={}){const[n,r]=u.useState(null),[o,c]=u.useState(new Map),a={enableGestures:!0,touchTargetSize:44,preventScrolling:!0,...s};u.useEffect(()=>{const l=Qe.detectCapabilities();r(l)},[]);const[d,h]=u.useState({isGesturing:!1,startTime:0,startDistance:0,lastTapTime:0,tapCount:0,initialCenter:null,wasRecentlyGesturing:!1}),j=u.useCallback(l=>{const y=Array.from(l.values());if(y.length<2)return 0;const f=y[0],q=y[1];if(!f||!q)return 0;const T=f.x-q.x,v=f.y-q.y;return Math.sqrt(T*T+v*v)},[]),z=u.useCallback(l=>{const y=Array.from(l.values());if(y.length===0)return{x:0,y:0};const f=y.reduce((q,T)=>({x:q.x+T.x,y:q.y+T.y}),{x:0,y:0});return{x:f.x/y.length,y:f.y/y.length}},[]),E=u.useCallback(l=>{var v;if(!i.current)return;a.preventScrolling&&l.preventDefault();const y=i.current.getBoundingClientRect(),f=l.clientX-y.left,q=l.clientY-y.top,T=Qe.normalizePointerEvent(l);T.x=f,T.y=q,c(X=>{const G=new Map(X);if(G.set(l.pointerId,T),a.enableGestures&&G.size>=2){const F=j(G),V=z(G);h(L=>({...L,isGesturing:!0,startTime:l.timeStamp,startDistance:F,initialCenter:V,wasRecentlyGesturing:!1}))}return G}),i.current.setPointerCapture(l.pointerId),(v=t.onPointerDown)==null||v.call(t,T)},[i,t,a,j]),m=u.useCallback(l=>{var v;if(!i.current)return;const y=i.current.getBoundingClientRect(),f=l.clientX-y.left,q=l.clientY-y.top,T=Qe.normalizePointerEvent(l);T.x=f,T.y=q,c(X=>{var F,V;const G=new Map(X);if(G.set(l.pointerId,T),a.enableGestures&&G.size>=2){const L=j(G),ee=z(G);if(d.isGesturing&&d.startDistance>0&&d.initialCenter){const g=L/d.startDistance,w={x:d.initialCenter.x*.7+ee.x*.3,y:d.initialCenter.y*.7+ee.y*.3};(F=t.onGesture)==null||F.call(t,{type:"pinch",center:w,scale:g,touches:G.size})}}else if(!(G.size===1&&d.wasRecentlyGesturing)){if(G.size===1&&d.isGesturing){const L=z(G);(V=t.onGesture)==null||V.call(t,{type:"pan",center:L,touches:G.size})}}return G}),(v=t.onPointerMove)==null||v.call(t,T)},[t,a,j,z,d]),D=u.useCallback(l=>{var v;if(!i.current)return;const y=i.current.getBoundingClientRect(),f=l.clientX-y.left,q=l.clientY-y.top,T=Qe.normalizePointerEvent(l);T.x=f,T.y=q,c(X=>{var F;const G=new Map(X);if(G.delete(l.pointerId),G.size<2&&d.isGesturing&&(h(V=>({...V,isGesturing:!1,wasRecentlyGesturing:!0,initialCenter:null})),setTimeout(()=>{h(V=>({...V,wasRecentlyGesturing:!1}))},100)),a.enableGestures&&G.size===0){const L=l.timeStamp-d.startTime<200&&!d.wasRecentlyGesturing,ee=l.timeStamp-d.lastTapTime;L&&!d.isGesturing&&(ee<300?h(g=>({...g,tapCount:g.tapCount+1})):((F=t.onGesture)==null||F.call(t,{type:"tap",center:{x:T.x,y:T.y},touches:1}),h(g=>({...g,tapCount:1,lastTapTime:l.timeStamp})))),h(g=>({...g,isGesturing:!1}))}return G}),i.current&&i.current.releasePointerCapture(l.pointerId),(v=t.onPointerUp)==null||v.call(t,T)},[i,t,a,d]),U=u.useCallback(l=>{var v;if(!i.current)return;const y=i.current.getBoundingClientRect(),f=l.clientX-y.left,q=l.clientY-y.top,T=Qe.normalizePointerEvent(l);T.x=f,T.y=q,c(X=>{const G=new Map(X);return G.delete(l.pointerId),G}),h(X=>({...X,isGesturing:!1})),(v=t.onPointerCancel)==null||v.call(t,T)},[t]);return u.useEffect(()=>{const l=i.current;if(!l)return;l.addEventListener("pointerdown",E),l.addEventListener("pointermove",m),l.addEventListener("pointerup",D),l.addEventListener("pointercancel",U);const y=f=>f.preventDefault();return l.addEventListener("contextmenu",y),()=>{l.removeEventListener("pointerdown",E),l.removeEventListener("pointermove",m),l.removeEventListener("pointerup",D),l.removeEventListener("pointercancel",U),l.removeEventListener("contextmenu",y)}},[i,E,m,D,U]),{capabilities:n,activePointers:Array.from(o.values()),isGesturing:d.isGesturing,touchTargetSize:n?Qe.getTouchTargetSize(n.hasTouch?"touch":"mouse"):a.touchTargetSize}}function kt(i,t={minSpacing:8,maxSpacing:80,labelMinSpacing:40}){const s=i.zoom;let r=1,o=r*s;for(;o<t.minSpacing&&r<1e4;)r*=Tt(r),o=r*s;for(;o>t.maxSpacing&&r>1e-4;)r/=ts(r),o=r*s;let c=r,a=c*s;for(;a<t.labelMinSpacing&&c<r*100;)c*=Tt(c),a=c*s;const d=Math.max(.1,Math.min(1,(o-t.minSpacing)/(t.maxSpacing-t.minSpacing)));return{gridSize:r,labelStep:c,shouldShowGrid:o>=t.minSpacing,shouldShowLabels:a>=t.labelMinSpacing,opacity:d}}function Tt(i){if(i<1)return i>=.5?2:i>=.2?2.5:(i>=.1,2);if(i<10)return i>=5?2:i>=2?2.5:(i>=1,2);{const t=Math.pow(10,Math.floor(Math.log10(i))),s=i/t;return s>=5?2:s>=2?2.5:(s>=1,2)}}function ts(i){if(i<=1)return i<=.1||i<=.2?2:i<=.5?2.5:(i<=1,2);if(i<=10)return i<=2?2:i<=5?2.5:(i<=10,2);{const t=Math.pow(10,Math.floor(Math.log10(i))),s=i/t;return s<=2?2:s<=5?2.5:(s<=10,2)}}function ss(i,t,s,n,r=!0){const{gridSize:o}=s,c={left:i.center.x-t.width/2/i.zoom,right:i.center.x+t.width/2/i.zoom,top:i.center.y+t.height/2/i.zoom,bottom:i.center.y-t.height/2/i.zoom},a=[],d=[],h=Math.floor(c.left/o)*o,j=Math.ceil(c.right/o)*o;for(let m=h;m<=j;m+=o){const D=n({x:m,y:0}).x,U=Math.abs(m)<o/2,l=Math.abs(m%(o*5))<o/2;a.push({x:D,isAxis:U,isMajor:l,isInteger:!1,value:m})}if(r&&(o>=2||o<1)){const m=Math.floor(c.left),D=Math.ceil(c.right);for(let U=m;U<=D;U+=1)if(Math.abs(U%o)>.001){const l=n({x:U,y:0}).x,y=Math.abs(U)<.5;a.push({x:l,isAxis:y,isMajor:!1,isInteger:!0,value:U})}}const z=Math.floor(c.bottom/o)*o,E=Math.ceil(c.top/o)*o;for(let m=z;m<=E;m+=o){const D=n({x:0,y:m}).y,U=Math.abs(m)<o/2,l=Math.abs(m%(o*5))<o/2;d.push({y:D,isAxis:U,isMajor:l,isInteger:!1,value:m})}if(r&&(o>=2||o<1)){const m=Math.floor(c.bottom),D=Math.ceil(c.top);for(let U=m;U<=D;U+=1)if(Math.abs(U%o)>.001){const l=n({x:0,y:U}).y,y=Math.abs(U)<.5;d.push({y:l,isAxis:y,isMajor:!1,isInteger:!0,value:U})}}return{verticalLines:a,horizontalLines:d}}function be(i,t=3){if(Number.isInteger(i))return i.toString();const s=i.toFixed(t);return parseFloat(s).toString()}function ot(i,t,s){const n=s.x-t.x,r=s.y-t.y,o=Math.sqrt(n*n+r*r);if(o===0)return Math.sqrt((i.x-t.x)**2+(i.y-t.y)**2);const c=Math.max(0,Math.min(1,((i.x-t.x)*n+(i.y-t.y)*r)/(o*o))),a={x:t.x+c*n,y:t.y+c*r};return Math.sqrt((i.x-a.x)**2+(i.y-a.y)**2)}function Pt(i,t){const[s,n,r]=t,o=(n.y-r.y)*(s.x-r.x)+(r.x-n.x)*(s.y-r.y),c=((n.y-r.y)*(i.x-r.x)+(r.x-n.x)*(i.y-r.y))/o,a=((r.y-s.y)*(i.x-r.x)+(s.x-r.x)*(i.y-r.y))/o,d=1-c-a;return c>=0&&a>=0&&d>=0}function Nt(i,t,s){const n=Math.sqrt((i.x-t.x)**2+(i.y-t.y)**2);return Math.abs(n-s)}function Q(i,t){return t>=1?i.toFixed(0):t>=.1?i.toFixed(1):t>=.01?i.toFixed(2):i.toFixed(3)}function et(i,t,s){if(s!=="adaptive")switch(s){case"whole":return 1;case"half":return .5;case"quarter":return .25;case"tenth":return .1;default:return 1}const r=kt(i,{minSpacing:8,maxSpacing:80,labelMinSpacing:40}).gridSize/t;return r<=.1?r:r<=.5?.1:r<=2?.25:1}const At={showEquivalentFractions:!0,showLengthMultiples:!0,showAreaRectangle:!0,showDivisionMultiples:!0,showRiseRunTriangle:!0,showDistanceMarkers:!0,showAngleArc:!1,showCoordinateProjections:!0,showTangentLines:!1,showFunctionExtensions:!0,showTriangleAngles:!0,showSOHCAHTOA:!1,showTrigValues:!1,showTriangleClassification:!0,showTriangleAltitudes:!1,showSpecialTriangles:!0,showPythagoreanSquares:!1,showDivisionAnswer:!0,showLatticePoints:!1,showReferenceLineY_equals_X:!0,showFactorPairs:!1,showCommutativeProperty:!1,showDistributiveProperty:!1,showPrimeComposite:!1,showGCF:!0,showLCM:!1,fontScale:1,gridScale:1,snapPrecision:"whole",coordinateSystem:"cartesian",showPolarGrid:!1,customOrigin:null,zoomSensitivity:"medium"},De=pt(i=>({...At,toggleSetting:t=>{i(s=>({[t]:!s[t]})),ae.scheduleSave()},setFontScale:t=>{i({fontScale:t}),ae.scheduleSave()},setGridScale:t=>{i({gridScale:t}),ae.scheduleSave()},setSnapPrecision:t=>{i({snapPrecision:t}),ae.scheduleSave()},setCoordinateSystem:t=>{i({coordinateSystem:t}),ae.scheduleSave()},setCustomOrigin:t=>{i({customOrigin:t}),ae.scheduleSave()},setZoomSensitivity:t=>{i({zoomSensitivity:t}),ae.scheduleSave()},resetToDefaults:()=>{i(At),ae.scheduleSave()}}));function ns({viewport:i,canvasSize:t,worldToScreen:s,objects:n=[]}){const r=De(),o=l=>Math.round(l*r.fontScale),c=kt(i,{minSpacing:8,maxSpacing:80,labelMinSpacing:40}),a={gridSize:c.gridSize/r.gridScale,labelStep:c.labelStep/r.gridScale},{verticalLines:d,horizontalLines:h}=ss(i,t,a,s,!1);if(!c.shouldShowGrid)return null;const j=[];if(r.coordinateSystem==="polar"||r.coordinateSystem==="both"){const l=s({x:0,y:0}),y=Math.max(Math.abs(i.center.x)+t.width/(2*i.zoom),Math.abs(i.center.y)+t.height/(2*i.zoom));for(let f=a.gridSize;f<=y;f+=a.gridSize){const q=f*i.zoom;q>=10&&j.push(e.jsx("circle",{cx:l.x,cy:l.y,r:q,fill:"none",stroke:"#9CA3AF",strokeWidth:"0.5",opacity:.4},`polar-circle-${f}`))}for(let f=0;f<360;f+=30){const q=f*Math.PI/180,T=l.x+y*i.zoom*Math.cos(q),v=l.y-y*i.zoom*Math.sin(q);j.push(e.jsx("line",{x1:l.x,y1:l.y,x2:T,y2:v,stroke:"#9CA3AF",strokeWidth:"0.5",opacity:.3},`polar-line-${f}`))}}const z=[];n.forEach(l=>{if(l.type==="ray"){const{startPoint:y,endPoint:f}=l.properties;if(Math.abs(y.x)<.001&&Math.abs(y.y)<.001){const q=f.x-y.x,T=f.y-y.y;if(Math.abs(q)>.001){const v=1/q;if(v>0&&v<=1){const X=y.y+v*T,G=s({x:1,y:X});z.push({y:X,screenY:G.y})}}}}});const E=d.map(l=>{const f=Math.abs(l.value-1)<.001&&r.showDivisionAnswer,q=l.isAxis?"#374151":f?"#60A5FA":l.isMajor?"#9CA3AF":"#E5E7EB",T=l.isAxis?2:f?1.5:l.isMajor?1:.5,v=l.isAxis?1:f?.8:l.isMajor?.6*c.opacity:.3*c.opacity;return e.jsx("line",{x1:l.x,y1:0,x2:l.x,y2:t.height,stroke:q,strokeWidth:T,opacity:v},`v${l.value}`)}),m=h.map(l=>e.jsx("line",{x1:0,y1:l.y,x2:t.width,y2:l.y,stroke:l.isAxis?"#374151":l.isMajor?"#9CA3AF":"#E5E7EB",strokeWidth:l.isAxis?2:l.isMajor?1:.5,opacity:l.isAxis?1:l.isMajor?.6*c.opacity:.3*c.opacity},`h${l.value}`)),D=r.showReferenceLineY_equals_X?(()=>{const l={left:i.center.x-t.width/2/i.zoom,right:i.center.x+t.width/2/i.zoom,top:i.center.y+t.height/2/i.zoom,bottom:i.center.y-t.height/2/i.zoom},y=Math.min(l.left,l.bottom),f=Math.max(l.right,l.top),q=s({x:y,y}),T=s({x:f,y:f});return{lineStart:q,lineEnd:T}})():null,U=r.showLatticePoints?(()=>{const l={left:i.center.x-t.width/2/i.zoom,right:i.center.x+t.width/2/i.zoom,top:i.center.y+t.height/2/i.zoom,bottom:i.center.y-t.height/2/i.zoom},y=[],f=Math.max(-20,Math.floor(l.left)),q=Math.min(20,Math.ceil(l.right)),T=Math.max(-20,Math.floor(l.bottom)),v=Math.min(20,Math.ceil(l.top)),X=(q-f+1)*(v-T+1);if(X>200){const G=Math.ceil(Math.sqrt(X/200));for(let F=f;F<=q;F+=G)for(let V=T;V<=v;V+=G){const L=s({x:F,y:V});L.x>=-20&&L.x<=t.width+20&&L.y>=-20&&L.y<=t.height+20&&y.push(L)}}else for(let G=f;G<=q;G++)for(let F=T;F<=v;F++){const V=s({x:G,y:F});V.x>=-20&&V.x<=t.width+20&&V.y>=-20&&V.y<=t.height+20&&y.push(V)}return y})():[];return e.jsxs("g",{className:"grid",children:[(r.coordinateSystem==="polar"||r.coordinateSystem==="both")&&e.jsx("g",{className:"polar-grid",children:j}),(r.coordinateSystem==="cartesian"||r.coordinateSystem==="both")&&e.jsxs("g",{className:"cartesian-grid",children:[E,m]}),U.map((l,y)=>e.jsx("circle",{cx:l.x,cy:l.y,r:"1.5",fill:"#9CA3AF",opacity:"0.3"},`lattice-${y}`)),D&&e.jsx("line",{x1:D.lineStart.x,y1:D.lineStart.y,x2:D.lineEnd.x,y2:D.lineEnd.y,stroke:"#A78BFA",strokeWidth:"1.5",opacity:"0.6",strokeDasharray:"5,5"}),c.shouldShowLabels&&e.jsxs("g",{className:"labels",fontSize:"12",fill:"#374151",children:[d.filter(l=>{const y=Math.abs(l.value%a.labelStep)<a.gridSize/10,f=Math.abs(l.value)>=a.labelStep/2;return y&&f}).filter((l,y,f)=>!f.slice(0,y).some(q=>Math.abs(q.value-l.value)<.001)).map(l=>e.jsx("text",{x:l.x,y:s({x:0,y:0}).y+20,textAnchor:"middle",fontSize:o(11),fontWeight:"500",opacity:Math.max(.7,c.opacity),children:Q(l.value,c.gridSize)},`xlabel${l.value}`)),h.filter(l=>{const y=Math.abs(l.value%a.labelStep)<a.gridSize/10,f=Math.abs(l.value)>=a.labelStep/2;return y&&f}).filter((l,y,f)=>!f.slice(0,y).some(q=>Math.abs(q.value-l.value)<.001)).map(l=>e.jsx("text",{x:s({x:0,y:0}).x-15,y:l.y+4,textAnchor:"middle",fontSize:o(11),fontWeight:"500",opacity:Math.max(.7,c.opacity),children:Q(l.value,c.gridSize)},`ylabel${l.value}`)),e.jsxs("g",{children:[e.jsx("circle",{cx:s({x:0,y:0}).x,cy:s({x:0,y:0}).y,r:"3",fill:"#374151",opacity:"0.6"}),e.jsx("text",{x:s({x:0,y:0}).x-25,y:s({x:0,y:0}).y-10,fontSize:o(11),fontWeight:"600",fill:"#374151",opacity:Math.max(.8,c.opacity),children:"(0,0)"})]}),r.showDivisionAnswer&&z.map((l,y)=>{const f=s({x:1,y:0}).x;return e.jsxs("g",{children:[e.jsx("circle",{cx:f,cy:l.screenY,r:"4",fill:"white",stroke:"#60A5FA",strokeWidth:"2",opacity:"0.9"}),e.jsxs("text",{x:f+15,y:l.screenY+4,fontSize:o(10),fontWeight:"600",fill:"#60A5FA",opacity:"0.9",children:["y = ",l.y.toFixed(2)]})]},`ray-intersection-${y}`)})]})]})}const dt=[{code:"en",name:"English",nativeName:"English",direction:"ltr"},{code:"es",name:"Spanish",nativeName:"Español",direction:"ltr"},{code:"fr",name:"French",nativeName:"Français",direction:"ltr"},{code:"de",name:"German",nativeName:"Deutsch",direction:"ltr"},{code:"pt",name:"Portuguese",nativeName:"Português",direction:"ltr"},{code:"ja",name:"Japanese",nativeName:"日本語",direction:"ltr"},{code:"zh",name:"Chinese",nativeName:"中文",direction:"ltr"},{code:"ar",name:"Arabic",nativeName:"العربية",direction:"rtl"},{code:"hi",name:"Hindi",nativeName:"हिन्दी",direction:"ltr"}],is={"app.name":"Grix","toolbar.build":"Build","toolbar.examples":"Examples","tools.line":"Line Builder","tools.line.description":"Create and edit lines to explore slopes and fractions","tools.rectangle":"Rectangle Builder","tools.rectangle.description":"Create rectangles to explore area and multiplication","tools.circle":"Circle Builder","tools.circle.description":"Create circles to explore circumference and area","tools.triangle":"Triangle Builder","tools.triangle.description":"Create triangles to explore angles and trigonometry","tools.function":"Function Grapher","tools.function.description":"Create function graphs like parabolas, sine waves, and more","settings.title":"Visualization Settings","settings.resetAll":"Reset All","settings.allSettings":"All Settings","settings.sections.originLines":"Origin Lines","settings.sections.originLines.subtitle":"Enhancements for lines from (0,0)","settings.sections.divisionFractions":"Division & Fractions","settings.sections.divisionFractions.subtitle":"Visual fraction and division concepts","settings.sections.gridReference":"Grid & Reference","settings.sections.gridReference.subtitle":"Grid enhancements and reference lines","settings.sections.circlesConcepts":"Circle Concepts","settings.sections.circlesConcepts.subtitle":"Visual features for circles and curves","settings.sections.functionConcepts":"Function Concepts","settings.sections.functionConcepts.subtitle":"Mathematical function visualization features","settings.sections.triangleConcepts":"Triangle Concepts","settings.sections.triangleConcepts.subtitle":"Trigonometry and geometry learning features","settings.sections.rectangleConcepts":"Rectangle Concepts","settings.sections.rectangleConcepts.subtitle":"Educational features for rectangles and areas","settings.sections.display":"Display","settings.sections.display.subtitle":"Adjust visibility for classrooms and large screens","context.details":"Details","context.delete":"Delete","context.close":"Close","context.expand":"Expand","context.collapse":"Collapse","objects.line":"Line","objects.rectangle":"Rectangle","objects.circle":"Circle","objects.triangle":"Triangle","objects.function":"Function","math.slope":"slope","math.area":"area","math.radius":"radius","math.diameter":"diameter","math.circumference":"circumference","math.perimeter":"perimeter","math.angle":"angle","math.degrees":"degrees","actions.title":"Actions & Tools","actions.clearBoard":"Clear Board","actions.clearBoard.description":"Remove all shapes and reset settings","actions.exportSession":"Export Session","actions.exportSession.description":"Save your work as a file","actions.importSession":"Import Session","actions.importSession.description":"Load saved work from file","actions.exportImage":"Export Image","actions.exportImage.description":"Save as PNG (coming soon)","confirm.clearEverything":"Clear Everything?","confirm.clearEverything.message":"This will remove all shapes, reset settings, and clear your saved work. This action cannot be undone.","confirm.cancel":"Cancel","confirm.clearAll":"Clear All","tutorial.welcome.title":"Welcome to Grix! 🎯","tutorial.welcome.content":"Grix is a mathematical visualization platform where you can explore concepts like slopes, fractions, multiplication, and more through interactive graphics.","tutorial.examples.title":"Explore Examples 📚","tutorial.examples.content":"Click the 'Examples' button in the toolbar to load pre-made mathematical demonstrations. Perfect for getting started!","tutorial.settings.title":"Customize Visualizations ⚙️","tutorial.settings.content":"Use the 'Settings' button in the bottom-left to enable different mathematical features like equivalent fractions, area calculations, and more.","tutorial.tools.title":"Interactive Tools 🛠️","tutorial.tools.content":"Use the toolbar to draw lines and rectangles. Zoom with Ctrl+scroll wheel, and pan by scrolling. On mobile, use pinch gestures.","tutorial.skip":"Skip Tutorial","tutorial.next":"Next","tutorial.tryExample":"Try an Example!","tutorial.loading":"Loading...","tutorial.step":"Step","tutorial.of":"of","info.about":"About Grix","info.subtitle":"Mathematical Visualization Playground","info.description":"Grix is a playground-first mathematical grid system that scales from 3rd-grade fractions to professional linear algebra. Explore slopes, areas, trigonometry, functions, and more through interactive visual learning.","info.keyFeatures":"Key Features","info.features.interactive":"Interactive mathematical shapes and functions","info.features.realtime":"Real-time visualization of mathematical concepts","info.features.educational":"Educational features for fractions, geometry, and algebra","info.features.touch":"Touch-friendly interface for tablets and mobile devices","info.features.progressive":"Progressive complexity from elementary to advanced math","info.opensource":"Free & Open Source","info.opensource.description":"Grix is completely free to use and open source under the MIT License. Anyone can contribute, modify, or use it for any purpose including commercial.","info.viewGithub":"View on GitHub","info.contact":"Get in Touch","info.contact.description":"Have questions, suggestions, or want to contribute? We'd love to hear from you!","info.madeWith":"Made with ❤️ for mathematical learning","zoom.zoomIn":"Zoom in (Ctrl+scroll up)","zoom.zoomOut":"Zoom out (Ctrl+scroll down)","zoom.centerView":"Center view (single click) or Reset zoom (double click)","zoom.tip":"Tip:","zoom.tipMessage":"Double-tap this button to reset zoom level too!","error.loadExample":"Failed to load example","error.importFile":"Failed to import state. Please check the file format.","error.readFile":"Failed to read file. Please select a valid Grix export file.","common.loading":"Loading...","common.shapes":"shapes","common.shape":"shape","common.onCanvas":"on canvas","common.dismiss":"Dismiss permanently","translation.missing":"Translation needed"},Ft="en";class rs{constructor(){ie(this,"currentLanguage",Ft);ie(this,"translations",new Map);ie(this,"fallbackTranslations",is);ie(this,"isInitialized",!1);this.initialize()}async initialize(){try{await this.loadLanguage(Ft);const t=localStorage.getItem("grix-language");if(t&&dt.some(s=>s.code===t))await this.setLanguage(t);else{const s=navigator.language.split("-")[0];dt.some(n=>n.code===s)&&await this.setLanguage(s)}this.isInitialized=!0,window.dispatchEvent(new CustomEvent("translationsReady"))}catch(t){console.error("Failed to initialize translations:",t),this.isInitialized=!0,window.dispatchEvent(new CustomEvent("translationsReady"))}}async loadLanguage(t){try{if(this.translations.has(t))return!0;const s=await fetch(`/locales/${t}.json`);if(!s.ok)return console.warn(`Translation file for ${t} not found`),!1;const n=await s.json();return this.translations.set(t,n),!0}catch(s){return console.error(`Failed to load language ${t}:`,s),!1}}async setLanguage(t){if(await this.loadLanguage(t)){this.currentLanguage=t,localStorage.setItem("grix-language",t);const n=dt.find(r=>r.code===t);return n&&(document.documentElement.dir=n.direction),window.dispatchEvent(new CustomEvent("languageChanged",{detail:{language:t}})),!0}return!1}getCurrentLanguage(){return this.currentLanguage}getAvailableLanguages(){return dt}translate(t,s){const n=this.translations.get(this.currentLanguage);let r=n==null?void 0:n[t];return r||(r=this.fallbackTranslations[t]),r?(s&&Object.entries(s).forEach(([o,c])=>{r=r.replace(`{${o}}`,String(c))}),r):(console.warn(`Missing translation for key: ${t}`),t)}t(t,s){return this.translate(t,s)}hasTranslation(t){const s=this.translations.get(this.currentLanguage);return!!(s!=null&&s[t]||this.fallbackTranslations[t])}getAllTranslations(){return this.translations.get(this.currentLanguage)||this.fallbackTranslations}}const ht=new rs;function Xe(){const[i,t]=u.useState(ht.getCurrentLanguage()),[,s]=u.useState({});u.useEffect(()=>{const c=d=>{t(d.detail.language),s({})},a=()=>{s({})};return window.addEventListener("languageChanged",c),window.addEventListener("translationsReady",a),()=>{window.removeEventListener("languageChanged",c),window.removeEventListener("translationsReady",a)}},[]);const n=u.useCallback((c,a)=>ht.t(c,a),[i]),r=u.useCallback(async c=>await ht.setLanguage(c),[]),o=u.useCallback(()=>ht.getAvailableLanguages(),[]);return{t:n,language:i,changeLanguage:r,availableLanguages:o()}}function os({viewport:i,onZoomIn:t,onZoomOut:s,onZoomReset:n,onCenterOnly:r}){const{t:o}=Xe(),[c,a]=u.useState(0),d=u.useRef(null),h=()=>{const j=Date.now();j-c<500?(d.current&&(clearTimeout(d.current),d.current=null),n()):d.current=window.setTimeout(()=>{r(),d.current=null},300),a(j)};return u.useEffect(()=>()=>{d.current&&clearTimeout(d.current)},[]),e.jsxs("div",{className:"absolute bottom-4 right-4 flex flex-col gap-2",children:[e.jsx("button",{onClick:t,className:"w-10 h-10 bg-white/90 hover:bg-white border border-gray-300 rounded-lg shadow-md flex items-center justify-center text-gray-700 font-bold transition-colors",title:o("zoom.zoomIn"),disabled:i.zoom>=1e3,children:"+"}),e.jsx("button",{onClick:s,className:"w-10 h-10 bg-white/90 hover:bg-white border border-gray-300 rounded-lg shadow-md flex items-center justify-center text-gray-700 font-bold transition-colors",title:o("zoom.zoomOut"),disabled:i.zoom<=.01,children:"−"}),e.jsx("div",{className:"relative",children:e.jsx("button",{onClick:h,className:"w-10 h-10 bg-white/90 hover:bg-white border border-gray-300 rounded-lg shadow-md flex items-center justify-center text-gray-600 text-lg transition-colors",title:o("zoom.centerView"),children:"🏠"})}),e.jsxs("div",{className:`w-12 h-8 border rounded text-xs flex flex-col items-center justify-center transition-colors ${i.zoom<.5?"bg-red-50 border-red-200 text-red-700":i.zoom>100?"bg-orange-50 border-orange-200 text-orange-700":"bg-white/90 border-gray-300 text-gray-600"}`,children:[e.jsxs("div",{className:"font-semibold",children:[i.zoom>=1?Math.round(i.zoom):i.zoom.toFixed(1),"×"]}),i.zoom<.5&&e.jsx("div",{className:"text-[8px] leading-none",children:o("zoom.far")}),i.zoom>100&&e.jsx("div",{className:"text-[8px] leading-none",children:o("zoom.close")})]}),i.zoom<.5||i.zoom>100?e.jsx("button",{onClick:()=>n(),className:"w-10 h-6 bg-blue-500 hover:bg-blue-600 text-white text-xs rounded font-medium transition-colors",title:o("zoom.centerView"),children:o("zoom.fix")}):null]})}function as({objects:i,viewport:t,touchTargetSize:s,worldToScreen:n,selectedObjects:r=[],canvasSize:o}){const c=De(),a=g=>Math.round(g*c.fontScale),d=et(t,c.gridScale,c.snapPrecision),h=d,[j,z]=u.useState(null),[E,m]=u.useState(null),[D,U]=u.useState(null),[l,y]=u.useState(null),[f,q]=u.useState(null),[T,v]=u.useState(null),[X,G]=u.useState(null),[F,V]=u.useState(null),L=u.useRef(null);u.useEffect(()=>{const g=w=>{const ne=w.target;l&&!(ne!=null&&ne.closest("circle"))&&y(null)};if(l)return document.addEventListener("touchstart",g),()=>document.removeEventListener("touchstart",g)},[l]),u.useEffect(()=>()=>{L.current&&clearTimeout(L.current)},[]);const ee=g=>{var ne,xe;const w=r.includes(g.id);switch(g.type){case"ray":const Fe=n(g.properties.startPoint),ge=n(g.properties.endPoint);return e.jsxs("g",{children:[w&&e.jsx("line",{x1:Fe.x,y1:Fe.y,x2:ge.x,y2:ge.y,stroke:"#60A5FA",strokeWidth:6,opacity:.4}),e.jsx("line",{x1:Fe.x,y1:Fe.y,x2:ge.x,y2:ge.y,stroke:w?"#1D4ED8":"#2563eb",strokeWidth:w?3:2}),c.showCoordinateProjections&&Math.abs(g.properties.startPoint.x)<.001&&Math.abs(g.properties.startPoint.y)<.001&&e.jsxs(e.Fragment,{children:[e.jsx("line",{x1:ge.x,y1:ge.y,x2:ge.x,y2:n({x:g.properties.endPoint.x,y:0}).y,stroke:"#9CA3AF",strokeWidth:"1",strokeDasharray:"2,3",opacity:"0.6"}),e.jsx("line",{x1:ge.x,y1:ge.y,x2:n({x:0,y:g.properties.endPoint.y}).x,y2:ge.y,stroke:"#9CA3AF",strokeWidth:"1",strokeDasharray:"2,3",opacity:"0.6"})]}),e.jsxs("g",{children:[e.jsx("circle",{cx:Fe.x,cy:Fe.y,r:s/4,fill:w?"#1D4ED8":"#2563eb",stroke:w?"#60A5FA":"none",strokeWidth:w?2:0,style:{cursor:"move"}}),e.jsx("circle",{cx:Fe.x,cy:Fe.y,r:Math.max(12,s/2),fill:"transparent",style:{cursor:"move"},onMouseEnter:()=>z(`${g.id}-start`),onMouseLeave:()=>z(null)})]}),e.jsxs("g",{children:[e.jsx("circle",{cx:ge.x,cy:ge.y,r:s/4,fill:w?"#1D4ED8":"#2563eb",stroke:w?"#60A5FA":"none",strokeWidth:w?2:0,style:{cursor:"move"}}),e.jsx("circle",{cx:ge.x,cy:ge.y,r:Math.max(12,s/2),fill:"transparent",style:{cursor:"move"},onMouseEnter:()=>z(`${g.id}-end`),onMouseLeave:()=>z(null)})]}),!(Math.abs(g.properties.startPoint.x)<.001&&Math.abs(g.properties.startPoint.y)<.001)&&j===`${g.id}-start`&&e.jsxs("text",{x:Fe.x-5,y:Fe.y-10,fontSize:a(10),fontWeight:"500",fill:w?"#1D4ED8":"#2563eb",textAnchor:"middle",opacity:"0.8",style:{pointerEvents:"none"},children:["(",Q(g.properties.startPoint.x,h),","," ",Q(g.properties.startPoint.y,h),")"]}),j===`${g.id}-end`&&e.jsxs("text",{x:Math.abs(g.properties.startPoint.x)<.001&&Math.abs(g.properties.startPoint.y)<.001?ge.x-20:ge.x+5,y:(()=>{const k=Math.abs(g.properties.startPoint.x)<.001&&Math.abs(g.properties.startPoint.y)<.001;return ge.y-10})(),fontSize:a(10),fontWeight:"500",fill:w?"#1D4ED8":"#2563eb",textAnchor:Math.abs(g.properties.startPoint.x)<.001&&Math.abs(g.properties.startPoint.y)<.001?"end":"middle",opacity:"0.8",style:{pointerEvents:"none"},children:["(",Q(g.properties.endPoint.x,h),","," ",Q(g.properties.endPoint.y,h),")"]}),(()=>{const k=g.properties.endPoint.x-g.properties.startPoint.x;g.properties.endPoint.y-g.properties.startPoint.y;const x=Math.abs(g.properties.startPoint.x)<.001&&Math.abs(g.properties.startPoint.y)<.001;if(Math.abs(k)>.001){const C=ge.x,B=ge.y;if(x){const S=g.properties.endPoint.x,M=g.properties.endPoint.y,R=Q(M,h),N=Q(S,h);return e.jsxs("g",{children:[e.jsx("text",{x:C+15,y:B-25,fontSize:a(9),fontWeight:"500",fill:w?"#1D4ED8":"#2563eb",textAnchor:"middle",opacity:"0.8",children:R}),e.jsx("line",{x1:C+8,y1:B-19,x2:C+22,y2:B-19,stroke:w?"#1D4ED8":"#2563eb",strokeWidth:"1",opacity:"0.8"}),e.jsx("text",{x:C+15,y:B-9,fontSize:a(9),fontWeight:"500",fill:w?"#1D4ED8":"#2563eb",textAnchor:"middle",opacity:"0.8",children:N})]})}else return null}return null})(),(()=>{if(!(Math.abs(g.properties.startPoint.x)<.001&&Math.abs(g.properties.startPoint.y)<.001))return null;const x=g.properties.endPoint.x,C=g.properties.endPoint.y;if(Math.abs(x)<.001&&Math.abs(C)<.001)return null;const B=x,S=C,M={left:t.center.x-o.width/2/t.zoom,right:t.center.x+o.width/2/t.zoom,top:t.center.y+o.height/2/t.zoom,bottom:t.center.y-o.height/2/t.zoom},R=Math.max(Math.abs(M.left),Math.abs(M.right),Math.abs(M.top),Math.abs(M.bottom))*2,N=Math.sqrt(B*B+S*S);if(N===0)return null;const p=B/N,A=S/N,O={x:R*p,y:R*A},W=n(O),I=[];if(Math.abs(x)>.001&&Math.abs(C)>.001){const P=x,_=C;for(let Y=2;Y<=50;Y++){const H=P*Y,J=_*Y,le=Math.round(H/d)*d,ue=Math.round(J/d)*d;if(Math.abs(H-le)<d/10&&Math.abs(J-ue)<d/10&&le>0&&ue>0&&le<=Math.min(100,Math.abs(R))&&ue<=Math.min(100,Math.abs(R))){const Ee=n({x:le,y:ue});Ee.x>=-100&&Ee.x<=o.width+100&&Ee.y>=-100&&Ee.y<=o.height+100&&I.push({world:{x:le,y:ue},screen:Ee,fraction:{num:Q(ue,d),den:Q(le,d)}})}}}const se=Math.sqrt(x*x+C*C),te=[];if(se>0&&c.showLengthMultiples)for(let P=2;P<=5;P++){const _=x*P,Y=C*P,H=n({x:_,y:Y});H.x>=-50&&H.x<=o.width+50&&H.y>=-50&&H.y<=o.height+50&&te.push({screen:H,multiple:P})}return e.jsxs("g",{children:[c.showEquivalentFractions&&e.jsx("line",{x1:ge.x,y1:ge.y,x2:W.x,y2:W.y,stroke:w?"#1D4ED8":"#2563eb",strokeWidth:"1",opacity:"0.3",strokeDasharray:"3,3"}),te.map((P,_)=>e.jsxs("g",{children:[e.jsx("circle",{cx:P.screen.x,cy:P.screen.y,r:"2",fill:w?"#1D4ED8":"#2563eb",opacity:"0.4",style:{pointerEvents:"none"}}),e.jsxs("text",{x:P.screen.x+8,y:P.screen.y-8,fontSize:a(7),fontWeight:"400",fill:w?"#1D4ED8":"#2563eb",textAnchor:"start",opacity:"0.5",style:{pointerEvents:"none"},children:["×",P.multiple]})]},`length-${_}`)),c.showAreaRectangle&&(()=>{if(x>0&&C>0){const P=n({x:0,y:0}),_=n({x,y:C}),Y=Math.abs(_.x-P.x),H=Math.abs(_.y-P.y),J=Math.min(P.x,_.x),le=Math.min(P.y,_.y),ue=x*C;return e.jsxs("g",{children:[e.jsx("rect",{x:J,y:le,width:Y,height:H,fill:w?"#1D4ED8":"#2563eb",opacity:"0.08",stroke:w?"#1D4ED8":"#2563eb",strokeWidth:"0.5",strokeOpacity:"0.15"}),e.jsxs("text",{x:J+Y/2,y:le+15,fontSize:a(10),fontWeight:"400",fill:w?"#1D4ED8":"#2563eb",textAnchor:"middle",opacity:"0.6",children:[Q(C,h)," ×"," ",Q(x,h)," ="," ",Q(ue,h)]})]})}return null})(),c.showDivisionMultiples&&c.showDivisionAnswer&&(()=>{if(!(Math.abs(g.properties.startPoint.x)<.001&&Math.abs(g.properties.startPoint.y)<.001)||x<=0)return null;const _=C/x,Y=.15,H=25;if(_<Y)return null;const J=n({x:0,y:0}),le=n({x:1,y:0}),ue=[],Ee=Math.min(Math.floor(C/_),H);for(let Ce=1;Ce<=Ee;Ce++){const Pe=Ce*_,Ie=n({x:0,y:Pe}).y,Le=Math.abs(Pe-_)<.01;if(!c.showAreaRectangle){const Se=Math.abs(Ie-J.y)/Ce,je=Math.abs(le.x-J.x);ue.push(e.jsx("rect",{x:J.x,y:Ie,width:je,height:Se,fill:w?"#1D4ED8":"#2563eb",opacity:"0.08",stroke:w?"#1D4ED8":"#2563eb",strokeWidth:"0.5",strokeOpacity:"0.15"},`division-box-${Ce}`))}ue.push(e.jsxs("g",{children:[e.jsx("line",{x1:J.x,y1:Ie,x2:le.x,y2:Ie,stroke:w?"#1D4ED8":"#2563eb",strokeWidth:"1",opacity:"0.3",strokeDasharray:Le?"4,2":"2,2"}),!Le&&e.jsx("text",{x:le.x+8,y:Ie-5,fontSize:a(8),fontWeight:"400",fill:w?"#1D4ED8":"#2563eb",textAnchor:"start",opacity:"0.5",children:be(Pe)})]},`division-marker-${Ce}`))}return e.jsx("g",{children:ue})})(),c.showRiseRunTriangle&&(()=>{if(x>0&&C>0){const P=n({x:0,y:0}),_=n({x,y:0}),Y=n({x,y:C});return e.jsxs("g",{children:[e.jsx("path",{d:`M ${P.x},${P.y} L ${_.x},${_.y} L ${Y.x},${Y.y} Z`,fill:"none",stroke:w?"#1D4ED8":"#2563eb",strokeWidth:"1",opacity:"0.4",strokeDasharray:"2,2",style:{pointerEvents:"none"}}),e.jsxs("text",{x:_.x+12,y:(_.y+Y.y)/2,fontSize:a(9),fontWeight:"500",fill:w?"#1D4ED8":"#2563eb",textAnchor:"start",opacity:"0.7",style:{pointerEvents:"none"},children:["rise: ",Q(C,h)]}),e.jsxs("text",{x:(P.x+_.x)/2,y:_.y+10,fontSize:a(9),fontWeight:"500",fill:w?"#1D4ED8":"#2563eb",textAnchor:"middle",opacity:"0.7",style:{pointerEvents:"none"},children:["run: ",Q(x,h)]})]})}return null})(),c.showDistanceMarkers&&(()=>{const P=[],_=Math.sqrt(x*x+C*C);if(_>0){const Y=n({x:0,y:0});let H=Math.atan2(C,x);H<0&&(H=H+2*Math.PI);const J=[];for(let ue=1;ue<=Math.floor(_);ue++)J.push({radius:ue,isUnit:!0});J.push({radius:_,isUnit:!1}),J.forEach(({radius:ue,isUnit:Ee},Ce)=>{const Pe=ue*t.zoom;if(Pe>=15&&Pe<=800&&Math.abs(H)>.05){const Ie=H>Math.PI?1:0,Se=`M ${Y.x+Pe},${Y.y} A ${Pe},${Pe} 0 ${Ie},0 ${Y.x+Pe*Math.cos(H)},${Y.y-Pe*Math.sin(H)}`;P.push(e.jsx("path",{d:Se,fill:"none",stroke:w?"#1D4ED8":"#2563eb",strokeWidth:Ee?"1":"1.5",opacity:Ee?"0.3":"0.6",strokeDasharray:Ee?"2,2":"none"},`radial-${g.id}-${ue.toFixed(3)}-${H.toFixed(3)}-${Ce}`))}});const le=n({x:_,y:0});P.push(e.jsxs("g",{children:[e.jsx("path",{d:`M ${le.x},${Y.y} L ${le.x-4},${Y.y+8} L ${le.x+4},${Y.y+8} Z`,fill:w?"#1D4ED8":"#2563eb",opacity:"0.7"}),e.jsxs("text",{x:le.x+15,y:Y.y-8,fontSize:a(10),fontWeight:"600",fill:w?"#1D4ED8":"#2563eb",textAnchor:"start",opacity:"0.8",children:["d = ",_.toFixed(3).replace(/\.?0+$/,"")]})]},`distance-${g.id}`))}return e.jsx("g",{children:P})})(),c.showAngleArc&&(()=>{let P=Math.atan2(C,x);if(P<0&&(P=P+2*Math.PI),Math.abs(x)>.05||Math.abs(C)>.05){const _=n({x:0,y:0}),Y=50,H=(P*180/Math.PI).toFixed(1),J=P,le=P>Math.PI?1:0,ue=`M ${_.x+Y},${_.y} A ${Y},${Y} 0 ${le},0 ${_.x+Y*Math.cos(J)},${_.y-Y*Math.sin(J)}`,Ee=P/2,Ce=Y*.7,Pe=_.x+Ce*Math.cos(Ee),Ie=_.y-Ce*Math.sin(Ee);return e.jsxs("g",{children:[e.jsx("path",{d:ue,fill:"none",stroke:w?"#1D4ED8":"#2563eb",strokeWidth:"2",opacity:"0.6"}),e.jsxs("text",{x:Pe,y:Ie,fontSize:a(11),fontWeight:"600",fill:w?"#1D4ED8":"#2563eb",textAnchor:"middle",opacity:"0.8",children:["θ = ",H,"°"]})]})}return null})(),c.showEquivalentFractions&&I.map((P,_)=>{const H=Math.abs(P.world.x-1)<.1&&c.showDivisionAnswer,J=Math.abs(P.world.x-x)<.1&&Math.abs(P.world.y-C)<.1;return H||J?null:e.jsxs("g",{children:[e.jsx("circle",{cx:P.screen.x,cy:P.screen.y,r:"4",fill:"white",stroke:"#22C55E",strokeWidth:"2",opacity:"0.8",style:{pointerEvents:"none"}}),e.jsxs("text",{x:P.screen.x+15,y:P.screen.y+4,fontSize:a(9),fontWeight:"500",fill:"#22C55E",textAnchor:"start",opacity:"0.8",style:{pointerEvents:"none"},children:[P.fraction.num,"/",P.fraction.den]})]},`equiv-${_}`)})]})})()]},g.id);case"rectangle":const $=n({x:g.properties.x,y:g.properties.y+g.properties.height}),ce=g.properties.width*t.zoom,b=g.properties.height*t.zoom,Z={x:g.properties.x,y:g.properties.y},de={x:g.properties.x+g.properties.width,y:g.properties.y},fe={x:g.properties.x,y:g.properties.y+g.properties.height},Oe={x:g.properties.x+g.properties.width,y:g.properties.y+g.properties.height};return e.jsxs("g",{children:[w&&e.jsx("rect",{x:$.x-3,y:$.y-3,width:ce+6,height:b+6,fill:"none",stroke:"#60A5FA",strokeWidth:4,opacity:.5,style:{cursor:"pointer"}}),e.jsx("rect",{x:$.x,y:$.y,width:ce,height:b,fill:w?"rgba(34, 197, 94, 0.3)":"rgba(34, 197, 94, 0.2)",stroke:w?"#16A34A":"#22c55e",strokeWidth:w?3:2,style:{cursor:"pointer"}}),e.jsxs("g",{children:[e.jsx("circle",{cx:$.x,cy:$.y,r:Math.max(6,s/6),fill:w?"#16A34A":"#22c55e",stroke:w?"#60A5FA":"none",strokeWidth:w?2:0,style:{cursor:"nw-resize"}}),e.jsx("circle",{cx:$.x,cy:$.y,r:s/2,fill:"transparent",style:{cursor:"nw-resize"}})]}),e.jsxs("g",{children:[e.jsx("circle",{cx:$.x+ce,cy:$.y,r:Math.max(6,s/6),fill:w?"#16A34A":"#22c55e",stroke:w?"#60A5FA":"none",strokeWidth:w?2:0,style:{cursor:"ne-resize"}}),e.jsx("circle",{cx:$.x+ce,cy:$.y,r:s/2,fill:"transparent",style:{cursor:"ne-resize"}})]}),e.jsxs("g",{children:[e.jsx("circle",{cx:$.x,cy:$.y+b,r:Math.max(6,s/6),fill:w?"#16A34A":"#22c55e",stroke:w?"#60A5FA":"none",strokeWidth:w?2:0,style:{cursor:"sw-resize"}}),e.jsx("circle",{cx:$.x,cy:$.y+b,r:s/2,fill:"transparent",style:{cursor:"sw-resize"}})]}),e.jsxs("g",{children:[e.jsx("circle",{cx:$.x+ce,cy:$.y+b,r:Math.max(6,s/6),fill:w?"#16A34A":"#22c55e",stroke:w?"#60A5FA":"none",strokeWidth:w?2:0,style:{cursor:"se-resize"}}),e.jsx("circle",{cx:$.x+ce,cy:$.y+b,r:s/2,fill:"transparent",style:{cursor:"se-resize"}})]}),e.jsxs("text",{x:$.x-10,y:$.y-5,fontSize:a(9),fontWeight:"500",fill:"#22c55e",textAnchor:"end",opacity:"0.8",children:["(",Q(fe.x,h),","," ",Q(fe.y,h),")"]}),e.jsxs("text",{x:$.x+ce+10,y:$.y-5,fontSize:a(9),fontWeight:"500",fill:"#22c55e",textAnchor:"start",opacity:"0.8",children:["(",Q(Oe.x,h),","," ",Q(Oe.y,h),")"]}),e.jsxs("text",{x:$.x-10,y:$.y+b+15,fontSize:a(9),fontWeight:"500",fill:"#22c55e",textAnchor:"end",opacity:"0.8",children:["(",Q(Z.x,h),","," ",Q(Z.y,h),")"]}),e.jsxs("text",{x:$.x+ce+10,y:$.y+b+15,fontSize:a(9),fontWeight:"500",fill:"#22c55e",textAnchor:"start",opacity:"0.8",children:["(",Q(de.x,h),","," ",Q(de.y,h),")"]}),e.jsxs("text",{x:$.x+ce/2,y:$.y+b/2,fontSize:a(12),fontWeight:"600",fill:"#22c55e",textAnchor:"middle",opacity:"0.9",children:[Q(g.properties.height,h)," ×"," ",Q(g.properties.width,h)," ="," ",Q(g.properties.area,h)]}),(()=>{const k=g.properties.width,x=g.properties.height,C=g.properties.area;if(k<=0||x<=0||k!==Math.floor(k)||x!==Math.floor(x))return null;const B=[];if(c.showFactorPairs&&C>1&&C<=50){const S=[];for(let M=1;M<=Math.sqrt(C);M++)if(C%M===0){const R=C/M;(M!==k||R!==x)&&S.push({w:M,h:R})}S.forEach((M,R)=>{const N=(R+1)*(ce+20),p={x:$.x+N,y:$.y,width:M.w*t.zoom,height:M.h*t.zoom};B.push(e.jsx("rect",{x:p.x,y:p.y,width:p.width,height:p.height,fill:"rgba(168, 85, 247, 0.15)",stroke:"#A855F7",strokeWidth:"1",strokeDasharray:"3,3",opacity:"0.7"},`factor-${R}`))})}if(c.showCommutativeProperty&&k!==x){const S={x:$.x-b-30,y:$.y,width:x*t.zoom,height:k*t.zoom};B.push(e.jsxs("g",{children:[e.jsx("rect",{x:S.x,y:S.y,width:S.width,height:S.height,fill:"rgba(59, 130, 246, 0.15)",stroke:"#3B82F6",strokeWidth:"1",strokeDasharray:"4,2",opacity:"0.7"}),e.jsx("path",{d:`M ${S.x+S.width+5},${S.y+S.height/2} L ${$.x-5},${$.y+b/2}`,stroke:"#3B82F6",strokeWidth:"1",fill:"none",markerEnd:"url(#arrowhead)",opacity:"0.6"})]},"commutative"))}if(c.showPrimeComposite&&C>1&&C<=100){const S=C>1&&![...Array(Math.floor(Math.sqrt(C))+1).keys()].slice(2).some(M=>C%M===0);B.push(e.jsxs("g",{children:[e.jsx("circle",{cx:$.x+ce+15,cy:$.y-15,r:"8",fill:S?"#10B981":"#F59E0B",opacity:"0.8"}),e.jsx("text",{x:$.x+ce+15,y:$.y-11,fontSize:a(8),fontWeight:"600",fill:"white",textAnchor:"middle",children:S?"P":"C"}),e.jsx("text",{x:$.x+ce+30,y:$.y-10,fontSize:a(8),fontWeight:"500",fill:S?"#10B981":"#F59E0B",textAnchor:"start",opacity:"0.8",children:S?"Prime":"Composite"})]},"prime-composite"))}if(c.showGCF&&k>1&&x>1){const S=(R,N)=>N===0?R:S(N,R%N),M=S(k,x);if(M>1){const R=M*t.zoom,N=k/M,p=x/M,A=[];for(let O=0;O<N;O++)for(let W=0;W<p;W++)A.push(e.jsx("rect",{x:$.x+O*R,y:$.y+W*R,width:R,height:R,fill:"none",stroke:"#10B981",strokeWidth:"1.5",opacity:"0.6"},`gcf-${O}-${W}`));B.push(e.jsxs("g",{children:[A,e.jsxs("text",{x:$.x+ce/2,y:$.y-25,fontSize:a(10),fontWeight:"600",fill:"#10B981",textAnchor:"middle",opacity:"0.9",children:["GCF(",k,", ",x,") = ",M]}),e.jsxs("text",{x:$.x+ce/2,y:$.y-10,fontSize:a(8),fontWeight:"500",fill:"#10B981",textAnchor:"middle",opacity:"0.7",children:[p," × ",N," squares (side = ",M,")"]})]},"gcf"))}}if(c.showLCM&&k>1&&x>1){const S=(N,p)=>p===0?N:S(p,N%p),R=((N,p)=>N*p/S(N,p))(k,x);if(R>Math.max(k,x)&&R<=100){const N=R*t.zoom,p=R*t.zoom,A=$.x,O=$.y+b-p,W=R/k,I=R/x,se=[];for(let te=0;te<I;te++)for(let P=0;P<W;P++){const _=A+P*(k*t.zoom),Y=O+te*(x*t.zoom);se.push(e.jsx("rect",{x:_,y:Y,width:k*t.zoom,height:x*t.zoom,fill:"rgba(245, 158, 11, 0.1)",stroke:"#F59E0B",strokeWidth:"1",strokeDasharray:"2,2",opacity:"0.6",pointerEvents:"none"},`shadow-${te}-${P}`))}B.push(e.jsxs("g",{children:[e.jsx("rect",{x:A,y:O,width:N,height:p,fill:"none",stroke:"#F59E0B",strokeWidth:"2",strokeDasharray:"5,5",opacity:"0.8",pointerEvents:"none"}),se,e.jsxs("text",{x:A+N/2,y:O-15,fontSize:a(10),fontWeight:"600",fill:"#F59E0B",textAnchor:"middle",opacity:"0.9",pointerEvents:"none",children:["LCM(",k,", ",x,") = ",R]}),e.jsxs("text",{x:A+N/2,y:O-2,fontSize:a(8),fontWeight:"500",fill:"#F59E0B",textAnchor:"middle",opacity:"0.7",pointerEvents:"none",children:[W," × ",I," ="," ",W*I," rectangles"]})]},"lcm"))}}if(c.showDistributiveProperty&&k>2&&x>1){const S=Math.floor(k/2),M=S*t.zoom,R=(k-S)*t.zoom;B.push(e.jsxs("g",{children:[e.jsx("line",{x1:$.x+M,y1:$.y,x2:$.x+M,y2:$.y+b,stroke:"#EF4444",strokeWidth:"2",opacity:"0.8"}),e.jsxs("text",{x:$.x+M/2,y:$.y+b+20,fontSize:a(9),fontWeight:"500",fill:"#EF4444",textAnchor:"middle",opacity:"0.8",children:[x," × ",S," = ",x*S]}),e.jsxs("text",{x:$.x+M+R/2,y:$.y+b+20,fontSize:a(9),fontWeight:"500",fill:"#EF4444",textAnchor:"middle",opacity:"0.8",children:[x," × ",k-S," = ",x*(k-S)]}),e.jsxs("text",{x:$.x+ce/2,y:$.y+b+40,fontSize:a(10),fontWeight:"600",fill:"#EF4444",textAnchor:"middle",opacity:"0.9",children:[x," × (",S," + ",k-S,") = ",x*S," ","+ ",x*(k-S)," = ",C]})]},"distributive"))}return B})()]},g.id);case"circle":const K=n(g.properties.center),ke=g.properties.radius*t.zoom,Re=c.showTangentLines&&(D===g.id&&E||l&&l.circleId===g.id);let oe=null;if(Re){let k=null;if(l&&l.circleId===g.id?k=l.point:E&&D===g.id&&(k={x:(E.x-o.width/2)/t.zoom+t.center.x,y:-(E.y-o.height/2)/t.zoom+t.center.y}),k){const x=k.x-g.properties.center.x,C=k.y-g.properties.center.y,B=Math.atan2(C,x),S={x:g.properties.center.x+g.properties.radius*Math.cos(B),y:g.properties.center.y+g.properties.radius*Math.sin(B)},M=C/x,R=isFinite(M)&&M!==0?-1/M:null,N=Math.max(o.width,o.height)/t.zoom,p={x:S.x-N*Math.cos(B+Math.PI/2),y:S.y-N*Math.sin(B+Math.PI/2)},A={x:S.x+N*Math.cos(B+Math.PI/2),y:S.y+N*Math.sin(B+Math.PI/2)};oe={point:S,start:p,end:A,slope:R,angle:B}}}return e.jsxs("g",{children:[w&&e.jsx("circle",{cx:K.x,cy:K.y,r:ke+3,fill:"none",stroke:"#60A5FA",strokeWidth:4,opacity:.5}),e.jsx("circle",{cx:K.x,cy:K.y,r:ke*1.8,fill:"transparent",style:{cursor:"pointer"},onMouseEnter:()=>{L.current&&(clearTimeout(L.current),L.current=null),U(g.id)},onMouseLeave:()=>{L.current=setTimeout(()=>{U(null),m(null)},100)},onMouseMove:k=>{var x;if(c.showTangentLines&&D===g.id){const C=(x=k.currentTarget.ownerSVGElement)==null?void 0:x.getBoundingClientRect();C&&m({x:k.clientX-C.left,y:k.clientY-C.top})}},onTouchStart:k=>{var x;if(c.showTangentLines){k.preventDefault();const C=(x=k.currentTarget.ownerSVGElement)==null?void 0:x.getBoundingClientRect();if(C&&k.touches[0]){const B={x:k.touches[0].clientX-C.left,y:k.touches[0].clientY-C.top},S={x:(B.x-o.width/2)/t.zoom+t.center.x,y:-(B.y-o.height/2)/t.zoom+t.center.y},M=S.x-g.properties.center.x,N=(S.y-g.properties.center.y)/M,p=isFinite(N)?-1/N:null;y({circleId:g.id,point:S,slope:p})}}},onTouchEnd:()=>{setTimeout(()=>y(null),100)}}),e.jsx("circle",{cx:K.x,cy:K.y,r:ke,fill:w?"rgba(168, 85, 247, 0.15)":"rgba(168, 85, 247, 0.1)",stroke:w?"#7C3AED":"#A855F7",strokeWidth:w?3:2,style:{cursor:"pointer",pointerEvents:"none"}}),oe&&e.jsxs("g",{children:[e.jsx("line",{x1:n(oe.start).x,y1:n(oe.start).y,x2:n(oe.end).x,y2:n(oe.end).y,stroke:"#EF4444",strokeWidth:"2",opacity:"0.7",strokeDasharray:"4,2"}),e.jsx("circle",{cx:n(oe.point).x,cy:n(oe.point).y,r:"3",fill:"#EF4444",opacity:"0.8"}),e.jsx("line",{x1:K.x,y1:K.y,x2:n(oe.point).x,y2:n(oe.point).y,stroke:"#EF4444",strokeWidth:"1",opacity:"0.5",strokeDasharray:"2,2"}),oe.slope!==null&&isFinite(oe.slope)&&e.jsxs("text",{x:n(oe.point).x+15,y:n(oe.point).y-10,fontSize:a(10),fontWeight:"500",fill:"#EF4444",textAnchor:"start",opacity:"0.9",children:["slope = ",oe.slope.toFixed(2)]}),(oe.slope===null||!isFinite(oe.slope))&&e.jsx("text",{x:n(oe.point).x+15,y:n(oe.point).y-10,fontSize:a(10),fontWeight:"500",fill:"#EF4444",textAnchor:"start",opacity:"0.9",children:"slope = ∞"})]}),e.jsx("circle",{cx:K.x,cy:K.y,r:s/6,fill:w?"#7C3AED":"#A855F7",stroke:w?"#60A5FA":"none",strokeWidth:w?2:0,style:{cursor:"move"}}),e.jsx("circle",{cx:K.x+ke,cy:K.y,r:s/6,fill:w?"#7C3AED":"#A855F7",stroke:w?"#60A5FA":"none",strokeWidth:w?2:0,style:{cursor:"ew-resize"}}),e.jsx("line",{x1:K.x,y1:K.y,x2:K.x+ke,y2:K.y,stroke:w?"#7C3AED":"#A855F7",strokeWidth:"1",opacity:"0.6",strokeDasharray:"2,2"}),e.jsxs("text",{x:K.x,y:K.y-ke-25,fontSize:a(10),fontWeight:"500",fill:w?"#7C3AED":"#A855F7",textAnchor:"middle",opacity:"0.8",children:["r = ",be(g.properties.radius)]}),e.jsxs("text",{x:K.x,y:K.y-ke-15,fontSize:a(9),fontWeight:"400",fill:w?"#7C3AED":"#A855F7",textAnchor:"middle",opacity:"0.7",children:["A = ",be(g.properties.area)]}),e.jsxs("text",{x:K.x,y:K.y-ke-5,fontSize:a(9),fontWeight:"400",fill:w?"#7C3AED":"#A855F7",textAnchor:"middle",opacity:"0.7",children:["C = ",be(g.properties.circumference)]})]},g.id);case"triangle":const re=g.properties.vertices.map(n),[me,ye,ve]=re,$e=g.properties.vertices,pe=(()=>{const[k,x,C]=$e,B=Math.sqrt((x.x-C.x)**2+(x.y-C.y)**2),S=Math.sqrt((k.x-C.x)**2+(k.y-C.y)**2),M=Math.sqrt((k.x-x.x)**2+(k.y-x.y)**2),R=Math.acos((S**2+M**2-B**2)/(2*S*M))*180/Math.PI,N=Math.acos((B**2+M**2-S**2)/(2*B*M))*180/Math.PI,p=180-R-N,A=1;let O="scalene",W=!1,I=!1,se="";Math.abs(R-90)<A||Math.abs(N-90)<A||Math.abs(p-90)<A?(W=!0,O="right"):R>90||N>90||p>90?O="obtuse":O="acute",Math.abs(B-S)<.1&&Math.abs(S-M)<.1?O="equilateral":(Math.abs(B-S)<.1||Math.abs(S-M)<.1||Math.abs(B-M)<.1)&&(O="isosceles");const te=[R,N,p].sort((P,_)=>P-_);return Math.abs(te[0]-30)<A&&Math.abs(te[1]-60)<A&&Math.abs(te[2]-90)<A?(I=!0,se="30-60-90"):Math.abs(te[0]-45)<A&&Math.abs(te[1]-45)<A&&Math.abs(te[2]-90)<A&&(I=!0,se="45-45-90"),{sideA:B,sideB:S,sideC:M,angleA:R,angleB:N,angleC:p,classification:O,isRight:W,isSpecial:I,specialType:se,area:g.properties.area}})(),he=(()=>{if(!c.showSOHCAHTOA||!pe.isRight)return null;const k=[{index:0,value:pe.angleA},{index:1,value:pe.angleB},{index:2,value:pe.angleC}],x=k.find(N=>Math.abs(N.value-90)<1),C=k.filter(N=>N.value<89);if(!x||C.length<2)return null;const B=C.reduce((N,p)=>p.value>N.value?p:N),S=x.index,M=B.index,R=[0,1,2].find(N=>N!==S&&N!==M);return{referenceAngle:B,rightVertex:S,refVertex:M,thirdVertex:R,hypotenuseStart:M,hypotenuseEnd:R,oppositeStart:S,oppositeEnd:R,adjacentStart:M,adjacentEnd:S}})();return e.jsxs("g",{children:[c.showSpecialTriangles&&pe.isSpecial&&e.jsx("path",{d:`M ${me.x},${me.y} L ${ye.x},${ye.y} L ${ve.x},${ve.y} Z`,fill:"rgba(255, 215, 0, 0.15)",stroke:"none"}),w&&e.jsx("path",{d:`M ${me.x},${me.y} L ${ye.x},${ye.y} L ${ve.x},${ve.y} Z`,fill:"none",stroke:"#60A5FA",strokeWidth:6,opacity:.4}),e.jsx("path",{d:`M ${me.x},${me.y} L ${ye.x},${ye.y} L ${ve.x},${ve.y} Z`,fill:w?"rgba(245, 101, 101, 0.15)":"rgba(245, 101, 101, 0.1)",stroke:w?"#DC2626":"#F56565",strokeWidth:w?3:2,style:{cursor:"pointer"},onMouseEnter:()=>{c.showTrigValues&&q(g.id)},onMouseLeave:()=>{q(null),v(null)},onMouseMove:k=>{var x;if(c.showTrigValues&&f===g.id){const C=(x=k.currentTarget.ownerSVGElement)==null?void 0:x.getBoundingClientRect();C&&v({x:k.clientX-C.left,y:k.clientY-C.top})}}}),he&&e.jsxs("g",{children:[e.jsx("circle",{cx:re[he.referenceAngle.index].x,cy:re[he.referenceAngle.index].y,r:"8",fill:"rgba(255, 215, 0, 0.3)",stroke:"#FFA500",strokeWidth:"2"}),e.jsxs("g",{children:[e.jsx("line",{x1:re[he.hypotenuseStart].x,y1:re[he.hypotenuseStart].y,x2:re[he.hypotenuseEnd].x,y2:re[he.hypotenuseEnd].y,stroke:"#00AA00",strokeWidth:"5",opacity:"0.8"}),e.jsx("text",{x:(re[he.hypotenuseStart].x+re[he.hypotenuseEnd].x)/2,y:(re[he.hypotenuseStart].y+re[he.hypotenuseEnd].y)/2-15,fontSize:a(11),fontWeight:"700",fill:"#00AA00",textAnchor:"middle",children:"HYPOTENUSE"}),e.jsx("line",{x1:re[he.oppositeStart].x,y1:re[he.oppositeStart].y,x2:re[he.oppositeEnd].x,y2:re[he.oppositeEnd].y,stroke:"#FF0000",strokeWidth:"4",opacity:"0.8"}),e.jsx("text",{x:(re[he.oppositeStart].x+re[he.oppositeEnd].x)/2+15,y:(re[he.oppositeStart].y+re[he.oppositeEnd].y)/2,fontSize:a(10),fontWeight:"600",fill:"#FF0000",textAnchor:"middle",children:"OPPOSITE"}),e.jsx("line",{x1:re[he.adjacentStart].x,y1:re[he.adjacentStart].y,x2:re[he.adjacentEnd].x,y2:re[he.adjacentEnd].y,stroke:"#0000FF",strokeWidth:"4",opacity:"0.8"}),e.jsx("text",{x:(re[he.adjacentStart].x+re[he.adjacentEnd].x)/2,y:(re[he.adjacentStart].y+re[he.adjacentEnd].y)/2+20,fontSize:a(10),fontWeight:"600",fill:"#0000FF",textAnchor:"middle",children:"ADJACENT"}),e.jsxs("text",{x:re[he.refVertex].x,y:re[he.refVertex].y-25,fontSize:a(10),fontWeight:"700",fill:"#FFA500",textAnchor:"middle",children:["Reference Angle:"," ",he.referenceAngle.value.toFixed(1),"°"]})]})]}),c.showPythagoreanSquares&&pe.isRight&&e.jsx("g",{children:(()=>{var He;const k=(He=[{index:0,angle:pe.angleA},{index:1,angle:pe.angleB},{index:2,angle:pe.angleC}].find(Ae=>Math.abs(Ae.angle-90)<1))==null?void 0:He.index;if(k===void 0)return null;const x=$e[k],C=$e[(k+1)%3],B=$e[(k+2)%3],S=Math.sqrt((x.x-C.x)**2+(x.y-C.y)**2),M=Math.sqrt((x.x-B.x)**2+(x.y-B.y)**2),R=Math.sqrt((C.x-B.x)**2+(C.y-B.y)**2),N={x:(C.x-x.x)/S,y:(C.y-x.y)/S},p={x:(B.x-x.x)/M,y:(B.y-x.y)/M},A={x:(B.x-C.x)/R,y:(B.y-C.y)/R},O=(Ae,ze,Ge,Ve)=>{const Ye=(lt,qt,gt)=>(lt.x-gt.x)*(qt.y-gt.y)-(qt.x-gt.x)*(lt.y-gt.y),st=Ye(Ae,ze,Ge),ct=Ye(Ae,Ge,Ve),Be=Ye(Ae,Ve,ze),xt=st<0||ct<0||Be<0,We=st>0||ct>0||Be>0;return!(xt&&We)},W={x:-N.y,y:N.x},I={x:N.y,y:-N.x},se={x:-p.y,y:p.x},te={x:p.y,y:-p.x},P={x:-A.y,y:A.x},_={x:A.y,y:-A.x},Y={x:x.x+S*W.x*.1,y:x.y+S*W.y*.1};x.x+S*I.x*.1,x.y+S*I.y*.1;const H=O(Y,x,C,B)?I:W,J={x:x.x+M*se.x*.1,y:x.y+M*se.y*.1};x.x+M*te.x*.1,x.y+M*te.y*.1;const le=O(J,x,C,B)?te:se,ue={x:(C.x+B.x)/2,y:(C.y+B.y)/2},Ee={x:ue.x+R*P.x*.1,y:ue.y+R*P.y*.1},Ce=O(Ee,x,C,B)?_:P,Pe=[x,{x:x.x+S*N.x,y:x.y+S*N.y},{x:x.x+S*N.x+S*H.x,y:x.y+S*N.y+S*H.y},{x:x.x+S*H.x,y:x.y+S*H.y}],Ie=[x,{x:x.x+M*p.x,y:x.y+M*p.y},{x:x.x+M*p.x+M*le.x,y:x.y+M*p.y+M*le.y},{x:x.x+M*le.x,y:x.y+M*le.y}],Le=[C,B,{x:B.x+R*Ce.x,y:B.y+R*Ce.y},{x:C.x+R*Ce.x,y:C.y+R*Ce.y}],Se=Pe.map(n),je=Ie.map(n),Ne=Le.map(n);return e.jsxs("g",{children:[e.jsx("path",{d:`M ${Se[0].x},${Se[0].y} L ${Se[1].x},${Se[1].y} L ${Se[2].x},${Se[2].y} L ${Se[3].x},${Se[3].y} Z`,fill:"rgba(59, 130, 246, 0.3)",stroke:"#3B82F6",strokeWidth:"2",opacity:"0.8"}),e.jsxs("text",{x:(Se[0].x+Se[1].x+Se[2].x+Se[3].x)/4,y:(Se[0].y+Se[1].y+Se[2].y+Se[3].y)/4,fontSize:a(10),fontWeight:"600",fill:"#1D4ED8",textAnchor:"middle",children:["a² = ",(S**2).toFixed(1)]}),e.jsx("path",{d:`M ${je[0].x},${je[0].y} L ${je[1].x},${je[1].y} L ${je[2].x},${je[2].y} L ${je[3].x},${je[3].y} Z`,fill:"rgba(239, 68, 68, 0.3)",stroke:"#EF4444",strokeWidth:"2",opacity:"0.8"}),e.jsxs("text",{x:(je[0].x+je[1].x+je[2].x+je[3].x)/4,y:(je[0].y+je[1].y+je[2].y+je[3].y)/4,fontSize:a(10),fontWeight:"600",fill:"#DC2626",textAnchor:"middle",children:["b² = ",(M**2).toFixed(1)]}),e.jsx("path",{d:`M ${Ne[0].x},${Ne[0].y} L ${Ne[1].x},${Ne[1].y} L ${Ne[2].x},${Ne[2].y} L ${Ne[3].x},${Ne[3].y} Z`,fill:"rgba(34, 197, 94, 0.3)",stroke:"#22C55E",strokeWidth:"2",opacity:"0.8"}),e.jsxs("text",{x:(Ne[0].x+Ne[1].x+Ne[2].x+Ne[3].x)/4,y:(Ne[0].y+Ne[1].y+Ne[2].y+Ne[3].y)/4,fontSize:a(10),fontWeight:"600",fill:"#16A34A",textAnchor:"middle",children:["c² = ",(R**2).toFixed(1)]}),(()=>{const Ae={x:(me.x+ye.x+ve.x)/3,y:(me.y+ye.y+ve.y)/3},ze=[...Se,...je,...Ne],Ge=Math.min(...ze.map(We=>We.x)),Ve=Math.max(...ze.map(We=>We.x)),Ye=Math.min(...ze.map(We=>We.y)),st=Math.max(...ze.map(We=>We.y)),ct=[{x:(Ge+Ve)/2,y:st+40,label:"below"},{x:(Ge+Ve)/2,y:Ye-40,label:"above"},{x:Ge-80,y:(Ye+st)/2,label:"left"},{x:Ve+80,y:(Ye+st)/2,label:"right"}];let Be=ct[0],xt=1/0;return ct.forEach(We=>{const lt=Math.sqrt((We.x-Ae.x)**2+(We.y-Ae.y)**2);lt<xt&&(xt=lt,Be=We)}),e.jsxs("g",{children:[e.jsx("rect",{x:Be.x-85,y:Be.y-20,width:"170",height:"35",fill:"rgba(255, 255, 255, 0.9)",stroke:"#374151",strokeWidth:"1",rx:"6",opacity:"0.95"}),e.jsxs("text",{x:Be.x,y:Be.y-5,fontSize:a(11),fontWeight:"700",fill:"#374151",textAnchor:"middle",opacity:"1",children:[(S**2).toFixed(1)," +"," ",(M**2).toFixed(1)," ="," ",(R**2).toFixed(1)]}),e.jsx("text",{x:Be.x,y:Be.y+10,fontSize:a(10),fontWeight:"600",fill:"#6B7280",textAnchor:"middle",opacity:"1",children:"a² + b² = c²"})]})})()]})})()}),c.showTriangleAltitudes&&e.jsx("g",{children:$e.map((k,x)=>{const C=$e[(x+1)%3],B=$e[(x+2)%3],S=B.x-C.x,M=B.y-C.y,R=Math.sqrt(S*S+M*M);if(R===0)return null;const N=((k.x-C.x)*S+(k.y-C.y)*M)/(R*R),p={x:C.x+N*S,y:C.y+N*M},A=n(k),O=n(p);return e.jsxs("g",{children:[e.jsx("line",{x1:A.x,y1:A.y,x2:O.x,y2:O.y,stroke:"#9CA3AF",strokeWidth:"1",strokeDasharray:"3,3",opacity:"0.7"}),e.jsx("circle",{cx:O.x,cy:O.y,r:"2",fill:"#9CA3AF",opacity:"0.7"})]},`altitude-${x}`)})}),re.map((k,x)=>e.jsx("circle",{cx:k.x,cy:k.y,r:s/6,fill:w?"#DC2626":"#F56565",stroke:w?"#60A5FA":"none",strokeWidth:w?2:0,style:{cursor:"move"}},`vertex-${x}`)),c.showTriangleAngles&&e.jsxs("g",{children:[[{vertex:me,angle:pe.angleA,label:"A"},{vertex:ye,angle:pe.angleB,label:"B"},{vertex:ve,angle:pe.angleC,label:"C"}].map((k,x)=>e.jsxs("text",{x:k.vertex.x+(x===0?-25:x===1?25:0),y:k.vertex.y+(x===2?25:-15),fontSize:a(9),fontWeight:"600",fill:w?"#DC2626":"#F56565",textAnchor:"middle",opacity:"0.9",children:[k.label,": ",k.angle.toFixed(1),"°"]},`angle-${x}`)),e.jsxs("text",{x:(me.x+ye.x+ve.x)/3,y:(me.y+ye.y+ve.y)/3+20,fontSize:a(8),fontWeight:"400",fill:w?"#DC2626":"#F56565",textAnchor:"middle",opacity:"0.6",children:["Sum:"," ",(pe.angleA+pe.angleB+pe.angleC).toFixed(1),"°"]})]}),c.showTriangleClassification&&e.jsxs("g",{children:[e.jsx("text",{x:(me.x+ye.x+ve.x)/3,y:(me.y+ye.y+ve.y)/3-15,fontSize:a(11),fontWeight:"600",fill:pe.isSpecial?"#FFA500":w?"#DC2626":"#F56565",textAnchor:"middle",opacity:"0.9",children:pe.isSpecial?pe.specialType:pe.classification}),pe.isSpecial&&e.jsx("text",{x:(me.x+ye.x+ve.x)/3,y:(me.y+ye.y+ve.y)/3-2,fontSize:a(9),fontWeight:"500",fill:"#FFA500",textAnchor:"middle",opacity:"0.8",children:"Special Triangle!"})]}),e.jsxs("text",{x:(me.x+ye.x+ve.x)/3,y:(me.y+ye.y+ve.y)/3+(c.showTriangleAngles?35:8),fontSize:a(10),fontWeight:"500",fill:w?"#DC2626":"#F56565",textAnchor:"middle",opacity:"0.8",children:["Area = ",be(pe.area)]}),c.showTrigValues&&f===g.id&&T&&e.jsx("g",{children:(()=>{const k=[{label:"A",value:pe.angleA,index:0},{label:"B",value:pe.angleB,index:1},{label:"C",value:pe.angleC,index:2}];let x=k[0],C=1/0;k.forEach(N=>{const p=re[N.index],A=Math.sqrt((T.x-p.x)**2+(T.y-p.y)**2);A<C&&(C=A,x=N)});const B=x.value*Math.PI/180,S=Math.sin(B),M=Math.cos(B),R=Math.tan(B);return e.jsxs("g",{children:[e.jsx("rect",{x:T.x+10,y:T.y-55,width:"140",height:"60",fill:"rgba(255, 255, 255, 0.95)",stroke:"#374151",strokeWidth:"1",rx:"4"}),e.jsxs("text",{x:T.x+80,y:T.y-40,fontSize:a(9),fontWeight:"600",fill:"#374151",textAnchor:"middle",children:["Angle ",x.label,":"," ",x.value.toFixed(1),"°"]}),e.jsxs("text",{x:T.x+80,y:T.y-28,fontSize:a(8),fontWeight:"500",fill:"#374151",textAnchor:"middle",children:["sin = ",S.toFixed(3)]}),e.jsxs("text",{x:T.x+80,y:T.y-16,fontSize:a(8),fontWeight:"500",fill:"#374151",textAnchor:"middle",children:["cos = ",M.toFixed(3)]}),e.jsxs("text",{x:T.x+80,y:T.y-4,fontSize:a(8),fontWeight:"500",fill:"#374151",textAnchor:"middle",children:["tan = ",isFinite(R)?R.toFixed(3):"∞"]})]})})()}),e.jsx("text",{x:(me.x+ye.x)/2,y:(me.y+ye.y)/2-10,fontSize:a(8),fontWeight:"400",fill:w?"#DC2626":"#F56565",textAnchor:"middle",opacity:"0.6",children:be(pe.sideC)}),e.jsx("text",{x:(ye.x+ve.x)/2+10,y:(ye.y+ve.y)/2,fontSize:a(8),fontWeight:"400",fill:w?"#DC2626":"#F56565",textAnchor:"middle",opacity:"0.6",children:be(pe.sideA)}),e.jsx("text",{x:(me.x+ve.x)/2-10,y:(me.y+ve.y)/2,fontSize:a(8),fontWeight:"400",fill:w?"#DC2626":"#F56565",textAnchor:"middle",opacity:"0.6",children:be(pe.sideB)})]},g.id);case"function":const Te=g,qe=Te.properties.points;if(!qe||qe.length<2)return null;const at=qe.map(n).reduce((k,x,C)=>C===0?`M ${x.x} ${x.y}`:`${k} L ${x.x} ${x.y}`,""),Ue=n({x:Te.properties.domain.min,y:((ne=qe[0])==null?void 0:ne.y)||0}),ut=n({x:Te.properties.domain.max,y:((xe=qe[qe.length-1])==null?void 0:xe.y)||0});return e.jsxs("g",{children:[c.showFunctionExtensions&&(()=>{const k=(S,M)=>{try{const R=S.replace(/\bx\b/g,`(${M})`).replace(/\^/g,"**").replace(/sin/g,"Math.sin").replace(/cos/g,"Math.cos").replace(/tan/g,"Math.tan").replace(/log/g,"Math.log").replace(/ln/g,"Math.log").replace(/exp/g,"Math.exp").replace(/sqrt/g,"Math.sqrt").replace(/abs/g,"Math.abs").replace(/pi/g,"Math.PI").replace(/e\b/g,"Math.E"),p=new Function("x",`return ${R}`)(M);return typeof p=="number"&&!isNaN(p)&&isFinite(p)?p:null}catch{return null}},x={left:t.center.x-o.width/2/t.zoom,right:t.center.x+o.width/2/t.zoom},C=Te.properties.equation,B=[];if(Te.properties.domain.min>x.left){const S=[],M=Math.max(x.left,Te.properties.domain.min-6),R=(Te.properties.domain.min-M)/15;for(let N=M;N<=Te.properties.domain.min;N+=R){const p=k(C,N);p!==null&&S.push(n({x:N,y:p}))}if(S.length>1){const N=S.reduce((p,A,O)=>p+(O===0?`M ${A.x} ${A.y}`:` L ${A.x} ${A.y}`),"");B.push(N)}}if(Te.properties.domain.max<x.right){const S=[],M=Math.min(x.right,Te.properties.domain.max+6),R=(M-Te.properties.domain.max)/15;for(let N=Te.properties.domain.max;N<=M;N+=R){const p=k(C,N);p!==null&&S.push(n({x:N,y:p}))}if(S.length>1){const N=S.reduce((p,A,O)=>p+(O===0?`M ${A.x} ${A.y}`:` L ${A.x} ${A.y}`),"");B.push(N)}}return e.jsx("g",{children:B.map((S,M)=>e.jsx("path",{d:S,fill:"none",stroke:Te.properties.color||"#2563eb",strokeWidth:1,strokeDasharray:"4,4",opacity:.5,strokeLinecap:"round"},`ext-${M}`))})})(),w&&e.jsx("path",{d:at,fill:"none",stroke:"#60A5FA",strokeWidth:6,opacity:.4}),e.jsx("path",{d:at,fill:"none",stroke:"transparent",strokeWidth:12,strokeLinecap:"round",strokeLinejoin:"round",style:{pointerEvents:"stroke"},onMouseEnter:()=>G(g.id),onMouseLeave:()=>{G(null),V(null)},onMouseMove:k=>{var x;if(X===g.id){const C=(x=k.currentTarget.ownerSVGElement)==null?void 0:x.getBoundingClientRect();if(C){const B=k.clientX-C.left,S=k.clientY-C.top;t.center.x+(B-o.width/2)/t.zoom,t.center.y-(S-o.height/2)/t.zoom;let M=null,R=1/0;for(const N of qe){const p=n(N),A=Math.sqrt((B-p.x)**2+(S-p.y)**2);A<R&&(R=A,M=N)}M&&V(M)}}}}),e.jsx("path",{d:at,fill:"none",stroke:w?"#1D4ED8":Te.properties.color||"#2563eb",strokeWidth:w?3:Te.properties.strokeWidth||2,strokeLinecap:"round",strokeLinejoin:"round",style:{pointerEvents:"none"}}),w&&e.jsxs("g",{children:[e.jsx("circle",{cx:Ue.x,cy:Ue.y,r:"6",fill:"#1D4ED8",stroke:"white",strokeWidth:"2",opacity:.8}),e.jsx("circle",{cx:ut.x,cy:ut.y,r:"6",fill:"#1D4ED8",stroke:"white",strokeWidth:"2",opacity:.8})]}),X===g.id&&F&&e.jsxs("g",{children:[e.jsx("circle",{cx:n(F).x,cy:n(F).y,r:"4",fill:Te.properties.color||"#2563eb",stroke:"white",strokeWidth:"2"}),e.jsx("rect",{x:n(F).x-70,y:n(F).y-55,width:"140",height:"45",fill:"rgba(255, 255, 255, 0.95)",stroke:"#374151",strokeWidth:"1",rx:"4"}),e.jsxs("text",{x:n(F).x,y:n(F).y-40,fontSize:a(9),fontWeight:"600",fill:"#374151",textAnchor:"middle",children:["(",Q(F.x,h),","," ",Q(F.y,h),")"]}),e.jsxs("text",{x:n(F).x,y:n(F).y-28,fontSize:a(8),fontWeight:"500",fill:"#374151",textAnchor:"middle",children:["f(",Q(F.x,h),") ="," ",Q(F.y,h)]}),e.jsxs("text",{x:n(F).x,y:n(F).y-16,fontSize:a(8),fontWeight:"400",fill:"#666",textAnchor:"middle",children:["f(x) = ",Te.properties.equation]})]}),(w||j===g.id)&&e.jsxs("g",{children:[e.jsx("rect",{x:Ue.x-40,y:Ue.y-35,width:"80",height:"25",fill:"rgba(255, 255, 255, 0.95)",stroke:"#374151",strokeWidth:"1",rx:"4"}),e.jsxs("text",{x:Ue.x,y:Ue.y-20,fontSize:a(10),fontWeight:"600",fill:"#374151",textAnchor:"middle",children:["f(x) = ",Te.properties.equation]})]})]},g.id);default:return null}};return e.jsxs(e.Fragment,{children:[e.jsx("defs",{children:e.jsx("marker",{id:"arrowhead",markerWidth:"10",markerHeight:"7",refX:"9",refY:"3.5",orient:"auto",children:e.jsx("polygon",{points:"0 0, 10 3.5, 0 7",fill:"#3B82F6",opacity:"0.6"})})}),e.jsx("g",{className:"objects",children:i.map(ee)})]})}function cs({capabilities:i,viewport:t,activeTool:s,selectedObjectsCount:n}){return i?e.jsxs("div",{className:"absolute top-2 left-2 text-xs text-gray-500 bg-white/80 p-2 rounded shadow-sm",children:[e.jsxs("div",{children:["Input: ",i.hasTouch?"👆":"🖱️"," ",i.hasPencil?"✏️":""]}),e.jsxs("div",{children:["Zoom: ",t.zoom>=1?t.zoom.toFixed(1):t.zoom.toFixed(2),"×"]}),e.jsxs("div",{children:["Center: (",t.center.x.toFixed(1),", ",t.center.y.toFixed(1),")"]}),e.jsxs("div",{children:["Tool: ",s||"Pan Mode"]}),n>0&&e.jsxs("div",{children:["Selected: ",n," object",n!==1?"s":""]})]}):null}function ls({selectedObject:i,onDelete:t,onUpdate:s,onClose:n}){const r="ontouchstart"in window||navigator.maxTouchPoints>0||window.innerWidth<768,[o,c]=u.useState(()=>{var D;const E=ae.loadState(),m=(D=E==null?void 0:E.uiSettings)==null?void 0:D.contextMenuCollapsed;if(m!==void 0)return m;try{const U=localStorage.getItem("grix-ui-collapsed");if(U!==null)return U==="true"}catch{}return r});u.useEffect(()=>{var m;const E=ae.loadState();if(((m=E==null?void 0:E.uiSettings)==null?void 0:m.contextMenuCollapsed)===void 0){const D=r,U={...E,uiSettings:{...E==null?void 0:E.uiSettings,contextMenuCollapsed:D}};ae.saveState(U),ae.scheduleSave(),c(D)}},[r]);const a=()=>{const E=!o;c(E);const m=ae.loadState()||{},D={...m,uiSettings:{...m.uiSettings,contextMenuCollapsed:E}};ae.saveState(D),ae.scheduleSave();try{localStorage.setItem("grix-ui-collapsed",E.toString())}catch{console.warn("Could not save collapsed state to localStorage")}};if(!i)return null;const d=()=>{t(),n()},h=(E,m)=>{try{const D=(T,v)=>{try{const X=T.replace(/\bx\b/g,`(${v})`).replace(/\^/g,"**").replace(/sin/g,"Math.sin").replace(/cos/g,"Math.cos").replace(/tan/g,"Math.tan").replace(/log/g,"Math.log").replace(/ln/g,"Math.log").replace(/exp/g,"Math.exp").replace(/sqrt/g,"Math.sqrt").replace(/abs/g,"Math.abs").replace(/pi/g,"Math.PI").replace(/e\b/g,"Math.E"),F=new Function("x",`return ${X}`)(v);return typeof F=="number"&&!isNaN(F)&&isFinite(F)?F:null}catch{return null}},U=T=>T.includes("sin")||T.includes("cos")||T.includes("tan")?"trigonometric":T.includes("exp")||T.includes("e^")?"exponential":T.includes("log")||T.includes("ln")?"logarithmic":/x\^\d+|x\*\*\d+/.test(T)?"polynomial":"custom",l=E.properties.domain,y=E.properties.resolution||20,f=[],q=(l.max-l.min)/(y*(l.max-l.min));for(let T=l.min;T<=l.max;T+=q){const v=D(m,T);v!==null&&f.push({x:T,y:v})}return{properties:{...E.properties,equation:m,functionType:U(m),points:f}}}catch(D){return console.error("Failed to update function equation:",D),null}},j=()=>{switch(i.type){case"ray":const{startPoint:E,endPoint:m,slope:D}=i.properties,U=Math.abs(E.x)<.001&&Math.abs(E.y)<.001;return e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Line Details"}),e.jsxs("div",{className:"space-y-1 text-xs text-gray-600",children:[e.jsxs("div",{children:["Start: (",Q(E.x,1),", ",Q(E.y,1),")"]}),e.jsxs("div",{children:["End: (",Q(m.x,1),", ",Q(m.y,1),")"]}),U&&e.jsxs("div",{children:["Fraction: ",Math.round(m.y),"/",Math.round(m.x)]}),e.jsxs("div",{children:["Slope: ",isFinite(D)?D.toFixed(3):"undefined"]})]})]});case"rectangle":const{x:l,y,width:f,height:q,area:T}=i.properties;return e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Rectangle Details"}),e.jsxs("div",{className:"space-y-1 text-xs text-gray-600",children:[e.jsxs("div",{children:["Position: (",Q(l,1),", ",Q(y,1),")"]}),e.jsxs("div",{children:["Size: ",Q(f,1)," × ",Q(q,1)]})]})]});case"circle":const{center:v,radius:X,diameter:G,circumference:F,area:V}=i.properties;return e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Circle Details"}),e.jsxs("div",{className:"space-y-1 text-xs text-gray-600",children:[e.jsxs("div",{children:["Center: (",Q(v.x,1),", ",Q(v.y,1),")"]}),e.jsxs("div",{children:["Radius: ",be(X)]}),e.jsxs("div",{children:["Diameter: ",be(G)]}),e.jsxs("div",{children:["Circumference: ",be(F)]}),e.jsxs("div",{children:["Area: ",be(V)]})]})]});case"triangle":const{vertices:L,sideA:ee,sideB:g,sideC:w,angleA:ne,angleB:xe,angleC:Fe,area:ge,perimeter:$,type:ce}=i.properties;return e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Triangle Details"}),e.jsxs("div",{className:"space-y-1 text-xs text-gray-600",children:[e.jsxs("div",{children:["Type: ",ce]}),e.jsx("div",{children:"Vertices:"}),e.jsxs("div",{className:"ml-2",children:[e.jsxs("div",{children:["A: (",Q(L[0].x,1),", ",Q(L[0].y,1),")"]}),e.jsxs("div",{children:["B: (",Q(L[1].x,1),", ",Q(L[1].y,1),")"]}),e.jsxs("div",{children:["C: (",Q(L[2].x,1),", ",Q(L[2].y,1),")"]})]}),e.jsxs("div",{children:["Sides: ",be(ee),", ",be(g),", ",be(w)]}),e.jsxs("div",{children:["Angles: ",be(ne),"°, ",be(xe),"°, ",be(Fe),"°"]}),e.jsxs("div",{children:["Area: ",be(ge)]}),e.jsxs("div",{children:["Perimeter: ",be($)]})]})]});case"function":const b=i,{equation:Z,functionType:de,domain:fe,points:Oe}=b.properties;return e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Function Details"}),e.jsxs("div",{className:"space-y-1 text-xs text-gray-600",children:[e.jsxs("div",{children:["Equation: f(x) = ",Z]}),e.jsxs("div",{children:["Type: ",de]}),e.jsxs("div",{children:["Domain: [",Q(fe.min,1),", ",Q(fe.max,1),"]"]}),e.jsxs("div",{children:["Points: ",Oe.length]})]}),e.jsxs("div",{className:"mt-2 pt-2 border-t border-gray-100",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Edit Equation:"}),e.jsx("input",{type:"text",defaultValue:Z,className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"e.g., x^2, sin(x), 2*x + 1",onKeyDown:K=>{if(K.stopPropagation(),K.key==="Enter"){const ke=K.target.value.trim();if(ke&&ke!==Z){const Re=h(b,ke);Re&&s(i.id,{properties:Re.properties})}K.target.blur()}else K.key==="Escape"&&K.target.blur()},onKeyUp:K=>{K.stopPropagation()},onKeyPress:K=>{K.stopPropagation()},onFocus:K=>{K.target.select()}}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Press Enter to apply. Examples: x^2, sin(x), cos(x), log(x), exp(x)"})]})]});default:return null}},z=()=>{switch(i.type){case"ray":return`Line: slope ${be(i.properties.slope)}`;case"rectangle":const E=i;return`Rectangle: ${be(E.properties.width)} × ${be(E.properties.height)}`;case"circle":return`Circle: r=${be(i.properties.radius)}`;case"triangle":return"Triangle";case"function":return`Function: ${i.properties.equation}`;default:return i.type}};return o?e.jsx("div",{className:"fixed top-20 right-4 bg-white border border-gray-200 rounded-lg shadow-lg z-50",children:e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2",children:[e.jsx("button",{onClick:a,className:"text-gray-500 hover:text-gray-700",title:"Expand",children:"▶"}),e.jsx("span",{className:"text-sm text-gray-700",children:z()}),e.jsx("button",{onClick:d,className:"ml-2 text-red-600 hover:text-red-700",title:"Delete",children:"🗑️"}),e.jsx("button",{onClick:n,className:"text-gray-400 hover:text-gray-600",title:"Close",children:"✕"})]})}):e.jsxs("div",{className:"fixed top-20 right-4 bg-white border border-gray-200 rounded-lg shadow-lg p-3 z-50 min-w-48",onKeyDown:E=>{E.stopPropagation()},onKeyUp:E=>{E.stopPropagation()},onKeyPress:E=>{E.stopPropagation()},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-700",children:[i.type.charAt(0).toUpperCase()+i.type.slice(1)," Details"]}),e.jsx("button",{onClick:a,className:"text-gray-400 hover:text-gray-600 text-xs",title:"Collapse",children:"▼"})]}),j(),e.jsxs("div",{className:"mt-3 pt-2 border-t border-gray-100 flex gap-2",children:[e.jsxs("button",{onClick:d,className:"flex items-center gap-1 px-2 py-1 text-xs text-red-600 hover:bg-red-50 rounded transition-colors",children:[e.jsx("span",{children:"🗑️"}),"Delete"]}),e.jsxs("button",{onClick:n,className:"flex items-center gap-1 px-2 py-1 text-xs text-gray-600 hover:bg-gray-50 rounded transition-colors",children:[e.jsx("span",{children:"✕"}),"Close"]})]})]})}function ds({isOpen:i,onToggle:t}={}){const[s,n]=u.useState(!1),r=i!==void 0?i:s,[o,c]=u.useState("all"),a=u.useRef(null),d=De(),{toggleSetting:h,setFontScale:j,setGridScale:z,setSnapPrecision:E,setCoordinateSystem:m,setZoomSensitivity:D,resetToDefaults:U}=d,{t:l,language:y,changeLanguage:f,availableLanguages:q}=Xe(),T=()=>{t?t():n(!s)};u.useEffect(()=>{function F(V){a.current&&!a.current.contains(V.target)&&(t?t():n(!1))}if(r)return document.addEventListener("mousedown",F,!0),document.addEventListener("click",F,!0),()=>{document.removeEventListener("mousedown",F,!0),document.removeEventListener("click",F,!0)}},[r,t]);const v=[{title:l("settings.sections.originLines"),subtitle:l("settings.sections.originLines.subtitle"),settings:[{key:"showEquivalentFractions",label:l("settings.equivalentFractions"),description:l("settings.equivalentFractions.description")},{key:"showLengthMultiples",label:l("settings.lengthMultiples"),description:l("settings.lengthMultiples.description")},{key:"showAreaRectangle",label:l("settings.areaRectangle"),description:l("settings.areaRectangle.description")},{key:"showDivisionMultiples",label:l("settings.divisionMultiples"),description:l("settings.divisionMultiples.description")},{key:"showRiseRunTriangle",label:l("settings.riseRunTriangle"),description:l("settings.riseRunTriangle.description")},{key:"showDistanceMarkers",label:l("settings.distanceMarkers"),description:l("settings.distanceMarkers.description")},{key:"showAngleArc",label:l("settings.angleArc"),description:l("settings.angleArc.description")},{key:"showCoordinateProjections",label:l("settings.coordinateProjections"),description:l("settings.coordinateProjections.description")}]},{title:l("settings.sections.divisionFractions"),subtitle:l("settings.sections.divisionFractions.subtitle"),settings:[{key:"showDivisionAnswer",label:l("settings.divisionAnswer"),description:l("settings.divisionAnswer.description")}]},{title:l("settings.sections.gridReference"),subtitle:l("settings.sections.gridReference.subtitle"),settings:[{key:"showLatticePoints",label:l("settings.latticePoints"),description:l("settings.latticePoints.description")},{key:"showReferenceLineY_equals_X",label:l("settings.referenceLineY_equals_X"),description:l("settings.referenceLineY_equals_X.description")}]},{title:l("settings.sections.circlesConcepts"),subtitle:l("settings.sections.circlesConcepts.subtitle"),settings:[{key:"showTangentLines",label:l("settings.tangentLines"),description:l("settings.tangentLines.description")}]},{title:l("settings.sections.functionConcepts"),subtitle:l("settings.sections.functionConcepts.subtitle"),settings:[{key:"showFunctionExtensions",label:l("settings.functionExtensions"),description:l("settings.functionExtensions.description")}]},{title:l("settings.sections.triangleConcepts"),subtitle:l("settings.sections.triangleConcepts.subtitle"),settings:[{key:"showTriangleAngles",label:l("settings.triangleAngles"),description:l("settings.triangleAngles.description")},{key:"showTriangleClassification",label:l("settings.triangleClassification"),description:l("settings.triangleClassification.description")},{key:"showSpecialTriangles",label:l("settings.specialTriangles"),description:l("settings.specialTriangles.description")},{key:"showSOHCAHTOA",label:l("settings.sohcahtoa"),description:l("settings.sohcahtoa.description")},{key:"showTrigValues",label:l("settings.trigValues"),description:l("settings.trigValues.description")},{key:"showTriangleAltitudes",label:l("settings.triangleAltitudes"),description:l("settings.triangleAltitudes.description")},{key:"showPythagoreanSquares",label:l("settings.pythagoreanSquares"),description:l("settings.pythagoreanSquares.description")}]},{title:l("settings.sections.rectangleConcepts"),subtitle:l("settings.sections.rectangleConcepts.subtitle"),settings:[{key:"showFactorPairs",label:l("settings.factorPairs"),description:l("settings.factorPairs.description")},{key:"showCommutativeProperty",label:l("settings.commutativeProperty"),description:l("settings.commutativeProperty.description")},{key:"showDistributiveProperty",label:l("settings.distributiveProperty"),description:l("settings.distributiveProperty.description")},{key:"showPrimeComposite",label:l("settings.primeComposite"),description:l("settings.primeComposite.description")},{key:"showGCF",label:l("settings.gcf"),description:l("settings.gcf.description")},{key:"showLCM",label:l("settings.lcm"),description:l("settings.lcm.description")}]},{title:l("settings.sections.display"),subtitle:l("settings.sections.display.subtitle"),settings:[]}],X=o==="all"?v:v.filter(F=>F.title.toLowerCase().replace(/[^a-z0-9]/g,"-")===o),G=[{id:"all",name:l("settings.allSettings")},...v.map(F=>({id:F.title.toLowerCase().replace(/[^a-z0-9]/g,"-"),name:F.title}))];return e.jsxs("div",{ref:a,className:"relative",children:[e.jsx("button",{onClick:T,className:"w-12 h-12 bg-white border border-gray-200 rounded-full shadow-lg hover:bg-gray-50 transition-all hover:shadow-xl flex items-center justify-center",title:l("settings.title"),children:e.jsx("span",{className:"text-lg",children:"⚙️"})}),r&&e.jsxs("div",{className:"settings-panel absolute bottom-full left-0 mb-2 bg-white border border-gray-200 rounded-lg shadow-lg w-80 max-h-[28rem] overflow-y-auto z-60",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-100 px-4 py-3 rounded-t-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:l("settings.title")}),e.jsx("button",{onClick:U,className:"text-xs text-blue-600 hover:text-blue-800 font-medium",children:l("settings.resetAll")})]}),e.jsx("div",{className:"px-4 pt-2",children:e.jsx("select",{value:o,onChange:F=>c(F.target.value),className:"w-full text-xs border border-gray-200 rounded px-2 py-1 bg-white",children:G.map(F=>e.jsx("option",{value:F.id,children:F.name},F.id))})})]}),e.jsx("div",{className:"settings-scrollable p-4 space-y-5",children:X.map((F,V)=>e.jsxs("div",{children:[e.jsxs("div",{className:`${V>0?"border-t border-gray-100 pt-4":""} mb-3`,children:[e.jsx("h4",{className:"text-xs font-semibold text-gray-700 uppercase tracking-wide",children:F.title}),F.subtitle&&e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:F.subtitle})]}),e.jsxs("div",{className:"space-y-2.5",children:[F.settings.map(L=>e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[e.jsx("input",{type:"checkbox",checked:d[L.key],onChange:()=>h(L.key),className:"mt-0.5 w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500 focus:ring-2"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 group-hover:text-gray-900",children:L.label}),e.jsx("div",{className:"text-xs text-gray-500 leading-relaxed",children:L.description})]})]},L.key)),F.title===l("settings.sections.display")&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:l("settings.fontSize")}),e.jsxs("span",{className:"text-xs text-gray-500 font-mono",children:[Math.round(d.fontScale*100),"%"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xs text-gray-400",children:"A"}),e.jsx("input",{type:"range",min:"0.8",max:"2.0",step:"0.1",value:d.fontScale,onChange:L=>j(parseFloat(L.target.value)),className:"flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider"}),e.jsx("span",{className:"text-sm text-gray-600",children:"A"})]}),e.jsx("div",{className:"text-xs text-gray-500 leading-relaxed",children:l("settings.fontSize.description")}),e.jsxs("div",{className:"space-y-3 pt-4 border-t border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:l("settings.gridDensity")}),e.jsxs("span",{className:"text-xs text-gray-500 font-mono",children:[Math.round(d.gridScale*100),"%"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xs text-gray-400",children:l("settings.gridSparse")}),e.jsx("input",{type:"range",min:"0.2",max:"5.0",step:"0.1",value:d.gridScale,onChange:L=>z(parseFloat(L.target.value)),className:"flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider"}),e.jsx("span",{className:"text-xs text-gray-600",children:l("settings.gridDense")})]}),e.jsx("div",{className:"text-xs text-gray-500 leading-relaxed",children:l("settings.gridDensity.description")})]}),e.jsxs("div",{className:"space-y-3 pt-4 border-t border-gray-100",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:l("settings.coordinateSystem")}),e.jsx("div",{className:"space-y-2",children:[{value:"cartesian",label:l("settings.cartesianOnly"),desc:l("settings.cartesianOnly.description")},{value:"polar",label:l("settings.polarOnly"),desc:l("settings.polarOnly.description")},{value:"both",label:l("settings.bothSystems"),desc:l("settings.bothSystems.description")}].map(L=>e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[e.jsx("input",{type:"radio",name:"coordinateSystem",value:L.value,checked:d.coordinateSystem===L.value,onChange:ee=>m(ee.target.value),className:"mt-0.5 w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 group-hover:text-gray-900",children:L.label}),e.jsx("div",{className:"text-xs text-gray-500",children:L.desc})]})]},L.value))})]}),e.jsxs("div",{className:"space-y-3 pt-4 border-t border-gray-100",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:l("settings.snapPrecision")}),e.jsx("div",{className:"space-y-2",children:[{value:"adaptive",label:l("settings.adaptive"),desc:l("settings.adaptive.description")},{value:"whole",label:l("settings.wholeNumbers"),desc:l("settings.wholeNumbers.description")},{value:"half",label:l("settings.halfUnits"),desc:l("settings.halfUnits.description")},{value:"quarter",label:l("settings.quarterUnits"),desc:l("settings.quarterUnits.description")},{value:"tenth",label:l("settings.tenthUnits"),desc:l("settings.tenthUnits.description")}].map(L=>e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[e.jsx("input",{type:"radio",name:"snapPrecision",value:L.value,checked:d.snapPrecision===L.value,onChange:ee=>E(ee.target.value),className:"mt-0.5 w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 group-hover:text-gray-900",children:L.label}),e.jsx("div",{className:"text-xs text-gray-500",children:L.desc})]})]},L.value))}),e.jsx("div",{className:"text-xs text-gray-500 leading-relaxed",children:l("settings.snapPrecision.description")})]}),e.jsxs("div",{className:"space-y-3 pt-4 border-t border-gray-100",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:l("settings.zoomSensitivity")}),e.jsx("div",{className:"grid grid-cols-1 gap-1",children:[{value:"low",label:l("settings.low"),desc:l("settings.low.description")},{value:"medium",label:l("settings.medium"),desc:l("settings.medium.description")},{value:"high",label:l("settings.high"),desc:l("settings.high.description")}].map(L=>e.jsxs("label",{className:"flex items-start gap-3 p-2 rounded hover:bg-gray-50 cursor-pointer group",children:[e.jsx("input",{type:"radio",name:"zoomSensitivity",value:L.value,checked:d.zoomSensitivity===L.value,onChange:ee=>D(ee.target.value),className:"mt-0.5"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 group-hover:text-gray-700",children:L.label}),e.jsx("div",{className:"text-xs text-gray-500",children:L.desc})]})]},L.value))}),e.jsx("div",{className:"text-xs text-gray-500 leading-relaxed",children:l("settings.zoomSensitivity.description")})]}),e.jsxs("div",{className:"space-y-3 pt-4 border-t border-gray-100",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:l("settings.language")}),e.jsx("select",{value:y,onChange:L=>f(L.target.value),className:"w-full text-sm border border-gray-200 rounded px-3 py-2 bg-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:q.map(L=>e.jsxs("option",{value:L.code,children:[L.nativeName," (",L.name,")"]},L.code))}),e.jsx("div",{className:"text-xs text-gray-500 leading-relaxed",children:l("settings.language.description")})]})]})]})]},F.title))}),e.jsx("div",{className:"sticky bottom-0 bg-gray-50 border-t border-gray-100 px-4 py-2 rounded-b-lg",children:e.jsx("p",{className:"text-xs text-gray-500 text-center",children:l("settings.footerText")})})]})]})}const Ke=class Ke{constructor(){ie(this,"examplesData",null);ie(this,"isLoading",!1)}static getInstance(){return Ke.instance||(Ke.instance=new Ke),Ke.instance}async loadExamples(){if(this.examplesData)return this.examplesData;if(this.isLoading)return await new Promise(t=>{const s=()=>{this.isLoading?setTimeout(s,50):t(void 0)};s()}),this.examplesData;this.isLoading=!0;try{const t=await fetch("/examples.json");if(!t.ok)throw new Error(`Failed to load examples: ${t.status}`);const s=await t.json();if(!s.examples||!Array.isArray(s.examples))throw new Error("Invalid examples data: missing examples array");if(!s.categories||!Array.isArray(s.categories))throw new Error("Invalid examples data: missing categories array");for(const n of s.examples)if(!n.id||!n.title||!n.objects||!Array.isArray(n.objects))throw new Error(`Invalid example: ${n.id||"unknown"}`);return this.examplesData=s,this.examplesData}catch(t){return console.error("Failed to load examples:",t),this.examplesData={examples:[],categories:[]},this.examplesData}finally{this.isLoading=!1}}async getExamples(){return(await this.loadExamples()).examples}async getCategories(){return(await this.loadExamples()).categories}async getExampleById(t){return(await this.getExamples()).find(n=>n.id===t)||null}async getExamplesByCategory(t){return(await this.getExamples()).filter(n=>n.category===t)}generateObjectId(){return`example_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}convertExampleObjectToMathObject(t){const s={id:this.generateObjectId(),type:t.type,visible:!0,selected:!1,zIndex:0};switch(t.type){case"ray":return{...s,type:"ray",properties:{startPoint:t.properties.startPoint,endPoint:t.properties.endPoint,slope:(t.properties.endPoint.y-t.properties.startPoint.y)/(t.properties.endPoint.x-t.properties.startPoint.x)}};case"rectangle":return{...s,type:"rectangle",properties:{x:t.properties.x,y:t.properties.y,width:t.properties.width,height:t.properties.height,area:t.properties.width*t.properties.height}};case"circle":return{...s,type:"circle",properties:{center:t.properties.center,radius:t.properties.radius,diameter:t.properties.diameter,circumference:t.properties.circumference,area:t.properties.area}};case"triangle":return{...s,type:"triangle",properties:{vertices:t.properties.vertices,sideA:t.properties.sideA,sideB:t.properties.sideB,sideC:t.properties.sideC,angleA:t.properties.angleA,angleB:t.properties.angleB,angleC:t.properties.angleC,area:t.properties.area,perimeter:t.properties.perimeter,type:t.properties.type}};default:throw new Error(`Unknown object type: ${t.type}`)}}async applyExample(t){const s=await this.getExampleById(t);if(!s)throw new Error(`Example not found: ${t}`);const n=Me.getState(),r=De.getState();try{n.getAllObjects().forEach(c=>{n.removeObject(c.id)}),n.clearSelection(),s.viewport&&n.setViewport(s.viewport),Object.entries(s.settings).forEach(([c,a])=>{c in r&&typeof a=="boolean"?(r.toggleSetting(c),r[c]!==a&&r.toggleSetting(c)):c==="snapPrecision"&&typeof a=="string"?r.setSnapPrecision(a):c==="coordinateSystem"&&typeof a=="string"?r.setCoordinateSystem(a):c==="fontScale"&&typeof a=="number"?r.setFontScale(a):c==="gridScale"&&typeof a=="number"&&r.setGridScale(a)}),s.objects.forEach(c=>{const a=this.convertExampleObjectToMathObject(c);n.addObject(a)}),console.log(`Applied example: ${s.title}`)}catch(o){throw console.error("Failed to apply example:",o),new Error(`Failed to apply example "${s.title}": ${o.message}`)}}async clearCanvas(){const t=Me.getState(),s=De.getState();t.getAllObjects().forEach(r=>{t.removeObject(r.id)}),t.clearSelection(),t.setViewport({zoom:20,center:{x:0,y:0}}),s.resetToDefaults(),console.log("Canvas cleared and reset to defaults")}async getBeginnerExamples(){return(await this.getExamples()).filter(s=>s.difficulty==="beginner")}async getRandomExampleFromCategory(t){const s=await this.getExamplesByCategory(t);if(s.length===0)return null;const n=Math.floor(Math.random()*s.length);return s[n]}};ie(Ke,"instance");let mt=Ke;const tt=mt.getInstance(),Ot="grix-tutorial-completed";function hs(){const[i,t]=u.useState(!1),[s,n]=u.useState(0),[r,o]=u.useState(!1);u.useEffect(()=>{localStorage.getItem(Ot)||t(!0)},[]);const c=[{title:"Welcome to Grix! 🎯",content:"Grix is a mathematical visualization platform where you can explore concepts like slopes, fractions, multiplication, and more through interactive graphics.",highlight:null},{title:"Explore Examples 📚",content:"Click the 'Examples' button in the toolbar to load pre-made mathematical demonstrations. Perfect for getting started!",highlight:"examples"},{title:"Customize Visualizations ⚙️",content:"Use the 'Settings' button in the bottom-left to enable different mathematical features like equivalent fractions, area calculations, and more.",highlight:"settings"},{title:"Interactive Tools 🛠️",content:"Use the toolbar to draw lines and rectangles. Zoom with Ctrl+scroll wheel, and pan by scrolling. On mobile, use pinch gestures.",highlight:"toolbar"}],a=()=>{s<c.length-1?n(s+1):h()},d=()=>{h()},h=()=>{localStorage.setItem(Ot,"true"),t(!1)},j=async()=>{try{o(!0);const m=await tt.getBeginnerExamples();m.length>0&&await tt.applyExample(m[0].id),h()}catch(m){console.error("Failed to load example:",m),h()}finally{o(!1)}};if(!i)return null;const z=c[s],E=s===c.length-1;return e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9999]",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-md mx-4 p-6 relative",children:[e.jsx("div",{className:"flex gap-2 mb-4",children:c.map((m,D)=>e.jsx("div",{className:`h-2 flex-1 rounded-full ${D<=s?"bg-blue-500":"bg-gray-200"}`},D))}),e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-3",children:z.title}),e.jsx("p",{className:"text-gray-600 leading-relaxed mb-6",children:z.content})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:d,className:"flex-1 px-4 py-2 text-gray-600 hover:text-gray-800 font-medium transition-colors",disabled:r,children:"Skip Tutorial"}),E?e.jsx("button",{onClick:j,className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors disabled:opacity-50",disabled:r,children:r?"Loading...":"Try an Example!"}):e.jsx("button",{onClick:a,className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors",children:"Next"})]}),e.jsxs("div",{className:"text-center mt-4 text-sm text-gray-500",children:["Step ",s+1," of ",c.length]}),e.jsx("button",{onClick:d,className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600 text-xl font-bold w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100",title:"Close tutorial",children:"×"})]}),z.highlight&&e.jsxs(e.Fragment,{children:[z.highlight==="examples"&&e.jsx("div",{className:"fixed top-0 right-0 z-[10000] pointer-events-none",children:e.jsx("div",{className:"absolute top-2 right-2 w-32 h-12 border-4 border-yellow-400 rounded-lg animate-pulse"})}),z.highlight==="settings"&&e.jsx("div",{className:"fixed bottom-4 left-4 z-[10000] pointer-events-none",children:e.jsx("div",{className:"w-12 h-12 border-4 border-yellow-400 rounded-full animate-pulse"})}),z.highlight==="toolbar"&&e.jsx("div",{className:"fixed top-0 left-0 z-[10000] pointer-events-none",children:e.jsx("div",{className:"absolute top-2 left-32 w-24 h-12 border-4 border-yellow-400 rounded-lg animate-pulse"})})]})]})}function us(){const{t:i}=Xe(),[t,s]=u.useState(!1),n=u.useRef(null);u.useEffect(()=>{function c(a){n.current&&!n.current.contains(a.target)&&s(!1)}if(t)return document.addEventListener("mousedown",c,!0),document.addEventListener("click",c,!0),document.body.style.overflow="hidden",()=>{document.removeEventListener("mousedown",c,!0),document.removeEventListener("click",c,!0),document.body.style.overflow="unset"}},[t]),u.useEffect(()=>{const c=a=>{a.key==="Escape"&&s(!1)};if(t)return document.addEventListener("keydown",c),()=>document.removeEventListener("keydown",c)},[t]);const o=["GetGrix","@","gmail",".","com"].join("");return e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>s(!0),className:"fixed bottom-4 right-20 z-40 w-10 h-10 bg-white border border-gray-200 rounded-full shadow-lg hover:bg-gray-50 transition-all hover:shadow-xl flex items-center justify-center",title:i("info.about"),children:e.jsx("span",{className:"text-sm font-bold text-blue-600",children:"ℹ️"})}),t&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{ref:n,className:"bg-white rounded-lg shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto info-modal-scrollable",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("svg",{width:"32",height:"32",viewBox:"0 0 32 32",className:"flex-shrink-0",children:[e.jsx("rect",{width:"32",height:"32",fill:"#2563eb",rx:"6"}),e.jsxs("g",{stroke:"#60A5FA",strokeWidth:"0.5",opacity:"0.6",children:[e.jsx("line",{x1:"8",y1:"4",x2:"8",y2:"28"}),e.jsx("line",{x1:"16",y1:"4",x2:"16",y2:"28"}),e.jsx("line",{x1:"24",y1:"4",x2:"24",y2:"28"}),e.jsx("line",{x1:"4",y1:"8",x2:"28",y2:"8"}),e.jsx("line",{x1:"4",y1:"16",x2:"28",y2:"16"}),e.jsx("line",{x1:"4",y1:"24",x2:"28",y2:"24"})]}),e.jsxs("g",{stroke:"#FFFFFF",strokeWidth:"1",children:[e.jsx("line",{x1:"16",y1:"4",x2:"16",y2:"28"}),e.jsx("line",{x1:"4",y1:"16",x2:"28",y2:"16"})]}),e.jsx("line",{x1:"16",y1:"16",x2:"24",y2:"8",stroke:"#22C55E",strokeWidth:"2"}),e.jsx("circle",{cx:"16",cy:"16",r:"2",fill:"#FFFFFF"}),e.jsx("circle",{cx:"24",cy:"8",r:"1.5",fill:"#22C55E"})]}),e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:i("info.about")})]}),e.jsx("button",{onClick:()=>s(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx("span",{className:"text-xl",children:"✕"})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:i("info.subtitle")}),e.jsx("p",{className:"text-gray-600 leading-relaxed",children:i("info.description")})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-semibold text-gray-800 mb-2",children:i("info.keyFeatures")}),e.jsxs("ul",{className:"text-gray-600 space-y-1 text-sm",children:[e.jsxs("li",{children:["• ",i("info.features.interactive")]}),e.jsxs("li",{children:["• ",i("info.features.realtime")]}),e.jsxs("li",{children:["• ",i("info.features.educational")]}),e.jsxs("li",{children:["• ",i("info.features.touch")]}),e.jsxs("li",{children:["• ",i("info.features.progressive")]})]})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"text-md font-semibold text-green-800 mb-2",children:["🌟 ",i("info.opensource")]}),e.jsx("p",{className:"text-green-700 text-sm mb-3",children:i("info.opensource.description")}),e.jsxs("a",{href:"https://github.com/getgrix/grix",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 text-green-700 hover:text-green-800 font-medium text-sm underline",children:[e.jsx("span",{children:"📁"}),i("info.viewGithub")]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-semibold text-gray-800 mb-2",children:i("info.contact")}),e.jsx("p",{className:"text-gray-600 text-sm mb-2",children:i("info.contact.description")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"📧"}),e.jsx("span",{className:"text-sm text-blue-600 cursor-pointer hover:text-blue-800",onClick:()=>{const c=o;window.location.href=`mailto:${c}?subject=Grix Feedback`},title:"Click to send email",children:o})]})]}),e.jsx("div",{className:"pt-4 border-t border-gray-200",children:e.jsx("p",{className:"text-xs text-gray-500 text-center",children:i("info.madeWith")})})]})]})})]})}function xs({onClearBoard:i,onExportImage:t,onImportState:s,isOpen:n,onToggle:r}){const[o,c]=u.useState(!1),a=n!==void 0?n:o,[d,h]=u.useState(!1),[j,z]=u.useState(null),E=u.useRef(null),m=u.useRef(null),{objects:D,clearObjects:U,clearSelection:l}=Me(),{resetToDefaults:y}=De(),f=()=>{r?r():c(!o)};u.useEffect(()=>{function ee(g){E.current&&!E.current.contains(g.target)&&(r?r():c(!1),h(!1))}if(a)return document.addEventListener("mousedown",ee,!0),document.addEventListener("click",ee,!0),document.addEventListener("touchstart",ee,!0),document.addEventListener("touchend",ee,!0),()=>{document.removeEventListener("mousedown",ee,!0),document.removeEventListener("click",ee,!0),document.removeEventListener("touchstart",ee,!0),document.removeEventListener("touchend",ee,!0)}},[a,r]),u.useEffect(()=>{if(a){const ee=ae.getStorageInfo();z(ee)}},[a]);const q=()=>{r?r():c(!1)},T=()=>{U(),l(),y(),ae.clearState(),h(!1),q()},v=()=>{const ee=ae.exportState();if(ee){const g=new Blob([ee],{type:"application/json"}),w=URL.createObjectURL(g),ne=document.createElement("a");ne.href=w,ne.download=`grix-session-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(ne),ne.click(),document.body.removeChild(ne),URL.revokeObjectURL(w)}q()},X=()=>{var ee;(ee=m.current)==null||ee.click()},G=async ee=>{var w;const g=(w=ee.target.files)==null?void 0:w[0];if(g){try{const ne=await g.text();await ae.importState(ne)?window.location.reload():alert("Failed to import state. Please check the file format.")}catch{alert("Failed to read file. Please select a valid Grix export file.")}m.current&&(m.current.value=""),q()}},F=()=>{t==null||t(),q()},V=ee=>{if(ee===0)return"0 B";const g=1024,w=["B","KB","MB","GB"],ne=Math.floor(Math.log(ee)/Math.log(g));return parseFloat((ee/Math.pow(g,ne)).toFixed(1))+" "+w[ne]},L=ee=>new Date(ee).toLocaleString();return d?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{ref:E,className:"bg-white rounded-lg shadow-xl max-w-sm w-full p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Clear Everything?"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"This will remove all shapes, reset settings, and clear your saved work. This action cannot be undone."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>h(!1),className:"flex-1 px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:T,className:"flex-1 px-4 py-2 text-white bg-red-600 rounded-lg hover:bg-red-700 transition-colors",children:"Clear All"})]})]})}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:f,className:"w-12 h-12 bg-white border border-gray-200 rounded-full shadow-lg hover:bg-gray-50 transition-all hover:shadow-xl flex items-center justify-center",title:"Actions & Tools",children:e.jsx("span",{className:"text-lg",children:"⚡"})}),e.jsx("input",{ref:m,type:"file",accept:".json",onChange:G,className:"hidden"}),a&&e.jsxs("div",{ref:E,className:"absolute bottom-full left-0 mb-2 z-50 bg-white border border-gray-200 rounded-lg shadow-xl min-w-64 max-w-80",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-100",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Actions & Tools"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[D.length," shape",D.length!==1?"s":""," on canvas"]})]}),e.jsxs("div",{className:"p-2",children:[e.jsxs("button",{onClick:()=>h(!0),className:"w-full flex items-center gap-3 px-3 py-2 text-left hover:bg-red-50 rounded-lg transition-colors text-red-600",disabled:D.length===0,children:[e.jsx("span",{className:"text-lg",children:"🗑️"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:"Clear Board"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Remove all shapes and reset settings"})]})]}),e.jsx("div",{className:"border-t border-gray-100 my-2"}),e.jsxs("button",{onClick:v,className:"w-full flex items-center gap-3 px-3 py-2 text-left hover:bg-gray-50 rounded-lg transition-colors text-gray-700",children:[e.jsx("span",{className:"text-lg",children:"📤"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:"Export Session"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Save your work as a file"})]})]}),e.jsxs("button",{onClick:X,className:"w-full flex items-center gap-3 px-3 py-2 text-left hover:bg-gray-50 rounded-lg transition-colors text-gray-700",children:[e.jsx("span",{className:"text-lg",children:"📥"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:"Import Session"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Load saved work from file"})]})]}),e.jsxs("button",{onClick:F,className:"w-full flex items-center gap-3 px-3 py-2 text-left hover:bg-gray-50 rounded-lg transition-colors text-gray-400",disabled:!0,children:[e.jsx("span",{className:"text-lg",children:"🖼️"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:"Export Image"}),e.jsx("div",{className:"text-xs text-gray-400",children:"Save as PNG (coming soon)"})]})]}),e.jsx("div",{className:"border-t border-gray-100 my-2"}),j&&e.jsxs("div",{className:"px-3 py-2",children:[e.jsx("div",{className:"text-xs font-medium text-gray-700 mb-2",children:"Storage Status"}),e.jsxs("div",{className:"space-y-1 text-xs text-gray-600",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Session size:"}),e.jsx("span",{children:V(j.stateSize)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Total used:"}),e.jsx("span",{children:V(j.usedSpace)})]}),j.lastSaved&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Last saved:"}),e.jsx("span",{children:L(j.lastSaved)})]})]}),e.jsxs("div",{className:"mt-2 text-xs text-green-600 flex items-center gap-1",children:[e.jsx("span",{children:"●"}),e.jsx("span",{children:"Auto-save enabled"})]})]})]}),e.jsx("div",{className:"px-4 py-2 bg-gray-50 border-t border-gray-100 rounded-b-lg",children:e.jsx("p",{className:"text-xs text-gray-500 text-center",children:"Works offline • Auto-saves your progress"})})]})]})}function gs({isVisible:i,onDismiss:t}){const{t:s}=Xe(),[n,r]=u.useState(!1);u.useEffect(()=>{i&&r(!0)},[i]);const o=(c=!1)=>{if(c){const a=ae.loadState()||{},d={...a,tutorialSettings:{...a.tutorialSettings,lineToolTutorialSeen:!0}};ae.saveState(d),ae.scheduleSave()}r(!1),setTimeout(()=>t(),300)};return i?e.jsx("div",{className:"fixed inset-0 bg-gray-900 bg-opacity-20 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:`bg-white rounded-2xl shadow-2xl max-w-md w-full border border-gray-200 transform transition-all duration-300 ${n?"scale-100 opacity-100":"scale-95 opacity-0"}`,children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-purple-700 text-white p-6 rounded-t-2xl relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-black/20"}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("h3",{className:"text-lg font-bold mb-1 text-white drop-shadow-sm",children:s("linetool.firstTime.title")}),e.jsx("p",{className:"text-white/90 text-sm",children:s("linetool.firstTime.subtitle")})]})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsx("div",{className:"flex items-start gap-3",children:e.jsx("span",{className:"text-sm",children:s("linetool.firstTime.feature1")})}),e.jsx("div",{className:"flex items-start gap-3",children:e.jsx("span",{className:"text-sm",children:s("linetool.firstTime.feature2")})}),e.jsx("div",{className:"flex items-start gap-3",children:e.jsx("span",{className:"text-sm",children:s("linetool.firstTime.feature3")})}),e.jsx("div",{className:"flex items-start gap-3",children:e.jsx("span",{className:"text-sm",children:s("linetool.firstTime.feature4")})})]}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 mb-6 border-2 border-dashed border-gray-300",children:e.jsxs("div",{className:"relative w-full h-24 flex items-center justify-center",children:[e.jsxs("svg",{width:"120",height:"80",viewBox:"0 0 120 80",className:"absolute",children:[e.jsxs("g",{stroke:"#E5E7EB",strokeWidth:"0.5",children:[e.jsx("line",{x1:"20",y1:"0",x2:"20",y2:"80"}),e.jsx("line",{x1:"40",y1:"0",x2:"40",y2:"80"}),e.jsx("line",{x1:"60",y1:"0",x2:"60",y2:"80"}),e.jsx("line",{x1:"80",y1:"0",x2:"80",y2:"80"}),e.jsx("line",{x1:"100",y1:"0",x2:"100",y2:"80"}),e.jsx("line",{x1:"0",y1:"20",x2:"120",y2:"20"}),e.jsx("line",{x1:"0",y1:"40",x2:"120",y2:"40"}),e.jsx("line",{x1:"0",y1:"60",x2:"120",y2:"60"})]}),e.jsxs("g",{stroke:"#374151",strokeWidth:"1",children:[e.jsx("line",{x1:"60",y1:"0",x2:"60",y2:"80"}),e.jsx("line",{x1:"0",y1:"40",x2:"120",y2:"40"})]}),e.jsx("circle",{cx:"60",cy:"40",r:"3",fill:"#EF4444",className:"animate-pulse",children:e.jsx("animate",{attributeName:"r",values:"2;4;2",dur:"1.5s",repeatCount:"indefinite"})}),e.jsx("line",{x1:"60",y1:"40",x2:"100",y2:"20",stroke:"#2563eb",strokeWidth:"2"}),e.jsxs("g",{transform:"translate(100, 15)",children:[e.jsx("rect",{x:"-8",y:"-8",width:"16",height:"16",fill:"#60A5FA",rx:"2",opacity:"0.9"}),e.jsx("text",{x:"0",y:"-2",fontSize:"6",fill:"white",textAnchor:"middle",children:"3"}),e.jsx("line",{x1:"-6",y1:"0",x2:"6",y2:"0",stroke:"white",strokeWidth:"0.5"}),e.jsx("text",{x:"0",y:"6",fontSize:"6",fill:"white",textAnchor:"middle",children:"2"})]}),e.jsx("circle",{cx:"80",cy:"30",r:"1.5",fill:"#22C55E",opacity:"0.7"}),e.jsx("circle",{cx:"100",cy:"20",r:"1.5",fill:"#22C55E",opacity:"0.7"})]}),e.jsx("div",{className:"absolute bottom-1 left-1/2 transform -translate-x-1/2",children:e.jsx("span",{className:"text-xs text-gray-600 bg-white px-2 py-1 rounded shadow",children:"Start here: (0,0)"})})]})}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:e.jsx("p",{className:"text-blue-800 text-sm font-medium text-center",children:s("linetool.firstTime.hint")})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>o(!1),className:"flex-1 bg-blue-600 text-white py-3 px-4 rounded-lg font-medium hover:bg-blue-700 transition-colors",children:s("linetool.firstTime.dismiss")}),e.jsx("button",{onClick:()=>o(!0),className:"px-4 py-3 text-gray-500 hover:text-gray-700 text-sm transition-colors",children:s("linetool.firstTime.dontShow")})]})]})]})}):null}function ps({isVisible:i,onDismiss:t}){const{t:s}=Xe(),[n,r]=u.useState(!1);u.useEffect(()=>{i&&r(!0)},[i]);const o=(c=!1)=>{if(c){const a=ae.loadState()||{},d={...a,tutorialSettings:{...a.tutorialSettings,homeButtonTutorialSeen:!0}};ae.saveState(d),ae.scheduleSave()}r(!1),setTimeout(()=>t(),300)};return i?e.jsx("div",{className:"fixed inset-0 bg-gray-900 bg-opacity-20 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:`bg-white rounded-2xl shadow-2xl max-w-md w-full border border-gray-200 transform transition-all duration-300 ${n?"scale-100 opacity-100":"scale-95 opacity-0"}`,children:[e.jsxs("div",{className:"bg-gradient-to-r from-green-600 to-blue-700 text-white p-6 rounded-t-2xl relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-black/20"}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("h3",{className:"text-lg font-bold mb-1 text-white drop-shadow-sm",children:s("homebutton.firstTime.title")}),e.jsx("p",{className:"text-white/90 text-sm",children:s("homebutton.firstTime.subtitle")})]})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-lg",children:"👆"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-1",children:s("homebutton.firstTime.singleClick")}),e.jsx("p",{className:"text-sm text-gray-600",children:s("homebutton.firstTime.singleClickDesc")})]})]})}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-lg",children:"👆👆"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-1",children:s("homebutton.firstTime.doubleClick")}),e.jsx("p",{className:"text-sm text-gray-600",children:s("homebutton.firstTime.doubleClickDesc")})]})]})})]}),e.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-green-50 rounded-lg p-4 mb-6 border-2 border-dashed border-blue-300",children:e.jsx("div",{className:"relative w-full h-32 flex items-center justify-center",children:e.jsxs("svg",{width:"200",height:"100",viewBox:"0 0 200 100",className:"absolute",children:[e.jsxs("g",{stroke:"#E5E7EB",strokeWidth:"0.5",children:[[40,60,80,100,120,140,160].map(c=>e.jsx("line",{x1:c,y1:"0",x2:c,y2:"100"},`v${c}`)),[20,40,60,80].map(c=>e.jsx("line",{x1:"0",y1:c,x2:"200",y2:c},`h${c}`))]}),e.jsxs("g",{stroke:"#374151",strokeWidth:"1",children:[e.jsx("line",{x1:"100",y1:"0",x2:"100",y2:"100"}),e.jsx("line",{x1:"0",y1:"50",x2:"200",y2:"50"})]}),e.jsx("circle",{cx:"100",cy:"50",r:"3",fill:"#EF4444"}),e.jsxs("g",{transform:"translate(170, 70)",children:[e.jsx("rect",{x:"-15",y:"-15",width:"30",height:"30",rx:"15",fill:"#2563eb",opacity:"0.9"}),e.jsx("text",{x:"0",y:"5",fontSize:"16",fill:"white",textAnchor:"middle",children:"🏠"}),e.jsxs("circle",{cx:"0",cy:"0",r:"20",fill:"none",stroke:"#2563eb",strokeWidth:"2",opacity:"0.3",children:[e.jsx("animate",{attributeName:"r",values:"15;25;15",dur:"2s",repeatCount:"indefinite"}),e.jsx("animate",{attributeName:"opacity",values:"0.5;0;0.5",dur:"2s",repeatCount:"indefinite"})]})]}),e.jsx("path",{d:"M 130 50 L 110 50 M 110 50 L 115 45 M 110 50 L 115 55",stroke:"#10B981",strokeWidth:"2",fill:"none",strokeDasharray:"2,2",opacity:"0.7"})]})})}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:e.jsx("p",{className:"text-blue-800 text-sm font-medium text-center",children:s("homebutton.firstTime.hint")})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>o(!1),className:"flex-1 bg-blue-600 text-white py-3 px-4 rounded-lg font-medium hover:bg-blue-700 transition-colors",children:s("homebutton.firstTime.dismiss")}),e.jsx("button",{onClick:()=>o(!0),className:"px-4 py-3 text-gray-500 hover:text-gray-700 text-sm transition-colors",children:s("homebutton.firstTime.dontShow")})]})]})]})}):null}function fs({onDismiss:i}){const{worldToScreen:t,objects:s}=Me(),{t:n}=Xe(),[r,o]=u.useState(!0),c=s.find(E=>E.id.startsWith("ray_default_")),a=(c==null?void 0:c.properties.endPoint)||{x:3,y:9},d={x:a.x,y:a.y-3};u.useEffect(()=>{const E=setTimeout(()=>{h()},3e4),m=()=>{clearTimeout(E),setTimeout(()=>h(),500)};return document.addEventListener("mousedown",m),document.addEventListener("touchstart",m),()=>{clearTimeout(E),document.removeEventListener("mousedown",m),document.removeEventListener("touchstart",m)}},[]);const h=()=>{o(!1),setTimeout(()=>i(),300)};if(!r)return null;const j=t(d),z=window.innerWidth<768;return c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40 bg-black bg-opacity-10",onClick:h}),e.jsx("div",{className:"fixed z-45 pointer-events-none",style:{left:j.x-16,top:j.y-16},children:e.jsxs("div",{className:"relative w-8 h-8",children:[e.jsx("div",{className:"absolute inset-0 bg-yellow-400 rounded-full animate-ping opacity-50"}),e.jsx("div",{className:"absolute inset-1 bg-blue-500 rounded-full animate-ping opacity-40 animation-delay-200"}),e.jsx("div",{className:"absolute inset-2 bg-white rounded-full border-2 border-blue-600 shadow-lg animate-pulse"}),e.jsx("div",{className:"absolute inset-3 bg-blue-600 rounded-full"})]})}),e.jsx("div",{className:`fixed z-50 transition-all duration-300 ease-out ${r?"opacity-100 translate-y-0":"opacity-0 translate-y-4"} ${z?"bottom-20 left-4 right-4":"bottom-8 left-1/2 transform -translate-x-1/2"}`,style:z?{}:{width:"400px",maxWidth:"90vw"},children:e.jsxs("div",{className:"bg-white border border-blue-200 rounded-xl shadow-lg p-4 relative",children:[e.jsx("button",{onClick:h,className:"absolute top-2 right-2 text-gray-400 hover:text-gray-600 text-xl leading-none w-6 h-6 flex items-center justify-center",children:"×"}),e.jsxs("div",{className:"pr-8",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse"}),e.jsx("div",{className:"font-semibold text-gray-800 text-sm",children:n("endpoint.tooltip.title")})]}),e.jsx("div",{className:"text-gray-600 text-sm leading-relaxed",children:n("endpoint.tooltip.message")})]}),e.jsx("div",{className:"absolute inset-0 rounded-xl bg-gradient-to-r from-blue-500 to-purple-500 opacity-20 pointer-events-none"})]})})]}):null}const zt=(i,t)=>{const s=t*Math.PI/180,n=Math.cos(s),r=Math.sin(s);return{x:i.x*n-i.y*r,y:i.x*r+i.y*n}},ms=(i,t)=>({x:i.x*t,y:i.y*t}),Dt=(i,t)=>{switch(t){case"x":return{x:i.x,y:-i.y};case"y":return{x:-i.x,y:i.y};case"origin":return{x:-i.x,y:-i.y};default:return i}},ys=pt((i,t)=>({isTransforming:!1,activeTransform:null,selectedObject:null,rotateObject:(s,n,r)=>{if(!r){console.log(`No canvas API provided for rotation of ${s}`);return}const o=r.getObject(s);if(o){if(o.type==="ray"){if(Math.abs(o.properties.startPoint.x)<.001&&Math.abs(o.properties.startPoint.y)<.001){const a=zt(o.properties.endPoint,n);r.updateObject(s,{properties:{...o.properties,endPoint:a}})}}else if(o.type==="rectangle"){const c=o.properties.x+o.properties.width/2,a=o.properties.y+o.properties.height/2,d={x:o.properties.x-c,y:o.properties.y-a},h=zt(d,n);r.updateObject(s,{properties:{...o.properties,x:h.x+c,y:h.y+a}})}}},scaleObject:(s,n,r)=>{if(!r){console.log(`No canvas API provided for scaling of ${s}`);return}const o=r.getObject(s);if(o)if(o.type==="ray"){if(Math.abs(o.properties.startPoint.x)<.001&&Math.abs(o.properties.startPoint.y)<.001){const a=ms(o.properties.endPoint,n);r.updateObject(s,{properties:{...o.properties,endPoint:a}})}}else o.type==="rectangle"&&r.updateObject(s,{properties:{...o.properties,width:o.properties.width*n,height:o.properties.height*n,area:o.properties.width*n*o.properties.height*n}})},reflectObject:(s,n,r)=>{if(!r){console.log(`No canvas API provided for reflection of ${s}`);return}const o=r.getObject(s);if(o){if(o.type==="ray"){if(Math.abs(o.properties.startPoint.x)<.001&&Math.abs(o.properties.startPoint.y)<.001){const a=Dt(o.properties.endPoint,n);r.updateObject(s,{properties:{...o.properties,endPoint:a}})}}else if(o.type==="rectangle"){const c=Dt({x:o.properties.x,y:o.properties.y},n);r.updateObject(s,{properties:{...o.properties,x:c.x,y:c.y}})}}},rotate90:(s,n)=>{t().rotateObject(s,90,n)},rotate180:(s,n)=>{t().rotateObject(s,180,n)},rotate270:(s,n)=>{t().rotateObject(s,270,n)},setActiveTransform:s=>{i({activeTransform:s,isTransforming:s!==null})},setSelectedObject:s=>{i({selectedObject:s})},clearTransform:()=>{i({isTransforming:!1,activeTransform:null,selectedObject:null})}})),It=u.createContext(void 0);function bs({children:i}){const[t,s]=u.useState(null);return e.jsx(It.Provider,{value:{openMenu:t,setOpenMenu:s},children:i})}function yt(){const i=u.useContext(It);if(!i)throw new Error("useMenuState must be used within a MenuStateProvider");return i}function Lt({width:i=800,height:t=600,className:s="",onObjectInteraction:n}){const r=u.useRef(null),{openMenu:o,setOpenMenu:c}=yt(),{viewport:a,setViewport:d,objects:h,selectedObjects:j,snapToGrid:z,gridDensity:E,canvasSize:m,setCanvasSize:D,removeObject:U,clearSelection:l,selectObject:y,screenToWorld:f,worldToScreen:q,getObject:T,updateObject:v}=Me(),X=es(),{activeTool:G,setActiveTool:F,eventBus:V}=rt(),{rotate90:L,rotate180:ee,rotate270:g,scaleObject:w,setSelectedObject:ne}=ys(),{zoomSensitivity:xe}=De(),[Fe,ge]=u.useState(!1);u.useEffect(()=>{const p=()=>{const W=localStorage.getItem("grix-show-endpoint-tooltip"),I=localStorage.getItem("grix-tutorial-completed");return console.log("Endpoint tooltip check:",{shouldShow:W,tutorialCompleted:I,willShow:W==="true"&&I==="true"}),W==="true"&&I==="true"?(console.log("Showing endpoint tooltip in 1 second..."),setTimeout(()=>{ge(!0)},1e3)):null},A=p(),O=W=>{if(W.key==="grix-tutorial-completed"){const I=p();return A&&clearTimeout(A),I}};return window.addEventListener("storage",O),()=>{A&&clearTimeout(A),window.removeEventListener("storage",O)}},[]),u.useEffect(()=>{D({width:i,height:t})},[i,t,D]);const $=u.useRef({isPanning:!1,startPoint:{x:0,y:0},startCenter:{x:0,y:0}}),ce=u.useRef({isDown:!1,startPoint:{x:0,y:0},hasMoved:!1,dragThreshold:5,pendingSelection:null}),[b,Z]=u.useState(null),[de,fe]=u.useState(!1),[Oe,K]=u.useState(!1),[ke,Re]=u.useState(!1),[oe,re]=u.useState(!1),[me,ye]=u.useState(!1),ve=u.useRef(0),$e=u.useRef({worldPoint:{x:0,y:0},timestamp:0,overlappingObjects:[],currentIndex:0}),pe=u.useCallback((p,A=.5)=>{const O=[];for(const W of h){let I=0,se=1/0,te=!1;switch(W.type){case"ray":const P=ot(p,W.properties.startPoint,W.properties.endPoint);P<=A&&(I=100,se=P,te=!0);break;case"rectangle":const{x:_,y:Y,width:H,height:J}=W.properties,le=[{start:{x:_,y:Y},end:{x:_+H,y:Y}},{start:{x:_+H,y:Y},end:{x:_+H,y:Y+J}},{start:{x:_+H,y:Y+J},end:{x:_,y:Y+J}},{start:{x:_,y:Y+J},end:{x:_,y:Y}}];let ue=1/0;for(const Ae of le){const ze=ot(p,Ae.start,Ae.end);ue=Math.min(ue,ze)}ue<=A?(I=100,se=ue,te=!0):p.x>=_&&p.x<=_+H&&p.y>=Y&&p.y<=Y+J&&(I=50,se=0,te=!0);break;case"circle":const{center:Ee,radius:Ce}=W.properties,Pe=Math.sqrt((p.x-Ee.x)**2+(p.y-Ee.y)**2),Ie=Nt(p,Ee,Ce);Ie<=A?(I=100,se=Ie,te=!0):Pe<=Ce&&(I=50,se=Ce-Pe,te=!0);break;case"triangle":const{vertices:Le}=W.properties,Se=[[Le[0],Le[1]],[Le[1],Le[2]],[Le[2],Le[0]]];let je=1/0;for(const[Ae,ze]of Se){const Ge=ot(p,Ae,ze);je=Math.min(je,Ge)}je<=A?(I=100,se=je,te=!0):Pt(p,Le)&&(I=50,se=0,te=!0);break;case"function":const He=W.properties.points;if(He&&He.length>1){let Ae=1/0;for(let ze=0;ze<He.length-1;ze++){const Ge=He[ze],Ve=He[ze+1],Ye=ot(p,Ge,Ve);Ae=Math.min(Ae,Ye)}Ae<=A&&(I=100,se=Ae,te=!0)}break}te&&O.push({object:W,priority:I,distance:se})}return O.sort((W,I)=>W.priority!==I.priority?I.priority-W.priority:W.distance!==I.distance?W.distance-I.distance:(I.object.zIndex||0)-(W.object.zIndex||0)),O.map(W=>W.object)},[h,ot,Pt,Nt]),he=u.useCallback(p=>{const A={x:p.x,y:p.y};ce.current={isDown:!0,startPoint:A,hasMoved:!1,dragThreshold:5,pendingSelection:null};const O=f(A),I=pe(O,.5);let se=!1,te=null;if(I.length>0){se=!0;const P=Date.now(),_=$e.current,Y=Math.abs(O.x-_.worldPoint.x)<.1&&Math.abs(O.y-_.worldPoint.y)<.1,H=P-_.timestamp<500;if(Y&&H&&_.overlappingObjects.length>1){const J=(_.currentIndex+1)%_.overlappingObjects.length,le=_.overlappingObjects[J];te=I.find(ue=>ue.id===le)||I[0],$e.current={worldPoint:O,timestamp:P,overlappingObjects:_.overlappingObjects,currentIndex:J}}else te=I[0],$e.current={worldPoint:O,timestamp:P,overlappingObjects:I.map(J=>J.id),currentIndex:0};ce.current.pendingSelection={objectId:te.id,type:te.type},y(te.id)}else $e.current={worldPoint:{x:0,y:0},timestamp:0,overlappingObjects:[],currentIndex:0};(!se&&!G||!se&&G)&&l(),(G||se)&&X.handlePointerDown(p),!se&&!G&&(p.type==="touch"||p.type==="mouse")&&($.current={isPanning:!0,startPoint:{x:p.x,y:p.y},startCenter:{...a.center}})},[a.center,X,G,F,h,f,q,a.zoom]),Te=u.useCallback(p=>{const A={x:p.x,y:p.y};if(p.type==="mouse"&&G?Z(A):G||Z(null),ce.current.isDown&&!ce.current.hasMoved){const O=Math.abs(p.x-ce.current.startPoint.x),W=Math.abs(p.y-ce.current.startPoint.y);Math.sqrt(O*O+W*W)>=ce.current.dragThreshold&&(ce.current.hasMoved=!0,Re(!0),ce.current.pendingSelection=null)}if(X.handlePointerMove(p),!G&&$.current.isPanning){const O=(p.x-$.current.startPoint.x)/a.zoom,W=(p.y-$.current.startPoint.y)/a.zoom;d({center:{x:$.current.startCenter.x-O,y:$.current.startCenter.y+W}})}},[a.zoom,d,X,G,Z]),qe=u.useCallback(p=>{Re(!1),ce.current={isDown:!1,startPoint:{x:0,y:0},hasMoved:!1,dragThreshold:5,pendingSelection:null},X.handlePointerUp(p),$.current.isPanning=!1},[X,F]),_t=u.useCallback(p=>{switch(p.type){case"pinch":if(p.scale&&p.center){const A=h.length,O=()=>{const J=A>50?100:A>20?200:500;return a.zoom<1?{min:.1,max:Math.min(50,J)}:a.zoom>100?{min:5,max:J}:{min:.1,max:J}},{min:W,max:I}=O();let se=1;if(p.touches&&p.touches>1){const H=/iPad|iPhone|iPod/.test(navigator.userAgent),J=(()=>{switch(xe){case"low":return H?.15:.25;case"medium":return H?.25:.35;case"high":return H?.4:.5;default:return H?.25:.35}})(),le=a.zoom<.5||a.zoom>50?.7:1,Ce=Math.abs(p.scale-1)>(xe==="high"?.5:.3)?.6:1;se=J*le*Ce}const te=p.scale-1,P=xe==="high"?.01:xe==="low"?.03:.02;if(Math.abs(te)<P)return;const _=1+te*se;let Y=a.zoom*_;if(Y>I*.9){const H=(Y-I*.9)/(I*.1);Y=I*.9+I*.1*(1-Math.exp(-H))}if(Y<W*1.1){const H=(W*1.1-Y)/(W*.1);Y=W*1.1-W*.1*(1-Math.exp(-H))}if(Y=Math.max(W,Math.min(I,Y)),Math.abs(Y-a.zoom)>.001){const H=Y/a.zoom,J=f(p.center),le={x:J.x+(a.center.x-J.x)/H,y:J.y+(a.center.y-J.y)/H};d({zoom:Y,center:le})}}break}},[a.zoom,a.center,d,h.length,f,xe]),{capabilities:at,touchTargetSize:Ue}=Mt(r,{onPointerDown:he,onPointerMove:Te,onPointerUp:qe,onGesture:_t},{enableGestures:!0,preventScrolling:!0});u.useEffect(()=>{const p=O=>{switch(O.key){case"ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":if(j.length>0){O.preventDefault();const W=O.shiftKey?.1:1;let I=0,se=0;switch(O.key){case"ArrowUp":se=W;break;case"ArrowDown":se=-W;break;case"ArrowLeft":I=-W;break;case"ArrowRight":I=W;break}j.forEach(te=>{const P=T(te);if(P)switch(P.type){case"ray":v(te,{properties:{...P.properties,startPoint:{x:P.properties.startPoint.x+I,y:P.properties.startPoint.y+se},endPoint:{x:P.properties.endPoint.x+I,y:P.properties.endPoint.y+se}}});break;case"rectangle":v(te,{properties:{...P.properties,x:P.properties.x+I,y:P.properties.y+se}});break;case"circle":v(te,{properties:{...P.properties,center:{x:P.properties.center.x+I,y:P.properties.center.y+se}}});break;case"triangle":const _=P.properties.vertices.map(J=>({x:J.x+I,y:J.y+se}));v(te,{properties:{...P.properties,vertices:_}});break;case"function":const Y={min:P.properties.domain.min+I,max:P.properties.domain.max+I},H=P.properties.points.map(J=>({x:J.x+I,y:J.y+se}));v(te,{properties:{...P.properties,domain:Y,points:H}});break}})}break;case"Escape":G&&(V.emit("tool:cancel",{toolId:G}),F(null));break;case"Delete":case"Backspace":j.length>0&&(console.log("Deleting objects:",j),j.forEach(W=>{V.emit("object:removed",{objectId:W}),U(W)}),l(),F(null));break;case"r":case"R":if(j.length>0&&!O.ctrlKey){O.preventDefault();const W={getObject:T,updateObject:v};j.forEach(I=>{O.shiftKey?g(I,W):L(I,W)})}break;case"f":case"F":if(j.length>0&&!O.ctrlKey){O.preventDefault();const W={getObject:T,updateObject:v};j.forEach(I=>{ee(I,W)})}break;case"=":case"+":if(j.length>0&&!O.ctrlKey){O.preventDefault();const W={getObject:T,updateObject:v};j.forEach(I=>{w(I,2,W)})}break;case"-":case"_":if(j.length>0&&!O.ctrlKey){O.preventDefault();const W={getObject:T,updateObject:v};j.forEach(I=>{w(I,.5,W)})}break}},A=O=>{l(),F(null)};return document.addEventListener("keydown",p),V.on("tool:creation-complete",A),()=>{document.removeEventListener("keydown",p),V.off("tool:creation-complete",A)}},[G,F,V,j,U,l]),u.useEffect(()=>{j.length===1&&!ke&&!Oe?fe(!0):(j.length!==1||ke)&&(fe(!1),K(!1))},[j,ke,Oe]),u.useEffect(()=>{o&&de&&fe(!1)},[o,de]),u.useEffect(()=>{var p;if(G==="ray-tool"){const A=ae.loadState();if(!((p=A==null?void 0:A.tutorialSettings)==null?void 0:p.lineToolTutorialSeen)){const W=setTimeout(()=>{re(!0)},300);return()=>clearTimeout(W)}}},[G]);const ut=u.useCallback(()=>{fe(!1),K(!0)},[]),k=u.useCallback(()=>{j.length>0&&(j.forEach(p=>{V.emit("object:removed",{objectId:p}),U(p)}),l())},[j,U,l,V]),x=u.useCallback((p,A)=>{v(p,A)},[v]),C=u.useCallback(()=>{re(!1)},[]),B=u.useCallback(()=>{ye(!1)},[]),S=u.useCallback(()=>{const p=Math.min(1e3,a.zoom*1.4);d({zoom:p})},[a.zoom,d]),M=u.useCallback(()=>{const p=Math.max(.01,a.zoom/1.4);d({zoom:p})},[a.zoom,d]),R=u.useCallback(()=>{d({zoom:20,center:{x:0,y:0}})},[d]),N=u.useCallback(()=>{var p;if(d({center:{x:0,y:0}}),ve.current+=1,ve.current===1){const A=ae.loadState();((p=A==null?void 0:A.tutorialSettings)==null?void 0:p.homeButtonTutorialSeen)||setTimeout(()=>{ye(!0)},300)}},[d]);return u.useEffect(()=>{const p=O=>{O.preventDefault();const I=Me.getState().viewport;if(O.ctrlKey||O.metaKey){const se=O.deltaY>0?.9:1.1,te=Math.max(.01,Math.min(1e3,I.zoom*se));d({zoom:te})}else{const te=O.shiftKey?O.deltaY:0,P=O.shiftKey?0:O.deltaY,_=te*1/I.zoom,Y=P*1/I.zoom;d({center:{x:I.center.x+_,y:I.center.y-Y}})}},A=r.current;if(A)return A.addEventListener("wheel",p,{passive:!1}),()=>{A.removeEventListener("wheel",p)}},[d]),e.jsxs("div",{className:`relative ${s}`,style:{width:i,height:t},children:[e.jsxs("svg",{ref:r,width:i,height:t,className:"absolute inset-0 bg-white",style:{touchAction:"none"},children:[e.jsx(ns,{viewport:a,canvasSize:{width:i,height:t},worldToScreen:q,objects:h}),e.jsx(as,{objects:h,viewport:a,touchTargetSize:Ue,worldToScreen:q,selectedObjects:j,canvasSize:{width:i,height:t}}),G&&b&&!ce.current.isDown&&e.jsx("circle",{cx:b.x,cy:b.y,r:"4",fill:"rgba(37, 99, 235, 0.4)",stroke:"#2563eb",strokeWidth:"1",opacity:"0.8",style:{pointerEvents:"none"}})]}),e.jsx(cs,{capabilities:at,viewport:a,activeTool:G,selectedObjectsCount:j.length}),e.jsx(os,{viewport:a,onZoomIn:S,onZoomOut:M,onZoomReset:R,onCenterOnly:N}),de&&j.length===1&&e.jsx(ls,{selectedObject:h.find(p=>p.id===j[0])||null,onDelete:k,onUpdate:x,onClose:ut}),e.jsxs("div",{className:"fixed bottom-4 left-4 z-50 flex gap-3",children:[e.jsx(ds,{isOpen:o==="settings",onToggle:()=>c(o==="settings"?null:"settings")}),e.jsx(xs,{isOpen:o==="action",onToggle:()=>c(o==="action"?null:"action")})]}),e.jsx(hs,{}),e.jsx(us,{}),e.jsx(gs,{isVisible:oe,onDismiss:C}),e.jsx(ps,{isVisible:me,onDismiss:B}),Fe&&e.jsx(fs,{onDismiss:()=>{ge(!1),localStorage.removeItem("grix-show-endpoint-tooltip")}})]})}function vs(){const{t:i}=Xe(),{openMenu:t,setOpenMenu:s}=yt(),n=t==="examples",[r,o]=u.useState([]),[c,a]=u.useState([]),[d,h]=u.useState("all"),[j,z]=u.useState(!1),[E,m]=u.useState(null),D=u.useRef(null);u.useEffect(()=>{function v(X){D.current&&!D.current.contains(X.target)&&s(null)}if(n)return document.addEventListener("mousedown",v,!0),document.addEventListener("click",v,!0),()=>{document.removeEventListener("mousedown",v,!0),document.removeEventListener("click",v,!0)}},[n,s]),u.useEffect(()=>{(async()=>{try{z(!0),m(null);const[X,G]=await Promise.all([tt.getExamples(),tt.getCategories()]);o(X),a(G)}catch(X){console.error("Failed to load examples:",X),m("Failed to load examples")}finally{z(!1)}})()},[]);const U=async v=>{try{z(!0),m(null),await tt.applyExample(v.id),s(null)}catch(X){console.error("Failed to apply example:",X),m(`Failed to load "${v.title}"`)}finally{z(!1)}},l=async()=>{try{z(!0),m(null),await tt.clearCanvas(),s(null)}catch(v){console.error("Failed to clear canvas:",v),m("Failed to clear canvas")}finally{z(!1)}},y=d==="all"?r:r.filter(v=>v.category===d),f=v=>{switch(v){case"beginner":return"text-green-600 bg-green-50";case"intermediate":return"text-yellow-600 bg-yellow-50";case"advanced":return"text-red-600 bg-red-50";default:return"text-gray-600 bg-gray-50"}},q=v=>{switch(v){case"beginner":return"●";case"intermediate":return"●●";case"advanced":return"●●●";default:return"?"}},T=v=>{const X={fractions:"examples.category.fractions",geometry:"examples.category.geometry",algebra:"examples.category.algebra",trigonometry:"examples.category.trigonometry",calculus:"examples.category.calculus",statistics:"examples.category.statistics",basics:"examples.category.basics",advanced:"examples.category.advanced","number theory":"examples.category.numbertheory",numbertheory:"examples.category.numbertheory","number-theory":"examples.category.numbertheory",precalculus:"examples.category.precalculus","pre-calculus":"examples.category.precalculus",linearalgebra:"examples.category.linearalgebra","linear algebra":"examples.category.linearalgebra","linear-algebra":"examples.category.linearalgebra",discrete:"examples.category.discrete","discrete math":"examples.category.discrete","discrete-math":"examples.category.discrete",discretemath:"examples.category.discrete",probability:"examples.category.probability",functions:"examples.category.functions"},G=v.id.toLowerCase().replace(/[^a-z0-9]/g,""),F=v.name.toLowerCase().replace(/[^a-z0-9]/g,""),V=X[G]||X[F];if(V){const L=i(V);return L===V?v.name:L}return v.name};return e.jsxs("div",{ref:D,className:"relative z-50",children:[e.jsxs("button",{onClick:()=>s(t==="examples"?null:"examples"),className:"flex items-center gap-2 px-4 py-2 rounded-lg border transition-all bg-gray-50 border-gray-200 text-gray-700 hover:bg-gray-100",title:i("toolbar.examples"),disabled:j,children:[e.jsx("span",{className:"text-lg",children:"📚"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:i("toolbar.examples")}),e.jsx("span",{className:`text-xs transition-transform ${n?"rotate-180":""}`,children:"▼"})]}),n&&e.jsxs("div",{className:"absolute top-full right-0 mt-2 bg-white border border-gray-200 rounded-lg shadow-lg w-80 max-h-[32rem] overflow-hidden",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-100 px-4 py-3 rounded-t-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:i("tutorial.examples.title")}),e.jsx("button",{onClick:l,className:"text-xs text-red-600 hover:text-red-800 font-medium",disabled:j,children:i("actions.clearBoard")})]}),e.jsx("div",{className:"mt-2",children:e.jsxs("select",{value:d,onChange:v=>h(v.target.value),className:"w-full text-xs border border-gray-200 rounded px-2 py-1 bg-white",disabled:j,children:[e.jsx("option",{value:"all",children:(()=>{const v=i("examples.allCategories");return v==="examples.allCategories"?"All Categories":v})()}),c.map(v=>e.jsx("option",{value:v.id,children:T(v)},v.id))]})})]}),E&&e.jsx("div",{className:"px-4 py-2 bg-red-50 border-b border-red-100",children:e.jsx("p",{className:"text-xs text-red-600",children:E})}),e.jsx("div",{className:"overflow-y-auto max-h-80 examples-scrollable",children:j?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"text-sm text-gray-500",children:i("tutorial.loading")})}):y.length===0?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"text-sm text-gray-500",children:i("examples.noExamples")})}):e.jsx("div",{className:"p-2 space-y-1",children:y.map(v=>e.jsx("button",{onClick:()=>U(v),className:"w-full text-left p-3 rounded-lg hover:bg-gray-50 transition-colors group",disabled:j,children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 group-hover:text-blue-600 truncate",children:v.title}),e.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded font-medium ${f(v.difficulty)}`,title:`${v.difficulty} difficulty`,children:q(v.difficulty)})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1 line-clamp-2",children:v.description}),c.find(X=>X.id===v.category)&&e.jsxs("div",{className:"flex items-center gap-1 mt-2",children:[e.jsx("span",{className:"text-xs text-gray-400",children:(()=>{const X=c.find(G=>G.id===v.category);return X?T(X):""})()}),e.jsx("span",{className:"text-xs text-gray-300",children:"•"}),e.jsxs("span",{className:"text-xs text-gray-400",children:[v.objects.length," object",v.objects.length!==1?"s":""]})]})]})})},v.id))})}),e.jsx("div",{className:"sticky bottom-0 bg-gray-50 border-t border-gray-100 px-4 py-2 rounded-b-lg",children:e.jsx("p",{className:"text-xs text-gray-500 text-center",children:"Click an example to explore mathematical concepts"})})]})]})}function Wt({className:i=""}){const{activeTool:t,setActiveTool:s}=rt(),{openMenu:n,setOpenMenu:r}=yt(),{t:o}=Xe(),c=n==="build",a=u.useRef(null),d=[{id:"ray-tool",name:o("tools.line"),icon:"📏",description:o("tools.line.description")},{id:"rectangle-tool",name:o("tools.rectangle"),icon:"⬜",description:o("tools.rectangle.description")},{id:"circle-tool",name:o("tools.circle"),icon:"⭕",description:o("tools.circle.description")},{id:"triangle-tool",name:o("tools.triangle"),icon:"🔺",description:o("tools.triangle.description")},{id:"function-tool",name:o("tools.function"),icon:"📈",description:o("tools.function.description")}],h=m=>{s(m),r(null)},j=()=>{s(null),r(null)},z=()=>{r(n==="build"?null:"build")},E=d.find(m=>m.id===t);return u.useEffect(()=>{const m=D=>{a.current&&!a.current.contains(D.target)&&r(null)};if(c)return document.addEventListener("mousedown",m,!0),document.addEventListener("touchstart",m,!0),document.addEventListener("click",m,!0),()=>{document.removeEventListener("mousedown",m,!0),document.removeEventListener("touchstart",m,!0),document.removeEventListener("click",m,!0)}},[c,r]),e.jsxs("div",{className:`flex items-center gap-2 p-2 bg-white border-b border-gray-200 ${i}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mr-4",children:[e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 32 32",className:"flex-shrink-0",children:[e.jsx("rect",{width:"32",height:"32",fill:"#2563eb",rx:"6"}),e.jsxs("g",{stroke:"#60A5FA",strokeWidth:"0.5",opacity:"0.6",children:[e.jsx("line",{x1:"8",y1:"4",x2:"8",y2:"28"}),e.jsx("line",{x1:"16",y1:"4",x2:"16",y2:"28"}),e.jsx("line",{x1:"24",y1:"4",x2:"24",y2:"28"}),e.jsx("line",{x1:"4",y1:"8",x2:"28",y2:"8"}),e.jsx("line",{x1:"4",y1:"16",x2:"28",y2:"16"}),e.jsx("line",{x1:"4",y1:"24",x2:"28",y2:"24"})]}),e.jsxs("g",{stroke:"#FFFFFF",strokeWidth:"1",children:[e.jsx("line",{x1:"16",y1:"4",x2:"16",y2:"28"}),e.jsx("line",{x1:"4",y1:"16",x2:"28",y2:"16"})]}),e.jsx("line",{x1:"16",y1:"16",x2:"24",y2:"8",stroke:"#22C55E",strokeWidth:"2"}),e.jsx("circle",{cx:"16",cy:"16",r:"2",fill:"#FFFFFF"}),e.jsx("circle",{cx:"24",cy:"8",r:"1.5",fill:"#22C55E"})]}),e.jsx("h1",{className:"text-lg font-semibold text-gray-800",children:"Grix"})]}),e.jsxs("div",{className:"relative",ref:a,children:[e.jsxs("button",{onClick:z,className:`
            flex items-center gap-2 px-4 py-2 rounded-lg border transition-all
            ${t?"bg-blue-100 border-blue-300 text-blue-700":"bg-gray-50 border-gray-200 text-gray-700 hover:bg-gray-100"}
          `,children:[e.jsx("span",{className:"text-lg",children:"🏗️"}),e.jsx("span",{className:"text-sm font-medium",children:E?E.name:o("toolbar.build")}),e.jsx("span",{className:`text-xs transition-transform ${c?"rotate-180":""}`,children:"▼"})]}),c&&e.jsx("div",{className:"build-dropdown absolute top-full left-0 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg z-50 min-w-48 max-h-80 overflow-y-auto",children:e.jsxs("div",{className:"build-dropdown-scrollable",children:[d.map(m=>e.jsxs("button",{onClick:()=>h(m.id),className:`
                    w-full flex items-center gap-3 px-4 py-3 text-left hover:bg-gray-50 first:rounded-t-lg transition-colors
                    ${t===m.id?"bg-blue-50 text-blue-700":"text-gray-700"}
                  `,title:m.description,children:[e.jsx("span",{className:"text-lg",children:m.icon}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:m.name}),e.jsx("div",{className:"text-xs text-gray-500",children:m.description})]})]},m.id)),t&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-t border-gray-100"}),e.jsxs("button",{onClick:j,className:"w-full flex items-center gap-3 px-4 py-2 text-left hover:bg-gray-50 rounded-b-lg transition-colors text-gray-600",children:[e.jsx("span",{className:"text-lg",children:"✕"}),e.jsx("span",{className:"text-sm",children:o("toolbar.panMode")})]})]})]})})]}),e.jsx("div",{className:"ml-auto",children:e.jsx(vs,{})})]})}class $t extends u.Component{constructor(t){super(t),this.state={hasError:!1}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,s){console.error("Canvas Error Boundary caught an error:",t,s),this.setState({error:t,errorInfo:s})}render(){var t,s;if(this.state.hasError){const n=this.props.fallback;return n?e.jsx(n,{error:this.state.error}):e.jsx("div",{className:"flex items-center justify-center h-full bg-red-50 text-red-700 p-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Something went wrong with the Canvas"}),e.jsxs("details",{className:"text-sm",children:[e.jsx("summary",{className:"cursor-pointer mb-2",children:"Error Details"}),e.jsxs("pre",{className:"whitespace-pre-wrap text-left bg-red-100 p-4 rounded",children:[(t=this.state.error)==null?void 0:t.toString(),(s=this.state.errorInfo)==null?void 0:s.componentStack]})]}),e.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Reload Page"})]})})}return this.props.children}}function js({children:i}){const[t,s]=u.useState(!1),[n,r]=u.useState(navigator.onLine),[o,c]=u.useState(null),{loadState:a,saveState:d}=Me(),h=De();u.useEffect(()=>{"serviceWorker"in navigator&&j(),z(),E(),m(),D(),s(!0)},[]);const j=async()=>{try{const y=await navigator.serviceWorker.register("/sw.js",{scope:"/"});console.log("🎯 Grix PWA: Service Worker registered successfully:",y.scope),y.addEventListener("updatefound",()=>{const f=y.installing;f&&f.addEventListener("statechange",()=>{f.state==="installed"&&navigator.serviceWorker.controller&&(console.log("🔄 Grix PWA: New version available"),U())})})}catch(y){console.error("❌ Grix PWA: Service Worker registration failed:",y)}},z=()=>{try{const y=ae.loadState();if(y)(y.objects||y.viewport)&&a(),y.visualizationSettings&&Object.entries(y.visualizationSettings).forEach(([f,q])=>{f in h&&typeof h[f]==typeof q&&(h[f]=q)}),console.log("📂 Grix PWA: Restored saved state from previous session");else{const f=Me.getState();if(f.objects.length===0){const q={id:`ray_default_${Date.now()}`,type:"ray",properties:{startPoint:{x:0,y:0},endPoint:{x:3,y:9},slope:3,yIntercept:0},visible:!0,selected:!1,zIndex:0};f.addObject(q),console.log("🎯 Grix PWA: Created default line (0,0) to (3,9) for first-time user"),localStorage.setItem("grix-show-endpoint-tooltip","true")}}}catch(y){console.error("❌ Grix PWA: Failed to load saved state:",y)}},E=()=>{window.addEventListener("grix:auto-save-requested",()=>{const y=Me.getState(),f=De.getState();ae.saveState({objects:y.objects,selectedObjects:y.selectedObjects,viewport:y.viewport,visualizationSettings:{showEquivalentFractions:f.showEquivalentFractions,showLengthMultiples:f.showLengthMultiples,showAreaRectangle:f.showAreaRectangle,showDivisionMultiples:f.showDivisionMultiples,showRiseRunTriangle:f.showRiseRunTriangle,showDistanceMarkers:f.showDistanceMarkers,showAngleArc:f.showAngleArc,showCoordinateProjections:f.showCoordinateProjections,showDivisionAnswer:f.showDivisionAnswer,showLatticePoints:f.showLatticePoints,showReferenceLineY_equals_X:f.showReferenceLineY_equals_X,showTangentLines:f.showTangentLines,showFunctionExtensions:f.showFunctionExtensions,showTriangleAngles:f.showTriangleAngles,showTriangleClassification:f.showTriangleClassification,showSpecialTriangles:f.showSpecialTriangles,showSOHCAHTOA:f.showSOHCAHTOA,showTrigValues:f.showTrigValues,showTriangleAltitudes:f.showTriangleAltitudes,showPythagoreanSquares:f.showPythagoreanSquares,fontScale:f.fontScale,gridScale:f.gridScale,snapPrecision:f.snapPrecision,coordinateSystem:f.coordinateSystem}})})},m=()=>{const y=()=>{r(!0),console.log("🌐 Grix PWA: Back online")},f=()=>{r(!1),console.log("📱 Grix PWA: Now offline")};return window.addEventListener("online",y),window.addEventListener("offline",f),()=>{window.removeEventListener("online",y),window.removeEventListener("offline",f)}},D=()=>{const y=f=>{f.preventDefault(),c(f),console.log("📱 Grix PWA: Install prompt available")};return window.addEventListener("beforeinstallprompt",y),()=>{window.removeEventListener("beforeinstallprompt",y)}},U=()=>{console.log("🔄 Grix PWA: New version available - refresh to update")},l=async()=>{if(o)try{const y=await o.prompt();console.log("📱 Grix PWA: Install prompt result:",y.outcome),c(null)}catch(y){console.error("❌ Grix PWA: Install failed:",y)}};return t?e.jsxs("div",{className:"relative",children:[i,!n&&e.jsx("div",{className:"fixed top-0 left-0 right-0 bg-yellow-500 text-white text-center py-2 z-50",children:e.jsx("span",{className:"text-sm font-medium",children:"📱 You're offline - Grix continues to work with saved data"})}),o&&e.jsxs("div",{className:"fixed bottom-20 right-4 bg-blue-600 text-white p-4 rounded-lg shadow-lg z-40 max-w-sm",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Install Grix App"}),e.jsx("p",{className:"text-sm mb-3",children:"Add Grix to your home screen for quick access and offline use."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>c(null),className:"px-3 py-1 text-sm bg-blue-500 rounded hover:bg-blue-400",children:"Later"}),e.jsx("button",{onClick:l,className:"px-3 py-1 text-sm bg-white text-blue-600 rounded hover:bg-gray-100",children:"Install"})]})]})]}):e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Loading Grix"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Preparing your mathematical playground..."})]})})}class ws{constructor(){ie(this,"id","ray-tool");ie(this,"name","Line Builder");ie(this,"context");ie(this,"state",{isCreating:!1,startPoint:null,currentRay:null,dragTarget:null,dragOffset:null})}init(t){this.context=t,t.events.on("tool:changed",this.handleToolChange.bind(this)),t.events.on("tool:cancel",this.handleToolCancel.bind(this))}destroy(){this.context.events.off("tool:changed",this.handleToolChange.bind(this)),this.context.events.off("tool:cancel",this.handleToolCancel.bind(this))}handleToolChange(t){t.current!==this.id&&this.cancelCreation()}handleToolCancel(t){t.toolId===this.id&&this.cancelCreation()}cancelCreation(){this.state.currentRay&&this.state.isCreating&&this.context.canvas.removeObject(this.state.currentRay.id),this.state={isCreating:!1,startPoint:null,currentRay:null,dragTarget:null,dragOffset:null}}generateId(){return`ray_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}snapPoint(t){const s=this.context.state.getState();if(s.snapToGrid){if(Math.sqrt(t.x*t.x+t.y*t.y)<=.75)return{x:0,y:0};const o=De.getState(),c=et(s.viewport,o.gridScale,o.snapPrecision);return this.context.math.snapToGrid(t,c)}return t}findNearestHandle(t,s=20){this.context.canvas.screenToWorld(t);const n=this.context.canvas.getAllObjects();for(const r of n)if(r.type==="ray"){const o=r,c=this.context.canvas.worldToScreen(o.properties.startPoint),a=this.context.canvas.worldToScreen(o.properties.endPoint),d=this.context.math.distance(t,c),h=this.context.math.distance(t,a);if(d<=s)return{rayId:o.id,handle:"start"};if(h<=s)return{rayId:o.id,handle:"end"};const j=8,z=a.x-c.x,E=a.y-c.y,m=Math.sqrt(z*z+E*E);if(m>0){const D=Math.max(0,Math.min(1,((t.x-c.x)*z+(t.y-c.y)*E)/(m*m))),U={x:c.x+D*z,y:c.y+D*E};if(this.context.math.distance(t,U)<=j)return{rayId:o.id,handle:"move"}}}return null}onPointerDown(t){const s={x:t.x,y:t.y},n=this.snapPoint(this.context.canvas.screenToWorld(s)),r=this.findNearestHandle(s);if(r){const o=this.context.canvas.getObject(r.rayId),c=this.context.state.getState().selectedObjects;if(o&&c.includes(r.rayId)){this.state.currentRay=o,this.state.dragTarget=r.handle,this.state.isCreating=!1,r.handle==="move"&&(this.state.dragOffset={x:n.x-o.properties.startPoint.x,y:n.y-o.properties.startPoint.y});return}}if(!this.state.isCreating){if(this.context.state.getState().selectedObjects.some(d=>{const h=this.context.canvas.getObject(d);return(h==null?void 0:h.type)==="ray"}))return;this.state.isCreating=!0,this.state.startPoint=n;const a={id:this.generateId(),type:"ray",properties:{startPoint:n,endPoint:{...n},slope:0,yIntercept:n.y},visible:!0,selected:!1,zIndex:0};this.state.currentRay=a,this.context.canvas.addObject(a)}}onPointerMove(t){if(!this.state.currentRay)return;const s={x:t.x,y:t.y},n=this.snapPoint(this.context.canvas.screenToWorld(s));if(this.state.isCreating){const r=this.context.math.slope(this.state.currentRay.properties.startPoint,n),o=n.y-r*n.x;this.context.canvas.updateObject(this.state.currentRay.id,{properties:{...this.state.currentRay.properties,endPoint:n,slope:r,yIntercept:isFinite(r)?o:this.state.currentRay.properties.startPoint.y}})}else if(this.state.dragTarget){const r=this.context.canvas.getObject(this.state.currentRay.id);if(!r)return;const o={...r.properties};if(this.state.dragTarget==="start")o.startPoint=n;else if(this.state.dragTarget==="end")o.endPoint=n;else if(this.state.dragTarget==="move"&&this.state.dragOffset){const c=n.x-this.state.dragOffset.x-r.properties.startPoint.x,a=n.y-this.state.dragOffset.y-r.properties.startPoint.y;o.startPoint={x:r.properties.startPoint.x+c,y:r.properties.startPoint.y+a},o.endPoint={x:r.properties.endPoint.x+c,y:r.properties.endPoint.y+a}}if(this.state.dragTarget==="start"||this.state.dragTarget==="end"){const c=this.context.math.slope(o.startPoint,o.endPoint);o.slope=c,o.yIntercept=isFinite(c)?o.startPoint.y-c*o.startPoint.x:o.startPoint.y}this.context.canvas.updateObject(this.state.currentRay.id,{properties:o})}this.context.events.emit("ray:update",{rayId:this.state.currentRay.id,ray:this.context.canvas.getObject(this.state.currentRay.id)})}onPointerUp(t){if(this.state.isCreating&&this.state.currentRay){const s={x:t.x,y:t.y},n=this.snapPoint(this.context.canvas.screenToWorld(s)),r=this.state.currentRay.properties.startPoint;this.context.math.distance(r,n)<.1?this.context.canvas.removeObject(this.state.currentRay.id):(this.context.events.emit("ray:created",{rayId:this.state.currentRay.id,ray:this.state.currentRay}),this.context.events.emit("tool:creation-complete",{toolId:this.id,objectId:this.state.currentRay.id}))}this.state={isCreating:!1,startPoint:null,currentRay:null,dragTarget:null,dragOffset:null}}}function Rt(){return new ws}class Ss{constructor(){ie(this,"id","rectangle-tool");ie(this,"name","Rectangle Builder");ie(this,"context");ie(this,"state",{isCreating:!1,startPoint:null,currentRectangle:null,dragTarget:null,dragOffset:null,lockedCorner:null})}init(t){this.context=t,t.events.on("tool:changed",this.handleToolChange.bind(this)),t.events.on("tool:cancel",this.handleToolCancel.bind(this))}destroy(){this.context.events.off("tool:changed",this.handleToolChange.bind(this)),this.context.events.off("tool:cancel",this.handleToolCancel.bind(this))}handleToolChange(t){t.current!==this.id&&this.cancelCreation()}handleToolCancel(t){t.toolId===this.id&&this.cancelCreation()}cancelCreation(){this.state.currentRectangle&&this.state.isCreating&&this.context.canvas.removeObject(this.state.currentRectangle.id),this.state={isCreating:!1,startPoint:null,currentRectangle:null,dragTarget:null,dragOffset:null,lockedCorner:null}}generateId(){return`rect_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}snapPoint(t){const s=this.context.state.getState();if(s.snapToGrid){if(Math.sqrt(t.x*t.x+t.y*t.y)<=.75)return{x:0,y:0};const o=De.getState(),c=et(s.viewport,o.gridScale,o.snapPrecision);return this.context.math.snapToGrid(t,c)}return t}findRectangleAtPoint(t){const s=this.context.canvas.getAllObjects();for(const n of s)if(n.type==="rectangle"){const r=n,{x:o,y:c,width:a,height:d}=r.properties;if(t.x>=o&&t.x<=o+a&&t.y>=c&&t.y<=c+d)return r}return null}findNearestCorner(t,s,n=.5){const{x:r,y:o,width:c,height:a}=s.properties,d=[{point:{x:r,y:o},type:"corner-bl"},{point:{x:r+c,y:o},type:"corner-br"},{point:{x:r,y:o+a},type:"corner-tl"},{point:{x:r+c,y:o+a},type:"corner-tr"}];for(const h of d)if(this.context.math.distance(t,h.point)<=n)return h.type;return null}onPointerDown(t){const s={x:t.x,y:t.y},n=this.snapPoint(this.context.canvas.screenToWorld(s)),r=this.findRectangleAtPoint(n);if(r&&this.context.state.getState().selectedObjects.includes(r.id)){const h=this.findNearestCorner(n,r);if(h){this.state.currentRectangle=r,this.state.dragTarget=h,this.state.isCreating=!1;const{x:j,y:z,width:E,height:m}=r.properties;switch(h){case"corner-tl":this.state.lockedCorner={x:j+E,y:z};break;case"corner-tr":this.state.lockedCorner={x:j,y:z};break;case"corner-bl":this.state.lockedCorner={x:j+E,y:z+m};break;case"corner-br":this.state.lockedCorner={x:j,y:z+m};break}return}else{this.state.currentRectangle=r,this.state.dragTarget="move",this.state.dragOffset={x:n.x-r.properties.x,y:n.y-r.properties.y},this.state.isCreating=!1;return}}if(this.context.state.getState().selectedObjects.some(d=>{const h=this.context.canvas.getObject(d);return(h==null?void 0:h.type)==="rectangle"}))return;this.state.isCreating=!0,this.state.startPoint=n;const a={id:this.generateId(),type:"rectangle",properties:{x:n.x,y:n.y,width:0,height:0,area:0},visible:!0,selected:!1,zIndex:0};this.state.currentRectangle=a,this.context.canvas.addObject(a)}onPointerMove(t){if(!this.state.currentRectangle)return;const s={x:t.x,y:t.y},n=this.snapPoint(this.context.canvas.screenToWorld(s));if(this.state.isCreating&&this.state.startPoint){const r=Math.min(this.state.startPoint.x,n.x),o=Math.min(this.state.startPoint.y,n.y),c=Math.abs(n.x-this.state.startPoint.x),a=Math.abs(n.y-this.state.startPoint.y),d=c*a;this.context.canvas.updateObject(this.state.currentRectangle.id,{properties:{x:r,y:o,width:c,height:a,area:d}})}else if(this.state.dragTarget==="move"&&this.state.dragOffset){const r=n.x-this.state.dragOffset.x,o=n.y-this.state.dragOffset.y;this.context.canvas.updateObject(this.state.currentRectangle.id,{properties:{...this.state.currentRectangle.properties,x:r,y:o}})}else if(this.state.dragTarget&&this.state.dragTarget.startsWith("corner-")&&this.state.lockedCorner){const r=this.state.lockedCorner,o=Math.min(n.x,r.x),c=Math.max(n.x,r.x),a=Math.min(n.y,r.y),d=Math.max(n.y,r.y),h=o,j=a,z=c-o,E=d-a,m=Math.max(.1,z),D=Math.max(.1,E),U=m*D;this.context.canvas.updateObject(this.state.currentRectangle.id,{properties:{x:h,y:j,width:m,height:D,area:U}})}this.context.events.emit("rectangle:update",{rectangleId:this.state.currentRectangle.id,rectangle:this.context.canvas.getObject(this.state.currentRectangle.id)})}onPointerUp(t){if(this.state.isCreating&&this.state.currentRectangle){const s=this.context.canvas.getObject(this.state.currentRectangle.id);s&&(s.properties.width<.1||s.properties.height<.1?this.context.canvas.removeObject(this.state.currentRectangle.id):(this.context.events.emit("rectangle:created",{rectangleId:this.state.currentRectangle.id,rectangle:s}),this.context.events.emit("tool:creation-complete",{toolId:this.id,objectId:this.state.currentRectangle.id})))}this.state={isCreating:!1,startPoint:null,currentRectangle:null,dragTarget:null,dragOffset:null,lockedCorner:null}}}function Gt(){return new Ss}class Cs{constructor(){ie(this,"id","circle-tool");ie(this,"name","Circle Builder");ie(this,"context");ie(this,"state",{isCreating:!1,center:null,currentCircle:null,dragTarget:null,dragOffset:null})}init(t){this.context=t,t.events.on("tool:changed",this.handleToolChange.bind(this)),t.events.on("tool:cancel",this.handleToolCancel.bind(this))}destroy(){this.context.events.off("tool:changed",this.handleToolChange.bind(this)),this.context.events.off("tool:cancel",this.handleToolCancel.bind(this))}handleToolChange(t){t.current!==this.id&&this.cancelCreation()}handleToolCancel(t){t.toolId===this.id&&this.cancelCreation()}cancelCreation(){this.state.currentCircle&&this.state.isCreating&&this.context.canvas.removeObject(this.state.currentCircle.id),this.state={isCreating:!1,center:null,currentCircle:null,dragTarget:null,dragOffset:null}}generateId(){return`circle_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}snapPoint(t){const s=this.context.state.getState();if(s.snapToGrid){if(Math.sqrt(t.x*t.x+t.y*t.y)<=.75)return{x:0,y:0};const o=De.getState(),c=et(s.viewport,o.gridScale,o.snapPrecision);return this.context.math.snapToGrid(t,c)}return t}calculateCircleProperties(t,s){const n=this.context.math.distance(t,s),r=n*2,o=2*Math.PI*n,c=Math.PI*n*n;return{radius:n,diameter:r,circumference:o,area:c}}findCircleAtPoint(t){const s=this.context.canvas.getAllObjects();for(const n of s)if(n.type==="circle"){const r=n;if(this.context.math.distance(t,r.properties.center)<=r.properties.radius+.5)return r}return null}findNearestHandle(t,s,n=.5){const{center:r,radius:o}=s.properties;if(this.context.math.distance(t,r)<=n)return"center";const c={x:r.x+o,y:r.y};return this.context.math.distance(t,c)<=n?"radius":null}onPointerDown(t){const s={x:t.x,y:t.y},n=this.snapPoint(this.context.canvas.screenToWorld(s)),r=this.findCircleAtPoint(n);if(r&&!this.context.state.getState().selectedObjects.includes(r.id))return;if(r&&this.context.state.getState().selectedObjects.includes(r.id)){const h=this.findNearestHandle(n,r);if(h){this.state.currentCircle=r,this.state.dragTarget=h,this.state.isCreating=!1,h==="center"&&(this.state.dragOffset={x:n.x-r.properties.center.x,y:n.y-r.properties.center.y});return}else{this.state.currentCircle=r,this.state.dragTarget="center",this.state.isCreating=!1,this.state.dragOffset={x:n.x-r.properties.center.x,y:n.y-r.properties.center.y};return}}if(this.context.state.getState().selectedObjects.some(d=>{const h=this.context.canvas.getObject(d);return(h==null?void 0:h.type)==="circle"}))return;this.state.isCreating=!0,this.state.center=n;const a={id:this.generateId(),type:"circle",properties:{center:n,radius:0,diameter:0,circumference:0,area:0},visible:!0,selected:!1,zIndex:0};this.state.currentCircle=a,this.context.canvas.addObject(a)}onPointerMove(t){if(!this.state.currentCircle)return;const s={x:t.x,y:t.y},n=this.snapPoint(this.context.canvas.screenToWorld(s));if(this.state.isCreating&&this.state.center){const r=this.calculateCircleProperties(this.state.center,n);this.context.canvas.updateObject(this.state.currentCircle.id,{properties:{center:this.state.center,...r}})}else if(this.state.dragTarget==="center"&&this.state.dragOffset){const r={x:n.x-this.state.dragOffset.x,y:n.y-this.state.dragOffset.y};this.context.canvas.updateObject(this.state.currentCircle.id,{properties:{...this.state.currentCircle.properties,center:r}})}else if(this.state.dragTarget==="radius"){const r=this.state.currentCircle.properties.center,o=this.calculateCircleProperties(r,n);this.context.canvas.updateObject(this.state.currentCircle.id,{properties:{center:r,...o}})}this.context.events.emit("circle:update",{circleId:this.state.currentCircle.id,circle:this.context.canvas.getObject(this.state.currentCircle.id)})}onPointerUp(t){if(this.state.isCreating&&this.state.currentCircle){const s=this.context.canvas.getObject(this.state.currentCircle.id);s&&(s.properties.radius<.1?this.context.canvas.removeObject(this.state.currentCircle.id):(this.context.events.emit("circle:created",{circleId:this.state.currentCircle.id,circle:s}),this.context.events.emit("tool:creation-complete",{toolId:this.id,objectId:this.state.currentCircle.id})))}this.state={isCreating:!1,center:null,currentCircle:null,dragTarget:null,dragOffset:null}}}function Es(){return new Cs}class Ms{constructor(){ie(this,"id","triangle-tool");ie(this,"name","Triangle Builder");ie(this,"context");ie(this,"state",{isCreating:!1,creationStep:0,vertices:[null,null,null],currentTriangle:null,dragTarget:null,dragOffset:null})}init(t){this.context=t,t.events.on("tool:changed",this.handleToolChange.bind(this)),t.events.on("tool:cancel",this.handleToolCancel.bind(this))}destroy(){this.context.events.off("tool:changed",this.handleToolChange.bind(this)),this.context.events.off("tool:cancel",this.handleToolCancel.bind(this))}handleToolChange(t){t.current!==this.id&&this.cancelCreation()}handleToolCancel(t){t.toolId===this.id&&this.cancelCreation()}cancelCreation(){this.state.currentTriangle&&this.state.isCreating&&this.context.canvas.removeObject(this.state.currentTriangle.id),this.state={isCreating:!1,creationStep:0,vertices:[null,null,null],currentTriangle:null,dragTarget:null,dragOffset:null}}generateId(){return`triangle_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}snapPoint(t){const s=this.context.state.getState();if(s.snapToGrid){if(Math.sqrt(t.x*t.x+t.y*t.y)<=.75)return{x:0,y:0};const o=De.getState(),c=et(s.viewport,o.gridScale,o.snapPrecision);return this.context.math.snapToGrid(t,c)}return t}calculateTriangleProperties(t){const[s,n,r]=t,o=this.context.math.distance(n,r),c=this.context.math.distance(s,r),a=this.context.math.distance(s,n),d=Math.acos((c*c+a*a-o*o)/(2*c*a))*180/Math.PI,h=Math.acos((o*o+a*a-c*c)/(2*o*a))*180/Math.PI,j=180-d-h,z=Math.abs((n.x-s.x)*(r.y-s.y)-(r.x-s.x)*(n.y-s.y))/2,E=o+c+a;let m="scalene";const D=.1;return Math.abs(d-90)<D||Math.abs(h-90)<D||Math.abs(j-90)<D?m="right":d>90||h>90||j>90?m="obtuse":d<90&&h<90&&j<90&&(m="acute"),Math.abs(o-c)<D&&Math.abs(c-a)<D?m="equilateral":(Math.abs(o-c)<D||Math.abs(c-a)<D||Math.abs(o-a)<D)&&(m="isosceles"),{sideA:o,sideB:c,sideC:a,angleA:d,angleB:h,angleC:j,area:z,perimeter:E,type:m}}findTriangleAtPoint(t){const s=this.context.canvas.getAllObjects();for(const n of s)if(n.type==="triangle"){const r=n,[o,c,a]=r.properties.vertices,d=(c.y-a.y)*(o.x-a.x)+(a.x-c.x)*(o.y-a.y),h=((c.y-a.y)*(t.x-a.x)+(a.x-c.x)*(t.y-a.y))/d,j=((a.y-o.y)*(t.x-a.x)+(o.x-a.x)*(t.y-a.y))/d,z=1-h-j;if(h>=0&&j>=0&&z>=0)return r}return null}findNearestVertex(t,s,n=.5){const r=s.properties.vertices;for(let o=0;o<r.length;o++)if(this.context.math.distance(t,r[o])<=n)return`vertex${o}`;return null}onPointerDown(t){const s={x:t.x,y:t.y},n=this.snapPoint(this.context.canvas.screenToWorld(s)),r=this.findTriangleAtPoint(n);if(r&&this.context.state.getState().selectedObjects.includes(r.id)){const c=this.findNearestVertex(n,r);if(c){this.state.currentTriangle=r,this.state.dragTarget=c,this.state.isCreating=!1;return}else{this.state.currentTriangle=r,this.state.dragTarget="move";const a={x:(r.properties.vertices[0].x+r.properties.vertices[1].x+r.properties.vertices[2].x)/3,y:(r.properties.vertices[0].y+r.properties.vertices[1].y+r.properties.vertices[2].y)/3};this.state.dragOffset={x:n.x-a.x,y:n.y-a.y},this.state.isCreating=!1;return}}if(!this.state.isCreating){if(this.context.state.getState().selectedObjects.some(h=>{const j=this.context.canvas.getObject(h);return(j==null?void 0:j.type)==="triangle"}))return;this.state.isCreating=!0,this.state.creationStep=0,this.state.vertices=[n,null,null];const a={x:n.x+3,y:n.y};this.state.vertices[1]=a,this.state.creationStep=1;const d={id:this.generateId(),type:"triangle",properties:{vertices:[n,a,n],sideA:0,sideB:0,sideC:0,angleA:0,angleB:0,angleC:0,area:0,perimeter:0,type:"scalene"},visible:!0,selected:!1,zIndex:0};this.state.currentTriangle=d,this.context.canvas.addObject(d)}}onPointerMove(t){if(!this.state.currentTriangle)return;const s={x:t.x,y:t.y},n=this.snapPoint(this.context.canvas.screenToWorld(s));if(this.state.isCreating&&this.state.creationStep===1){const[r,o]=this.state.vertices;if(r&&o){const c={x:o.x,y:n.y},a=[r,o,c],d=this.calculateTriangleProperties(a);this.context.canvas.updateObject(this.state.currentTriangle.id,{properties:{vertices:a,...d}})}}else if(this.state.dragTarget&&this.state.dragTarget.startsWith("vertex")){const r=parseInt(this.state.dragTarget.replace("vertex","")),o=[...this.state.currentTriangle.properties.vertices];o[r]=n;const c=this.calculateTriangleProperties(o);this.context.canvas.updateObject(this.state.currentTriangle.id,{properties:{vertices:o,...c}})}else if(this.state.dragTarget==="move"&&this.state.dragOffset){const r={x:n.x-this.state.dragOffset.x,y:n.y-this.state.dragOffset.y},o={x:(this.state.currentTriangle.properties.vertices[0].x+this.state.currentTriangle.properties.vertices[1].x+this.state.currentTriangle.properties.vertices[2].x)/3,y:(this.state.currentTriangle.properties.vertices[0].y+this.state.currentTriangle.properties.vertices[1].y+this.state.currentTriangle.properties.vertices[2].y)/3},c={x:r.x-o.x,y:r.y-o.y},a=[{x:this.state.currentTriangle.properties.vertices[0].x+c.x,y:this.state.currentTriangle.properties.vertices[0].y+c.y},{x:this.state.currentTriangle.properties.vertices[1].x+c.x,y:this.state.currentTriangle.properties.vertices[1].y+c.y},{x:this.state.currentTriangle.properties.vertices[2].x+c.x,y:this.state.currentTriangle.properties.vertices[2].y+c.y}];this.context.canvas.updateObject(this.state.currentTriangle.id,{properties:{...this.state.currentTriangle.properties,vertices:a}})}this.context.events.emit("triangle:update",{triangleId:this.state.currentTriangle.id,triangle:this.context.canvas.getObject(this.state.currentTriangle.id)})}onPointerUp(t){if(this.state.isCreating&&this.state.currentTriangle&&this.state.creationStep===1){const s=this.context.canvas.getObject(this.state.currentTriangle.id);s&&(s.properties.area<.1?this.context.canvas.removeObject(this.state.currentTriangle.id):(this.context.events.emit("triangle:created",{triangleId:this.state.currentTriangle.id,triangle:s}),this.context.events.emit("tool:creation-complete",{toolId:this.id,objectId:this.state.currentTriangle.id})))}this.state={isCreating:!1,creationStep:0,vertices:[null,null,null],currentTriangle:null,dragTarget:null,dragOffset:null}}}function ks(){return new Ms}class Ts{constructor(){ie(this,"id","function-tool");ie(this,"name","Function Grapher");ie(this,"context");ie(this,"state",{isCreating:!1,currentFunction:null,dragTarget:null,dragOffset:null,equation:"x^2",functionType:"polynomial"})}init(t){this.context=t,t.events.on("tool:changed",this.handleToolChange.bind(this)),t.events.on("tool:cancel",this.handleToolCancel.bind(this))}destroy(){this.context.events.off("tool:changed",this.handleToolChange.bind(this)),this.context.events.off("tool:cancel",this.handleToolCancel.bind(this))}handleToolChange(t){t.current!==this.id&&this.cancelCreation()}handleToolCancel(t){t.toolId===this.id&&this.cancelCreation()}cancelCreation(){this.state.currentFunction&&this.state.isCreating&&this.context.canvas.removeObject(this.state.currentFunction.id),this.state={isCreating:!1,currentFunction:null,dragTarget:null,dragOffset:null,equation:"x^2",functionType:"polynomial"}}generateId(){return`function_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}snapPoint(t){const s=this.context.state.getState();if(s.snapToGrid){const n=De.getState(),r=et(s.viewport,n.gridScale,n.snapPrecision);return this.context.math.snapToGrid(t,r)}return t}evaluateFunction(t,s){try{const n=t.replace(/\bx\b/g,`(${s})`).replace(/\^/g,"**").replace(/sin/g,"Math.sin").replace(/cos/g,"Math.cos").replace(/tan/g,"Math.tan").replace(/log/g,"Math.log").replace(/ln/g,"Math.log").replace(/exp/g,"Math.exp").replace(/sqrt/g,"Math.sqrt").replace(/abs/g,"Math.abs").replace(/pi/g,"Math.PI").replace(/e\b/g,"Math.E"),o=new Function("x",`return ${n}`)(s);if(typeof o=="number"&&!isNaN(o)&&isFinite(o))return o}catch{}return null}generateFunctionPoints(t,s,n){const r=[],o=(s.max-s.min)/(n*(s.max-s.min));for(let c=s.min;c<=s.max;c+=o){const a=this.evaluateFunction(t,c);a!==null&&r.push({x:c,y:a})}return r}detectFunctionType(t){return t.includes("sin")||t.includes("cos")||t.includes("tan")?"trigonometric":t.includes("exp")||t.includes("e^")?"exponential":t.includes("log")||t.includes("ln")?"logarithmic":/x\^\d+|x\*\*\d+/.test(t)?"polynomial":"custom"}getDefaultEquation(t){switch(t){case"polynomial":return"x^2";case"trigonometric":return"sin(x)";case"exponential":return"exp(x)";case"logarithmic":return"log(x)";default:return"x^2"}}findFunctionAtPoint(t){const s=this.context.canvas.getAllObjects(),n=.3;for(const r of s)if(r.type==="function"){const o=r;for(let c=0;c<o.properties.points.length-1;c++){const a=o.properties.points[c],d=o.properties.points[c+1];if(!a||!d)continue;const h=d.x-a.x,j=d.y-a.y,z=Math.sqrt(h*h+j*j);if(z===0)continue;const E=Math.max(0,Math.min(1,((t.x-a.x)*h+(t.y-a.y)*j)/(z*z))),m={x:a.x+E*h,y:a.y+E*j};if(Math.sqrt((t.x-m.x)**2+(t.y-m.y)**2)<=n)return o}}return null}onPointerDown(t){const s={x:t.x,y:t.y},n=this.snapPoint(this.context.canvas.screenToWorld(s)),r=this.findFunctionAtPoint(n);if(r&&this.context.state.getState().selectedObjects.includes(r.id)){const c=r.properties.domain,a=this.evaluateFunction(r.properties.equation,c.min),d=this.evaluateFunction(r.properties.equation,c.max);if(a!==null&&Math.abs(n.x-c.min)<.5&&Math.abs(n.y-a)<.5){this.state.currentFunction=r,this.state.dragTarget="domain-start",this.state.isCreating=!1;return}else if(d!==null&&Math.abs(n.x-c.max)<.5&&Math.abs(n.y-d)<.5){this.state.currentFunction=r,this.state.dragTarget="domain-end",this.state.isCreating=!1;return}else{this.state.currentFunction=r,this.state.dragTarget="move",this.state.dragOffset={x:0,y:0},this.state.isCreating=!1;return}}if(!this.state.isCreating){if(this.context.state.getState().selectedObjects.some(z=>{const E=this.context.canvas.getObject(z);return(E==null?void 0:E.type)==="function"}))return;this.state.isCreating=!0,this.state.equation=this.getDefaultEquation(this.state.functionType);const a=8,d={min:n.x-a/2,max:n.x+a/2},h=this.generateFunctionPoints(this.state.equation,d,20),j={id:this.generateId(),type:"function",properties:{equation:this.state.equation,functionType:this.detectFunctionType(this.state.equation),domain:d,points:h,resolution:20,color:"#2563eb",strokeWidth:2},visible:!0,selected:!1,zIndex:0};this.state.currentFunction=j,this.context.canvas.addObject(j)}}onPointerMove(t){if(!this.state.currentFunction)return;const s={x:t.x,y:t.y},n=this.snapPoint(this.context.canvas.screenToWorld(s));if(this.state.dragTarget==="domain-start"){const r={min:Math.min(n.x,this.state.currentFunction.properties.domain.max-.1),max:this.state.currentFunction.properties.domain.max},o=this.generateFunctionPoints(this.state.currentFunction.properties.equation,r,this.state.currentFunction.properties.resolution);this.context.canvas.updateObject(this.state.currentFunction.id,{properties:{...this.state.currentFunction.properties,domain:r,points:o}})}else if(this.state.dragTarget==="domain-end"){const r={min:this.state.currentFunction.properties.domain.min,max:Math.max(n.x,this.state.currentFunction.properties.domain.min+.1)},o=this.generateFunctionPoints(this.state.currentFunction.properties.equation,r,this.state.currentFunction.properties.resolution);this.context.canvas.updateObject(this.state.currentFunction.id,{properties:{...this.state.currentFunction.properties,domain:r,points:o}})}else if(this.state.dragTarget==="move"){if(!this.state.dragOffset){const d=(this.state.currentFunction.properties.domain.min+this.state.currentFunction.properties.domain.max)/2;this.state.dragOffset={x:n.x-d,y:0}}(this.state.currentFunction.properties.domain.min+this.state.currentFunction.properties.domain.max)/2;const r=n.x-this.state.dragOffset.x,o=this.state.currentFunction.properties.domain.max-this.state.currentFunction.properties.domain.min,c={min:r-o/2,max:r+o/2},a=this.generateFunctionPoints(this.state.currentFunction.properties.equation,c,this.state.currentFunction.properties.resolution);this.context.canvas.updateObject(this.state.currentFunction.id,{properties:{...this.state.currentFunction.properties,domain:c,points:a}})}this.context.events.emit("function:update",{functionId:this.state.currentFunction.id,function:this.context.canvas.getObject(this.state.currentFunction.id)})}onPointerUp(t){this.state.isCreating&&this.state.currentFunction&&(this.context.events.emit("function:created",{functionId:this.state.currentFunction.id,function:this.context.canvas.getObject(this.state.currentFunction.id)}),this.context.events.emit("tool:creation-complete",{toolId:this.id,objectId:this.state.currentFunction.id})),this.state={...this.state,isCreating:!1,currentFunction:null,dragTarget:null,dragOffset:null}}}function Ps(){return new Ts}class Ns{constructor(){ie(this,"id","area-counter");ie(this,"name","Area Counter");ie(this,"context");ie(this,"badges",new Map);ie(this,"badgeElements",new Map)}init(t){this.context=t,t.events.on("rectangle:created",this.handleRectangleCreated.bind(this)),t.events.on("rectangle:update",this.handleRectangleUpdated.bind(this)),t.events.on("object:removed",this.handleObjectRemoved.bind(this)),this.createBadgesForExistingRectangles();const s=t.state.subscribe(n=>{this.updateBadgePositions()});this.unsubscribeFromState=s}destroy(){this.context.events.off("rectangle:created",this.handleRectangleCreated.bind(this)),this.context.events.off("rectangle:update",this.handleRectangleUpdated.bind(this)),this.context.events.off("object:removed",this.handleObjectRemoved.bind(this)),this.unsubscribeFromState&&this.unsubscribeFromState(),this.badgeElements.forEach(t=>{t.remove()}),this.badgeElements.clear(),this.badges.clear()}createBadgesForExistingRectangles(){this.context.canvas.getAllObjects().forEach(s=>{s.type==="rectangle"&&this.createBadge(s)})}handleRectangleCreated(t){this.createBadge(t.rectangle)}handleRectangleUpdated(t){this.updateBadge(t.rectangle)}handleObjectRemoved(t){this.removeBadge(t.objectId)}createBadge(t){const s={rectangleId:t.id,x:t.properties.x,y:t.properties.y,width:t.properties.width,height:t.properties.height,area:t.properties.area,visible:!0};this.badges.set(t.id,s),this.createBadgeElement(s)}updateBadge(t){const s=this.badges.get(t.id);s&&(s.x=t.properties.x,s.y=t.properties.y,s.width=t.properties.width,s.height=t.properties.height,s.area=t.properties.area,this.updateBadgeElement(s))}removeBadge(t){const s=this.badgeElements.get(t);s&&(s.remove(),this.badgeElements.delete(t)),this.badges.delete(t)}createBadgeElement(t){const s=document.createElement("div");s.className="area-badge",s.style.cssText=`
      position: absolute;
      background: rgba(34, 197, 94, 0.9);
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 600;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
      white-space: nowrap;
      pointer-events: none;
      z-index: 1000;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(34, 197, 94, 1);
    `,(document.querySelector("[data-grix-canvas]")||document.body).appendChild(s),this.badgeElements.set(t.rectangleId,s),this.updateBadgeElement(t)}updateBadgeElement(t){const s=this.badgeElements.get(t.rectangleId);if(!s)return;const n=t.x+t.width/2,r=t.y+t.height/2,o=this.context.canvas.worldToScreen({x:n,y:r}),c=this.formatArea(t.area,t.width,t.height);s.textContent=c;const a=s.getBoundingClientRect();s.style.left=`${o.x-a.width/2}px`,s.style.top=`${o.y-a.height/2}px`,s.style.display="none"}formatArea(t,s,n){return""}updateBadgePositions(){this.badges.forEach(t=>{this.updateBadgeElement(t)})}showBadge(t){const s=this.badges.get(t);s&&(s.visible=!0,this.updateBadgeElement(s))}hideBadge(t){const s=this.badges.get(t);if(s){s.visible=!1;const n=this.badgeElements.get(t);n&&(n.style.display="none")}}showAllBadges(){this.badges.forEach((t,s)=>{this.showBadge(s)})}hideAllBadges(){this.badges.forEach((t,s)=>{this.hideBadge(s)})}}function Bt(){return new Ns}function As(){const{registerPlugin:i}=rt(),t=u.useRef(!1);return u.useEffect(()=>{if(t.current)return;const s=Rt(),n=Gt(),r=Es(),o=ks(),c=Ps(),a=Bt();return i(s),i(n),i(r),i(o),i(c),i(a),t.current=!0,()=>{}},[i]),e.jsxs("div",{className:"flex flex-col h-screen bg-gray-50",children:[e.jsx(Wt,{}),e.jsx("div",{className:"flex-1 relative","data-grix-canvas":!0,children:e.jsx(Lt,{width:window.innerWidth,height:window.innerHeight-60,className:"absolute inset-0"})})]})}function Fs(){return e.jsx($t,{children:e.jsx(js,{children:e.jsx(bs,{children:e.jsx(Et,{children:e.jsx($t,{children:e.jsx(As,{})})})})})})}const Os="0.1.0";we.Canvas=Lt,we.GrixApp=Fs,we.PluginManagerProvider=Et,we.ToolBar=Wt,we.createAreaCounter=Bt,we.createRayTool=Rt,we.createRectangleTool=Gt,we.useCanvasStore=Me,we.useInputSystem=Mt,we.usePluginManager=rt,we.version=Os,Object.defineProperty(we,Symbol.toStringTag,{value:"Module"})});
