(function(ye,j){typeof exports=="object"&&typeof module<"u"?j(exports,require("react")):typeof define=="function"&&define.amd?define(["exports","react"],j):(ye=typeof globalThis<"u"?globalThis:ye||self,j(ye.GrixUI={},ye.React))})(this,function(ye,j){"use strict";var ms=Object.defineProperty;var bs=(ye,j,Be)=>j in ye?ms(ye,j,{enumerable:!0,configurable:!0,writable:!0,value:Be}):ye[j]=Be;var ae=(ye,j,Be)=>bs(ye,typeof j!="symbol"?j+"":j,Be);var Be={exports:{}},tt={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xt;function $t(){if(xt)return tt;xt=1;var r=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function s(n,o,i){var c=null;if(i!==void 0&&(c=""+i),o.key!==void 0&&(c=""+o.key),"key"in o){i={};for(var a in o)a!=="key"&&(i[a]=o[a])}else i=o;return o=i.ref,{$$typeof:r,type:n,key:c,ref:o!==void 0?o:null,props:i}}return tt.Fragment=e,tt.jsx=s,tt.jsxs=s,tt}var st={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ut;function Wt(){return ut||(ut=1,process.env.NODE_ENV!=="production"&&function(){function r(p){if(p==null)return null;if(typeof p=="function")return p.$$typeof===de?null:p.displayName||p.name||null;if(typeof p=="string")return p;switch(p){case P:return"Fragment";case m:return"Profiler";case l:return"StrictMode";case I:return"Suspense";case Z:return"SuspenseList";case le:return"Activity"}if(typeof p=="object")switch(typeof p.tag=="number"&&console.error("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),p.$$typeof){case z:return"Portal";case k:return(p.displayName||"Context")+".Provider";case b:return(p._context.displayName||"Context")+".Consumer";case O:var R=p.render;return p=p.displayName,p||(p=R.displayName||R.name||"",p=p!==""?"ForwardRef("+p+")":"ForwardRef"),p;case Y:return R=p.displayName||null,R!==null?R:r(p.type)||"Memo";case V:R=p._payload,p=p._init;try{return r(p(R))}catch{}}return null}function e(p){return""+p}function s(p){try{e(p);var R=!1}catch{R=!0}if(R){R=console;var re=R.error,we=typeof Symbol=="function"&&Symbol.toStringTag&&p[Symbol.toStringTag]||p.constructor.name||"Object";return re.call(R,"The provided key is an unsupported type %s. This value must be coerced to a string before using it here.",we),e(p)}}function n(p){if(p===P)return"<>";if(typeof p=="object"&&p!==null&&p.$$typeof===V)return"<...>";try{var R=r(p);return R?"<"+R+">":"<...>"}catch{return"<...>"}}function o(){var p=ke.A;return p===null?null:p.getOwner()}function i(){return Error("react-stack-top-frame")}function c(p){if(g.call(p,"key")){var R=Object.getOwnPropertyDescriptor(p,"key").get;if(R&&R.isReactWarning)return!1}return p.key!==void 0}function a(p,R){function re(){ce||(ce=!0,console.error("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://react.dev/link/special-props)",R))}re.isReactWarning=!0,Object.defineProperty(p,"key",{get:re,configurable:!0})}function h(){var p=r(this.type);return Pe[p]||(Pe[p]=!0,console.error("Accessing element.ref was removed in React 19. ref is now a regular prop. It will be removed from the JSX Element type in a future release.")),p=this.props.ref,p!==void 0?p:null}function x(p,R,re,we,Ie,ee,Ne,_e){return re=ee.ref,p={$$typeof:F,type:p,key:R,props:ee,_owner:Ie},(re!==void 0?re:null)!==null?Object.defineProperty(p,"ref",{enumerable:!1,get:h}):Object.defineProperty(p,"ref",{enumerable:!1,value:null}),p._store={},Object.defineProperty(p._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:0}),Object.defineProperty(p,"_debugInfo",{configurable:!1,enumerable:!1,writable:!0,value:null}),Object.defineProperty(p,"_debugStack",{configurable:!1,enumerable:!1,writable:!0,value:Ne}),Object.defineProperty(p,"_debugTask",{configurable:!1,enumerable:!1,writable:!0,value:_e}),Object.freeze&&(Object.freeze(p.props),Object.freeze(p)),p}function S(p,R,re,we,Ie,ee,Ne,_e){var Q=R.children;if(Q!==void 0)if(we)if(w(Q)){for(we=0;we<Q.length;we++)T(Q[we]);Object.freeze&&Object.freeze(Q)}else console.error("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else T(Q);if(g.call(R,"key")){Q=r(p);var K=Object.keys(R).filter(function(pe){return pe!=="key"});we=0<K.length?"{key: someKey, "+K.join(": ..., ")+": ...}":"{key: someKey}",be[Q+we]||(K=0<K.length?"{"+K.join(": ..., ")+": ...}":"{}",console.error(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,we,Q,K,Q),be[Q+we]=!0)}if(Q=null,re!==void 0&&(s(re),Q=""+re),c(R)&&(s(R.key),Q=""+R.key),"key"in R){re={};for(var he in R)he!=="key"&&(re[he]=R[he])}else re=R;return Q&&a(re,typeof p=="function"?p.displayName||p.name||"Unknown":p),x(p,Q,ee,Ie,o(),re,Ne,_e)}function T(p){typeof p=="object"&&p!==null&&p.$$typeof===F&&p._store&&(p._store.validated=1)}var $=j,F=Symbol.for("react.transitional.element"),z=Symbol.for("react.portal"),P=Symbol.for("react.fragment"),l=Symbol.for("react.strict_mode"),m=Symbol.for("react.profiler"),b=Symbol.for("react.consumer"),k=Symbol.for("react.context"),O=Symbol.for("react.forward_ref"),I=Symbol.for("react.suspense"),Z=Symbol.for("react.suspense_list"),Y=Symbol.for("react.memo"),V=Symbol.for("react.lazy"),le=Symbol.for("react.activity"),de=Symbol.for("react.client.reference"),ke=$.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,g=Object.prototype.hasOwnProperty,w=Array.isArray,H=console.createTask?console.createTask:function(){return null};$={"react-stack-bottom-frame":function(p){return p()}};var ce,Pe={},je=$["react-stack-bottom-frame"].bind($,i)(),N=H(n(i)),be={};st.Fragment=P,st.jsx=function(p,R,re,we,Ie){var ee=1e4>ke.recentlyCreatedOwnerStacks++;return S(p,R,re,!1,we,Ie,ee?Error("react-stack-top-frame"):je,ee?H(n(p)):N)},st.jsxs=function(p,R,re,we,Ie){var ee=1e4>ke.recentlyCreatedOwnerStacks++;return S(p,R,re,!0,we,Ie,ee?Error("react-stack-top-frame"):je,ee?H(n(p)):N)}}()),st}var pt;function Lt(){return pt||(pt=1,process.env.NODE_ENV==="production"?Be.exports=$t():Be.exports=Wt()),Be.exports}var t=Lt();const Ue={distance(r,e){const s=e.x-r.x,n=e.y-r.y;return Math.sqrt(s*s+n*n)},slope(r,e){const s=e.x-r.x,n=e.y-r.y;return Math.abs(s)<Number.EPSILON?s===0||s>0?1/0:-1/0:n/s},angle(r,e){const s=e.x-r.x,n=e.y-r.y;return Math.atan2(n,s)},magnitude(r){return Math.sqrt(r.x*r.x+r.y*r.y)},normalize(r){const e=this.magnitude(r);return e===0?{x:0,y:0}:{x:r.x/e,y:r.y/e}},snapToGrid(r,e){return{x:Math.round(r.x/e)*e,y:Math.round(r.y/e)*e}},calculateArea(r){return Math.abs(r.properties.width*r.properties.height)},boundsContainPoint(r,e){return e.x>=r.x&&e.x<=r.x+r.width&&e.y>=r.y&&e.y<=r.y+r.height},boundsIntersect(r,e){return!(r.x+r.width<e.x||e.x+e.width<r.x||r.y+r.height<e.y||e.y+e.height<r.y)},gcd(r,e){for(r=Math.abs(r),e=Math.abs(e);e!==0;){const s=e;e=r%e,r=s}return r},simplifyFraction(r,e){if(e===0)return[r,1];const s=this.gcd(r,e);return[r/s,e/s]},worldToScreen(r,e,s){const n=s.width/2,o=s.height/2,i=(r.x-e.center.x)*e.zoom,c=(r.y-e.center.y)*e.zoom;return{x:n+i,y:o-c}},screenToWorld(r,e,s){const n=s.width/2,o=s.height/2,i=(r.x-n)/e.zoom,c=(o-r.y)/e.zoom;return{x:e.center.x+i,y:e.center.y+c}}},Ve={detectCapabilities(){const r="ontouchstart"in window||navigator.maxTouchPoints>0,e=r&&navigator.maxTouchPoints>1,s=!0,n=window.matchMedia("(hover: hover)").matches;return{hasTouch:r,hasPencil:e,hasKeyboard:s,hasHover:n,maxTouchPoints:navigator.maxTouchPoints||0,supportsPressure:"force"in Touch.prototype,supportsTilt:"altitudeAngle"in Touch.prototype}},normalizePointerEvent(r){let e="mouse";return r.pointerType==="touch"?e="touch":r.pointerType==="pen"&&(e="pen"),{type:e,pressure:r.pressure||0,tiltX:r.tiltX||0,tiltY:r.tiltY||0,x:r.clientX,y:r.clientY,timestamp:r.timeStamp,isPrimary:r.isPrimary,pointerId:r.pointerId}},getTouchTargetSize(r){switch(r){case"pen":return 32;case"touch":return 44;case"mouse":return 24;default:return 44}}};class Rt{constructor(){this.listeners=new Map}on(e,s){this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(s)}off(e,s){const n=this.listeners.get(e);if(n){const o=n.indexOf(s);o>-1&&n.splice(o,1)}}emit(e,s){const n=this.listeners.get(e);n&&n.forEach(o=>{try{o(s)}catch(i){console.error(`Error in event handler for ${e}:`,i)}})}clear(){this.listeners.clear()}getEvents(){return Array.from(this.listeners.keys())}getListenerCount(e){var s;return((s=this.listeners.get(e))==null?void 0:s.length)||0}}const gt=r=>{let e;const s=new Set,n=(x,S)=>{const T=typeof x=="function"?x(e):x;if(!Object.is(T,e)){const $=e;e=S??(typeof T!="object"||T===null)?T:Object.assign({},e,T),s.forEach(F=>F(e,$))}},o=()=>e,a={setState:n,getState:o,getInitialState:()=>h,subscribe:x=>(s.add(x),()=>s.delete(x))},h=e=r(n,o,a);return a},Bt=r=>r?gt(r):gt,Gt=r=>r;function qt(r,e=Gt){const s=j.useSyncExternalStore(r.subscribe,()=>e(r.getState()),()=>e(r.getInitialState()));return j.useDebugValue(s),s}const yt=r=>{const e=Bt(r),s=n=>qt(e,n);return Object.assign(s,e),s},dt=r=>r?yt(r):yt,Oe=dt((r,e)=>({viewport:{center:{x:0,y:0},zoom:20,bounds:{x:-10,y:-10,width:20,height:20}},objects:[],selectedObjects:[],snapToGrid:!0,gridDensity:"fine",canvasSize:{width:800,height:600},setViewport:s=>{r(n=>({viewport:{...n.viewport,...s}}))},addObject:s=>{r(n=>({objects:[...n.objects,s]}))},removeObject:s=>{r(n=>({objects:n.objects.filter(o=>o.id!==s),selectedObjects:n.selectedObjects.filter(o=>o!==s)}))},updateObject:(s,n)=>{r(o=>({objects:o.objects.map(i=>i.id===s?{...i,...n}:i)}))},selectObject:(s,n=!1)=>{r(o=>n?{selectedObjects:o.selectedObjects.includes(s)?o.selectedObjects.filter(c=>c!==s):[...o.selectedObjects,s]}:{selectedObjects:[s]})},clearSelection:()=>{r({selectedObjects:[]})},setSnapToGrid:s=>{r({snapToGrid:s})},setGridDensity:s=>{r({gridDensity:s})},setCanvasSize:s=>{r({canvasSize:s})},getObject:s=>e().objects.find(n=>n.id===s),getAllObjects:()=>e().objects,getSelectedObjects:()=>{const s=e();return s.objects.filter(n=>s.selectedObjects.includes(n.id))},screenToWorld:s=>{const{viewport:n,canvasSize:o}=e();return Ue.screenToWorld(s,n,o)},worldToScreen:s=>{const{viewport:n,canvasSize:o}=e();return Ue.worldToScreen(s,n,o)},bringToFront:s=>{r(n=>{const o=Math.max(...n.objects.map(i=>i.zIndex||0));return{objects:n.objects.map(i=>i.id===s?{...i,zIndex:o+1}:i)}})},sendToBack:s=>{r(n=>{const o=Math.min(...n.objects.map(i=>i.zIndex||0));return{objects:n.objects.map(i=>i.id===s?{...i,zIndex:o-1}:i)}})},bringForward:s=>{r(n=>{const o=n.objects.find(a=>a.id===s);if(!o)return n;const i=n.objects.filter(a=>(a.zIndex||0)>(o.zIndex||0));if(i.length===0)return n;const c=Math.min(...i.map(a=>a.zIndex||0));return{objects:n.objects.map(a=>a.id===s?{...a,zIndex:c+.1}:a)}})},sendBackward:s=>{r(n=>{const o=n.objects.find(a=>a.id===s);if(!o)return n;const i=n.objects.filter(a=>(a.zIndex||0)<(o.zIndex||0));if(i.length===0)return n;const c=Math.max(...i.map(a=>a.zIndex||0));return{objects:n.objects.map(a=>a.id===s?{...a,zIndex:c-.1}:a)}})}})),Yt=()=>({addObject:r=>Oe.getState().addObject(r),removeObject:r=>Oe.getState().removeObject(r),updateObject:(r,e)=>Oe.getState().updateObject(r,e),getObject:r=>Oe.getState().getObject(r),getAllObjects:()=>Oe.getState().getAllObjects(),screenToWorld:r=>Oe.getState().screenToWorld(r),worldToScreen:r=>Oe.getState().worldToScreen(r)}),_t=()=>({getState:()=>{const r=Oe.getState();return{viewport:r.viewport,objects:r.objects,selectedObjects:r.selectedObjects,snapToGrid:r.snapToGrid,gridDensity:r.gridDensity}},setState:r=>{Oe.setState(r)},subscribe:r=>Oe.subscribe(e=>{r({viewport:e.viewport,objects:e.objects,selectedObjects:e.selectedObjects,snapToGrid:e.snapToGrid,gridDensity:e.gridDensity})})}),ft=j.createContext(null);function nt(){const r=j.useContext(ft);if(!r)throw new Error("usePluginManager must be used within PluginManagerProvider");return r}function mt({children:r}){const[e]=j.useState(()=>new Rt),[s]=j.useState(()=>new Map),[n]=j.useState(()=>new Map),[o,i]=j.useState(null),c=j.useRef(),a=j.useRef(),h=j.useRef();c.current||(c.current=Yt()),a.current||(a.current=_t()),h.current||(h.current={distance:Ue.distance,slope:Ue.slope,snapToGrid:Ue.snapToGrid,calculateArea:Ue.calculateArea});const x=c.current,S=a.current,T=h.current,$=l=>{if(s.has(l.id)){console.warn(`Plugin ${l.id} is already registered`);return}const m={canvas:x,events:e,state:S,math:T};s.set(l.id,l),n.set(l.id,m);try{l.init(m),console.log(`Plugin ${l.id} initialized successfully`)}catch(b){console.error(`Failed to initialize plugin ${l.id}:`,b),s.delete(l.id),n.delete(l.id)}},F=l=>{var b;const m=s.get(l);if(m){try{(b=m.destroy)==null||b.call(m)}catch(k){console.error(`Error destroying plugin ${l}:`,k)}s.delete(l),n.delete(l),o===l&&i(null)}},z=()=>Array.from(s.values());j.useEffect(()=>{e.emit("tool:changed",{previous:null,current:o})},[o,e]),j.useEffect(()=>{const l=O=>I=>{var Y,V,le,de,ke,g;const Z=o?s.get(o):null;if(Z)try{switch(O){case"pointer:down":(Y=Z.onPointerDown)==null||Y.call(Z,I);break;case"pointer:move":(V=Z.onPointerMove)==null||V.call(Z,I);break;case"pointer:up":(le=Z.onPointerUp)==null||le.call(Z,I);break}}catch(w){console.error(`Error in plugin ${o} handling ${O}:`,w)}else{const w=S.getState().selectedObjects;try{let H;if(w.length===1){const ce=x.getObject(w[0]);(ce==null?void 0:ce.type)==="ray"?H=s.get("ray-tool"):(ce==null?void 0:ce.type)==="rectangle"?H=s.get("rectangle-tool"):(ce==null?void 0:ce.type)==="circle"?H=s.get("circle-tool"):(ce==null?void 0:ce.type)==="triangle"?H=s.get("triangle-tool"):(ce==null?void 0:ce.type)==="function"&&(H=s.get("function-tool"))}if(H)switch(O){case"pointer:down":(de=H.onPointerDown)==null||de.call(H,I);break;case"pointer:move":(ke=H.onPointerMove)==null||ke.call(H,I);break;case"pointer:up":(g=H.onPointerUp)==null||g.call(H,I);break}}catch(H){console.error(`Error in tool handling ${O} for manipulation:`,H)}}},m=l("pointer:down"),b=l("pointer:move"),k=l("pointer:up");return e.on("pointer:down",m),e.on("pointer:move",b),e.on("pointer:up",k),()=>{e.off("pointer:down",m),e.off("pointer:move",b),e.off("pointer:up",k)}},[o,s,e,S,x]);const P={eventBus:e,registerPlugin:$,unregisterPlugin:F,getActivePlugins:z,activeTool:o,setActiveTool:i};return t.jsx(ft.Provider,{value:P,children:r})}function Xt(){const{eventBus:r}=nt();return{handlePointerDown:o=>{r.emit("pointer:down",o)},handlePointerMove:o=>{r.emit("pointer:move",o)},handlePointerUp:o=>{r.emit("pointer:up",o)}}}function bt(r,e,s={}){const[n,o]=j.useState(null),[i,c]=j.useState(new Map),a={enableGestures:!0,touchTargetSize:44,preventScrolling:!0,...s};j.useEffect(()=>{const l=Ve.detectCapabilities();o(l)},[]);const[h,x]=j.useState({isGesturing:!1,startTime:0,startDistance:0,lastTapTime:0,tapCount:0}),S=j.useCallback(l=>{const m=Array.from(l.values());if(m.length<2)return 0;const b=m[0],k=m[1];if(!b||!k)return 0;const O=b.x-k.x,I=b.y-k.y;return Math.sqrt(O*O+I*I)},[]),T=j.useCallback(l=>{const m=Array.from(l.values());if(m.length===0)return{x:0,y:0};const b=m.reduce((k,O)=>({x:k.x+O.x,y:k.y+O.y}),{x:0,y:0});return{x:b.x/m.length,y:b.y/m.length}},[]),$=j.useCallback(l=>{var I;if(!r.current)return;a.preventScrolling&&l.preventDefault();const m=r.current.getBoundingClientRect(),b=l.clientX-m.left,k=l.clientY-m.top,O=Ve.normalizePointerEvent(l);O.x=b,O.y=k,c(Z=>{const Y=new Map(Z);if(Y.set(l.pointerId,O),a.enableGestures&&Y.size>=2){const V=S(Y);x(le=>({...le,isGesturing:!0,startTime:l.timeStamp,startDistance:V}))}return Y}),r.current.setPointerCapture(l.pointerId),(I=e.onPointerDown)==null||I.call(e,O)},[r,e,a,S]),F=j.useCallback(l=>{var I;if(!r.current)return;const m=r.current.getBoundingClientRect(),b=l.clientX-m.left,k=l.clientY-m.top,O=Ve.normalizePointerEvent(l);O.x=b,O.y=k,c(Z=>{var V,le;const Y=new Map(Z);if(Y.set(l.pointerId,O),a.enableGestures&&Y.size>=2){const de=S(Y),ke=T(Y);if(h.isGesturing&&h.startDistance>0){const g=de/h.startDistance;(V=e.onGesture)==null||V.call(e,{type:"pinch",center:ke,scale:g,touches:Y.size})}}else if(Y.size===1&&h.isGesturing){const de=T(Y);(le=e.onGesture)==null||le.call(e,{type:"pan",center:de,touches:Y.size})}return Y}),(I=e.onPointerMove)==null||I.call(e,O)},[e,a,S,T,h]),z=j.useCallback(l=>{var I;if(!r.current)return;const m=r.current.getBoundingClientRect(),b=l.clientX-m.left,k=l.clientY-m.top,O=Ve.normalizePointerEvent(l);O.x=b,O.y=k,c(Z=>{var V;const Y=new Map(Z);if(Y.delete(l.pointerId),a.enableGestures&&Y.size===0){const de=l.timeStamp-h.startTime<200,ke=l.timeStamp-h.lastTapTime;de&&!h.isGesturing&&(ke<300?x(g=>({...g,tapCount:g.tapCount+1})):((V=e.onGesture)==null||V.call(e,{type:"tap",center:{x:O.x,y:O.y},touches:1}),x(g=>({...g,tapCount:1,lastTapTime:l.timeStamp})))),x(g=>({...g,isGesturing:!1}))}return Y}),r.current&&r.current.releasePointerCapture(l.pointerId),(I=e.onPointerUp)==null||I.call(e,O)},[r,e,a,h]),P=j.useCallback(l=>{var I;if(!r.current)return;const m=r.current.getBoundingClientRect(),b=l.clientX-m.left,k=l.clientY-m.top,O=Ve.normalizePointerEvent(l);O.x=b,O.y=k,c(Z=>{const Y=new Map(Z);return Y.delete(l.pointerId),Y}),x(Z=>({...Z,isGesturing:!1})),(I=e.onPointerCancel)==null||I.call(e,O)},[e]);return j.useEffect(()=>{const l=r.current;if(!l)return;l.addEventListener("pointerdown",$),l.addEventListener("pointermove",F),l.addEventListener("pointerup",z),l.addEventListener("pointercancel",P);const m=b=>b.preventDefault();return l.addEventListener("contextmenu",m),()=>{l.removeEventListener("pointerdown",$),l.removeEventListener("pointermove",F),l.removeEventListener("pointerup",z),l.removeEventListener("pointercancel",P),l.removeEventListener("contextmenu",m)}},[r,$,F,z,P]),{capabilities:n,activePointers:Array.from(i.values()),isGesturing:h.isGesturing,touchTargetSize:n?Ve.getTouchTargetSize(n.hasTouch?"touch":"mouse"):a.touchTargetSize}}function vt(r,e={minSpacing:8,maxSpacing:80,labelMinSpacing:40}){const s=r.zoom;let o=1,i=o*s;for(;i<e.minSpacing&&o<1e4;)o*=jt(o),i=o*s;for(;i>e.maxSpacing&&o>1e-4;)o/=Ht(o),i=o*s;let c=o,a=c*s;for(;a<e.labelMinSpacing&&c<o*100;)c*=jt(c),a=c*s;const h=Math.max(.1,Math.min(1,(i-e.minSpacing)/(e.maxSpacing-e.minSpacing)));return{gridSize:o,labelStep:c,shouldShowGrid:i>=e.minSpacing,shouldShowLabels:a>=e.labelMinSpacing,opacity:h}}function jt(r){if(r<1)return r>=.5?2:r>=.2?2.5:(r>=.1,2);if(r<10)return r>=5?2:r>=2?2.5:(r>=1,2);{const e=Math.pow(10,Math.floor(Math.log10(r))),s=r/e;return s>=5?2:s>=2?2.5:(s>=1,2)}}function Ht(r){if(r<=1)return r<=.1||r<=.2?2:r<=.5?2.5:(r<=1,2);if(r<=10)return r<=2?2:r<=5?2.5:(r<=10,2);{const e=Math.pow(10,Math.floor(Math.log10(r))),s=r/e;return s<=2?2:s<=5?2.5:(s<=10,2)}}function Ut(r,e,s,n,o=!0){const{gridSize:i}=s,c={left:r.center.x-e.width/2/r.zoom,right:r.center.x+e.width/2/r.zoom,top:r.center.y+e.height/2/r.zoom,bottom:r.center.y-e.height/2/r.zoom},a=[],h=[],x=Math.floor(c.left/i)*i,S=Math.ceil(c.right/i)*i;for(let F=x;F<=S;F+=i){const z=n({x:F,y:0}).x,P=Math.abs(F)<i/2,l=Math.abs(F%(i*5))<i/2;a.push({x:z,isAxis:P,isMajor:l,isInteger:!1,value:F})}if(o&&(i>=2||i<1)){const F=Math.floor(c.left),z=Math.ceil(c.right);for(let P=F;P<=z;P+=1)if(Math.abs(P%i)>.001){const l=n({x:P,y:0}).x,m=Math.abs(P)<.5;a.push({x:l,isAxis:m,isMajor:!1,isInteger:!0,value:P})}}const T=Math.floor(c.bottom/i)*i,$=Math.ceil(c.top/i)*i;for(let F=T;F<=$;F+=i){const z=n({x:0,y:F}).y,P=Math.abs(F)<i/2,l=Math.abs(F%(i*5))<i/2;h.push({y:z,isAxis:P,isMajor:l,isInteger:!1,value:F})}if(o&&(i>=2||i<1)){const F=Math.floor(c.bottom),z=Math.ceil(c.top);for(let P=F;P<=z;P+=1)if(Math.abs(P%i)>.001){const l=n({x:0,y:P}).y,m=Math.abs(P)<.5;h.push({y:l,isAxis:m,isMajor:!1,isInteger:!0,value:P})}}return{verticalLines:a,horizontalLines:h}}function Se(r,e=3){if(Number.isInteger(r))return r.toString();const s=r.toFixed(e);return parseFloat(s).toString()}function rt(r,e,s){const n=s.x-e.x,o=s.y-e.y,i=Math.sqrt(n*n+o*o);if(i===0)return Math.sqrt((r.x-e.x)**2+(r.y-e.y)**2);const c=Math.max(0,Math.min(1,((r.x-e.x)*n+(r.y-e.y)*o)/(i*i))),a={x:e.x+c*n,y:e.y+c*o};return Math.sqrt((r.x-a.x)**2+(r.y-a.y)**2)}function wt(r,e){const[s,n,o]=e,i=(n.y-o.y)*(s.x-o.x)+(o.x-n.x)*(s.y-o.y),c=((n.y-o.y)*(r.x-o.x)+(o.x-n.x)*(r.y-o.y))/i,a=((o.y-s.y)*(r.x-o.x)+(s.x-o.x)*(r.y-o.y))/i,h=1-c-a;return c>=0&&a>=0&&h>=0}function Mt(r,e,s){const n=Math.sqrt((r.x-e.x)**2+(r.y-e.y)**2);return Math.abs(n-s)}function q(r,e){return e>=1?r.toFixed(0):e>=.1?r.toFixed(1):e>=.01?r.toFixed(2):r.toFixed(3)}function Ze(r,e,s){if(s!=="adaptive")switch(s){case"whole":return 1;case"half":return .5;case"quarter":return .25;case"tenth":return .1;default:return 1}const o=vt(r,{minSpacing:8,maxSpacing:80,labelMinSpacing:40}).gridSize/e;return o<=.1?o:o<=.5?.1:o<=2?.25:1}const Ct={showEquivalentFractions:!0,showLengthMultiples:!0,showAreaRectangle:!0,showDivisionMultiples:!0,showRiseRunTriangle:!1,showDistanceMarkers:!1,showAngleArc:!1,showTangentLines:!1,showFunctionExtensions:!0,showTriangleAngles:!0,showSOHCAHTOA:!1,showTrigValues:!1,showTriangleClassification:!0,showTriangleAltitudes:!1,showSpecialTriangles:!0,showPythagoreanSquares:!1,showDivisionAnswer:!0,showLatticePoints:!1,showIntegerGridLines:!0,showReferenceLineY_equals_X:!0,showFactorPairs:!1,showCommutativeProperty:!1,showDistributiveProperty:!1,showPrimeComposite:!1,showGCF:!0,showLCM:!1,fontScale:1,gridScale:1,snapPrecision:"whole",coordinateSystem:"cartesian",showPolarGrid:!1,customOrigin:null},Le=dt(r=>({...Ct,toggleSetting:e=>{r(s=>({[e]:!s[e]}))},setFontScale:e=>{r({fontScale:e})},setGridScale:e=>{r({gridScale:e})},setSnapPrecision:e=>{r({snapPrecision:e})},setCoordinateSystem:e=>{r({coordinateSystem:e})},setCustomOrigin:e=>{r({customOrigin:e})},resetToDefaults:()=>{r(Ct)}}));function Vt({viewport:r,canvasSize:e,worldToScreen:s,objects:n=[]}){const o=Le(),i=l=>Math.round(l*o.fontScale),c=vt(r,{minSpacing:8,maxSpacing:80,labelMinSpacing:40}),a={gridSize:c.gridSize/o.gridScale,labelStep:c.labelStep/o.gridScale},{verticalLines:h,horizontalLines:x}=Ut(r,e,a,s,o.showIntegerGridLines);if(!c.shouldShowGrid)return null;const S=[];if(o.coordinateSystem==="polar"||o.coordinateSystem==="both"){const l=s({x:0,y:0}),m=Math.max(Math.abs(r.center.x)+e.width/(2*r.zoom),Math.abs(r.center.y)+e.height/(2*r.zoom));for(let b=a.gridSize;b<=m;b+=a.gridSize){const k=b*r.zoom;k>=10&&S.push(t.jsx("circle",{cx:l.x,cy:l.y,r:k,fill:"none",stroke:"#9CA3AF",strokeWidth:"0.5",opacity:.4},`polar-circle-${b}`))}for(let b=0;b<360;b+=30){const k=b*Math.PI/180,O=l.x+m*r.zoom*Math.cos(k),I=l.y-m*r.zoom*Math.sin(k);S.push(t.jsx("line",{x1:l.x,y1:l.y,x2:O,y2:I,stroke:"#9CA3AF",strokeWidth:"0.5",opacity:.3},`polar-line-${b}`))}}const T=[];n.forEach(l=>{if(l.type==="ray"){const{startPoint:m,endPoint:b}=l.properties;if(Math.abs(m.x)<.001&&Math.abs(m.y)<.001){const k=b.x-m.x,O=b.y-m.y;if(Math.abs(k)>.001){const I=1/k;if(I>0&&I<=1){const Z=m.y+I*O,Y=s({x:1,y:Z});T.push({y:Z,screenY:Y.y})}}}}});const $=h.map(l=>{const m=Math.abs(l.value-1)<.001,b=l.isAxis?"#374151":m?"#60A5FA":l.isInteger?"#D1D5DB":l.isMajor?"#9CA3AF":"#E5E7EB",k=l.isAxis?2:m?1.5:l.isInteger||l.isMajor?1:.5,O=l.isAxis?1:m?.8:l.isInteger?.5:l.isMajor?.6*c.opacity:.3*c.opacity;return t.jsx("line",{x1:l.x,y1:0,x2:l.x,y2:e.height,stroke:b,strokeWidth:k,opacity:O},`v${l.value}`)}),F=x.map(l=>t.jsx("line",{x1:0,y1:l.y,x2:e.width,y2:l.y,stroke:l.isAxis?"#374151":l.isInteger?"#D1D5DB":l.isMajor?"#9CA3AF":"#E5E7EB",strokeWidth:l.isAxis?2:l.isInteger||l.isMajor?1:.5,opacity:l.isAxis?1:l.isInteger?.5:l.isMajor?.6*c.opacity:.3*c.opacity},`h${l.value}`)),z=o.showReferenceLineY_equals_X?(()=>{const l={left:r.center.x-e.width/2/r.zoom,right:r.center.x+e.width/2/r.zoom,top:r.center.y+e.height/2/r.zoom,bottom:r.center.y-e.height/2/r.zoom},m=Math.min(l.left,l.bottom),b=Math.max(l.right,l.top),k=s({x:m,y:m}),O=s({x:b,y:b});return{lineStart:k,lineEnd:O}})():null,P=o.showLatticePoints?(()=>{const l={left:r.center.x-e.width/2/r.zoom,right:r.center.x+e.width/2/r.zoom,top:r.center.y+e.height/2/r.zoom,bottom:r.center.y-e.height/2/r.zoom},m=[],b=Math.max(-20,Math.floor(l.left)),k=Math.min(20,Math.ceil(l.right)),O=Math.max(-20,Math.floor(l.bottom)),I=Math.min(20,Math.ceil(l.top)),Z=(k-b+1)*(I-O+1);if(Z>200){const Y=Math.ceil(Math.sqrt(Z/200));for(let V=b;V<=k;V+=Y)for(let le=O;le<=I;le+=Y){const de=s({x:V,y:le});de.x>=-20&&de.x<=e.width+20&&de.y>=-20&&de.y<=e.height+20&&m.push(de)}}else for(let Y=b;Y<=k;Y++)for(let V=O;V<=I;V++){const le=s({x:Y,y:V});le.x>=-20&&le.x<=e.width+20&&le.y>=-20&&le.y<=e.height+20&&m.push(le)}return m})():[];return t.jsxs("g",{className:"grid",children:[(o.coordinateSystem==="polar"||o.coordinateSystem==="both")&&t.jsx("g",{className:"polar-grid",children:S}),(o.coordinateSystem==="cartesian"||o.coordinateSystem==="both")&&t.jsxs("g",{className:"cartesian-grid",children:[$,F]}),P.map((l,m)=>t.jsx("circle",{cx:l.x,cy:l.y,r:"1.5",fill:"#9CA3AF",opacity:"0.3"},`lattice-${m}`)),z&&t.jsx("line",{x1:z.lineStart.x,y1:z.lineStart.y,x2:z.lineEnd.x,y2:z.lineEnd.y,stroke:"#A78BFA",strokeWidth:"1.5",opacity:"0.6",strokeDasharray:"5,5"}),c.shouldShowLabels&&t.jsxs("g",{className:"labels",fontSize:"12",fill:"#374151",children:[h.filter(l=>{const m=Math.abs(l.value%a.labelStep)<a.gridSize/10,b=Math.abs(l.value)>=a.labelStep/2;return m&&b}).filter((l,m,b)=>!b.slice(0,m).some(k=>Math.abs(k.value-l.value)<.001)).map(l=>t.jsx("text",{x:l.x,y:s({x:0,y:0}).y+20,textAnchor:"middle",fontSize:i(11),fontWeight:"500",opacity:Math.max(.7,c.opacity),children:q(l.value,c.gridSize)},`xlabel${l.value}`)),x.filter(l=>{const m=Math.abs(l.value%a.labelStep)<a.gridSize/10,b=Math.abs(l.value)>=a.labelStep/2;return m&&b}).filter((l,m,b)=>!b.slice(0,m).some(k=>Math.abs(k.value-l.value)<.001)).map(l=>t.jsx("text",{x:s({x:0,y:0}).x-15,y:l.y+4,textAnchor:"middle",fontSize:i(11),fontWeight:"500",opacity:Math.max(.7,c.opacity),children:q(l.value,c.gridSize)},`ylabel${l.value}`)),t.jsxs("g",{children:[t.jsx("circle",{cx:s({x:0,y:0}).x,cy:s({x:0,y:0}).y,r:"3",fill:"#374151",opacity:"0.6"}),t.jsx("text",{x:s({x:0,y:0}).x-25,y:s({x:0,y:0}).y-10,fontSize:i(11),fontWeight:"600",fill:"#374151",opacity:Math.max(.8,c.opacity),children:"(0,0)"})]}),o.showDivisionAnswer&&T.map((l,m)=>{const b=s({x:1,y:0}).x;return t.jsxs("g",{children:[t.jsx("circle",{cx:b,cy:l.screenY,r:"4",fill:"white",stroke:"#60A5FA",strokeWidth:"2",opacity:"0.9"}),t.jsxs("text",{x:b+15,y:l.screenY+4,fontSize:i(10),fontWeight:"600",fill:"#60A5FA",opacity:"0.9",children:["y = ",l.y.toFixed(2)]})]},`ray-intersection-${m}`)})]})]})}function Zt({viewport:r,onZoomIn:e,onZoomOut:s,onZoomReset:n,onCenterOnly:o}){const[i,c]=j.useState(0),a=j.useRef(null),h=()=>{const x=Date.now();x-i<500?(a.current&&(clearTimeout(a.current),a.current=null),n()):a.current=window.setTimeout(()=>{o(),a.current=null},300),c(x)};return t.jsxs("div",{className:"absolute bottom-4 right-4 flex flex-col gap-2",children:[t.jsx("button",{onClick:e,className:"w-10 h-10 bg-white/90 hover:bg-white border border-gray-300 rounded-lg shadow-md flex items-center justify-center text-gray-700 font-bold transition-colors",title:"Zoom in (Ctrl+scroll up)",disabled:r.zoom>=1e3,children:"+"}),t.jsx("button",{onClick:s,className:"w-10 h-10 bg-white/90 hover:bg-white border border-gray-300 rounded-lg shadow-md flex items-center justify-center text-gray-700 font-bold transition-colors",title:"Zoom out (Ctrl+scroll down)",disabled:r.zoom<=.01,children:"−"}),t.jsx("button",{onClick:h,className:"w-10 h-10 bg-white/90 hover:bg-white border border-gray-300 rounded-lg shadow-md flex items-center justify-center text-gray-600 text-xs transition-colors",title:"Center view (single click) or Reset zoom (double click)",children:"⌂"}),t.jsxs("div",{className:"w-10 h-6 bg-white/90 border border-gray-300 rounded text-xs flex items-center justify-center text-gray-600",children:[r.zoom>=1?Math.round(r.zoom):r.zoom.toFixed(1),"×"]})]})}function Kt({objects:r,viewport:e,touchTargetSize:s,worldToScreen:n,selectedObjects:o=[],canvasSize:i}){const c=Le(),a=g=>Math.round(g*c.fontScale),h=Ze(e,c.gridScale,c.snapPrecision),x=h,[S,T]=j.useState(null),[$,F]=j.useState(null),[z,P]=j.useState(null),[l,m]=j.useState(null),[b,k]=j.useState(null),[O,I]=j.useState(null),[Z,Y]=j.useState(null),[V,le]=j.useState(null),de=j.useRef(null);j.useEffect(()=>{const g=w=>{const H=w.target;l&&!(H!=null&&H.closest("circle"))&&m(null)};if(l)return document.addEventListener("touchstart",g),()=>document.removeEventListener("touchstart",g)},[l]),j.useEffect(()=>()=>{de.current&&clearTimeout(de.current)},[]);const ke=g=>{var H,ce;const w=o.includes(g.id);switch(g.type){case"ray":const Pe=n(g.properties.startPoint),je=n(g.properties.endPoint);return t.jsxs("g",{children:[w&&t.jsx("line",{x1:Pe.x,y1:Pe.y,x2:je.x,y2:je.y,stroke:"#60A5FA",strokeWidth:6,opacity:.4}),t.jsx("line",{x1:Pe.x,y1:Pe.y,x2:je.x,y2:je.y,stroke:w?"#1D4ED8":"#2563eb",strokeWidth:w?3:2}),t.jsx("circle",{cx:Pe.x,cy:Pe.y,r:s/4,fill:w?"#1D4ED8":"#2563eb",stroke:w?"#60A5FA":"none",strokeWidth:w?2:0,style:{cursor:"move"},onMouseEnter:()=>T(`${g.id}-start`),onMouseLeave:()=>T(null)}),t.jsx("circle",{cx:je.x,cy:je.y,r:s/4,fill:w?"#1D4ED8":"#2563eb",stroke:w?"#60A5FA":"none",strokeWidth:w?2:0,style:{cursor:"move"},onMouseEnter:()=>T(`${g.id}-end`),onMouseLeave:()=>T(null)}),!(Math.abs(g.properties.startPoint.x)<.001&&Math.abs(g.properties.startPoint.y)<.001)&&S===`${g.id}-start`&&t.jsxs("text",{x:Pe.x-5,y:Pe.y-10,fontSize:a(10),fontWeight:"500",fill:w?"#1D4ED8":"#2563eb",textAnchor:"middle",opacity:"0.8",children:["(",q(g.properties.startPoint.x,x),", ",q(g.properties.startPoint.y,x),")"]}),S===`${g.id}-end`&&t.jsxs("text",{x:Math.abs(g.properties.startPoint.x)<.001&&Math.abs(g.properties.startPoint.y)<.001?je.x-60:je.x+5,y:Math.abs(g.properties.startPoint.x)<.001&&Math.abs(g.properties.startPoint.y)<.001?je.y+4:je.y-10,fontSize:a(10),fontWeight:"500",fill:w?"#1D4ED8":"#2563eb",textAnchor:Math.abs(g.properties.startPoint.x)<.001&&Math.abs(g.properties.startPoint.y)<.001?"end":"middle",opacity:"0.8",children:["(",q(g.properties.endPoint.x,x),", ",q(g.properties.endPoint.y,x),")"]}),(()=>{const y=g.properties.endPoint.x-g.properties.startPoint.x;g.properties.endPoint.y-g.properties.startPoint.y;const d=Math.abs(g.properties.startPoint.x)<.001&&Math.abs(g.properties.startPoint.y)<.001;if(Math.abs(y)>.001){const u=je.x,C=je.y;if(d){const f=g.properties.endPoint.x,v=g.properties.endPoint.y,A=q(v,x),M=q(f,x);return t.jsxs("g",{children:[t.jsx("text",{x:u+15,y:C-25,fontSize:a(9),fontWeight:"500",fill:w?"#1D4ED8":"#2563eb",textAnchor:"middle",opacity:"0.8",children:A}),t.jsx("line",{x1:u+8,y1:C-19,x2:u+22,y2:C-19,stroke:w?"#1D4ED8":"#2563eb",strokeWidth:"1",opacity:"0.8"}),t.jsx("text",{x:u+15,y:C-9,fontSize:a(9),fontWeight:"500",fill:w?"#1D4ED8":"#2563eb",textAnchor:"middle",opacity:"0.8",children:M})]})}else return null}return null})(),(()=>{if(!(Math.abs(g.properties.startPoint.x)<.001&&Math.abs(g.properties.startPoint.y)<.001))return null;const d=g.properties.endPoint.x,u=g.properties.endPoint.y;if(Math.abs(d)<.001&&Math.abs(u)<.001)return null;const C=d,f=u,v={left:e.center.x-i.width/2/e.zoom,right:e.center.x+i.width/2/e.zoom,top:e.center.y+i.height/2/e.zoom,bottom:e.center.y-i.height/2/e.zoom},A=Math.max(Math.abs(v.left),Math.abs(v.right),Math.abs(v.top),Math.abs(v.bottom))*2,M=Math.sqrt(C*C+f*f);if(M===0)return null;const D=C/M,B=f/M,se={x:A*D,y:A*B},Me=n(se),ve=[];if(Math.abs(d)>.001&&Math.abs(u)>.001){const W=d,G=u;for(let X=2;X<=8;X++){const J=W*X,ge=G*X,xe=Math.round(J/h)*h,ue=Math.round(ge/h)*h;if(Math.abs(J-xe)<h/10&&Math.abs(ge-ue)<h/10&&xe>0&&ue>0&&xe<=Math.min(20,Math.abs(A))&&ue<=Math.min(20,Math.abs(A))){const Te=n({x:xe,y:ue});Te.x>=-100&&Te.x<=i.width+100&&Te.y>=-100&&Te.y<=i.height+100&&ve.push({world:{x:xe,y:ue},screen:Te,fraction:{num:q(ue,h),den:q(xe,h)}})}}}const ze=Math.sqrt(d*d+u*u),me=[];if(ze>0&&c.showLengthMultiples)for(let W=2;W<=5;W++){const G=d*W,X=u*W,J=n({x:G,y:X});J.x>=-50&&J.x<=i.width+50&&J.y>=-50&&J.y<=i.height+50&&me.push({screen:J,multiple:W})}return t.jsxs("g",{children:[c.showEquivalentFractions&&t.jsx("line",{x1:je.x,y1:je.y,x2:Me.x,y2:Me.y,stroke:w?"#1D4ED8":"#2563eb",strokeWidth:"1",opacity:"0.3",strokeDasharray:"3,3"}),me.map((W,G)=>t.jsxs("g",{children:[t.jsx("circle",{cx:W.screen.x,cy:W.screen.y,r:"2",fill:w?"#1D4ED8":"#2563eb",opacity:"0.4"}),t.jsxs("text",{x:W.screen.x+8,y:W.screen.y-8,fontSize:a(7),fontWeight:"400",fill:w?"#1D4ED8":"#2563eb",textAnchor:"start",opacity:"0.5",children:["×",W.multiple]})]},`length-${G}`)),c.showAreaRectangle&&(()=>{if(d>0&&u>0){const W=n({x:0,y:0}),G=n({x:d,y:u}),X=Math.abs(G.x-W.x),J=Math.abs(G.y-W.y),ge=Math.min(W.x,G.x),xe=Math.min(W.y,G.y),ue=d*u;return t.jsxs("g",{children:[t.jsx("rect",{x:ge,y:xe,width:X,height:J,fill:w?"#1D4ED8":"#2563eb",opacity:"0.08",stroke:w?"#1D4ED8":"#2563eb",strokeWidth:"0.5",strokeOpacity:"0.15"}),t.jsxs("text",{x:ge+X/2,y:xe+15,fontSize:a(10),fontWeight:"400",fill:w?"#1D4ED8":"#2563eb",textAnchor:"middle",opacity:"0.6",children:[q(u,x)," × ",q(d,x)," = ",q(ue,x)]})]})}return null})(),c.showDivisionMultiples&&(()=>{if(!(Math.abs(g.properties.startPoint.x)<.001&&Math.abs(g.properties.startPoint.y)<.001)||d<=0)return null;const G=u/d,X=.15,J=25;if(G<X)return null;const ge=n({x:0,y:0}),xe=n({x:1,y:0}),ue=[],Te=Math.min(Math.floor(u/G),J);for(let Fe=1;Fe<=Te;Fe++){const De=Fe*G,We=n({x:0,y:De}).y,it=Math.abs(De-G)<.01;if(!c.showAreaRectangle){const Ce=Math.abs(We-ge.y)/Fe,Ee=Math.abs(xe.x-ge.x);ue.push(t.jsx("rect",{x:ge.x,y:We,width:Ee,height:Ce,fill:w?"#1D4ED8":"#2563eb",opacity:"0.08",stroke:w?"#1D4ED8":"#2563eb",strokeWidth:"0.5",strokeOpacity:"0.15"},`division-box-${Fe}`))}ue.push(t.jsxs("g",{children:[t.jsx("line",{x1:ge.x,y1:We,x2:xe.x,y2:We,stroke:w?"#1D4ED8":"#2563eb",strokeWidth:"1",opacity:"0.3",strokeDasharray:it?"4,2":"2,2"}),!it&&t.jsx("text",{x:xe.x+8,y:We-5,fontSize:a(8),fontWeight:"400",fill:w?"#1D4ED8":"#2563eb",textAnchor:"start",opacity:"0.5",children:Se(De)})]},`division-marker-${Fe}`))}return t.jsx("g",{children:ue})})(),c.showRiseRunTriangle&&(()=>{if(d>0&&u>0){const W=n({x:0,y:0}),G=n({x:d,y:0}),X=n({x:d,y:u});return t.jsxs("g",{children:[t.jsx("path",{d:`M ${W.x},${W.y} L ${G.x},${G.y} L ${X.x},${X.y} Z`,fill:"none",stroke:w?"#1D4ED8":"#2563eb",strokeWidth:"1",opacity:"0.4",strokeDasharray:"2,2"}),t.jsxs("text",{x:G.x+12,y:(G.y+X.y)/2,fontSize:a(9),fontWeight:"500",fill:w?"#1D4ED8":"#2563eb",textAnchor:"start",opacity:"0.7",children:["rise: ",q(u,x)]}),t.jsxs("text",{x:(W.x+G.x)/2,y:G.y+8,fontSize:a(9),fontWeight:"500",fill:w?"#1D4ED8":"#2563eb",textAnchor:"middle",opacity:"0.7",children:["run: ",q(d,x)]})]})}return null})(),c.showDistanceMarkers&&(()=>{const W=[],G=Math.sqrt(d*d+u*u);if(G>0){const X=n({x:0,y:0});let J=Math.atan2(u,d);J<0&&(J=J+2*Math.PI);const ge=[];for(let ue=1;ue<=Math.floor(G);ue++)ge.push({radius:ue,isUnit:!0});ge.push({radius:G,isUnit:!1}),ge.forEach(({radius:ue,isUnit:Te},Fe)=>{const De=ue*e.zoom;if(De>=15&&De<=800&&Math.abs(J)>.05){const We=J>Math.PI?1:0,Ce=`M ${X.x+De},${X.y} A ${De},${De} 0 ${We},0 ${X.x+De*Math.cos(J)},${X.y-De*Math.sin(J)}`;W.push(t.jsx("path",{d:Ce,fill:"none",stroke:w?"#1D4ED8":"#2563eb",strokeWidth:Te?"1":"1.5",opacity:Te?"0.3":"0.6",strokeDasharray:Te?"2,2":"none"},`radial-${g.id}-${ue.toFixed(3)}-${J.toFixed(3)}-${Fe}`))}});const xe=n({x:G,y:0});W.push(t.jsxs("g",{children:[t.jsx("path",{d:`M ${xe.x},${X.y} L ${xe.x-4},${X.y+8} L ${xe.x+4},${X.y+8} Z`,fill:w?"#1D4ED8":"#2563eb",opacity:"0.7"}),t.jsxs("text",{x:xe.x+15,y:X.y-8,fontSize:a(10),fontWeight:"600",fill:w?"#1D4ED8":"#2563eb",textAnchor:"start",opacity:"0.8",children:["d = ",G.toFixed(2)]})]},`distance-${g.id}`))}return t.jsx("g",{children:W})})(),c.showAngleArc&&(()=>{let W=Math.atan2(u,d);if(W<0&&(W=W+2*Math.PI),Math.abs(d)>.05||Math.abs(u)>.05){const G=n({x:0,y:0}),X=50,J=(W*180/Math.PI).toFixed(1),ge=W,xe=W>Math.PI?1:0,ue=`M ${G.x+X},${G.y} A ${X},${X} 0 ${xe},0 ${G.x+X*Math.cos(ge)},${G.y-X*Math.sin(ge)}`,Te=W/2,Fe=X*.7,De=G.x+Fe*Math.cos(Te),We=G.y-Fe*Math.sin(Te);return t.jsxs("g",{children:[t.jsx("path",{d:ue,fill:"none",stroke:w?"#1D4ED8":"#2563eb",strokeWidth:"2",opacity:"0.6"}),t.jsxs("text",{x:De,y:We,fontSize:a(11),fontWeight:"600",fill:w?"#1D4ED8":"#2563eb",textAnchor:"middle",opacity:"0.8",children:["θ = ",J,"°"]})]})}return null})(),c.showEquivalentFractions&&ve.map((W,G)=>{const J=Math.abs(W.world.x-1)<.1&&c.showDivisionAnswer,ge=Math.abs(W.world.x-d)<.1&&Math.abs(W.world.y-u)<.1;return J||ge?null:t.jsxs("g",{children:[t.jsx("circle",{cx:W.screen.x,cy:W.screen.y,r:"4",fill:"white",stroke:"#22C55E",strokeWidth:"2",opacity:"0.8"}),t.jsxs("text",{x:W.screen.x+15,y:W.screen.y+4,fontSize:a(9),fontWeight:"500",fill:"#22C55E",textAnchor:"start",opacity:"0.8",children:[W.fraction.num,"/",W.fraction.den]})]},`equiv-${G}`)})]})})()]},g.id);case"rectangle":const N=n({x:g.properties.x,y:g.properties.y+g.properties.height}),be=g.properties.width*e.zoom,p=g.properties.height*e.zoom,R={x:g.properties.x,y:g.properties.y},re={x:g.properties.x+g.properties.width,y:g.properties.y},we={x:g.properties.x,y:g.properties.y+g.properties.height},Ie={x:g.properties.x+g.properties.width,y:g.properties.y+g.properties.height};return t.jsxs("g",{children:[w&&t.jsx("rect",{x:N.x-3,y:N.y-3,width:be+6,height:p+6,fill:"none",stroke:"#60A5FA",strokeWidth:4,opacity:.5,style:{cursor:"pointer"}}),t.jsx("rect",{x:N.x,y:N.y,width:be,height:p,fill:w?"rgba(34, 197, 94, 0.3)":"rgba(34, 197, 94, 0.2)",stroke:w?"#16A34A":"#22c55e",strokeWidth:w?3:2,style:{cursor:"pointer"}}),t.jsx("circle",{cx:N.x,cy:N.y,r:s/6,fill:w?"#16A34A":"#22c55e",stroke:w?"#60A5FA":"none",strokeWidth:w?2:0,style:{cursor:"nw-resize"}}),t.jsx("circle",{cx:N.x+be,cy:N.y,r:s/6,fill:w?"#16A34A":"#22c55e",stroke:w?"#60A5FA":"none",strokeWidth:w?2:0,style:{cursor:"ne-resize"}}),t.jsx("circle",{cx:N.x,cy:N.y+p,r:s/6,fill:w?"#16A34A":"#22c55e",stroke:w?"#60A5FA":"none",strokeWidth:w?2:0,style:{cursor:"sw-resize"}}),t.jsx("circle",{cx:N.x+be,cy:N.y+p,r:s/6,fill:w?"#16A34A":"#22c55e",stroke:w?"#60A5FA":"none",strokeWidth:w?2:0,style:{cursor:"se-resize"}}),t.jsxs("text",{x:N.x-10,y:N.y-5,fontSize:a(9),fontWeight:"500",fill:"#22c55e",textAnchor:"end",opacity:"0.8",children:["(",q(we.x,x),", ",q(we.y,x),")"]}),t.jsxs("text",{x:N.x+be+10,y:N.y-5,fontSize:a(9),fontWeight:"500",fill:"#22c55e",textAnchor:"start",opacity:"0.8",children:["(",q(Ie.x,x),", ",q(Ie.y,x),")"]}),t.jsxs("text",{x:N.x-10,y:N.y+p+15,fontSize:a(9),fontWeight:"500",fill:"#22c55e",textAnchor:"end",opacity:"0.8",children:["(",q(R.x,x),", ",q(R.y,x),")"]}),t.jsxs("text",{x:N.x+be+10,y:N.y+p+15,fontSize:a(9),fontWeight:"500",fill:"#22c55e",textAnchor:"start",opacity:"0.8",children:["(",q(re.x,x),", ",q(re.y,x),")"]}),t.jsxs("text",{x:N.x+be/2,y:N.y+p/2,fontSize:a(12),fontWeight:"600",fill:"#22c55e",textAnchor:"middle",opacity:"0.9",children:[q(g.properties.height,x)," × ",q(g.properties.width,x)," = ",q(g.properties.area,x)]}),(()=>{const y=g.properties.width,d=g.properties.height,u=g.properties.area;if(y<=0||d<=0||y!==Math.floor(y)||d!==Math.floor(d))return null;const C=[];if(c.showFactorPairs&&u>1&&u<=50){const f=[];for(let v=1;v<=Math.sqrt(u);v++)if(u%v===0){const A=u/v;(v!==y||A!==d)&&f.push({w:v,h:A})}f.forEach((v,A)=>{const M=(A+1)*(be+20),D={x:N.x+M,y:N.y,width:v.w*e.zoom,height:v.h*e.zoom};C.push(t.jsx("rect",{x:D.x,y:D.y,width:D.width,height:D.height,fill:"rgba(168, 85, 247, 0.15)",stroke:"#A855F7",strokeWidth:"1",strokeDasharray:"3,3",opacity:"0.7"},`factor-${A}`))})}if(c.showCommutativeProperty&&y!==d){const f={x:N.x-p-30,y:N.y,width:d*e.zoom,height:y*e.zoom};C.push(t.jsxs("g",{children:[t.jsx("rect",{x:f.x,y:f.y,width:f.width,height:f.height,fill:"rgba(59, 130, 246, 0.15)",stroke:"#3B82F6",strokeWidth:"1",strokeDasharray:"4,2",opacity:"0.7"}),t.jsx("path",{d:`M ${f.x+f.width+5},${f.y+f.height/2} L ${N.x-5},${N.y+p/2}`,stroke:"#3B82F6",strokeWidth:"1",fill:"none",markerEnd:"url(#arrowhead)",opacity:"0.6"})]},"commutative"))}if(c.showPrimeComposite&&u>1&&u<=100){const f=u>1&&![...Array(Math.floor(Math.sqrt(u))+1).keys()].slice(2).some(v=>u%v===0);C.push(t.jsxs("g",{children:[t.jsx("circle",{cx:N.x+be+15,cy:N.y-15,r:"8",fill:f?"#10B981":"#F59E0B",opacity:"0.8"}),t.jsx("text",{x:N.x+be+15,y:N.y-11,fontSize:a(8),fontWeight:"600",fill:"white",textAnchor:"middle",children:f?"P":"C"}),t.jsx("text",{x:N.x+be+30,y:N.y-10,fontSize:a(8),fontWeight:"500",fill:f?"#10B981":"#F59E0B",textAnchor:"start",opacity:"0.8",children:f?"Prime":"Composite"})]},"prime-composite"))}if(c.showGCF&&y>1&&d>1){const f=(A,M)=>M===0?A:f(M,A%M),v=f(y,d);if(v>1){const A=v*e.zoom,M=y/v,D=d/v,B=[];for(let se=0;se<M;se++)for(let Me=0;Me<D;Me++)B.push(t.jsx("rect",{x:N.x+se*A,y:N.y+Me*A,width:A,height:A,fill:"none",stroke:"#10B981",strokeWidth:"1.5",opacity:"0.6"},`gcf-${se}-${Me}`));C.push(t.jsxs("g",{children:[B,t.jsxs("text",{x:N.x+be/2,y:N.y-25,fontSize:a(10),fontWeight:"600",fill:"#10B981",textAnchor:"middle",opacity:"0.9",children:["GCF(",y,", ",d,") = ",v]}),t.jsxs("text",{x:N.x+be/2,y:N.y-10,fontSize:a(8),fontWeight:"500",fill:"#10B981",textAnchor:"middle",opacity:"0.7",children:[M," × ",D," = ",M*D," squares"]})]},"gcf"))}}if(c.showLCM&&y>1&&d>1){const f=(M,D)=>D===0?M:f(D,M%D),A=((M,D)=>M*D/f(M,D))(y,d);if(A>Math.max(y,d)&&A<=100){const M=A*e.zoom,D=A*e.zoom,B=N.x,se=N.y+p-D,Me=A/y,ve=A/d,ze=[];for(let me=0;me<ve;me++)for(let W=0;W<Me;W++){const G=B+W*(y*e.zoom),X=se+me*(d*e.zoom);ze.push(t.jsx("rect",{x:G,y:X,width:y*e.zoom,height:d*e.zoom,fill:"rgba(245, 158, 11, 0.1)",stroke:"#F59E0B",strokeWidth:"1",strokeDasharray:"2,2",opacity:"0.6",pointerEvents:"none"},`shadow-${me}-${W}`))}C.push(t.jsxs("g",{children:[t.jsx("rect",{x:B,y:se,width:M,height:D,fill:"none",stroke:"#F59E0B",strokeWidth:"2",strokeDasharray:"5,5",opacity:"0.8",pointerEvents:"none"}),ze,t.jsxs("text",{x:B+M/2,y:se-15,fontSize:a(10),fontWeight:"600",fill:"#F59E0B",textAnchor:"middle",opacity:"0.9",pointerEvents:"none",children:["LCM(",y,", ",d,") = ",A]}),t.jsxs("text",{x:B+M/2,y:se-2,fontSize:a(8),fontWeight:"500",fill:"#F59E0B",textAnchor:"middle",opacity:"0.7",pointerEvents:"none",children:[Me," × ",ve," = ",Me*ve," rectangles"]})]},"lcm"))}}if(c.showDistributiveProperty&&y>2&&d>1){const f=Math.floor(y/2),v=f*e.zoom,A=(y-f)*e.zoom;C.push(t.jsxs("g",{children:[t.jsx("line",{x1:N.x+v,y1:N.y,x2:N.x+v,y2:N.y+p,stroke:"#EF4444",strokeWidth:"2",opacity:"0.8"}),t.jsxs("text",{x:N.x+v/2,y:N.y+p+20,fontSize:a(9),fontWeight:"500",fill:"#EF4444",textAnchor:"middle",opacity:"0.8",children:[d," × ",f," = ",d*f]}),t.jsxs("text",{x:N.x+v+A/2,y:N.y+p+20,fontSize:a(9),fontWeight:"500",fill:"#EF4444",textAnchor:"middle",opacity:"0.8",children:[d," × ",y-f," = ",d*(y-f)]}),t.jsxs("text",{x:N.x+be/2,y:N.y+p+40,fontSize:a(10),fontWeight:"600",fill:"#EF4444",textAnchor:"middle",opacity:"0.9",children:[d," × (",f," + ",y-f,") = ",d*f," + ",d*(y-f)," = ",u]})]},"distributive"))}return C})()]},g.id);case"circle":const ee=n(g.properties.center),Ne=g.properties.radius*e.zoom,_e=c.showTangentLines&&(z===g.id&&$||l&&l.circleId===g.id);let Q=null;if(_e){let y=null;if(l&&l.circleId===g.id?y=l.point:$&&z===g.id&&(y={x:($.x-i.width/2)/e.zoom+e.center.x,y:-($.y-i.height/2)/e.zoom+e.center.y}),y){const d=y.x-g.properties.center.x,u=y.y-g.properties.center.y,C=Math.atan2(u,d),f={x:g.properties.center.x+g.properties.radius*Math.cos(C),y:g.properties.center.y+g.properties.radius*Math.sin(C)},v=u/d,A=isFinite(v)&&v!==0?-1/v:null,M=Math.max(i.width,i.height)/e.zoom,D={x:f.x-M*Math.cos(C+Math.PI/2),y:f.y-M*Math.sin(C+Math.PI/2)},B={x:f.x+M*Math.cos(C+Math.PI/2),y:f.y+M*Math.sin(C+Math.PI/2)};Q={point:f,start:D,end:B,slope:A,angle:C}}}return t.jsxs("g",{children:[w&&t.jsx("circle",{cx:ee.x,cy:ee.y,r:Ne+3,fill:"none",stroke:"#60A5FA",strokeWidth:4,opacity:.5}),t.jsx("circle",{cx:ee.x,cy:ee.y,r:Ne*1.8,fill:"transparent",style:{cursor:"pointer"},onMouseEnter:()=>{de.current&&(clearTimeout(de.current),de.current=null),P(g.id)},onMouseLeave:()=>{de.current=setTimeout(()=>{P(null),F(null)},100)},onMouseMove:y=>{var d;if(c.showTangentLines&&z===g.id){const u=(d=y.currentTarget.ownerSVGElement)==null?void 0:d.getBoundingClientRect();u&&F({x:y.clientX-u.left,y:y.clientY-u.top})}},onTouchStart:y=>{var d;if(c.showTangentLines){y.preventDefault();const u=(d=y.currentTarget.ownerSVGElement)==null?void 0:d.getBoundingClientRect();if(u&&y.touches[0]){const C={x:y.touches[0].clientX-u.left,y:y.touches[0].clientY-u.top},f={x:(C.x-i.width/2)/e.zoom+e.center.x,y:-(C.y-i.height/2)/e.zoom+e.center.y},v=f.x-g.properties.center.x,M=(f.y-g.properties.center.y)/v,D=isFinite(M)?-1/M:null;m({circleId:g.id,point:f,slope:D})}}},onTouchEnd:()=>{setTimeout(()=>m(null),100)}}),t.jsx("circle",{cx:ee.x,cy:ee.y,r:Ne,fill:w?"rgba(168, 85, 247, 0.15)":"rgba(168, 85, 247, 0.1)",stroke:w?"#7C3AED":"#A855F7",strokeWidth:w?3:2,style:{cursor:"pointer",pointerEvents:"none"}}),Q&&t.jsxs("g",{children:[t.jsx("line",{x1:n(Q.start).x,y1:n(Q.start).y,x2:n(Q.end).x,y2:n(Q.end).y,stroke:"#EF4444",strokeWidth:"2",opacity:"0.7",strokeDasharray:"4,2"}),t.jsx("circle",{cx:n(Q.point).x,cy:n(Q.point).y,r:"3",fill:"#EF4444",opacity:"0.8"}),t.jsx("line",{x1:ee.x,y1:ee.y,x2:n(Q.point).x,y2:n(Q.point).y,stroke:"#EF4444",strokeWidth:"1",opacity:"0.5",strokeDasharray:"2,2"}),Q.slope!==null&&isFinite(Q.slope)&&t.jsxs("text",{x:n(Q.point).x+15,y:n(Q.point).y-10,fontSize:a(10),fontWeight:"500",fill:"#EF4444",textAnchor:"start",opacity:"0.9",children:["slope = ",Q.slope.toFixed(2)]}),(Q.slope===null||!isFinite(Q.slope))&&t.jsx("text",{x:n(Q.point).x+15,y:n(Q.point).y-10,fontSize:a(10),fontWeight:"500",fill:"#EF4444",textAnchor:"start",opacity:"0.9",children:"slope = ∞"})]}),t.jsx("circle",{cx:ee.x,cy:ee.y,r:s/6,fill:w?"#7C3AED":"#A855F7",stroke:w?"#60A5FA":"none",strokeWidth:w?2:0,style:{cursor:"move"}}),t.jsx("circle",{cx:ee.x+Ne,cy:ee.y,r:s/6,fill:w?"#7C3AED":"#A855F7",stroke:w?"#60A5FA":"none",strokeWidth:w?2:0,style:{cursor:"ew-resize"}}),t.jsx("line",{x1:ee.x,y1:ee.y,x2:ee.x+Ne,y2:ee.y,stroke:w?"#7C3AED":"#A855F7",strokeWidth:"1",opacity:"0.6",strokeDasharray:"2,2"}),t.jsxs("text",{x:ee.x,y:ee.y-Ne-25,fontSize:a(10),fontWeight:"500",fill:w?"#7C3AED":"#A855F7",textAnchor:"middle",opacity:"0.8",children:["r = ",Se(g.properties.radius)]}),t.jsxs("text",{x:ee.x,y:ee.y-Ne-15,fontSize:a(9),fontWeight:"400",fill:w?"#7C3AED":"#A855F7",textAnchor:"middle",opacity:"0.7",children:["A = ",Se(g.properties.area)]}),t.jsxs("text",{x:ee.x,y:ee.y-Ne-5,fontSize:a(9),fontWeight:"400",fill:w?"#7C3AED":"#A855F7",textAnchor:"middle",opacity:"0.7",children:["C = ",Se(g.properties.circumference)]})]},g.id);case"triangle":const K=g.properties.vertices.map(n),[he,pe,fe]=K,Ge=g.properties.vertices,oe=(()=>{const[y,d,u]=Ge,C=Math.sqrt((d.x-u.x)**2+(d.y-u.y)**2),f=Math.sqrt((y.x-u.x)**2+(y.y-u.y)**2),v=Math.sqrt((y.x-d.x)**2+(y.y-d.y)**2),A=Math.acos((f**2+v**2-C**2)/(2*f*v))*180/Math.PI,M=Math.acos((C**2+v**2-f**2)/(2*C*v))*180/Math.PI,D=180-A-M,B=1;let se="scalene",Me=!1,ve=!1,ze="";Math.abs(A-90)<B||Math.abs(M-90)<B||Math.abs(D-90)<B?(Me=!0,se="right"):A>90||M>90||D>90?se="obtuse":se="acute",Math.abs(C-f)<.1&&Math.abs(f-v)<.1?se="equilateral":(Math.abs(C-f)<.1||Math.abs(f-v)<.1||Math.abs(C-v)<.1)&&(se="isosceles");const me=[A,M,D].sort((W,G)=>W-G);return Math.abs(me[0]-30)<B&&Math.abs(me[1]-60)<B&&Math.abs(me[2]-90)<B?(ve=!0,ze="30-60-90"):Math.abs(me[0]-45)<B&&Math.abs(me[1]-45)<B&&Math.abs(me[2]-90)<B&&(ve=!0,ze="45-45-90"),{sideA:C,sideB:f,sideC:v,angleA:A,angleB:M,angleC:D,classification:se,isRight:Me,isSpecial:ve,specialType:ze,area:g.properties.area}})(),ne=(()=>{if(!c.showSOHCAHTOA||!oe.isRight)return null;const y=[{index:0,value:oe.angleA},{index:1,value:oe.angleB},{index:2,value:oe.angleC}],d=y.find(M=>Math.abs(M.value-90)<1),u=y.filter(M=>M.value<89);if(!d||u.length<2)return null;const C=u.reduce((M,D)=>D.value>M.value?D:M),f=d.index,v=C.index,A=[0,1,2].find(M=>M!==f&&M!==v);return{referenceAngle:C,rightVertex:f,refVertex:v,thirdVertex:A,hypotenuseStart:v,hypotenuseEnd:A,oppositeStart:f,oppositeEnd:A,adjacentStart:v,adjacentEnd:f}})();return t.jsxs("g",{children:[c.showSpecialTriangles&&oe.isSpecial&&t.jsx("path",{d:`M ${he.x},${he.y} L ${pe.x},${pe.y} L ${fe.x},${fe.y} Z`,fill:"rgba(255, 215, 0, 0.15)",stroke:"none"}),w&&t.jsx("path",{d:`M ${he.x},${he.y} L ${pe.x},${pe.y} L ${fe.x},${fe.y} Z`,fill:"none",stroke:"#60A5FA",strokeWidth:6,opacity:.4}),t.jsx("path",{d:`M ${he.x},${he.y} L ${pe.x},${pe.y} L ${fe.x},${fe.y} Z`,fill:w?"rgba(245, 101, 101, 0.15)":"rgba(245, 101, 101, 0.1)",stroke:w?"#DC2626":"#F56565",strokeWidth:w?3:2,style:{cursor:"pointer"},onMouseEnter:()=>{c.showTrigValues&&k(g.id)},onMouseLeave:()=>{k(null),I(null)},onMouseMove:y=>{var d;if(c.showTrigValues&&b===g.id){const u=(d=y.currentTarget.ownerSVGElement)==null?void 0:d.getBoundingClientRect();u&&I({x:y.clientX-u.left,y:y.clientY-u.top})}}}),ne&&t.jsxs("g",{children:[t.jsx("circle",{cx:K[ne.referenceAngle.index].x,cy:K[ne.referenceAngle.index].y,r:"8",fill:"rgba(255, 215, 0, 0.3)",stroke:"#FFA500",strokeWidth:"2"}),t.jsxs("g",{children:[t.jsx("line",{x1:K[ne.hypotenuseStart].x,y1:K[ne.hypotenuseStart].y,x2:K[ne.hypotenuseEnd].x,y2:K[ne.hypotenuseEnd].y,stroke:"#00AA00",strokeWidth:"5",opacity:"0.8"}),t.jsx("text",{x:(K[ne.hypotenuseStart].x+K[ne.hypotenuseEnd].x)/2,y:(K[ne.hypotenuseStart].y+K[ne.hypotenuseEnd].y)/2-15,fontSize:a(11),fontWeight:"700",fill:"#00AA00",textAnchor:"middle",children:"HYPOTENUSE"}),t.jsx("line",{x1:K[ne.oppositeStart].x,y1:K[ne.oppositeStart].y,x2:K[ne.oppositeEnd].x,y2:K[ne.oppositeEnd].y,stroke:"#FF0000",strokeWidth:"4",opacity:"0.8"}),t.jsx("text",{x:(K[ne.oppositeStart].x+K[ne.oppositeEnd].x)/2+15,y:(K[ne.oppositeStart].y+K[ne.oppositeEnd].y)/2,fontSize:a(10),fontWeight:"600",fill:"#FF0000",textAnchor:"middle",children:"OPPOSITE"}),t.jsx("line",{x1:K[ne.adjacentStart].x,y1:K[ne.adjacentStart].y,x2:K[ne.adjacentEnd].x,y2:K[ne.adjacentEnd].y,stroke:"#0000FF",strokeWidth:"4",opacity:"0.8"}),t.jsx("text",{x:(K[ne.adjacentStart].x+K[ne.adjacentEnd].x)/2,y:(K[ne.adjacentStart].y+K[ne.adjacentEnd].y)/2+20,fontSize:a(10),fontWeight:"600",fill:"#0000FF",textAnchor:"middle",children:"ADJACENT"}),t.jsxs("text",{x:K[ne.refVertex].x,y:K[ne.refVertex].y-25,fontSize:a(10),fontWeight:"700",fill:"#FFA500",textAnchor:"middle",children:["Reference Angle: ",ne.referenceAngle.value.toFixed(1),"°"]})]})]}),c.showPythagoreanSquares&&oe.isRight&&t.jsx("g",{children:(()=>{var zt;const y=(zt=[{index:0,angle:oe.angleA},{index:1,angle:oe.angleB},{index:2,angle:oe.angleC}].find(qe=>Math.abs(qe.angle-90)<1))==null?void 0:zt.index;if(y===void 0)return null;const d=Ge[y],u=Ge[(y+1)%3],C=Ge[(y+2)%3],f=Math.sqrt((d.x-u.x)**2+(d.y-u.y)**2),v=Math.sqrt((d.x-C.x)**2+(d.y-C.y)**2),A=Math.sqrt((u.x-C.x)**2+(u.y-C.y)**2),M={x:(u.x-d.x)/f,y:(u.y-d.y)/f},D={x:(C.x-d.x)/v,y:(C.y-d.y)/v},B={x:(C.x-u.x)/A,y:(C.y-u.y)/A},se=(qe,Xe,Je,Qe)=>{const He=(at,It,lt)=>(at.x-lt.x)*(It.y-lt.y)-(It.x-lt.x)*(at.y-lt.y),et=He(qe,Xe,Je),ot=He(qe,Je,Qe),Re=He(qe,Qe,Xe),ct=et<0||ot<0||Re<0,$e=et>0||ot>0||Re>0;return!(ct&&$e)},Me={x:-M.y,y:M.x},ve={x:M.y,y:-M.x},ze={x:-D.y,y:D.x},me={x:D.y,y:-D.x},W={x:-B.y,y:B.x},G={x:B.y,y:-B.x},X={x:d.x+f*Me.x*.1,y:d.y+f*Me.y*.1};d.x+f*ve.x*.1,d.y+f*ve.y*.1;const J=se(X,d,u,C)?ve:Me,ge={x:d.x+v*ze.x*.1,y:d.y+v*ze.y*.1};d.x+v*me.x*.1,d.y+v*me.y*.1;const xe=se(ge,d,u,C)?me:ze,ue={x:(u.x+C.x)/2,y:(u.y+C.y)/2},Te={x:ue.x+A*W.x*.1,y:ue.y+A*W.y*.1},Fe=se(Te,d,u,C)?G:W,De=[d,{x:d.x+f*M.x,y:d.y+f*M.y},{x:d.x+f*M.x+f*J.x,y:d.y+f*M.y+f*J.y},{x:d.x+f*J.x,y:d.y+f*J.y}],We=[d,{x:d.x+v*D.x,y:d.y+v*D.y},{x:d.x+v*D.x+v*xe.x,y:d.y+v*D.y+v*xe.y},{x:d.x+v*xe.x,y:d.y+v*xe.y}],it=[u,C,{x:C.x+A*Fe.x,y:C.y+A*Fe.y},{x:u.x+A*Fe.x,y:u.y+A*Fe.y}],Ce=De.map(n),Ee=We.map(n),Ae=it.map(n);return t.jsxs("g",{children:[t.jsx("path",{d:`M ${Ce[0].x},${Ce[0].y} L ${Ce[1].x},${Ce[1].y} L ${Ce[2].x},${Ce[2].y} L ${Ce[3].x},${Ce[3].y} Z`,fill:"rgba(59, 130, 246, 0.3)",stroke:"#3B82F6",strokeWidth:"2",opacity:"0.8"}),t.jsxs("text",{x:(Ce[0].x+Ce[1].x+Ce[2].x+Ce[3].x)/4,y:(Ce[0].y+Ce[1].y+Ce[2].y+Ce[3].y)/4,fontSize:a(10),fontWeight:"600",fill:"#1D4ED8",textAnchor:"middle",children:["a² = ",(f**2).toFixed(1)]}),t.jsx("path",{d:`M ${Ee[0].x},${Ee[0].y} L ${Ee[1].x},${Ee[1].y} L ${Ee[2].x},${Ee[2].y} L ${Ee[3].x},${Ee[3].y} Z`,fill:"rgba(239, 68, 68, 0.3)",stroke:"#EF4444",strokeWidth:"2",opacity:"0.8"}),t.jsxs("text",{x:(Ee[0].x+Ee[1].x+Ee[2].x+Ee[3].x)/4,y:(Ee[0].y+Ee[1].y+Ee[2].y+Ee[3].y)/4,fontSize:a(10),fontWeight:"600",fill:"#DC2626",textAnchor:"middle",children:["b² = ",(v**2).toFixed(1)]}),t.jsx("path",{d:`M ${Ae[0].x},${Ae[0].y} L ${Ae[1].x},${Ae[1].y} L ${Ae[2].x},${Ae[2].y} L ${Ae[3].x},${Ae[3].y} Z`,fill:"rgba(34, 197, 94, 0.3)",stroke:"#22C55E",strokeWidth:"2",opacity:"0.8"}),t.jsxs("text",{x:(Ae[0].x+Ae[1].x+Ae[2].x+Ae[3].x)/4,y:(Ae[0].y+Ae[1].y+Ae[2].y+Ae[3].y)/4,fontSize:a(10),fontWeight:"600",fill:"#16A34A",textAnchor:"middle",children:["c² = ",(A**2).toFixed(1)]}),(()=>{const qe={x:(he.x+pe.x+fe.x)/3,y:(he.y+pe.y+fe.y)/3},Xe=[...Ce,...Ee,...Ae],Je=Math.min(...Xe.map($e=>$e.x)),Qe=Math.max(...Xe.map($e=>$e.x)),He=Math.min(...Xe.map($e=>$e.y)),et=Math.max(...Xe.map($e=>$e.y)),ot=[{x:(Je+Qe)/2,y:et+40,label:"below"},{x:(Je+Qe)/2,y:He-40,label:"above"},{x:Je-80,y:(He+et)/2,label:"left"},{x:Qe+80,y:(He+et)/2,label:"right"}];let Re=ot[0],ct=1/0;return ot.forEach($e=>{const at=Math.sqrt(($e.x-qe.x)**2+($e.y-qe.y)**2);at<ct&&(ct=at,Re=$e)}),t.jsxs("g",{children:[t.jsx("rect",{x:Re.x-85,y:Re.y-20,width:"170",height:"35",fill:"rgba(255, 255, 255, 0.9)",stroke:"#374151",strokeWidth:"1",rx:"6",opacity:"0.95"}),t.jsxs("text",{x:Re.x,y:Re.y-5,fontSize:a(11),fontWeight:"700",fill:"#374151",textAnchor:"middle",opacity:"1",children:[(f**2).toFixed(1)," + ",(v**2).toFixed(1)," = ",(A**2).toFixed(1)]}),t.jsx("text",{x:Re.x,y:Re.y+10,fontSize:a(10),fontWeight:"600",fill:"#6B7280",textAnchor:"middle",opacity:"1",children:"a² + b² = c²"})]})})()]})})()}),c.showTriangleAltitudes&&t.jsx("g",{children:Ge.map((y,d)=>{const u=Ge[(d+1)%3],C=Ge[(d+2)%3],f=C.x-u.x,v=C.y-u.y,A=Math.sqrt(f*f+v*v);if(A===0)return null;const M=((y.x-u.x)*f+(y.y-u.y)*v)/(A*A),D={x:u.x+M*f,y:u.y+M*v},B=n(y),se=n(D);return t.jsxs("g",{children:[t.jsx("line",{x1:B.x,y1:B.y,x2:se.x,y2:se.y,stroke:"#9CA3AF",strokeWidth:"1",strokeDasharray:"3,3",opacity:"0.7"}),t.jsx("circle",{cx:se.x,cy:se.y,r:"2",fill:"#9CA3AF",opacity:"0.7"})]},`altitude-${d}`)})}),K.map((y,d)=>t.jsx("circle",{cx:y.x,cy:y.y,r:s/6,fill:w?"#DC2626":"#F56565",stroke:w?"#60A5FA":"none",strokeWidth:w?2:0,style:{cursor:"move"}},`vertex-${d}`)),c.showTriangleAngles&&t.jsxs("g",{children:[[{vertex:he,angle:oe.angleA,label:"A"},{vertex:pe,angle:oe.angleB,label:"B"},{vertex:fe,angle:oe.angleC,label:"C"}].map((y,d)=>t.jsxs("text",{x:y.vertex.x+(d===0?-25:d===1?25:0),y:y.vertex.y+(d===2?25:-15),fontSize:a(9),fontWeight:"600",fill:w?"#DC2626":"#F56565",textAnchor:"middle",opacity:"0.9",children:[y.label,": ",y.angle.toFixed(1),"°"]},`angle-${d}`)),t.jsxs("text",{x:(he.x+pe.x+fe.x)/3,y:(he.y+pe.y+fe.y)/3+20,fontSize:a(8),fontWeight:"400",fill:w?"#DC2626":"#F56565",textAnchor:"middle",opacity:"0.6",children:["Sum: ",(oe.angleA+oe.angleB+oe.angleC).toFixed(1),"°"]})]}),c.showTriangleClassification&&t.jsxs("g",{children:[t.jsx("text",{x:(he.x+pe.x+fe.x)/3,y:(he.y+pe.y+fe.y)/3-15,fontSize:a(11),fontWeight:"600",fill:oe.isSpecial?"#FFA500":w?"#DC2626":"#F56565",textAnchor:"middle",opacity:"0.9",children:oe.isSpecial?oe.specialType:oe.classification}),oe.isSpecial&&t.jsx("text",{x:(he.x+pe.x+fe.x)/3,y:(he.y+pe.y+fe.y)/3-2,fontSize:a(9),fontWeight:"500",fill:"#FFA500",textAnchor:"middle",opacity:"0.8",children:"Special Triangle!"})]}),t.jsxs("text",{x:(he.x+pe.x+fe.x)/3,y:(he.y+pe.y+fe.y)/3+(c.showTriangleAngles?35:8),fontSize:a(10),fontWeight:"500",fill:w?"#DC2626":"#F56565",textAnchor:"middle",opacity:"0.8",children:["Area = ",Se(oe.area)]}),c.showTrigValues&&b===g.id&&O&&t.jsx("g",{children:(()=>{const y=[{label:"A",value:oe.angleA,index:0},{label:"B",value:oe.angleB,index:1},{label:"C",value:oe.angleC,index:2}];let d=y[0],u=1/0;y.forEach(M=>{const D=K[M.index],B=Math.sqrt((O.x-D.x)**2+(O.y-D.y)**2);B<u&&(u=B,d=M)});const C=d.value*Math.PI/180,f=Math.sin(C),v=Math.cos(C),A=Math.tan(C);return t.jsxs("g",{children:[t.jsx("rect",{x:O.x+10,y:O.y-55,width:"140",height:"60",fill:"rgba(255, 255, 255, 0.95)",stroke:"#374151",strokeWidth:"1",rx:"4"}),t.jsxs("text",{x:O.x+80,y:O.y-40,fontSize:a(9),fontWeight:"600",fill:"#374151",textAnchor:"middle",children:["Angle ",d.label,": ",d.value.toFixed(1),"°"]}),t.jsxs("text",{x:O.x+80,y:O.y-28,fontSize:a(8),fontWeight:"500",fill:"#374151",textAnchor:"middle",children:["sin = ",f.toFixed(3)]}),t.jsxs("text",{x:O.x+80,y:O.y-16,fontSize:a(8),fontWeight:"500",fill:"#374151",textAnchor:"middle",children:["cos = ",v.toFixed(3)]}),t.jsxs("text",{x:O.x+80,y:O.y-4,fontSize:a(8),fontWeight:"500",fill:"#374151",textAnchor:"middle",children:["tan = ",isFinite(A)?A.toFixed(3):"∞"]})]})})()}),t.jsx("text",{x:(he.x+pe.x)/2,y:(he.y+pe.y)/2-10,fontSize:a(8),fontWeight:"400",fill:w?"#DC2626":"#F56565",textAnchor:"middle",opacity:"0.6",children:Se(oe.sideC)}),t.jsx("text",{x:(pe.x+fe.x)/2+10,y:(pe.y+fe.y)/2,fontSize:a(8),fontWeight:"400",fill:w?"#DC2626":"#F56565",textAnchor:"middle",opacity:"0.6",children:Se(oe.sideA)}),t.jsx("text",{x:(he.x+fe.x)/2-10,y:(he.y+fe.y)/2,fontSize:a(8),fontWeight:"400",fill:w?"#DC2626":"#F56565",textAnchor:"middle",opacity:"0.6",children:Se(oe.sideB)})]},g.id);case"function":const E=g,ie=E.properties.points;if(!ie||ie.length<2)return null;const _=ie.map(n).reduce((y,d,u)=>u===0?`M ${d.x} ${d.y}`:`${y} L ${d.x} ${d.y}`,""),L=n({x:E.properties.domain.min,y:((H=ie[0])==null?void 0:H.y)||0}),te=n({x:E.properties.domain.max,y:((ce=ie[ie.length-1])==null?void 0:ce.y)||0});return t.jsxs("g",{children:[c.showFunctionExtensions&&(()=>{const y=(f,v)=>{try{const A=f.replace(/\bx\b/g,`(${v})`).replace(/\^/g,"**").replace(/sin/g,"Math.sin").replace(/cos/g,"Math.cos").replace(/tan/g,"Math.tan").replace(/log/g,"Math.log").replace(/ln/g,"Math.log").replace(/exp/g,"Math.exp").replace(/sqrt/g,"Math.sqrt").replace(/abs/g,"Math.abs").replace(/pi/g,"Math.PI").replace(/e\b/g,"Math.E"),D=new Function("x",`return ${A}`)(v);return typeof D=="number"&&!isNaN(D)&&isFinite(D)?D:null}catch{return null}},d={left:e.center.x-i.width/2/e.zoom,right:e.center.x+i.width/2/e.zoom},u=E.properties.equation,C=[];if(E.properties.domain.min>d.left){const f=[],v=Math.max(d.left,E.properties.domain.min-6),A=(E.properties.domain.min-v)/15;for(let M=v;M<=E.properties.domain.min;M+=A){const D=y(u,M);D!==null&&f.push(n({x:M,y:D}))}if(f.length>1){const M=f.reduce((D,B,se)=>D+(se===0?`M ${B.x} ${B.y}`:` L ${B.x} ${B.y}`),"");C.push(M)}}if(E.properties.domain.max<d.right){const f=[],v=Math.min(d.right,E.properties.domain.max+6),A=(v-E.properties.domain.max)/15;for(let M=E.properties.domain.max;M<=v;M+=A){const D=y(u,M);D!==null&&f.push(n({x:M,y:D}))}if(f.length>1){const M=f.reduce((D,B,se)=>D+(se===0?`M ${B.x} ${B.y}`:` L ${B.x} ${B.y}`),"");C.push(M)}}return t.jsx("g",{children:C.map((f,v)=>t.jsx("path",{d:f,fill:"none",stroke:E.properties.color||"#2563eb",strokeWidth:1,strokeDasharray:"4,4",opacity:.5,strokeLinecap:"round"},`ext-${v}`))})})(),w&&t.jsx("path",{d:_,fill:"none",stroke:"#60A5FA",strokeWidth:6,opacity:.4}),t.jsx("path",{d:_,fill:"none",stroke:"transparent",strokeWidth:12,strokeLinecap:"round",strokeLinejoin:"round",style:{pointerEvents:"stroke"},onMouseEnter:()=>Y(g.id),onMouseLeave:()=>{Y(null),le(null)},onMouseMove:y=>{var d;if(Z===g.id){const u=(d=y.currentTarget.ownerSVGElement)==null?void 0:d.getBoundingClientRect();if(u){const C=y.clientX-u.left,f=y.clientY-u.top;e.center.x+(C-i.width/2)/e.zoom,e.center.y-(f-i.height/2)/e.zoom;let v=null,A=1/0;for(const M of ie){const D=n(M),B=Math.sqrt((C-D.x)**2+(f-D.y)**2);B<A&&(A=B,v=M)}v&&le(v)}}}}),t.jsx("path",{d:_,fill:"none",stroke:w?"#1D4ED8":E.properties.color||"#2563eb",strokeWidth:w?3:E.properties.strokeWidth||2,strokeLinecap:"round",strokeLinejoin:"round",style:{pointerEvents:"none"}}),w&&t.jsxs("g",{children:[t.jsx("circle",{cx:L.x,cy:L.y,r:"6",fill:"#1D4ED8",stroke:"white",strokeWidth:"2",opacity:.8}),t.jsx("circle",{cx:te.x,cy:te.y,r:"6",fill:"#1D4ED8",stroke:"white",strokeWidth:"2",opacity:.8})]}),Z===g.id&&V&&t.jsxs("g",{children:[t.jsx("circle",{cx:n(V).x,cy:n(V).y,r:"4",fill:E.properties.color||"#2563eb",stroke:"white",strokeWidth:"2"}),t.jsx("rect",{x:n(V).x-70,y:n(V).y-55,width:"140",height:"45",fill:"rgba(255, 255, 255, 0.95)",stroke:"#374151",strokeWidth:"1",rx:"4"}),t.jsxs("text",{x:n(V).x,y:n(V).y-40,fontSize:a(9),fontWeight:"600",fill:"#374151",textAnchor:"middle",children:["(",q(V.x,x),", ",q(V.y,x),")"]}),t.jsxs("text",{x:n(V).x,y:n(V).y-28,fontSize:a(8),fontWeight:"500",fill:"#374151",textAnchor:"middle",children:["f(",q(V.x,x),") = ",q(V.y,x)]}),t.jsxs("text",{x:n(V).x,y:n(V).y-16,fontSize:a(8),fontWeight:"400",fill:"#666",textAnchor:"middle",children:["f(x) = ",E.properties.equation]})]}),(w||S===g.id)&&t.jsxs("g",{children:[t.jsx("rect",{x:L.x-40,y:L.y-35,width:"80",height:"25",fill:"rgba(255, 255, 255, 0.95)",stroke:"#374151",strokeWidth:"1",rx:"4"}),t.jsxs("text",{x:L.x,y:L.y-20,fontSize:a(10),fontWeight:"600",fill:"#374151",textAnchor:"middle",children:["f(x) = ",E.properties.equation]})]})]},g.id);default:return null}};return t.jsxs(t.Fragment,{children:[t.jsx("defs",{children:t.jsx("marker",{id:"arrowhead",markerWidth:"10",markerHeight:"7",refX:"9",refY:"3.5",orient:"auto",children:t.jsx("polygon",{points:"0 0, 10 3.5, 0 7",fill:"#3B82F6",opacity:"0.6"})})}),t.jsx("g",{className:"objects",children:r.map(ke)})]})}function Jt({capabilities:r,viewport:e,activeTool:s,selectedObjectsCount:n}){return r?t.jsxs("div",{className:"absolute top-2 left-2 text-xs text-gray-500 bg-white/80 p-2 rounded shadow-sm",children:[t.jsxs("div",{children:["Input: ",r.hasTouch?"👆":"🖱️"," ",r.hasPencil?"✏️":""]}),t.jsxs("div",{children:["Zoom: ",e.zoom>=1?e.zoom.toFixed(1):e.zoom.toFixed(2),"×"]}),t.jsxs("div",{children:["Center: (",e.center.x.toFixed(1),", ",e.center.y.toFixed(1),")"]}),t.jsxs("div",{children:["Tool: ",s||"Pan Mode"]}),n>0&&t.jsxs("div",{children:["Selected: ",n," object",n!==1?"s":""]})]}):null}function Qt({selectedObject:r,onDelete:e,onUpdate:s,onClose:n}){if(!r)return null;const o=()=>{e(),n()},i=(a,h)=>{try{const x=(P,l)=>{try{const m=P.replace(/\bx\b/g,`(${l})`).replace(/\^/g,"**").replace(/sin/g,"Math.sin").replace(/cos/g,"Math.cos").replace(/tan/g,"Math.tan").replace(/log/g,"Math.log").replace(/ln/g,"Math.log").replace(/exp/g,"Math.exp").replace(/sqrt/g,"Math.sqrt").replace(/abs/g,"Math.abs").replace(/pi/g,"Math.PI").replace(/e\b/g,"Math.E"),k=new Function("x",`return ${m}`)(l);return typeof k=="number"&&!isNaN(k)&&isFinite(k)?k:null}catch{return null}},S=P=>P.includes("sin")||P.includes("cos")||P.includes("tan")?"trigonometric":P.includes("exp")||P.includes("e^")?"exponential":P.includes("log")||P.includes("ln")?"logarithmic":/x\^\d+|x\*\*\d+/.test(P)?"polynomial":"custom",T=a.properties.domain,$=a.properties.resolution||20,F=[],z=(T.max-T.min)/($*(T.max-T.min));for(let P=T.min;P<=T.max;P+=z){const l=x(h,P);l!==null&&F.push({x:P,y:l})}return{properties:{...a.properties,equation:h,functionType:S(h),points:F}}}catch(x){return console.error("Failed to update function equation:",x),null}},c=()=>{switch(r.type){case"ray":const{startPoint:a,endPoint:h,slope:x}=r.properties,S=Math.abs(a.x)<.001&&Math.abs(a.y)<.001;return t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Line Details"}),t.jsxs("div",{className:"space-y-1 text-xs text-gray-600",children:[t.jsxs("div",{children:["Start: (",q(a.x,1),", ",q(a.y,1),")"]}),t.jsxs("div",{children:["End: (",q(h.x,1),", ",q(h.y,1),")"]}),S&&t.jsxs("div",{children:["Fraction: ",Math.round(h.y),"/",Math.round(h.x)]}),t.jsxs("div",{children:["Slope: ",isFinite(x)?x.toFixed(3):"undefined"]})]})]});case"rectangle":const{x:T,y:$,width:F,height:z,area:P}=r.properties;return t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Rectangle Details"}),t.jsxs("div",{className:"space-y-1 text-xs text-gray-600",children:[t.jsxs("div",{children:["Position: (",q(T,1),", ",q($,1),")"]}),t.jsxs("div",{children:["Size: ",q(F,1)," × ",q(z,1)]})]})]});case"circle":const{center:l,radius:m,diameter:b,circumference:k,area:O}=r.properties;return t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Circle Details"}),t.jsxs("div",{className:"space-y-1 text-xs text-gray-600",children:[t.jsxs("div",{children:["Center: (",q(l.x,1),", ",q(l.y,1),")"]}),t.jsxs("div",{children:["Radius: ",Se(m)]}),t.jsxs("div",{children:["Diameter: ",Se(b)]}),t.jsxs("div",{children:["Circumference: ",Se(k)]}),t.jsxs("div",{children:["Area: ",Se(O)]})]})]});case"triangle":const{vertices:I,sideA:Z,sideB:Y,sideC:V,angleA:le,angleB:de,angleC:ke,area:g,perimeter:w,type:H}=r.properties;return t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Triangle Details"}),t.jsxs("div",{className:"space-y-1 text-xs text-gray-600",children:[t.jsxs("div",{children:["Type: ",H]}),t.jsx("div",{children:"Vertices:"}),t.jsxs("div",{className:"ml-2",children:[t.jsxs("div",{children:["A: (",q(I[0].x,1),", ",q(I[0].y,1),")"]}),t.jsxs("div",{children:["B: (",q(I[1].x,1),", ",q(I[1].y,1),")"]}),t.jsxs("div",{children:["C: (",q(I[2].x,1),", ",q(I[2].y,1),")"]})]}),t.jsxs("div",{children:["Sides: ",Se(Z),", ",Se(Y),", ",Se(V)]}),t.jsxs("div",{children:["Angles: ",Se(le),"°, ",Se(de),"°, ",Se(ke),"°"]}),t.jsxs("div",{children:["Area: ",Se(g)]}),t.jsxs("div",{children:["Perimeter: ",Se(w)]})]})]});case"function":const ce=r,{equation:Pe,functionType:je,domain:N,points:be}=ce.properties;return t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Function Details"}),t.jsxs("div",{className:"space-y-1 text-xs text-gray-600",children:[t.jsxs("div",{children:["Equation: f(x) = ",Pe]}),t.jsxs("div",{children:["Type: ",je]}),t.jsxs("div",{children:["Domain: [",q(N.min,1),", ",q(N.max,1),"]"]}),t.jsxs("div",{children:["Points: ",be.length]})]}),t.jsxs("div",{className:"mt-2 pt-2 border-t border-gray-100",children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Edit Equation:"}),t.jsx("input",{type:"text",defaultValue:Pe,className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"e.g., x^2, sin(x), 2*x + 1",onKeyDown:p=>{if(p.stopPropagation(),p.key==="Enter"){const R=p.target.value.trim();if(R&&R!==Pe){const re=i(ce,R);re&&s(r.id,{properties:re.properties})}p.target.blur()}else p.key==="Escape"&&p.target.blur()},onKeyUp:p=>{p.stopPropagation()},onKeyPress:p=>{p.stopPropagation()},onFocus:p=>{p.target.select()}}),t.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Press Enter to apply. Examples: x^2, sin(x), cos(x), log(x), exp(x)"})]})]});default:return null}};return t.jsxs("div",{className:"fixed top-20 right-4 bg-white border border-gray-200 rounded-lg shadow-lg p-3 z-50 min-w-48",onKeyDown:a=>{a.stopPropagation()},onKeyUp:a=>{a.stopPropagation()},onKeyPress:a=>{a.stopPropagation()},children:[c(),t.jsxs("div",{className:"mt-3 pt-2 border-t border-gray-100 flex gap-2",children:[t.jsxs("button",{onClick:o,className:"flex items-center gap-1 px-2 py-1 text-xs text-red-600 hover:bg-red-50 rounded transition-colors",children:[t.jsx("span",{children:"🗑️"}),"Delete"]}),t.jsxs("button",{onClick:n,className:"flex items-center gap-1 px-2 py-1 text-xs text-gray-600 hover:bg-gray-50 rounded transition-colors",children:[t.jsx("span",{children:"✕"}),"Close"]})]})]})}function es(){const[r,e]=j.useState(!1),[s,n]=j.useState("all"),o=j.useRef(null),i=Le(),{toggleSetting:c,setFontScale:a,setGridScale:h,setSnapPrecision:x,setCoordinateSystem:S,resetToDefaults:T}=i;j.useEffect(()=>{function P(l){o.current&&!o.current.contains(l.target)&&e(!1)}if(r)return document.addEventListener("mousedown",P,!0),document.addEventListener("click",P,!0),()=>{document.removeEventListener("mousedown",P,!0),document.removeEventListener("click",P,!0)}},[r]);const $=[{title:"Origin Lines",subtitle:"Enhancements for lines from (0,0)",settings:[{key:"showEquivalentFractions",label:"Equivalent Fractions",description:"Green circles showing equivalent fractions"},{key:"showLengthMultiples",label:"Length Multiples",description:"Small dots at 2×, 3×, 4× line length"},{key:"showAreaRectangle",label:"Area Rectangle",description:"Soft rectangle showing multiplication"},{key:"showDivisionMultiples",label:"Division Multiples",description:"Horizontal lines showing division answer multiples"},{key:"showRiseRunTriangle",label:"Rise/Run Triangle",description:"Triangle showing slope components"},{key:"showDistanceMarkers",label:"Distance Markers",description:"Radial quarter-circles at unit distances"},{key:"showAngleArc",label:"Angle Arc",description:"Arc showing angle from x-axis with measurement"}]},{title:"Division & Fractions",subtitle:"Visual fraction and division concepts",settings:[{key:"showDivisionAnswer",label:"Slope/Division Answer (x=1)",description:"Blue dot showing slope value and division answer at x=1"}]},{title:"Grid & Reference",subtitle:"Grid enhancements and reference lines",settings:[{key:"showLatticePoints",label:"Lattice Points",description:"Dots at all integer coordinates"},{key:"showIntegerGridLines",label:"Integer Grid Lines",description:"Faint lines at whole numbers"},{key:"showReferenceLineY_equals_X",label:"y=x Reference Line",description:"Purple diagonal line for comparison"}]},{title:"Circle Concepts",subtitle:"Visual features for circles and curves",settings:[{key:"showTangentLines",label:"Tangent Lines",description:"Show tangent line and slope on hover"}]},{title:"Function Concepts",subtitle:"Mathematical function visualization features",settings:[{key:"showFunctionExtensions",label:"Function Extensions",description:"Show subtle curve extensions beyond domain endpoints"}]},{title:"Triangle Concepts",subtitle:"Trigonometry and geometry learning features",settings:[{key:"showTriangleAngles",label:"Angle Measurements",description:"Show all three angles with degree values"},{key:"showTriangleClassification",label:"Triangle Classification",description:"Label triangle type (scalene, isosceles, etc.)"},{key:"showSpecialTriangles",label:"Special Triangles",description:"Highlight 30-60-90 and 45-45-90 triangles"},{key:"showSOHCAHTOA",label:"SOH-CAH-TOA Visualization",description:"Highlight opposite, adjacent, hypotenuse sides"},{key:"showTrigValues",label:"Trigonometric Values",description:"Show sin, cos, tan values on hover"},{key:"showTriangleAltitudes",label:"Altitude Lines",description:"Show perpendicular height lines"},{key:"showPythagoreanSquares",label:"Pythagorean Squares",description:"Show a² + b² = c² with actual squares (right triangles)"}]},{title:"Rectangle Concepts",subtitle:"Educational features for rectangles and areas",settings:[{key:"showFactorPairs",label:"Factor Pairs",description:"Show all rectangles with the same area"},{key:"showCommutativeProperty",label:"Commutative Property",description:"Show flipped rectangle (w×h = h×w)"},{key:"showDistributiveProperty",label:"Distributive Property",description:"Split rectangle to show a(b+c) = ab+ac"},{key:"showPrimeComposite",label:"Prime vs Composite",description:"Badge showing if area is prime or composite"},{key:"showGCF",label:"Greatest Common Factor",description:"Largest square tiling both dimensions"},{key:"showLCM",label:"Least Common Multiple",description:"Smallest rectangle fitting both dimensions"}]},{title:"Display",subtitle:"Adjust visibility for classrooms and large screens",settings:[]}],F=s==="all"?$:$.filter(P=>P.title.toLowerCase().replace(/[^a-z0-9]/g,"-")===s),z=[{id:"all",name:"All Settings"},...$.map(P=>({id:P.title.toLowerCase().replace(/[^a-z0-9]/g,"-"),name:P.title}))];return t.jsxs("div",{ref:o,className:"fixed bottom-4 left-4 z-50",children:[t.jsxs("button",{onClick:()=>e(!r),className:"flex items-center gap-2 px-3 py-2 bg-white border border-gray-200 rounded-lg shadow-sm hover:bg-gray-50 transition-colors",title:"Visualization Settings",children:[t.jsx("span",{className:"text-lg",children:"⚙️"}),t.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Settings"}),t.jsx("span",{className:`text-xs transition-transform ${r?"":"rotate-180"}`,children:"▼"})]}),r&&t.jsxs("div",{className:"settings-panel absolute bottom-full left-0 mb-2 bg-white border border-gray-200 rounded-lg shadow-lg w-80 max-h-[28rem] overflow-y-auto",children:[t.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-100 px-4 py-3 rounded-t-lg",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Visualization Settings"}),t.jsx("button",{onClick:T,className:"text-xs text-blue-600 hover:text-blue-800 font-medium",children:"Reset All"})]}),t.jsx("div",{className:"px-4 pt-2",children:t.jsx("select",{value:s,onChange:P=>n(P.target.value),className:"w-full text-xs border border-gray-200 rounded px-2 py-1 bg-white",children:z.map(P=>t.jsx("option",{value:P.id,children:P.name},P.id))})})]}),t.jsx("div",{className:"settings-scrollable p-4 space-y-5",children:F.map((P,l)=>t.jsxs("div",{children:[t.jsxs("div",{className:`${l>0?"border-t border-gray-100 pt-4":""} mb-3`,children:[t.jsx("h4",{className:"text-xs font-semibold text-gray-700 uppercase tracking-wide",children:P.title}),P.subtitle&&t.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:P.subtitle})]}),t.jsxs("div",{className:"space-y-2.5",children:[P.settings.map(m=>t.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[t.jsx("input",{type:"checkbox",checked:i[m.key],onChange:()=>c(m.key),className:"mt-0.5 w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500 focus:ring-2"}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"text-sm font-medium text-gray-700 group-hover:text-gray-900",children:m.label}),t.jsx("div",{className:"text-xs text-gray-500 leading-relaxed",children:m.description})]})]},m.key)),P.title==="Display"&&t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Font Size"}),t.jsxs("span",{className:"text-xs text-gray-500 font-mono",children:[Math.round(i.fontScale*100),"%"]})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("span",{className:"text-xs text-gray-400",children:"A"}),t.jsx("input",{type:"range",min:"0.8",max:"2.0",step:"0.1",value:i.fontScale,onChange:m=>a(parseFloat(m.target.value)),className:"flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider"}),t.jsx("span",{className:"text-sm text-gray-600",children:"A"})]}),t.jsx("div",{className:"text-xs text-gray-500 leading-relaxed",children:"Increase font size for better visibility on TVs and projectors"}),t.jsxs("div",{className:"space-y-3 pt-4 border-t border-gray-100",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Grid Density"}),t.jsxs("span",{className:"text-xs text-gray-500 font-mono",children:[Math.round(i.gridScale*100),"%"]})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("span",{className:"text-xs text-gray-400",children:"Sparse"}),t.jsx("input",{type:"range",min:"0.2",max:"5.0",step:"0.1",value:i.gridScale,onChange:m=>h(parseFloat(m.target.value)),className:"flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider"}),t.jsx("span",{className:"text-xs text-gray-600",children:"Dense"})]}),t.jsx("div",{className:"text-xs text-gray-500 leading-relaxed",children:"Adjust grid line spacing for different zoom levels and detail needs"})]}),t.jsxs("div",{className:"space-y-3 pt-4 border-t border-gray-100",children:[t.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Coordinate System"}),t.jsx("div",{className:"space-y-2",children:[{value:"cartesian",label:"Cartesian Only",desc:"Standard x-y grid"},{value:"polar",label:"Polar Only",desc:"Circular coordinate system"},{value:"both",label:"Both Systems",desc:"Overlay polar on Cartesian"}].map(m=>t.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[t.jsx("input",{type:"radio",name:"coordinateSystem",value:m.value,checked:i.coordinateSystem===m.value,onChange:b=>S(b.target.value),className:"mt-0.5 w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500"}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"text-sm font-medium text-gray-700 group-hover:text-gray-900",children:m.label}),t.jsx("div",{className:"text-xs text-gray-500",children:m.desc})]})]},m.value))})]}),t.jsxs("div",{className:"space-y-3 pt-4 border-t border-gray-100",children:[t.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Snap Precision"}),t.jsx("div",{className:"space-y-2",children:[{value:"adaptive",label:"Adaptive",desc:"Automatically adjusts based on zoom level"},{value:"whole",label:"Whole Numbers",desc:"Snap to 1, 2, 3, etc."},{value:"half",label:"Half Units",desc:"Snap to 0.5, 1.0, 1.5, etc."},{value:"quarter",label:"Quarter Units",desc:"Snap to 0.25, 0.5, 0.75, etc."},{value:"tenth",label:"Tenth Units",desc:"Snap to 0.1, 0.2, 0.3, etc."}].map(m=>t.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[t.jsx("input",{type:"radio",name:"snapPrecision",value:m.value,checked:i.snapPrecision===m.value,onChange:b=>x(b.target.value),className:"mt-0.5 w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500"}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"text-sm font-medium text-gray-700 group-hover:text-gray-900",children:m.label}),t.jsx("div",{className:"text-xs text-gray-500",children:m.desc})]})]},m.value))}),t.jsx("div",{className:"text-xs text-gray-500 leading-relaxed",children:"Controls where objects can be placed when snap-to-grid is enabled"})]})]})]})]},P.title))}),t.jsx("div",{className:"sticky bottom-0 bg-gray-50 border-t border-gray-100 px-4 py-2 rounded-b-lg",children:t.jsx("p",{className:"text-xs text-gray-500 text-center",children:"Toggle features to explore different mathematical concepts"})})]})]})}const Ye=class Ye{constructor(){ae(this,"examplesData",null);ae(this,"isLoading",!1)}static getInstance(){return Ye.instance||(Ye.instance=new Ye),Ye.instance}async loadExamples(){if(this.examplesData)return this.examplesData;if(this.isLoading)return await new Promise(e=>{const s=()=>{this.isLoading?setTimeout(s,50):e(void 0)};s()}),this.examplesData;this.isLoading=!0;try{const e=await fetch("/examples.json");if(!e.ok)throw new Error(`Failed to load examples: ${e.status}`);const s=await e.json();if(!s.examples||!Array.isArray(s.examples))throw new Error("Invalid examples data: missing examples array");if(!s.categories||!Array.isArray(s.categories))throw new Error("Invalid examples data: missing categories array");for(const n of s.examples)if(!n.id||!n.title||!n.objects||!Array.isArray(n.objects))throw new Error(`Invalid example: ${n.id||"unknown"}`);return this.examplesData=s,this.examplesData}catch(e){return console.error("Failed to load examples:",e),this.examplesData={examples:[],categories:[]},this.examplesData}finally{this.isLoading=!1}}async getExamples(){return(await this.loadExamples()).examples}async getCategories(){return(await this.loadExamples()).categories}async getExampleById(e){return(await this.getExamples()).find(n=>n.id===e)||null}async getExamplesByCategory(e){return(await this.getExamples()).filter(n=>n.category===e)}generateObjectId(){return`example_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}convertExampleObjectToMathObject(e){const s={id:this.generateObjectId(),type:e.type,visible:!0,selected:!1,zIndex:0};switch(e.type){case"ray":return{...s,type:"ray",properties:{startPoint:e.properties.startPoint,endPoint:e.properties.endPoint,slope:(e.properties.endPoint.y-e.properties.startPoint.y)/(e.properties.endPoint.x-e.properties.startPoint.x)}};case"rectangle":return{...s,type:"rectangle",properties:{x:e.properties.x,y:e.properties.y,width:e.properties.width,height:e.properties.height,area:e.properties.width*e.properties.height}};case"circle":return{...s,type:"circle",properties:{center:e.properties.center,radius:e.properties.radius,diameter:e.properties.diameter,circumference:e.properties.circumference,area:e.properties.area}};case"triangle":return{...s,type:"triangle",properties:{vertices:e.properties.vertices,sideA:e.properties.sideA,sideB:e.properties.sideB,sideC:e.properties.sideC,angleA:e.properties.angleA,angleB:e.properties.angleB,angleC:e.properties.angleC,area:e.properties.area,perimeter:e.properties.perimeter,type:e.properties.type}};default:throw new Error(`Unknown object type: ${e.type}`)}}async applyExample(e){const s=await this.getExampleById(e);if(!s)throw new Error(`Example not found: ${e}`);const n=Oe.getState(),o=Le.getState();try{n.getAllObjects().forEach(c=>{n.removeObject(c.id)}),n.clearSelection(),s.viewport&&n.setViewport(s.viewport),Object.entries(s.settings).forEach(([c,a])=>{c in o&&typeof a=="boolean"?(o.toggleSetting(c),o[c]!==a&&o.toggleSetting(c)):c==="snapPrecision"&&typeof a=="string"?o.setSnapPrecision(a):c==="coordinateSystem"&&typeof a=="string"?o.setCoordinateSystem(a):c==="fontScale"&&typeof a=="number"?o.setFontScale(a):c==="gridScale"&&typeof a=="number"&&o.setGridScale(a)}),s.objects.forEach(c=>{const a=this.convertExampleObjectToMathObject(c);n.addObject(a)}),console.log(`Applied example: ${s.title}`)}catch(i){throw console.error("Failed to apply example:",i),new Error(`Failed to apply example "${s.title}": ${i.message}`)}}async clearCanvas(){const e=Oe.getState(),s=Le.getState();e.getAllObjects().forEach(o=>{e.removeObject(o.id)}),e.clearSelection(),e.setViewport({zoom:20,center:{x:0,y:0}}),s.resetToDefaults(),console.log("Canvas cleared and reset to defaults")}async getBeginnerExamples(){return(await this.getExamples()).filter(s=>s.difficulty==="beginner")}async getRandomExampleFromCategory(e){const s=await this.getExamplesByCategory(e);if(s.length===0)return null;const n=Math.floor(Math.random()*s.length);return s[n]}};ae(Ye,"instance");let ht=Ye;const Ke=ht.getInstance();function ts(){const[r,e]=j.useState(!1),[s,n]=j.useState([]),[o,i]=j.useState([]),[c,a]=j.useState("all"),[h,x]=j.useState(!1),[S,T]=j.useState(null),$=j.useRef(null);j.useEffect(()=>{function b(k){$.current&&!$.current.contains(k.target)&&e(!1)}if(r)return document.addEventListener("mousedown",b,!0),document.addEventListener("click",b,!0),()=>{document.removeEventListener("mousedown",b,!0),document.removeEventListener("click",b,!0)}},[r]),j.useEffect(()=>{(async()=>{try{x(!0),T(null);const[k,O]=await Promise.all([Ke.getExamples(),Ke.getCategories()]);n(k),i(O)}catch(k){console.error("Failed to load examples:",k),T("Failed to load examples")}finally{x(!1)}})()},[]);const F=async b=>{try{x(!0),T(null),await Ke.applyExample(b.id),e(!1)}catch(k){console.error("Failed to apply example:",k),T(`Failed to load "${b.title}"`)}finally{x(!1)}},z=async()=>{try{x(!0),T(null),await Ke.clearCanvas(),e(!1)}catch(b){console.error("Failed to clear canvas:",b),T("Failed to clear canvas")}finally{x(!1)}},P=c==="all"?s:s.filter(b=>b.category===c),l=b=>{switch(b){case"beginner":return"text-green-600 bg-green-50";case"intermediate":return"text-yellow-600 bg-yellow-50";case"advanced":return"text-red-600 bg-red-50";default:return"text-gray-600 bg-gray-50"}},m=b=>{switch(b){case"beginner":return"●";case"intermediate":return"●●";case"advanced":return"●●●";default:return"?"}};return t.jsxs("div",{ref:$,className:"fixed top-4 right-4 z-50",children:[t.jsxs("button",{onClick:()=>e(!r),className:"flex items-center gap-2 px-4 py-2 bg-white border border-gray-200 rounded-lg shadow-sm hover:bg-gray-50 transition-colors",title:"Mathematical Examples",disabled:h,children:[t.jsx("span",{className:"text-lg",children:"📚"}),t.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Examples"}),t.jsx("span",{className:`text-xs transition-transform ${r?"rotate-180":""}`,children:"▼"})]}),r&&t.jsxs("div",{className:"absolute top-full right-0 mt-2 bg-white border border-gray-200 rounded-lg shadow-lg w-80 max-h-[32rem] overflow-hidden",children:[t.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-100 px-4 py-3 rounded-t-lg",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Mathematical Examples"}),t.jsx("button",{onClick:z,className:"text-xs text-red-600 hover:text-red-800 font-medium",disabled:h,children:"Clear All"})]}),t.jsx("div",{className:"mt-2",children:t.jsxs("select",{value:c,onChange:b=>a(b.target.value),className:"w-full text-xs border border-gray-200 rounded px-2 py-1 bg-white",disabled:h,children:[t.jsx("option",{value:"all",children:"All Categories"}),o.map(b=>t.jsx("option",{value:b.id,children:b.name},b.id))]})})]}),S&&t.jsx("div",{className:"px-4 py-2 bg-red-50 border-b border-red-100",children:t.jsx("p",{className:"text-xs text-red-600",children:S})}),t.jsx("div",{className:"overflow-y-auto max-h-80 examples-scrollable",children:h?t.jsx("div",{className:"flex items-center justify-center py-8",children:t.jsx("div",{className:"text-sm text-gray-500",children:"Loading examples..."})}):P.length===0?t.jsx("div",{className:"flex items-center justify-center py-8",children:t.jsx("div",{className:"text-sm text-gray-500",children:"No examples available"})}):t.jsx("div",{className:"p-2 space-y-1",children:P.map(b=>{var k;return t.jsx("button",{onClick:()=>F(b),className:"w-full text-left p-3 rounded-lg hover:bg-gray-50 transition-colors group",disabled:h,children:t.jsx("div",{className:"flex items-start justify-between",children:t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 group-hover:text-blue-600 truncate",children:b.title}),t.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded font-medium ${l(b.difficulty)}`,title:`${b.difficulty} difficulty`,children:m(b.difficulty)})]}),t.jsx("p",{className:"text-xs text-gray-500 mt-1 line-clamp-2",children:b.description}),o.find(O=>O.id===b.category)&&t.jsxs("div",{className:"flex items-center gap-1 mt-2",children:[t.jsx("span",{className:"text-xs text-gray-400",children:(k=o.find(O=>O.id===b.category))==null?void 0:k.name}),t.jsx("span",{className:"text-xs text-gray-300",children:"•"}),t.jsxs("span",{className:"text-xs text-gray-400",children:[b.objects.length," object",b.objects.length!==1?"s":""]})]})]})})},b.id)})})}),t.jsx("div",{className:"sticky bottom-0 bg-gray-50 border-t border-gray-100 px-4 py-2 rounded-b-lg",children:t.jsx("p",{className:"text-xs text-gray-500 text-center",children:"Click an example to explore mathematical concepts"})})]})]})}const St="grix-tutorial-completed";function ss(){const[r,e]=j.useState(!1),[s,n]=j.useState(0),[o,i]=j.useState(!1);j.useEffect(()=>{localStorage.getItem(St)||e(!0)},[]);const c=[{title:"Welcome to Grix! 🎯",content:"Grix is a mathematical visualization platform where you can explore concepts like slopes, fractions, multiplication, and more through interactive graphics.",highlight:null},{title:"Explore Examples 📚",content:"Click the 'Examples' button in the top-right corner to load pre-made mathematical demonstrations. Perfect for getting started!",highlight:"examples"},{title:"Customize Visualizations ⚙️",content:"Use the 'Settings' button in the bottom-left to enable different mathematical features like equivalent fractions, area calculations, and more.",highlight:"settings"},{title:"Interactive Tools 🛠️",content:"Use the toolbar to draw lines and rectangles. Zoom with Ctrl+scroll wheel, and pan by scrolling. On mobile, use pinch gestures.",highlight:"toolbar"}],a=()=>{s<c.length-1?n(s+1):x()},h=()=>{x()},x=()=>{localStorage.setItem(St,"true"),e(!1)},S=async()=>{try{i(!0);const F=await Ke.getBeginnerExamples();F.length>0&&await Ke.applyExample(F[0].id),x()}catch(F){console.error("Failed to load example:",F),x()}finally{i(!1)}};if(!r)return null;const T=c[s],$=s===c.length-1;return t.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9999]",children:[t.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-md mx-4 p-6 relative",children:[t.jsx("div",{className:"flex gap-2 mb-4",children:c.map((F,z)=>t.jsx("div",{className:`h-2 flex-1 rounded-full ${z<=s?"bg-blue-500":"bg-gray-200"}`},z))}),t.jsxs("div",{className:"text-center",children:[t.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-3",children:T.title}),t.jsx("p",{className:"text-gray-600 leading-relaxed mb-6",children:T.content})]}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{onClick:h,className:"flex-1 px-4 py-2 text-gray-600 hover:text-gray-800 font-medium transition-colors",disabled:o,children:"Skip Tutorial"}),$?t.jsx("button",{onClick:S,className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors disabled:opacity-50",disabled:o,children:o?"Loading...":"Try an Example!"}):t.jsx("button",{onClick:a,className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors",children:"Next"})]}),t.jsxs("div",{className:"text-center mt-4 text-sm text-gray-500",children:["Step ",s+1," of ",c.length]}),t.jsx("button",{onClick:h,className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600 text-xl font-bold w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100",title:"Close tutorial",children:"×"})]}),T.highlight&&t.jsxs(t.Fragment,{children:[T.highlight==="examples"&&t.jsx("div",{className:"fixed top-4 right-4 z-[10000] pointer-events-none",children:t.jsx("div",{className:"w-24 h-12 border-4 border-yellow-400 rounded-lg animate-pulse"})}),T.highlight==="settings"&&t.jsx("div",{className:"fixed bottom-4 left-4 z-[10000] pointer-events-none",children:t.jsx("div",{className:"w-24 h-12 border-4 border-yellow-400 rounded-lg animate-pulse"})}),T.highlight==="toolbar"&&t.jsx("div",{className:"fixed top-4 left-4 z-[10000] pointer-events-none",children:t.jsx("div",{className:"w-48 h-12 border-4 border-yellow-400 rounded-lg animate-pulse"})})]})]})}function ns(){const[r,e]=j.useState(!1),s=j.useRef(null);j.useEffect(()=>{function i(c){s.current&&!s.current.contains(c.target)&&e(!1)}if(r)return document.addEventListener("mousedown",i,!0),document.addEventListener("click",i,!0),document.body.style.overflow="hidden",()=>{document.removeEventListener("mousedown",i,!0),document.removeEventListener("click",i,!0),document.body.style.overflow="unset"}},[r]),j.useEffect(()=>{const i=c=>{c.key==="Escape"&&e(!1)};if(r)return document.addEventListener("keydown",i),()=>document.removeEventListener("keydown",i)},[r]);const o=["GetGrix","@","gmail",".","com"].join("");return t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>e(!0),className:"fixed bottom-20 right-4 z-40 w-10 h-10 bg-white border border-gray-200 rounded-full shadow-lg hover:bg-gray-50 transition-all hover:shadow-xl flex items-center justify-center",title:"About Grix",children:t.jsx("span",{className:"text-sm font-bold text-blue-600",children:"ℹ️"})}),r&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:t.jsxs("div",{ref:s,className:"bg-white rounded-lg shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:[t.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("svg",{width:"32",height:"32",viewBox:"0 0 32 32",className:"flex-shrink-0",children:[t.jsx("rect",{width:"32",height:"32",fill:"#2563eb",rx:"6"}),t.jsxs("g",{stroke:"#60A5FA",strokeWidth:"0.5",opacity:"0.6",children:[t.jsx("line",{x1:"8",y1:"4",x2:"8",y2:"28"}),t.jsx("line",{x1:"16",y1:"4",x2:"16",y2:"28"}),t.jsx("line",{x1:"24",y1:"4",x2:"24",y2:"28"}),t.jsx("line",{x1:"4",y1:"8",x2:"28",y2:"8"}),t.jsx("line",{x1:"4",y1:"16",x2:"28",y2:"16"}),t.jsx("line",{x1:"4",y1:"24",x2:"28",y2:"24"})]}),t.jsxs("g",{stroke:"#FFFFFF",strokeWidth:"1",children:[t.jsx("line",{x1:"16",y1:"4",x2:"16",y2:"28"}),t.jsx("line",{x1:"4",y1:"16",x2:"28",y2:"16"})]}),t.jsx("line",{x1:"16",y1:"16",x2:"24",y2:"8",stroke:"#22C55E",strokeWidth:"2"}),t.jsx("circle",{cx:"16",cy:"16",r:"2",fill:"#FFFFFF"}),t.jsx("circle",{cx:"24",cy:"8",r:"1.5",fill:"#22C55E"})]}),t.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"About Grix"})]}),t.jsx("button",{onClick:()=>e(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:t.jsx("span",{className:"text-xl",children:"✕"})})]}),t.jsxs("div",{className:"p-6 space-y-4",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Mathematical Visualization Playground"}),t.jsx("p",{className:"text-gray-600 leading-relaxed",children:"Grix is a playground-first mathematical grid system that scales from 3rd-grade fractions to professional linear algebra. Explore slopes, areas, trigonometry, functions, and more through interactive visual learning."})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-md font-semibold text-gray-800 mb-2",children:"Key Features"}),t.jsxs("ul",{className:"text-gray-600 space-y-1 text-sm",children:[t.jsx("li",{children:"• Interactive mathematical shapes and functions"}),t.jsx("li",{children:"• Real-time visualization of mathematical concepts"}),t.jsx("li",{children:"• Educational features for fractions, geometry, and algebra"}),t.jsx("li",{children:"• Touch-friendly interface for tablets and mobile devices"}),t.jsx("li",{children:"• Progressive complexity from elementary to advanced math"})]})]}),t.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[t.jsx("h4",{className:"text-md font-semibold text-green-800 mb-2",children:"🌟 Free & Open Source"}),t.jsx("p",{className:"text-green-700 text-sm mb-3",children:"Grix is completely free to use and open source under the MIT License. Anyone can contribute, modify, or use it for educational purposes."}),t.jsxs("a",{href:"https://github.com/getgrix/grix",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 text-green-700 hover:text-green-800 font-medium text-sm underline",children:[t.jsx("span",{children:"📁"}),"View on GitHub"]})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-md font-semibold text-gray-800 mb-2",children:"Get in Touch"}),t.jsx("p",{className:"text-gray-600 text-sm mb-2",children:"Have questions, suggestions, or want to contribute? We'd love to hear from you!"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-sm text-gray-500",children:"📧"}),t.jsx("span",{className:"text-sm text-blue-600 cursor-pointer hover:text-blue-800",onClick:()=>{const i=o;window.location.href=`mailto:${i}?subject=Grix Feedback`},title:"Click to send email",children:o})]})]}),t.jsx("div",{className:"pt-4 border-t border-gray-200",children:t.jsx("p",{className:"text-xs text-gray-500 text-center",children:"Made with ❤️ for mathematical learning"})})]})]})})]})}const Pt=(r,e)=>{const s=e*Math.PI/180,n=Math.cos(s),o=Math.sin(s);return{x:r.x*n-r.y*o,y:r.x*o+r.y*n}},rs=(r,e)=>({x:r.x*e,y:r.y*e}),Et=(r,e)=>{switch(e){case"x":return{x:r.x,y:-r.y};case"y":return{x:-r.x,y:r.y};case"origin":return{x:-r.x,y:-r.y};default:return r}},is=dt((r,e)=>({isTransforming:!1,activeTransform:null,selectedObject:null,rotateObject:(s,n,o)=>{if(!o){console.log(`No canvas API provided for rotation of ${s}`);return}const i=o.getObject(s);if(i){if(i.type==="ray"){if(Math.abs(i.properties.startPoint.x)<.001&&Math.abs(i.properties.startPoint.y)<.001){const a=Pt(i.properties.endPoint,n);o.updateObject(s,{properties:{...i.properties,endPoint:a}})}}else if(i.type==="rectangle"){const c=i.properties.x+i.properties.width/2,a=i.properties.y+i.properties.height/2,h={x:i.properties.x-c,y:i.properties.y-a},x=Pt(h,n);o.updateObject(s,{properties:{...i.properties,x:x.x+c,y:x.y+a}})}}},scaleObject:(s,n,o)=>{if(!o){console.log(`No canvas API provided for scaling of ${s}`);return}const i=o.getObject(s);if(i)if(i.type==="ray"){if(Math.abs(i.properties.startPoint.x)<.001&&Math.abs(i.properties.startPoint.y)<.001){const a=rs(i.properties.endPoint,n);o.updateObject(s,{properties:{...i.properties,endPoint:a}})}}else i.type==="rectangle"&&o.updateObject(s,{properties:{...i.properties,width:i.properties.width*n,height:i.properties.height*n,area:i.properties.width*n*i.properties.height*n}})},reflectObject:(s,n,o)=>{if(!o){console.log(`No canvas API provided for reflection of ${s}`);return}const i=o.getObject(s);if(i){if(i.type==="ray"){if(Math.abs(i.properties.startPoint.x)<.001&&Math.abs(i.properties.startPoint.y)<.001){const a=Et(i.properties.endPoint,n);o.updateObject(s,{properties:{...i.properties,endPoint:a}})}}else if(i.type==="rectangle"){const c=Et({x:i.properties.x,y:i.properties.y},n);o.updateObject(s,{properties:{...i.properties,x:c.x,y:c.y}})}}},rotate90:(s,n)=>{e().rotateObject(s,90,n)},rotate180:(s,n)=>{e().rotateObject(s,180,n)},rotate270:(s,n)=>{e().rotateObject(s,270,n)},setActiveTransform:s=>{r({activeTransform:s,isTransforming:s!==null})},setSelectedObject:s=>{r({selectedObject:s})},clearTransform:()=>{r({isTransforming:!1,activeTransform:null,selectedObject:null})}}));function kt({width:r=800,height:e=600,className:s="",onObjectInteraction:n}){const o=j.useRef(null),{viewport:i,setViewport:c,objects:a,selectedObjects:h,snapToGrid:x,gridDensity:S,canvasSize:T,setCanvasSize:$,removeObject:F,clearSelection:z,selectObject:P,screenToWorld:l,worldToScreen:m,getObject:b,updateObject:k}=Oe(),O=Xt(),{activeTool:I,setActiveTool:Z,eventBus:Y}=nt(),{rotate90:V,rotate180:le,rotate270:de,scaleObject:ke,setSelectedObject:g}=is();j.useEffect(()=>{$({width:r,height:e})},[r,e,$]);const w=j.useRef({isPanning:!1,startPoint:{x:0,y:0},startCenter:{x:0,y:0}}),H=j.useRef({isDown:!1,startPoint:{x:0,y:0},hasMoved:!1,dragThreshold:5,pendingSelection:null}),[ce,Pe]=j.useState(null),[je,N]=j.useState(!1),[be,p]=j.useState(!1),R=j.useRef({worldPoint:{x:0,y:0},timestamp:0,overlappingObjects:[],currentIndex:0}),re=j.useCallback((E,ie=.5)=>{const U=[];for(const _ of a){let L=0,te=1/0,y=!1;switch(_.type){case"ray":const d=rt(E,_.properties.startPoint,_.properties.endPoint);d<=ie&&(L=100,te=d,y=!0);break;case"rectangle":const{x:u,y:C,width:f,height:v}=_.properties,A=[{start:{x:u,y:C},end:{x:u+f,y:C}},{start:{x:u+f,y:C},end:{x:u+f,y:C+v}},{start:{x:u+f,y:C+v},end:{x:u,y:C+v}},{start:{x:u,y:C+v},end:{x:u,y:C}}];let M=1/0;for(const X of A){const J=rt(E,X.start,X.end);M=Math.min(M,J)}M<=ie?(L=100,te=M,y=!0):E.x>=u&&E.x<=u+f&&E.y>=C&&E.y<=C+v&&(L=50,te=0,y=!0);break;case"circle":const{center:D,radius:B}=_.properties,se=Math.sqrt((E.x-D.x)**2+(E.y-D.y)**2),Me=Mt(E,D,B);Me<=ie?(L=100,te=Me,y=!0):se<=B&&(L=50,te=B-se,y=!0);break;case"triangle":const{vertices:ve}=_.properties,ze=[[ve[0],ve[1]],[ve[1],ve[2]],[ve[2],ve[0]]];let me=1/0;for(const[X,J]of ze){const ge=rt(E,X,J);me=Math.min(me,ge)}me<=ie?(L=100,te=me,y=!0):wt(E,ve)&&(L=50,te=0,y=!0);break;case"function":const G=_.properties.points;if(G&&G.length>1){let X=1/0;for(let J=0;J<G.length-1;J++){const ge=G[J],xe=G[J+1],ue=rt(E,ge,xe);X=Math.min(X,ue)}X<=ie&&(L=100,te=X,y=!0)}break}y&&U.push({object:_,priority:L,distance:te})}return U.sort((_,L)=>_.priority!==L.priority?L.priority-_.priority:_.distance!==L.distance?_.distance-L.distance:(L.object.zIndex||0)-(_.object.zIndex||0)),U.map(_=>_.object)},[a,rt,wt,Mt]),we=j.useCallback(E=>{const ie={x:E.x,y:E.y};H.current={isDown:!0,startPoint:ie,hasMoved:!1,dragThreshold:5,pendingSelection:null};const U=l(ie),L=re(U,.5);let te=!1,y=null;if(L.length>0){te=!0;const d=Date.now(),u=R.current,C=Math.abs(U.x-u.worldPoint.x)<.1&&Math.abs(U.y-u.worldPoint.y)<.1,f=d-u.timestamp<500;if(C&&f&&u.overlappingObjects.length>1){const v=(u.currentIndex+1)%u.overlappingObjects.length,A=u.overlappingObjects[v];y=L.find(M=>M.id===A)||L[0],R.current={worldPoint:U,timestamp:d,overlappingObjects:u.overlappingObjects,currentIndex:v}}else y=L[0],R.current={worldPoint:U,timestamp:d,overlappingObjects:L.map(v=>v.id),currentIndex:0};H.current.pendingSelection={objectId:y.id,type:y.type},P(y.id)}else R.current={worldPoint:{x:0,y:0},timestamp:0,overlappingObjects:[],currentIndex:0};(!te&&!I||!te&&I)&&z(),(I||te)&&O.handlePointerDown(E),!te&&!I&&(E.type==="touch"||E.type==="mouse")&&(w.current={isPanning:!0,startPoint:{x:E.x,y:E.y},startCenter:{...i.center}})},[i.center,O,I,Z,a,l,m,i.zoom]),Ie=j.useCallback(E=>{const ie={x:E.x,y:E.y};if(E.type==="mouse"&&I?Pe(ie):I||Pe(null),H.current.isDown&&!H.current.hasMoved){const U=Math.abs(E.x-H.current.startPoint.x),_=Math.abs(E.y-H.current.startPoint.y);Math.sqrt(U*U+_*_)>=H.current.dragThreshold&&(H.current.hasMoved=!0,p(!0),H.current.pendingSelection=null)}if(O.handlePointerMove(E),!I&&w.current.isPanning){const U=(E.x-w.current.startPoint.x)/i.zoom,_=(E.y-w.current.startPoint.y)/i.zoom;c({center:{x:w.current.startCenter.x-U,y:w.current.startCenter.y+_}})}},[i.zoom,c,O,I,Pe]),ee=j.useCallback(E=>{p(!1),H.current={isDown:!1,startPoint:{x:0,y:0},hasMoved:!1,dragThreshold:5,pendingSelection:null},O.handlePointerUp(E),w.current.isPanning=!1},[O,Z]),Ne=j.useCallback(E=>{switch(E.type){case"pinch":if(E.scale&&E.center){const ie=a.length;let U=E.scale;if(E.touches&&E.touches>1){const d=/iPad|iPhone|iPod/.test(navigator.userAgent)?.3:.4;U=1+(E.scale-1)*d}const _=ie>50?100:ie>20?200:500,te=Math.max(.1,Math.min(_,i.zoom*U));if(Math.abs(te-i.zoom)>.001){const y=te/i.zoom,d=l(E.center),u={x:d.x+(i.center.x-d.x)/y,y:d.y+(i.center.y-d.y)/y};c({zoom:te,center:u})}}break}},[i.zoom,i.center,c,a.length,l]),{capabilities:_e,touchTargetSize:Q}=bt(o,{onPointerDown:we,onPointerMove:Ie,onPointerUp:ee,onGesture:Ne},{enableGestures:!0,preventScrolling:!0});j.useEffect(()=>{const E=U=>{switch(U.key){case"ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":if(h.length>0){U.preventDefault();const _=U.shiftKey?.1:1;let L=0,te=0;switch(U.key){case"ArrowUp":te=_;break;case"ArrowDown":te=-_;break;case"ArrowLeft":L=-_;break;case"ArrowRight":L=_;break}h.forEach(y=>{const d=b(y);if(d)switch(d.type){case"ray":k(y,{properties:{...d.properties,startPoint:{x:d.properties.startPoint.x+L,y:d.properties.startPoint.y+te},endPoint:{x:d.properties.endPoint.x+L,y:d.properties.endPoint.y+te}}});break;case"rectangle":k(y,{properties:{...d.properties,x:d.properties.x+L,y:d.properties.y+te}});break;case"circle":k(y,{properties:{...d.properties,center:{x:d.properties.center.x+L,y:d.properties.center.y+te}}});break;case"triangle":const u=d.properties.vertices.map(v=>({x:v.x+L,y:v.y+te}));k(y,{properties:{...d.properties,vertices:u}});break;case"function":const C={min:d.properties.domain.min+L,max:d.properties.domain.max+L},f=d.properties.points.map(v=>({x:v.x+L,y:v.y+te}));k(y,{properties:{...d.properties,domain:C,points:f}});break}})}break;case"Escape":I&&(Y.emit("tool:cancel",{toolId:I}),Z(null));break;case"Delete":case"Backspace":h.length>0&&(console.log("Deleting objects:",h),h.forEach(_=>{Y.emit("object:removed",{objectId:_}),F(_)}),z(),Z(null));break;case"r":case"R":if(h.length>0&&!U.ctrlKey){U.preventDefault();const _={getObject:b,updateObject:k};h.forEach(L=>{U.shiftKey?de(L,_):V(L,_)})}break;case"f":case"F":if(h.length>0&&!U.ctrlKey){U.preventDefault();const _={getObject:b,updateObject:k};h.forEach(L=>{le(L,_)})}break;case"=":case"+":if(h.length>0&&!U.ctrlKey){U.preventDefault();const _={getObject:b,updateObject:k};h.forEach(L=>{ke(L,2,_)})}break;case"-":case"_":if(h.length>0&&!U.ctrlKey){U.preventDefault();const _={getObject:b,updateObject:k};h.forEach(L=>{ke(L,.5,_)})}break}},ie=U=>{z(),Z(null)};return document.addEventListener("keydown",E),Y.on("tool:creation-complete",ie),()=>{document.removeEventListener("keydown",E),Y.off("tool:creation-complete",ie)}},[I,Z,Y,h,F,z]),j.useEffect(()=>{h.length===1&&!be?N(!0):N(!1)},[h,be]);const K=j.useCallback(()=>{N(!1)},[]),he=j.useCallback(()=>{h.length>0&&(h.forEach(E=>{Y.emit("object:removed",{objectId:E}),F(E)}),z())},[h,F,z,Y]),pe=j.useCallback((E,ie)=>{k(E,ie)},[k]),fe=j.useCallback(()=>{const E=Math.min(1e3,i.zoom*1.4);c({zoom:E})},[i.zoom,c]),Ge=j.useCallback(()=>{const E=Math.max(.01,i.zoom/1.4);c({zoom:E})},[i.zoom,c]),oe=j.useCallback(()=>{c({zoom:20,center:{x:0,y:0}})},[c]),ne=j.useCallback(()=>{c({center:{x:0,y:0}})},[c]);return j.useEffect(()=>{const E=U=>{U.preventDefault();const L=Oe.getState().viewport;if(U.ctrlKey||U.metaKey){const te=U.deltaY>0?.9:1.1,y=Math.max(.01,Math.min(1e3,L.zoom*te));c({zoom:y})}else{const y=U.shiftKey?U.deltaY:0,d=U.shiftKey?0:U.deltaY,u=y*1/L.zoom,C=d*1/L.zoom;c({center:{x:L.center.x+u,y:L.center.y-C}})}},ie=o.current;if(ie)return ie.addEventListener("wheel",E,{passive:!1}),()=>{ie.removeEventListener("wheel",E)}},[c]),t.jsxs("div",{className:`relative ${s}`,style:{width:r,height:e},children:[t.jsxs("svg",{ref:o,width:r,height:e,className:"absolute inset-0 bg-white",style:{touchAction:"none"},children:[t.jsx(Vt,{viewport:i,canvasSize:{width:r,height:e},worldToScreen:m,objects:a}),t.jsx(Kt,{objects:a,viewport:i,touchTargetSize:Q,worldToScreen:m,selectedObjects:h,canvasSize:{width:r,height:e}}),I&&ce&&!H.current.isDown&&t.jsx("circle",{cx:ce.x,cy:ce.y,r:"4",fill:"rgba(37, 99, 235, 0.4)",stroke:"#2563eb",strokeWidth:"1",opacity:"0.8",style:{pointerEvents:"none"}})]}),t.jsx(Jt,{capabilities:_e,viewport:i,activeTool:I,selectedObjectsCount:h.length}),t.jsx(Zt,{viewport:i,onZoomIn:fe,onZoomOut:Ge,onZoomReset:oe,onCenterOnly:ne}),je&&h.length===1&&t.jsx(Qt,{selectedObject:a.find(E=>E.id===h[0])||null,onDelete:he,onUpdate:pe,onClose:K}),t.jsx(es,{}),t.jsx(ts,{}),t.jsx(ss,{}),t.jsx(ns,{})]})}const At=[{id:"ray-tool",name:"Line Builder",icon:"📏",description:"Create and edit lines to explore slopes and fractions"},{id:"rectangle-tool",name:"Rectangle Builder",icon:"⬜",description:"Create rectangles to explore area and multiplication"},{id:"circle-tool",name:"Circle Builder",icon:"⭕",description:"Create circles to explore circumference and area"},{id:"triangle-tool",name:"Triangle Builder",icon:"🔺",description:"Create triangles to explore angles and trigonometry"},{id:"function-tool",name:"Function Grapher",icon:"📈",description:"Create function graphs like parabolas, sine waves, and more"}];function Tt({className:r=""}){const{activeTool:e,setActiveTool:s}=nt(),[n,o]=j.useState(!1),i=j.useRef(null),c=S=>{s(S),o(!1)},a=()=>{s(null),o(!1)},h=()=>{o(!n)},x=At.find(S=>S.id===e);return j.useEffect(()=>{const S=T=>{i.current&&!i.current.contains(T.target)&&o(!1)};if(n)return document.addEventListener("mousedown",S,!0),document.addEventListener("touchstart",S,!0),document.addEventListener("click",S,!0),()=>{document.removeEventListener("mousedown",S,!0),document.removeEventListener("touchstart",S,!0),document.removeEventListener("click",S,!0)}},[n]),t.jsxs("div",{className:`flex items-center gap-2 p-2 bg-white border-b border-gray-200 ${r}`,children:[t.jsxs("div",{className:"flex items-center gap-2 mr-4",children:[t.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 32 32",className:"flex-shrink-0",children:[t.jsx("rect",{width:"32",height:"32",fill:"#2563eb",rx:"6"}),t.jsxs("g",{stroke:"#60A5FA",strokeWidth:"0.5",opacity:"0.6",children:[t.jsx("line",{x1:"8",y1:"4",x2:"8",y2:"28"}),t.jsx("line",{x1:"16",y1:"4",x2:"16",y2:"28"}),t.jsx("line",{x1:"24",y1:"4",x2:"24",y2:"28"}),t.jsx("line",{x1:"4",y1:"8",x2:"28",y2:"8"}),t.jsx("line",{x1:"4",y1:"16",x2:"28",y2:"16"}),t.jsx("line",{x1:"4",y1:"24",x2:"28",y2:"24"})]}),t.jsxs("g",{stroke:"#FFFFFF",strokeWidth:"1",children:[t.jsx("line",{x1:"16",y1:"4",x2:"16",y2:"28"}),t.jsx("line",{x1:"4",y1:"16",x2:"28",y2:"16"})]}),t.jsx("line",{x1:"16",y1:"16",x2:"24",y2:"8",stroke:"#22C55E",strokeWidth:"2"}),t.jsx("circle",{cx:"16",cy:"16",r:"2",fill:"#FFFFFF"}),t.jsx("circle",{cx:"24",cy:"8",r:"1.5",fill:"#22C55E"})]}),t.jsx("h1",{className:"text-lg font-semibold text-gray-800",children:"Grix"})]}),t.jsxs("div",{className:"relative",ref:i,children:[t.jsxs("button",{onClick:h,className:`
            flex items-center gap-2 px-4 py-2 rounded-lg border transition-all
            ${e?"bg-blue-100 border-blue-300 text-blue-700":"bg-gray-50 border-gray-200 text-gray-700 hover:bg-gray-100"}
          `,children:[t.jsx("span",{className:"text-lg",children:"🏗️"}),t.jsx("span",{className:"text-sm font-medium",children:x?x.name:"Build"}),t.jsx("span",{className:`text-xs transition-transform ${n?"rotate-180":""}`,children:"▼"})]}),n&&t.jsx("div",{className:"build-dropdown absolute top-full left-0 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg z-50 min-w-48 max-h-80 overflow-y-auto",children:t.jsxs("div",{className:"build-dropdown-scrollable",children:[At.map(S=>t.jsxs("button",{onClick:()=>c(S.id),className:`
                    w-full flex items-center gap-3 px-4 py-3 text-left hover:bg-gray-50 first:rounded-t-lg transition-colors
                    ${e===S.id?"bg-blue-50 text-blue-700":"text-gray-700"}
                  `,title:S.description,children:[t.jsx("span",{className:"text-lg",children:S.icon}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-medium",children:S.name}),t.jsx("div",{className:"text-xs text-gray-500",children:S.description})]})]},S.id)),e&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"border-t border-gray-100"}),t.jsxs("button",{onClick:a,className:"w-full flex items-center gap-3 px-4 py-2 text-left hover:bg-gray-50 rounded-b-lg transition-colors text-gray-600",children:[t.jsx("span",{className:"text-lg",children:"✕"}),t.jsx("span",{className:"text-sm",children:"Clear selection"})]})]})]})})]})]})}class Ft extends j.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,s){console.error("Canvas Error Boundary caught an error:",e,s),this.setState({error:e,errorInfo:s})}render(){var e,s;if(this.state.hasError){const n=this.props.fallback;return n?t.jsx(n,{error:this.state.error}):t.jsx("div",{className:"flex items-center justify-center h-full bg-red-50 text-red-700 p-8",children:t.jsxs("div",{className:"text-center",children:[t.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Something went wrong with the Canvas"}),t.jsxs("details",{className:"text-sm",children:[t.jsx("summary",{className:"cursor-pointer mb-2",children:"Error Details"}),t.jsxs("pre",{className:"whitespace-pre-wrap text-left bg-red-100 p-4 rounded",children:[(e=this.state.error)==null?void 0:e.toString(),(s=this.state.errorInfo)==null?void 0:s.componentStack]})]}),t.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Reload Page"})]})})}return this.props.children}}class os{constructor(){ae(this,"id","ray-tool");ae(this,"name","Line Builder");ae(this,"context");ae(this,"state",{isCreating:!1,startPoint:null,currentRay:null,dragTarget:null,dragOffset:null})}init(e){this.context=e,e.events.on("tool:changed",this.handleToolChange.bind(this)),e.events.on("tool:cancel",this.handleToolCancel.bind(this))}destroy(){this.context.events.off("tool:changed",this.handleToolChange.bind(this)),this.context.events.off("tool:cancel",this.handleToolCancel.bind(this))}handleToolChange(e){e.current!==this.id&&this.cancelCreation()}handleToolCancel(e){e.toolId===this.id&&this.cancelCreation()}cancelCreation(){this.state.currentRay&&this.state.isCreating&&this.context.canvas.removeObject(this.state.currentRay.id),this.state={isCreating:!1,startPoint:null,currentRay:null,dragTarget:null,dragOffset:null}}generateId(){return`ray_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}snapPoint(e){const s=this.context.state.getState();if(s.snapToGrid){if(Math.sqrt(e.x*e.x+e.y*e.y)<=.75)return{x:0,y:0};const i=Le.getState(),c=Ze(s.viewport,i.gridScale,i.snapPrecision);return this.context.math.snapToGrid(e,c)}return e}findNearestHandle(e,s=20){this.context.canvas.screenToWorld(e);const n=this.context.canvas.getAllObjects();for(const o of n)if(o.type==="ray"){const i=o,c=this.context.canvas.worldToScreen(i.properties.startPoint),a=this.context.canvas.worldToScreen(i.properties.endPoint),h=this.context.math.distance(e,c),x=this.context.math.distance(e,a);if(h<=s)return{rayId:i.id,handle:"start"};if(x<=s)return{rayId:i.id,handle:"end"};const S=8,T=a.x-c.x,$=a.y-c.y,F=Math.sqrt(T*T+$*$);if(F>0){const z=Math.max(0,Math.min(1,((e.x-c.x)*T+(e.y-c.y)*$)/(F*F))),P={x:c.x+z*T,y:c.y+z*$};if(this.context.math.distance(e,P)<=S)return{rayId:i.id,handle:"move"}}}return null}onPointerDown(e){const s={x:e.x,y:e.y},n=this.snapPoint(this.context.canvas.screenToWorld(s)),o=this.findNearestHandle(s);if(o){const i=this.context.canvas.getObject(o.rayId),c=this.context.state.getState().selectedObjects;if(i&&c.includes(o.rayId)){this.state.currentRay=i,this.state.dragTarget=o.handle,this.state.isCreating=!1,o.handle==="move"&&(this.state.dragOffset={x:n.x-i.properties.startPoint.x,y:n.y-i.properties.startPoint.y});return}}if(!this.state.isCreating){if(this.context.state.getState().selectedObjects.some(h=>{const x=this.context.canvas.getObject(h);return(x==null?void 0:x.type)==="ray"}))return;this.state.isCreating=!0,this.state.startPoint=n;const a={id:this.generateId(),type:"ray",properties:{startPoint:n,endPoint:{...n},slope:0,yIntercept:n.y},visible:!0,selected:!1,zIndex:0};this.state.currentRay=a,this.context.canvas.addObject(a)}}onPointerMove(e){if(!this.state.currentRay)return;const s={x:e.x,y:e.y},n=this.snapPoint(this.context.canvas.screenToWorld(s));if(this.state.isCreating){const o=this.context.math.slope(this.state.currentRay.properties.startPoint,n),i=n.y-o*n.x;this.context.canvas.updateObject(this.state.currentRay.id,{properties:{...this.state.currentRay.properties,endPoint:n,slope:o,yIntercept:isFinite(o)?i:this.state.currentRay.properties.startPoint.y}})}else if(this.state.dragTarget){const o=this.context.canvas.getObject(this.state.currentRay.id);if(!o)return;const i={...o.properties};if(this.state.dragTarget==="start")i.startPoint=n;else if(this.state.dragTarget==="end")i.endPoint=n;else if(this.state.dragTarget==="move"&&this.state.dragOffset){const c=n.x-this.state.dragOffset.x-o.properties.startPoint.x,a=n.y-this.state.dragOffset.y-o.properties.startPoint.y;i.startPoint={x:o.properties.startPoint.x+c,y:o.properties.startPoint.y+a},i.endPoint={x:o.properties.endPoint.x+c,y:o.properties.endPoint.y+a}}if(this.state.dragTarget==="start"||this.state.dragTarget==="end"){const c=this.context.math.slope(i.startPoint,i.endPoint);i.slope=c,i.yIntercept=isFinite(c)?i.startPoint.y-c*i.startPoint.x:i.startPoint.y}this.context.canvas.updateObject(this.state.currentRay.id,{properties:i})}this.context.events.emit("ray:update",{rayId:this.state.currentRay.id,ray:this.context.canvas.getObject(this.state.currentRay.id)})}onPointerUp(e){if(this.state.isCreating&&this.state.currentRay){const s={x:e.x,y:e.y},n=this.snapPoint(this.context.canvas.screenToWorld(s)),o=this.state.currentRay.properties.startPoint;this.context.math.distance(o,n)<.1?this.context.canvas.removeObject(this.state.currentRay.id):(this.context.events.emit("ray:created",{rayId:this.state.currentRay.id,ray:this.state.currentRay}),this.context.events.emit("tool:creation-complete",{toolId:this.id,objectId:this.state.currentRay.id}))}this.state={isCreating:!1,startPoint:null,currentRay:null,dragTarget:null,dragOffset:null}}}function Ot(){return new os}class as{constructor(){ae(this,"id","rectangle-tool");ae(this,"name","Rectangle Builder");ae(this,"context");ae(this,"state",{isCreating:!1,startPoint:null,currentRectangle:null,dragTarget:null,dragOffset:null,lockedCorner:null})}init(e){this.context=e,e.events.on("tool:changed",this.handleToolChange.bind(this)),e.events.on("tool:cancel",this.handleToolCancel.bind(this))}destroy(){this.context.events.off("tool:changed",this.handleToolChange.bind(this)),this.context.events.off("tool:cancel",this.handleToolCancel.bind(this))}handleToolChange(e){e.current!==this.id&&this.cancelCreation()}handleToolCancel(e){e.toolId===this.id&&this.cancelCreation()}cancelCreation(){this.state.currentRectangle&&this.state.isCreating&&this.context.canvas.removeObject(this.state.currentRectangle.id),this.state={isCreating:!1,startPoint:null,currentRectangle:null,dragTarget:null,dragOffset:null,lockedCorner:null}}generateId(){return`rect_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}snapPoint(e){const s=this.context.state.getState();if(s.snapToGrid){if(Math.sqrt(e.x*e.x+e.y*e.y)<=.75)return{x:0,y:0};const i=Le.getState(),c=Ze(s.viewport,i.gridScale,i.snapPrecision);return this.context.math.snapToGrid(e,c)}return e}findRectangleAtPoint(e){const s=this.context.canvas.getAllObjects();for(const n of s)if(n.type==="rectangle"){const o=n,{x:i,y:c,width:a,height:h}=o.properties;if(e.x>=i&&e.x<=i+a&&e.y>=c&&e.y<=c+h)return o}return null}findNearestCorner(e,s,n=.5){const{x:o,y:i,width:c,height:a}=s.properties,h=[{point:{x:o,y:i},type:"corner-bl"},{point:{x:o+c,y:i},type:"corner-br"},{point:{x:o,y:i+a},type:"corner-tl"},{point:{x:o+c,y:i+a},type:"corner-tr"}];for(const x of h)if(this.context.math.distance(e,x.point)<=n)return x.type;return null}onPointerDown(e){const s={x:e.x,y:e.y},n=this.snapPoint(this.context.canvas.screenToWorld(s)),o=this.findRectangleAtPoint(n);if(o&&this.context.state.getState().selectedObjects.includes(o.id)){const x=this.findNearestCorner(n,o);if(x){this.state.currentRectangle=o,this.state.dragTarget=x,this.state.isCreating=!1;const{x:S,y:T,width:$,height:F}=o.properties;switch(x){case"corner-tl":this.state.lockedCorner={x:S+$,y:T};break;case"corner-tr":this.state.lockedCorner={x:S,y:T};break;case"corner-bl":this.state.lockedCorner={x:S+$,y:T+F};break;case"corner-br":this.state.lockedCorner={x:S,y:T+F};break}return}else{this.state.currentRectangle=o,this.state.dragTarget="move",this.state.dragOffset={x:n.x-o.properties.x,y:n.y-o.properties.y},this.state.isCreating=!1;return}}if(this.context.state.getState().selectedObjects.some(h=>{const x=this.context.canvas.getObject(h);return(x==null?void 0:x.type)==="rectangle"}))return;this.state.isCreating=!0,this.state.startPoint=n;const a={id:this.generateId(),type:"rectangle",properties:{x:n.x,y:n.y,width:0,height:0,area:0},visible:!0,selected:!1,zIndex:0};this.state.currentRectangle=a,this.context.canvas.addObject(a)}onPointerMove(e){if(!this.state.currentRectangle)return;const s={x:e.x,y:e.y},n=this.snapPoint(this.context.canvas.screenToWorld(s));if(this.state.isCreating&&this.state.startPoint){const o=Math.min(this.state.startPoint.x,n.x),i=Math.min(this.state.startPoint.y,n.y),c=Math.abs(n.x-this.state.startPoint.x),a=Math.abs(n.y-this.state.startPoint.y),h=c*a;this.context.canvas.updateObject(this.state.currentRectangle.id,{properties:{x:o,y:i,width:c,height:a,area:h}})}else if(this.state.dragTarget==="move"&&this.state.dragOffset){const o=n.x-this.state.dragOffset.x,i=n.y-this.state.dragOffset.y;this.context.canvas.updateObject(this.state.currentRectangle.id,{properties:{...this.state.currentRectangle.properties,x:o,y:i}})}else if(this.state.dragTarget&&this.state.dragTarget.startsWith("corner-")&&this.state.lockedCorner){const o=this.state.lockedCorner,i=Math.min(n.x,o.x),c=Math.max(n.x,o.x),a=Math.min(n.y,o.y),h=Math.max(n.y,o.y),x=i,S=a,T=c-i,$=h-a,F=Math.max(.1,T),z=Math.max(.1,$),P=F*z;this.context.canvas.updateObject(this.state.currentRectangle.id,{properties:{x,y:S,width:F,height:z,area:P}})}this.context.events.emit("rectangle:update",{rectangleId:this.state.currentRectangle.id,rectangle:this.context.canvas.getObject(this.state.currentRectangle.id)})}onPointerUp(e){if(this.state.isCreating&&this.state.currentRectangle){const s=this.context.canvas.getObject(this.state.currentRectangle.id);s&&(s.properties.width<.1||s.properties.height<.1?this.context.canvas.removeObject(this.state.currentRectangle.id):(this.context.events.emit("rectangle:created",{rectangleId:this.state.currentRectangle.id,rectangle:s}),this.context.events.emit("tool:creation-complete",{toolId:this.id,objectId:this.state.currentRectangle.id})))}this.state={isCreating:!1,startPoint:null,currentRectangle:null,dragTarget:null,dragOffset:null,lockedCorner:null}}}function Dt(){return new as}class cs{constructor(){ae(this,"id","circle-tool");ae(this,"name","Circle Builder");ae(this,"context");ae(this,"state",{isCreating:!1,center:null,currentCircle:null,dragTarget:null,dragOffset:null})}init(e){this.context=e,e.events.on("tool:changed",this.handleToolChange.bind(this)),e.events.on("tool:cancel",this.handleToolCancel.bind(this))}destroy(){this.context.events.off("tool:changed",this.handleToolChange.bind(this)),this.context.events.off("tool:cancel",this.handleToolCancel.bind(this))}handleToolChange(e){e.current!==this.id&&this.cancelCreation()}handleToolCancel(e){e.toolId===this.id&&this.cancelCreation()}cancelCreation(){this.state.currentCircle&&this.state.isCreating&&this.context.canvas.removeObject(this.state.currentCircle.id),this.state={isCreating:!1,center:null,currentCircle:null,dragTarget:null,dragOffset:null}}generateId(){return`circle_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}snapPoint(e){const s=this.context.state.getState();if(s.snapToGrid){if(Math.sqrt(e.x*e.x+e.y*e.y)<=.75)return{x:0,y:0};const i=Le.getState(),c=Ze(s.viewport,i.gridScale,i.snapPrecision);return this.context.math.snapToGrid(e,c)}return e}calculateCircleProperties(e,s){const n=this.context.math.distance(e,s),o=n*2,i=2*Math.PI*n,c=Math.PI*n*n;return{radius:n,diameter:o,circumference:i,area:c}}findCircleAtPoint(e){const s=this.context.canvas.getAllObjects();for(const n of s)if(n.type==="circle"){const o=n;if(this.context.math.distance(e,o.properties.center)<=o.properties.radius+.5)return o}return null}findNearestHandle(e,s,n=.5){const{center:o,radius:i}=s.properties;if(this.context.math.distance(e,o)<=n)return"center";const c={x:o.x+i,y:o.y};return this.context.math.distance(e,c)<=n?"radius":null}onPointerDown(e){const s={x:e.x,y:e.y},n=this.snapPoint(this.context.canvas.screenToWorld(s)),o=this.findCircleAtPoint(n);if(o&&!this.context.state.getState().selectedObjects.includes(o.id))return;if(o&&this.context.state.getState().selectedObjects.includes(o.id)){const x=this.findNearestHandle(n,o);if(x){this.state.currentCircle=o,this.state.dragTarget=x,this.state.isCreating=!1,x==="center"&&(this.state.dragOffset={x:n.x-o.properties.center.x,y:n.y-o.properties.center.y});return}else{this.state.currentCircle=o,this.state.dragTarget="center",this.state.isCreating=!1,this.state.dragOffset={x:n.x-o.properties.center.x,y:n.y-o.properties.center.y};return}}if(this.context.state.getState().selectedObjects.some(h=>{const x=this.context.canvas.getObject(h);return(x==null?void 0:x.type)==="circle"}))return;this.state.isCreating=!0,this.state.center=n;const a={id:this.generateId(),type:"circle",properties:{center:n,radius:0,diameter:0,circumference:0,area:0},visible:!0,selected:!1,zIndex:0};this.state.currentCircle=a,this.context.canvas.addObject(a)}onPointerMove(e){if(!this.state.currentCircle)return;const s={x:e.x,y:e.y},n=this.snapPoint(this.context.canvas.screenToWorld(s));if(this.state.isCreating&&this.state.center){const o=this.calculateCircleProperties(this.state.center,n);this.context.canvas.updateObject(this.state.currentCircle.id,{properties:{center:this.state.center,...o}})}else if(this.state.dragTarget==="center"&&this.state.dragOffset){const o={x:n.x-this.state.dragOffset.x,y:n.y-this.state.dragOffset.y};this.context.canvas.updateObject(this.state.currentCircle.id,{properties:{...this.state.currentCircle.properties,center:o}})}else if(this.state.dragTarget==="radius"){const o=this.state.currentCircle.properties.center,i=this.calculateCircleProperties(o,n);this.context.canvas.updateObject(this.state.currentCircle.id,{properties:{center:o,...i}})}this.context.events.emit("circle:update",{circleId:this.state.currentCircle.id,circle:this.context.canvas.getObject(this.state.currentCircle.id)})}onPointerUp(e){if(this.state.isCreating&&this.state.currentCircle){const s=this.context.canvas.getObject(this.state.currentCircle.id);s&&(s.properties.radius<.1?this.context.canvas.removeObject(this.state.currentCircle.id):(this.context.events.emit("circle:created",{circleId:this.state.currentCircle.id,circle:s}),this.context.events.emit("tool:creation-complete",{toolId:this.id,objectId:this.state.currentCircle.id})))}this.state={isCreating:!1,center:null,currentCircle:null,dragTarget:null,dragOffset:null}}}function ls(){return new cs}class ds{constructor(){ae(this,"id","triangle-tool");ae(this,"name","Triangle Builder");ae(this,"context");ae(this,"state",{isCreating:!1,creationStep:0,vertices:[null,null,null],currentTriangle:null,dragTarget:null,dragOffset:null})}init(e){this.context=e,e.events.on("tool:changed",this.handleToolChange.bind(this)),e.events.on("tool:cancel",this.handleToolCancel.bind(this))}destroy(){this.context.events.off("tool:changed",this.handleToolChange.bind(this)),this.context.events.off("tool:cancel",this.handleToolCancel.bind(this))}handleToolChange(e){e.current!==this.id&&this.cancelCreation()}handleToolCancel(e){e.toolId===this.id&&this.cancelCreation()}cancelCreation(){this.state.currentTriangle&&this.state.isCreating&&this.context.canvas.removeObject(this.state.currentTriangle.id),this.state={isCreating:!1,creationStep:0,vertices:[null,null,null],currentTriangle:null,dragTarget:null,dragOffset:null}}generateId(){return`triangle_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}snapPoint(e){const s=this.context.state.getState();if(s.snapToGrid){if(Math.sqrt(e.x*e.x+e.y*e.y)<=.75)return{x:0,y:0};const i=Le.getState(),c=Ze(s.viewport,i.gridScale,i.snapPrecision);return this.context.math.snapToGrid(e,c)}return e}calculateTriangleProperties(e){const[s,n,o]=e,i=this.context.math.distance(n,o),c=this.context.math.distance(s,o),a=this.context.math.distance(s,n),h=Math.acos((c*c+a*a-i*i)/(2*c*a))*180/Math.PI,x=Math.acos((i*i+a*a-c*c)/(2*i*a))*180/Math.PI,S=180-h-x,T=Math.abs((n.x-s.x)*(o.y-s.y)-(o.x-s.x)*(n.y-s.y))/2,$=i+c+a;let F="scalene";const z=.1;return Math.abs(h-90)<z||Math.abs(x-90)<z||Math.abs(S-90)<z?F="right":h>90||x>90||S>90?F="obtuse":h<90&&x<90&&S<90&&(F="acute"),Math.abs(i-c)<z&&Math.abs(c-a)<z?F="equilateral":(Math.abs(i-c)<z||Math.abs(c-a)<z||Math.abs(i-a)<z)&&(F="isosceles"),{sideA:i,sideB:c,sideC:a,angleA:h,angleB:x,angleC:S,area:T,perimeter:$,type:F}}findTriangleAtPoint(e){const s=this.context.canvas.getAllObjects();for(const n of s)if(n.type==="triangle"){const o=n,[i,c,a]=o.properties.vertices,h=(c.y-a.y)*(i.x-a.x)+(a.x-c.x)*(i.y-a.y),x=((c.y-a.y)*(e.x-a.x)+(a.x-c.x)*(e.y-a.y))/h,S=((a.y-i.y)*(e.x-a.x)+(i.x-a.x)*(e.y-a.y))/h,T=1-x-S;if(x>=0&&S>=0&&T>=0)return o}return null}findNearestVertex(e,s,n=.5){const o=s.properties.vertices;for(let i=0;i<o.length;i++)if(this.context.math.distance(e,o[i])<=n)return`vertex${i}`;return null}onPointerDown(e){const s={x:e.x,y:e.y},n=this.snapPoint(this.context.canvas.screenToWorld(s)),o=this.findTriangleAtPoint(n);if(o&&this.context.state.getState().selectedObjects.includes(o.id)){const c=this.findNearestVertex(n,o);if(c){this.state.currentTriangle=o,this.state.dragTarget=c,this.state.isCreating=!1;return}else{this.state.currentTriangle=o,this.state.dragTarget="move";const a={x:(o.properties.vertices[0].x+o.properties.vertices[1].x+o.properties.vertices[2].x)/3,y:(o.properties.vertices[0].y+o.properties.vertices[1].y+o.properties.vertices[2].y)/3};this.state.dragOffset={x:n.x-a.x,y:n.y-a.y},this.state.isCreating=!1;return}}if(!this.state.isCreating){if(this.context.state.getState().selectedObjects.some(x=>{const S=this.context.canvas.getObject(x);return(S==null?void 0:S.type)==="triangle"}))return;this.state.isCreating=!0,this.state.creationStep=0,this.state.vertices=[n,null,null];const a={x:n.x+3,y:n.y};this.state.vertices[1]=a,this.state.creationStep=1;const h={id:this.generateId(),type:"triangle",properties:{vertices:[n,a,n],sideA:0,sideB:0,sideC:0,angleA:0,angleB:0,angleC:0,area:0,perimeter:0,type:"scalene"},visible:!0,selected:!1,zIndex:0};this.state.currentTriangle=h,this.context.canvas.addObject(h)}}onPointerMove(e){if(!this.state.currentTriangle)return;const s={x:e.x,y:e.y},n=this.snapPoint(this.context.canvas.screenToWorld(s));if(this.state.isCreating&&this.state.creationStep===1){const[o,i]=this.state.vertices;if(o&&i){const c={x:i.x,y:n.y},a=[o,i,c],h=this.calculateTriangleProperties(a);this.context.canvas.updateObject(this.state.currentTriangle.id,{properties:{vertices:a,...h}})}}else if(this.state.dragTarget&&this.state.dragTarget.startsWith("vertex")){const o=parseInt(this.state.dragTarget.replace("vertex","")),i=[...this.state.currentTriangle.properties.vertices];i[o]=n;const c=this.calculateTriangleProperties(i);this.context.canvas.updateObject(this.state.currentTriangle.id,{properties:{vertices:i,...c}})}else if(this.state.dragTarget==="move"&&this.state.dragOffset){const o={x:n.x-this.state.dragOffset.x,y:n.y-this.state.dragOffset.y},i={x:(this.state.currentTriangle.properties.vertices[0].x+this.state.currentTriangle.properties.vertices[1].x+this.state.currentTriangle.properties.vertices[2].x)/3,y:(this.state.currentTriangle.properties.vertices[0].y+this.state.currentTriangle.properties.vertices[1].y+this.state.currentTriangle.properties.vertices[2].y)/3},c={x:o.x-i.x,y:o.y-i.y},a=[{x:this.state.currentTriangle.properties.vertices[0].x+c.x,y:this.state.currentTriangle.properties.vertices[0].y+c.y},{x:this.state.currentTriangle.properties.vertices[1].x+c.x,y:this.state.currentTriangle.properties.vertices[1].y+c.y},{x:this.state.currentTriangle.properties.vertices[2].x+c.x,y:this.state.currentTriangle.properties.vertices[2].y+c.y}];this.context.canvas.updateObject(this.state.currentTriangle.id,{properties:{...this.state.currentTriangle.properties,vertices:a}})}this.context.events.emit("triangle:update",{triangleId:this.state.currentTriangle.id,triangle:this.context.canvas.getObject(this.state.currentTriangle.id)})}onPointerUp(e){if(this.state.isCreating&&this.state.currentTriangle&&this.state.creationStep===1){const s=this.context.canvas.getObject(this.state.currentTriangle.id);s&&(s.properties.area<.1?this.context.canvas.removeObject(this.state.currentTriangle.id):(this.context.events.emit("triangle:created",{triangleId:this.state.currentTriangle.id,triangle:s}),this.context.events.emit("tool:creation-complete",{toolId:this.id,objectId:this.state.currentTriangle.id})))}this.state={isCreating:!1,creationStep:0,vertices:[null,null,null],currentTriangle:null,dragTarget:null,dragOffset:null}}}function hs(){return new ds}class xs{constructor(){ae(this,"id","function-tool");ae(this,"name","Function Grapher");ae(this,"context");ae(this,"state",{isCreating:!1,currentFunction:null,dragTarget:null,dragOffset:null,equation:"x^2",functionType:"polynomial"})}init(e){this.context=e,e.events.on("tool:changed",this.handleToolChange.bind(this)),e.events.on("tool:cancel",this.handleToolCancel.bind(this))}destroy(){this.context.events.off("tool:changed",this.handleToolChange.bind(this)),this.context.events.off("tool:cancel",this.handleToolCancel.bind(this))}handleToolChange(e){e.current!==this.id&&this.cancelCreation()}handleToolCancel(e){e.toolId===this.id&&this.cancelCreation()}cancelCreation(){this.state.currentFunction&&this.state.isCreating&&this.context.canvas.removeObject(this.state.currentFunction.id),this.state={isCreating:!1,currentFunction:null,dragTarget:null,dragOffset:null,equation:"x^2",functionType:"polynomial"}}generateId(){return`function_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}snapPoint(e){const s=this.context.state.getState();if(s.snapToGrid){const n=Le.getState(),o=Ze(s.viewport,n.gridScale,n.snapPrecision);return this.context.math.snapToGrid(e,o)}return e}evaluateFunction(e,s){try{const n=e.replace(/\bx\b/g,`(${s})`).replace(/\^/g,"**").replace(/sin/g,"Math.sin").replace(/cos/g,"Math.cos").replace(/tan/g,"Math.tan").replace(/log/g,"Math.log").replace(/ln/g,"Math.log").replace(/exp/g,"Math.exp").replace(/sqrt/g,"Math.sqrt").replace(/abs/g,"Math.abs").replace(/pi/g,"Math.PI").replace(/e\b/g,"Math.E"),i=new Function("x",`return ${n}`)(s);if(typeof i=="number"&&!isNaN(i)&&isFinite(i))return i}catch{}return null}generateFunctionPoints(e,s,n){const o=[],i=(s.max-s.min)/(n*(s.max-s.min));for(let c=s.min;c<=s.max;c+=i){const a=this.evaluateFunction(e,c);a!==null&&o.push({x:c,y:a})}return o}detectFunctionType(e){return e.includes("sin")||e.includes("cos")||e.includes("tan")?"trigonometric":e.includes("exp")||e.includes("e^")?"exponential":e.includes("log")||e.includes("ln")?"logarithmic":/x\^\d+|x\*\*\d+/.test(e)?"polynomial":"custom"}getDefaultEquation(e){switch(e){case"polynomial":return"x^2";case"trigonometric":return"sin(x)";case"exponential":return"exp(x)";case"logarithmic":return"log(x)";default:return"x^2"}}findFunctionAtPoint(e){const s=this.context.canvas.getAllObjects(),n=.3;for(const o of s)if(o.type==="function"){const i=o;for(let c=0;c<i.properties.points.length-1;c++){const a=i.properties.points[c],h=i.properties.points[c+1];if(!a||!h)continue;const x=h.x-a.x,S=h.y-a.y,T=Math.sqrt(x*x+S*S);if(T===0)continue;const $=Math.max(0,Math.min(1,((e.x-a.x)*x+(e.y-a.y)*S)/(T*T))),F={x:a.x+$*x,y:a.y+$*S};if(Math.sqrt((e.x-F.x)**2+(e.y-F.y)**2)<=n)return i}}return null}onPointerDown(e){const s={x:e.x,y:e.y},n=this.snapPoint(this.context.canvas.screenToWorld(s)),o=this.findFunctionAtPoint(n);if(o&&this.context.state.getState().selectedObjects.includes(o.id)){const c=o.properties.domain,a=this.evaluateFunction(o.properties.equation,c.min),h=this.evaluateFunction(o.properties.equation,c.max);if(a!==null&&Math.abs(n.x-c.min)<.5&&Math.abs(n.y-a)<.5){this.state.currentFunction=o,this.state.dragTarget="domain-start",this.state.isCreating=!1;return}else if(h!==null&&Math.abs(n.x-c.max)<.5&&Math.abs(n.y-h)<.5){this.state.currentFunction=o,this.state.dragTarget="domain-end",this.state.isCreating=!1;return}else{this.state.currentFunction=o,this.state.dragTarget="move",this.state.dragOffset={x:0,y:0},this.state.isCreating=!1;return}}if(!this.state.isCreating){if(this.context.state.getState().selectedObjects.some(T=>{const $=this.context.canvas.getObject(T);return($==null?void 0:$.type)==="function"}))return;this.state.isCreating=!0,this.state.equation=this.getDefaultEquation(this.state.functionType);const a=8,h={min:n.x-a/2,max:n.x+a/2},x=this.generateFunctionPoints(this.state.equation,h,20),S={id:this.generateId(),type:"function",properties:{equation:this.state.equation,functionType:this.detectFunctionType(this.state.equation),domain:h,points:x,resolution:20,color:"#2563eb",strokeWidth:2},visible:!0,selected:!1,zIndex:0};this.state.currentFunction=S,this.context.canvas.addObject(S)}}onPointerMove(e){if(!this.state.currentFunction)return;const s={x:e.x,y:e.y},n=this.snapPoint(this.context.canvas.screenToWorld(s));if(this.state.dragTarget==="domain-start"){const o={min:Math.min(n.x,this.state.currentFunction.properties.domain.max-.1),max:this.state.currentFunction.properties.domain.max},i=this.generateFunctionPoints(this.state.currentFunction.properties.equation,o,this.state.currentFunction.properties.resolution);this.context.canvas.updateObject(this.state.currentFunction.id,{properties:{...this.state.currentFunction.properties,domain:o,points:i}})}else if(this.state.dragTarget==="domain-end"){const o={min:this.state.currentFunction.properties.domain.min,max:Math.max(n.x,this.state.currentFunction.properties.domain.min+.1)},i=this.generateFunctionPoints(this.state.currentFunction.properties.equation,o,this.state.currentFunction.properties.resolution);this.context.canvas.updateObject(this.state.currentFunction.id,{properties:{...this.state.currentFunction.properties,domain:o,points:i}})}else if(this.state.dragTarget==="move"){if(!this.state.dragOffset){const h=(this.state.currentFunction.properties.domain.min+this.state.currentFunction.properties.domain.max)/2;this.state.dragOffset={x:n.x-h,y:0}}(this.state.currentFunction.properties.domain.min+this.state.currentFunction.properties.domain.max)/2;const o=n.x-this.state.dragOffset.x,i=this.state.currentFunction.properties.domain.max-this.state.currentFunction.properties.domain.min,c={min:o-i/2,max:o+i/2},a=this.generateFunctionPoints(this.state.currentFunction.properties.equation,c,this.state.currentFunction.properties.resolution);this.context.canvas.updateObject(this.state.currentFunction.id,{properties:{...this.state.currentFunction.properties,domain:c,points:a}})}this.context.events.emit("function:update",{functionId:this.state.currentFunction.id,function:this.context.canvas.getObject(this.state.currentFunction.id)})}onPointerUp(e){this.state.isCreating&&this.state.currentFunction&&(this.context.events.emit("function:created",{functionId:this.state.currentFunction.id,function:this.context.canvas.getObject(this.state.currentFunction.id)}),this.context.events.emit("tool:creation-complete",{toolId:this.id,objectId:this.state.currentFunction.id})),this.state={...this.state,isCreating:!1,currentFunction:null,dragTarget:null,dragOffset:null}}}function us(){return new xs}class ps{constructor(){ae(this,"id","area-counter");ae(this,"name","Area Counter");ae(this,"context");ae(this,"badges",new Map);ae(this,"badgeElements",new Map)}init(e){this.context=e,e.events.on("rectangle:created",this.handleRectangleCreated.bind(this)),e.events.on("rectangle:update",this.handleRectangleUpdated.bind(this)),e.events.on("object:removed",this.handleObjectRemoved.bind(this)),this.createBadgesForExistingRectangles();const s=e.state.subscribe(n=>{this.updateBadgePositions()});this.unsubscribeFromState=s}destroy(){this.context.events.off("rectangle:created",this.handleRectangleCreated.bind(this)),this.context.events.off("rectangle:update",this.handleRectangleUpdated.bind(this)),this.context.events.off("object:removed",this.handleObjectRemoved.bind(this)),this.unsubscribeFromState&&this.unsubscribeFromState(),this.badgeElements.forEach(e=>{e.remove()}),this.badgeElements.clear(),this.badges.clear()}createBadgesForExistingRectangles(){this.context.canvas.getAllObjects().forEach(s=>{s.type==="rectangle"&&this.createBadge(s)})}handleRectangleCreated(e){this.createBadge(e.rectangle)}handleRectangleUpdated(e){this.updateBadge(e.rectangle)}handleObjectRemoved(e){this.removeBadge(e.objectId)}createBadge(e){const s={rectangleId:e.id,x:e.properties.x,y:e.properties.y,width:e.properties.width,height:e.properties.height,area:e.properties.area,visible:!0};this.badges.set(e.id,s),this.createBadgeElement(s)}updateBadge(e){const s=this.badges.get(e.id);s&&(s.x=e.properties.x,s.y=e.properties.y,s.width=e.properties.width,s.height=e.properties.height,s.area=e.properties.area,this.updateBadgeElement(s))}removeBadge(e){const s=this.badgeElements.get(e);s&&(s.remove(),this.badgeElements.delete(e)),this.badges.delete(e)}createBadgeElement(e){const s=document.createElement("div");s.className="area-badge",s.style.cssText=`
      position: absolute;
      background: rgba(34, 197, 94, 0.9);
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 600;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
      white-space: nowrap;
      pointer-events: none;
      z-index: 1000;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(34, 197, 94, 1);
    `,(document.querySelector("[data-grix-canvas]")||document.body).appendChild(s),this.badgeElements.set(e.rectangleId,s),this.updateBadgeElement(e)}updateBadgeElement(e){const s=this.badgeElements.get(e.rectangleId);if(!s)return;const n=e.x+e.width/2,o=e.y+e.height/2,i=this.context.canvas.worldToScreen({x:n,y:o}),c=this.formatArea(e.area,e.width,e.height);s.textContent=c;const a=s.getBoundingClientRect();s.style.left=`${i.x-a.width/2}px`,s.style.top=`${i.y-a.height/2}px`,s.style.display="none"}formatArea(e,s,n){return""}updateBadgePositions(){this.badges.forEach(e=>{this.updateBadgeElement(e)})}showBadge(e){const s=this.badges.get(e);s&&(s.visible=!0,this.updateBadgeElement(s))}hideBadge(e){const s=this.badges.get(e);if(s){s.visible=!1;const n=this.badgeElements.get(e);n&&(n.style.display="none")}}showAllBadges(){this.badges.forEach((e,s)=>{this.showBadge(s)})}hideAllBadges(){this.badges.forEach((e,s)=>{this.hideBadge(s)})}}function Nt(){return new ps}function gs(){const{registerPlugin:r}=nt(),e=j.useRef(!1);return j.useEffect(()=>{if(e.current)return;const s=Ot(),n=Dt(),o=ls(),i=hs(),c=us(),a=Nt();return r(s),r(n),r(o),r(i),r(c),r(a),e.current=!0,()=>{}},[r]),t.jsxs("div",{className:"flex flex-col h-screen bg-gray-50",children:[t.jsx(Tt,{}),t.jsx("div",{className:"flex-1 relative","data-grix-canvas":!0,children:t.jsx(kt,{width:window.innerWidth,height:window.innerHeight-60,className:"absolute inset-0"})})]})}function ys(){return t.jsx(Ft,{children:t.jsx(mt,{children:t.jsx(Ft,{children:t.jsx(gs,{})})})})}const fs="0.1.0";ye.Canvas=kt,ye.GrixApp=ys,ye.PluginManagerProvider=mt,ye.ToolBar=Tt,ye.createAreaCounter=Nt,ye.createRayTool=Ot,ye.createRectangleTool=Dt,ye.useCanvasStore=Oe,ye.useInputSystem=bt,ye.usePluginManager=nt,ye.version=fs,Object.defineProperty(ye,Symbol.toStringTag,{value:"Module"})});
