(function(C,u){typeof exports=="object"&&typeof module<"u"?u(exports,require("react")):typeof define=="function"&&define.amd?define(["exports","react"],u):(C=typeof globalThis<"u"?globalThis:C||self,u(C.GrixUI={},C.React))})(this,function(C,u){"use strict";var De=Object.defineProperty;var Ge=(C,u,G)=>u in C?De(C,u,{enumerable:!0,configurable:!0,writable:!0,value:G}):C[u]=G;var I=(C,u,G)=>Ge(C,typeof u!="symbol"?u+"":u,G);var G={exports:{}},H={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var se;function ye(){if(se)return H;se=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(r,i,o){var a=null;if(o!==void 0&&(a=""+o),i.key!==void 0&&(a=""+i.key),"key"in i){o={};for(var d in i)d!=="key"&&(o[d]=i[d])}else o=i;return i=o.ref,{$$typeof:n,type:r,key:a,ref:i!==void 0?i:null,props:o}}return H.Fragment=e,H.jsx=t,H.jsxs=t,H}var V={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ie;function me(){return ie||(ie=1,process.env.NODE_ENV!=="production"&&function(){function n(s){if(s==null)return null;if(typeof s=="function")return s.$$typeof===J?null:s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case E:return"Fragment";case P:return"Profiler";case h:return"StrictMode";case A:return"Suspense";case m:return"SuspenseList";case z:return"Activity"}if(typeof s=="object")switch(typeof s.tag=="number"&&console.error("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),s.$$typeof){case y:return"Portal";case b:return(s.displayName||"Context")+".Provider";case j:return(s._context.displayName||"Context")+".Consumer";case x:var g=s.render;return s=s.displayName,s||(s=g.displayName||g.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case N:return g=s.displayName||null,g!==null?g:n(s.type)||"Memo";case B:g=s._payload,s=s._init;try{return n(s(g))}catch{}}return null}function e(s){return""+s}function t(s){try{e(s);var g=!1}catch{g=!0}if(g){g=console;var S=g.error,k=typeof Symbol=="function"&&Symbol.toStringTag&&s[Symbol.toStringTag]||s.constructor.name||"Object";return S.call(g,"The provided key is an unsupported type %s. This value must be coerced to a string before using it here.",k),e(s)}}function r(s){if(s===E)return"<>";if(typeof s=="object"&&s!==null&&s.$$typeof===B)return"<...>";try{var g=n(s);return g?"<"+g+">":"<...>"}catch{return"<...>"}}function i(){var s=U.A;return s===null?null:s.getOwner()}function o(){return Error("react-stack-top-frame")}function a(s){if(L.call(s,"key")){var g=Object.getOwnPropertyDescriptor(s,"key").get;if(g&&g.isReactWarning)return!1}return s.key!==void 0}function d(s,g){function S(){Z||(Z=!0,console.error("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://react.dev/link/special-props)",g))}S.isReactWarning=!0,Object.defineProperty(s,"key",{get:S,configurable:!0})}function p(){var s=n(this.type);return ee[s]||(ee[s]=!0,console.error("Accessing element.ref was removed in React 19. ref is now a regular prop. It will be removed from the JSX Element type in a future release.")),s=this.props.ref,s!==void 0?s:null}function v(s,g,S,k,$,D,te,ne){return S=D.ref,s={$$typeof:c,type:s,key:g,props:D,_owner:$},(S!==void 0?S:null)!==null?Object.defineProperty(s,"ref",{enumerable:!1,get:p}):Object.defineProperty(s,"ref",{enumerable:!1,value:null}),s._store={},Object.defineProperty(s._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:0}),Object.defineProperty(s,"_debugInfo",{configurable:!1,enumerable:!1,writable:!0,value:null}),Object.defineProperty(s,"_debugStack",{configurable:!1,enumerable:!1,writable:!0,value:te}),Object.defineProperty(s,"_debugTask",{configurable:!1,enumerable:!1,writable:!0,value:ne}),Object.freeze&&(Object.freeze(s.props),Object.freeze(s)),s}function O(s,g,S,k,$,D,te,ne){var _=g.children;if(_!==void 0)if(k)if(K(_)){for(k=0;k<_.length;k++)T(_[k]);Object.freeze&&Object.freeze(_)}else console.error("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else T(_);if(L.call(g,"key")){_=n(s);var q=Object.keys(g).filter(function(Ne){return Ne!=="key"});k=0<q.length?"{key: someKey, "+q.join(": ..., ")+": ...}":"{key: someKey}",w[_+k]||(q=0<q.length?"{"+q.join(": ..., ")+": ...}":"{}",console.error(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,k,_,q,_),w[_+k]=!0)}if(_=null,S!==void 0&&(t(S),_=""+S),a(g)&&(t(g.key),_=""+g.key),"key"in g){S={};for(var re in g)re!=="key"&&(S[re]=g[re])}else S=g;return _&&d(S,typeof s=="function"?s.displayName||s.name||"Unknown":s),v(s,_,D,$,i(),S,te,ne)}function T(s){typeof s=="object"&&s!==null&&s.$$typeof===c&&s._store&&(s._store.validated=1)}var M=u,c=Symbol.for("react.transitional.element"),y=Symbol.for("react.portal"),E=Symbol.for("react.fragment"),h=Symbol.for("react.strict_mode"),P=Symbol.for("react.profiler"),j=Symbol.for("react.consumer"),b=Symbol.for("react.context"),x=Symbol.for("react.forward_ref"),A=Symbol.for("react.suspense"),m=Symbol.for("react.suspense_list"),N=Symbol.for("react.memo"),B=Symbol.for("react.lazy"),z=Symbol.for("react.activity"),J=Symbol.for("react.client.reference"),U=M.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,L=Object.prototype.hasOwnProperty,K=Array.isArray,X=console.createTask?console.createTask:function(){return null};M={"react-stack-bottom-frame":function(s){return s()}};var Z,ee={},f=M["react-stack-bottom-frame"].bind(M,o)(),R=X(r(o)),w={};V.Fragment=E,V.jsx=function(s,g,S,k,$){var D=1e4>U.recentlyCreatedOwnerStacks++;return O(s,g,S,!1,k,$,D?Error("react-stack-top-frame"):f,D?X(r(s)):R)},V.jsxs=function(s,g,S,k,$){var D=1e4>U.recentlyCreatedOwnerStacks++;return O(s,g,S,!0,k,$,D?Error("react-stack-top-frame"):f,D?X(r(s)):R)}}()),V}var oe;function be(){return oe||(oe=1,process.env.NODE_ENV==="production"?G.exports=ye():G.exports=me()),G.exports}var l=be();const W={distance(n,e){const t=e.x-n.x,r=e.y-n.y;return Math.sqrt(t*t+r*r)},slope(n,e){const t=e.x-n.x,r=e.y-n.y;return Math.abs(t)<Number.EPSILON?t===0||t>0?1/0:-1/0:r/t},angle(n,e){const t=e.x-n.x,r=e.y-n.y;return Math.atan2(r,t)},magnitude(n){return Math.sqrt(n.x*n.x+n.y*n.y)},normalize(n){const e=this.magnitude(n);return e===0?{x:0,y:0}:{x:n.x/e,y:n.y/e}},snapToGrid(n,e){return{x:Math.round(n.x/e)*e,y:Math.round(n.y/e)*e}},calculateArea(n){return Math.abs(n.properties.width*n.properties.height)},boundsContainPoint(n,e){return e.x>=n.x&&e.x<=n.x+n.width&&e.y>=n.y&&e.y<=n.y+n.height},boundsIntersect(n,e){return!(n.x+n.width<e.x||e.x+e.width<n.x||n.y+n.height<e.y||e.y+e.height<n.y)},gcd(n,e){for(n=Math.abs(n),e=Math.abs(e);e!==0;){const t=e;e=n%e,n=t}return n},simplifyFraction(n,e){if(e===0)return[n,1];const t=this.gcd(n,e);return[n/t,e/t]},worldToScreen(n,e,t){const r=t.width/2,i=t.height/2,o=(n.x-e.center.x)*e.zoom,a=(n.y-e.center.y)*e.zoom;return{x:r+o,y:i-a}},screenToWorld(n,e,t){const r=t.width/2,i=t.height/2,o=(n.x-r)/e.zoom,a=(i-n.y)/e.zoom;return{x:e.center.x+o,y:e.center.y+a}}},Y={detectCapabilities(){const n="ontouchstart"in window||navigator.maxTouchPoints>0,e=n&&navigator.maxTouchPoints>1,t=!0,r=window.matchMedia("(hover: hover)").matches;return{hasTouch:n,hasPencil:e,hasKeyboard:t,hasHover:r,maxTouchPoints:navigator.maxTouchPoints||0,supportsPressure:"force"in Touch.prototype,supportsTilt:"altitudeAngle"in Touch.prototype}},normalizePointerEvent(n){let e="mouse";return n.pointerType==="touch"?e="touch":n.pointerType==="pen"&&(e="pen"),{type:e,pressure:n.pressure||0,tiltX:n.tiltX||0,tiltY:n.tiltY||0,x:n.clientX,y:n.clientY,timestamp:n.timeStamp,isPrimary:n.isPrimary,pointerId:n.pointerId}},getTouchTargetSize(n){switch(n){case"pen":return 32;case"touch":return 44;case"mouse":return 24;default:return 44}}};class ve{constructor(){this.listeners=new Map}on(e,t){this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(t)}off(e,t){const r=this.listeners.get(e);if(r){const i=r.indexOf(t);i>-1&&r.splice(i,1)}}emit(e,t){const r=this.listeners.get(e);r&&r.forEach(i=>{try{i(t)}catch(o){console.error(`Error in event handler for ${e}:`,o)}})}clear(){this.listeners.clear()}getEvents(){return Array.from(this.listeners.keys())}getListenerCount(e){var t;return((t=this.listeners.get(e))==null?void 0:t.length)||0}}const ae=n=>{let e;const t=new Set,r=(v,O)=>{const T=typeof v=="function"?v(e):v;if(!Object.is(T,e)){const M=e;e=O??(typeof T!="object"||T===null)?T:Object.assign({},e,T),t.forEach(c=>c(e,M))}},i=()=>e,d={setState:r,getState:i,getInitialState:()=>p,subscribe:v=>(t.add(v),()=>t.delete(v))},p=e=n(r,i,d);return d},Pe=n=>n?ae(n):ae,Te=n=>n;function je(n,e=Te){const t=u.useSyncExternalStore(n.subscribe,()=>e(n.getState()),()=>e(n.getInitialState()));return u.useDebugValue(t),t}const we=n=>{const e=Pe(n),t=r=>je(e,r);return Object.assign(t,e),t},Se=n=>we,Ee=n=>(e,t,r)=>{const i=r.subscribe;return r.subscribe=(a,d,p)=>{let v=a;if(d){const O=(p==null?void 0:p.equalityFn)||Object.is;let T=a(r.getState());v=M=>{const c=a(M);if(!O(T,c)){const y=T;d(T=c,y)}},p!=null&&p.fireImmediately&&d(T,T)}return i(v)},n(e,t,r)},F=Se()(Ee((n,e)=>({viewport:{center:{x:0,y:0},zoom:20,bounds:{x:-10,y:-10,width:20,height:20}},objects:[],selectedObjects:[],snapToGrid:!0,gridDensity:"fine",canvasSize:{width:800,height:600},setViewport:t=>{n(r=>({viewport:{...r.viewport,...t}}))},addObject:t=>{n(r=>({objects:[...r.objects,t]}))},removeObject:t=>{n(r=>({objects:r.objects.filter(i=>i.id!==t),selectedObjects:r.selectedObjects.filter(i=>i!==t)}))},updateObject:(t,r)=>{n(i=>({objects:i.objects.map(o=>o.id===t?{...o,...r}:o)}))},selectObject:(t,r=!1)=>{n(i=>r?{selectedObjects:i.selectedObjects.includes(t)?i.selectedObjects.filter(a=>a!==t):[...i.selectedObjects,t]}:{selectedObjects:[t]})},clearSelection:()=>{n({selectedObjects:[]})},setSnapToGrid:t=>{n({snapToGrid:t})},setGridDensity:t=>{n({gridDensity:t})},setCanvasSize:t=>{n({canvasSize:t})},getObject:t=>e().objects.find(r=>r.id===t),getAllObjects:()=>e().objects,getSelectedObjects:()=>{const t=e();return t.objects.filter(r=>t.selectedObjects.includes(r.id))},screenToWorld:t=>{const{viewport:r,canvasSize:i}=e();return W.screenToWorld(t,r,i)},worldToScreen:t=>{const{viewport:r,canvasSize:i}=e();return W.worldToScreen(t,r,i)}}))),Ce=()=>{const n=F.getState();return{addObject:n.addObject,removeObject:n.removeObject,updateObject:n.updateObject,getObject:n.getObject,getAllObjects:n.getAllObjects,screenToWorld:n.screenToWorld,worldToScreen:n.worldToScreen}},Oe=()=>({getState:()=>{const n=F.getState();return{viewport:n.viewport,objects:n.objects,selectedObjects:n.selectedObjects,snapToGrid:n.snapToGrid,gridDensity:n.gridDensity}},setState:n=>{F.setState(n)},subscribe:n=>F.subscribe(e=>({viewport:e.viewport,objects:e.objects,selectedObjects:e.selectedObjects,snapToGrid:e.snapToGrid,gridDensity:e.gridDensity}),n)}),ce=u.createContext(null);function Q(){const n=u.useContext(ce);if(!n)throw new Error("usePluginManager must be used within PluginManagerProvider");return n}function le({children:n}){const[e]=u.useState(()=>new ve),[t]=u.useState(()=>new Map),[r]=u.useState(()=>new Map),[i,o]=u.useState(null),[a]=u.useState(()=>Ce()),[d]=u.useState(()=>Oe()),[p]=u.useState(()=>({distance:W.distance,slope:W.slope,snapToGrid:W.snapToGrid,calculateArea:W.calculateArea})),v=c=>{if(t.has(c.id)){console.warn(`Plugin ${c.id} is already registered`);return}const y={canvas:a,events:e,state:d,math:p};t.set(c.id,c),r.set(c.id,y);try{c.init(y),console.log(`Plugin ${c.id} initialized successfully`)}catch(E){console.error(`Failed to initialize plugin ${c.id}:`,E),t.delete(c.id),r.delete(c.id)}},O=c=>{var E;const y=t.get(c);if(y){try{(E=y.destroy)==null||E.call(y)}catch(h){console.error(`Error destroying plugin ${c}:`,h)}t.delete(c),r.delete(c),i===c&&o(null)}},T=()=>Array.from(t.values());u.useEffect(()=>{e.emit("tool:changed",{previous:null,current:i})},[i,e]),u.useEffect(()=>{const c=P=>j=>{var x,A,m;const b=i?t.get(i):null;if(b)try{switch(P){case"pointer:down":(x=b.onPointerDown)==null||x.call(b,j);break;case"pointer:move":(A=b.onPointerMove)==null||A.call(b,j);break;case"pointer:up":(m=b.onPointerUp)==null||m.call(b,j);break}}catch(N){console.error(`Error in plugin ${i} handling ${P}:`,N)}},y=c("pointer:down"),E=c("pointer:move"),h=c("pointer:up");return e.on("pointer:down",y),e.on("pointer:move",E),e.on("pointer:up",h),()=>{e.off("pointer:down",y),e.off("pointer:move",E),e.off("pointer:up",h)}},[i,t,e]);const M={eventBus:e,registerPlugin:v,unregisterPlugin:O,getActivePlugins:T,activeTool:i,setActiveTool:o};return l.jsx(ce.Provider,{value:M,children:n})}function Re(){const{eventBus:n}=Q();return{handlePointerDown:i=>{n.emit("pointer:down",i)},handlePointerMove:i=>{n.emit("pointer:move",i)},handlePointerUp:i=>{n.emit("pointer:up",i)}}}function ue(n,e,t={}){const[r,i]=u.useState(null),[o,a]=u.useState(new Map),d={enableGestures:!0,touchTargetSize:44,preventScrolling:!0,...t};u.useEffect(()=>{const h=Y.detectCapabilities();i(h)},[]);const[p,v]=u.useState({isGesturing:!1,startTime:0,startDistance:0,lastTapTime:0,tapCount:0}),O=u.useCallback(h=>{const P=Array.from(h.values());if(P.length<2)return 0;const j=P[0],b=P[1];if(!j||!b)return 0;const x=j.x-b.x,A=j.y-b.y;return Math.sqrt(x*x+A*A)},[]),T=u.useCallback(h=>{const P=Array.from(h.values());if(P.length===0)return{x:0,y:0};const j=P.reduce((b,x)=>({x:b.x+x.x,y:b.y+x.y}),{x:0,y:0});return{x:j.x/P.length,y:j.y/P.length}},[]),M=u.useCallback(h=>{var j;if(!n.current)return;d.preventScrolling&&h.preventDefault();const P=Y.normalizePointerEvent(h);a(b=>{const x=new Map(b);if(x.set(h.pointerId,P),d.enableGestures&&x.size>=2){const A=O(x);v(m=>({...m,isGesturing:!0,startTime:h.timeStamp,startDistance:A}))}return x}),n.current.setPointerCapture(h.pointerId),(j=e.onPointerDown)==null||j.call(e,P)},[n,e,d,O]),c=u.useCallback(h=>{var j;const P=Y.normalizePointerEvent(h);a(b=>{var A,m;const x=new Map(b);if(x.set(h.pointerId,P),d.enableGestures&&x.size>=2){const N=O(x),B=T(x);if(p.isGesturing&&p.startDistance>0){const z=N/p.startDistance;(A=e.onGesture)==null||A.call(e,{type:"pinch",center:B,scale:z,touches:x.size})}}else if(x.size===1&&p.isGesturing){const N=T(x);(m=e.onGesture)==null||m.call(e,{type:"pan",center:N,touches:x.size})}return x}),(j=e.onPointerMove)==null||j.call(e,P)},[e,d,O,T,p]),y=u.useCallback(h=>{var j;const P=Y.normalizePointerEvent(h);a(b=>{var A;const x=new Map(b);if(x.delete(h.pointerId),d.enableGestures&&x.size===0){const N=h.timeStamp-p.startTime<200,B=h.timeStamp-p.lastTapTime;N&&!p.isGesturing&&(B<300?v(z=>({...z,tapCount:z.tapCount+1})):((A=e.onGesture)==null||A.call(e,{type:"tap",center:{x:P.x,y:P.y},touches:1}),v(z=>({...z,tapCount:1,lastTapTime:h.timeStamp})))),v(z=>({...z,isGesturing:!1}))}return x}),n.current&&n.current.releasePointerCapture(h.pointerId),(j=e.onPointerUp)==null||j.call(e,P)},[n,e,d,p]),E=u.useCallback(h=>{var j;const P=Y.normalizePointerEvent(h);a(b=>{const x=new Map(b);return x.delete(h.pointerId),x}),v(b=>({...b,isGesturing:!1})),(j=e.onPointerCancel)==null||j.call(e,P)},[e]);return u.useEffect(()=>{const h=n.current;if(!h)return;h.addEventListener("pointerdown",M),h.addEventListener("pointermove",c),h.addEventListener("pointerup",y),h.addEventListener("pointercancel",E);const P=j=>j.preventDefault();return h.addEventListener("contextmenu",P),()=>{h.removeEventListener("pointerdown",M),h.removeEventListener("pointermove",c),h.removeEventListener("pointerup",y),h.removeEventListener("pointercancel",E),h.removeEventListener("contextmenu",P)}},[n,M,c,y,E]),{capabilities:r,activePointers:Array.from(o.values()),isGesturing:p.isGesturing,touchTargetSize:r?Y.getTouchTargetSize(r.hasTouch?"touch":"mouse"):d.touchTargetSize}}function de({width:n=800,height:e=600,className:t="",onObjectInteraction:r}){const i=u.useRef(null),{viewport:o,setViewport:a,objects:d,snapToGrid:p,gridDensity:v,canvasSize:O,setCanvasSize:T,screenToWorld:M,worldToScreen:c}=F(),y=Re();u.useEffect(()=>{T({width:n,height:e})},[n,e,T]);const E=u.useRef({isPanning:!1,startPoint:{x:0,y:0},startCenter:{x:0,y:0}}),h=u.useCallback(f=>{y.handlePointerDown(f),(f.type==="touch"||f.type==="mouse")&&(E.current={isPanning:!0,startPoint:{x:f.x,y:f.y},startCenter:{...o.center}})},[o.center,y]),P=u.useCallback(f=>{if(y.handlePointerMove(f),E.current.isPanning){const R=(f.x-E.current.startPoint.x)/o.zoom,w=(f.y-E.current.startPoint.y)/o.zoom;a({center:{x:E.current.startCenter.x-R,y:E.current.startCenter.y+w}})}},[o.zoom,a,y]),j=u.useCallback(f=>{y.handlePointerUp(f),E.current.isPanning=!1},[y]),b=u.useCallback(f=>{switch(f.type){case"pinch":if(f.scale){const R=Math.max(.1,Math.min(10,o.zoom*f.scale));a({zoom:R})}break}},[o.zoom,a]),{capabilities:x,touchTargetSize:A}=ue(i,{onPointerDown:h,onPointerMove:P,onPointerUp:j,onGesture:b},{enableGestures:!0,preventScrolling:!0}),m=v==="fine"?1:10,B=m*o.zoom>=8,z={left:o.center.x-n/2/o.zoom,right:o.center.x+n/2/o.zoom,top:o.center.y+e/2/o.zoom,bottom:o.center.y-e/2/o.zoom},J=Math.floor(z.left/m)*m,U=Math.ceil(z.right/m)*m,L=Math.floor(z.bottom/m)*m,K=Math.ceil(z.top/m)*m,X=[],Z=[];if(B){for(let f=J;f<=U;f+=m){const R=c({x:f,y:0}).x,w=Math.abs(f)<m/2,s=f%(m*5)===0;X.push(l.jsx("line",{x1:R,y1:0,x2:R,y2:e,stroke:w?"#374151":s?"#9CA3AF":"#E5E7EB",strokeWidth:w?2:s?1:.5,opacity:w?1:s?.6:.3},`v${f}`))}for(let f=L;f<=K;f+=m){const R=c({x:0,y:f}).y,w=Math.abs(f)<m/2,s=f%(m*5)===0;Z.push(l.jsx("line",{x1:0,y1:R,x2:n,y2:R,stroke:w?"#374151":s?"#9CA3AF":"#E5E7EB",strokeWidth:w?2:s?1:.5,opacity:w?1:s?.6:.3},`h${f}`))}}const ee=f=>{switch(f.type){case"ray":const R=c(f.properties.startPoint),w=c(f.properties.endPoint);return l.jsxs("g",{children:[l.jsx("line",{x1:R.x,y1:R.y,x2:w.x,y2:w.y,stroke:"#2563eb",strokeWidth:2,markerEnd:"url(#arrowhead)"}),l.jsx("circle",{cx:R.x,cy:R.y,r:A/4,fill:"#2563eb",style:{cursor:"pointer"}}),l.jsx("circle",{cx:w.x,cy:w.y,r:A/4,fill:"#2563eb",style:{cursor:"pointer"}})]},f.id);case"rectangle":const s=c({x:f.properties.x,y:f.properties.y+f.properties.height}),g=f.properties.width*o.zoom,S=f.properties.height*o.zoom;return l.jsxs("g",{children:[l.jsx("rect",{x:s.x,y:s.y,width:g,height:S,fill:"rgba(34, 197, 94, 0.2)",stroke:"#22c55e",strokeWidth:2,style:{cursor:"pointer"}}),l.jsx("circle",{cx:s.x,cy:s.y,r:A/6,fill:"#22c55e",style:{cursor:"nw-resize"}}),l.jsx("circle",{cx:s.x+g,cy:s.y+S,r:A/6,fill:"#22c55e",style:{cursor:"se-resize"}})]},f.id);default:return null}};return l.jsxs("div",{className:`relative ${t}`,style:{width:n,height:e},children:[l.jsxs("svg",{ref:i,width:n,height:e,className:"absolute inset-0 bg-white",style:{touchAction:"none"},children:[l.jsx("defs",{children:l.jsx("marker",{id:"arrowhead",markerWidth:"10",markerHeight:"7",refX:"9",refY:"3.5",orient:"auto",children:l.jsx("polygon",{points:"0 0, 10 3.5, 0 7",fill:"#2563eb"})})}),l.jsxs("g",{className:"grid",children:[X,Z]}),l.jsx("g",{className:"objects",children:d.map(ee)}),B&&l.jsxs("g",{className:"labels",fontSize:"12",fill:"#6B7280",children:[Array.from({length:Math.floor((U-J)/m)+1},(f,R)=>{const w=J+R*m;if(Math.abs(w)<m/2)return null;const s=c({x:w,y:0});return l.jsx("text",{x:s.x,y:s.y+20,textAnchor:"middle",fontSize:"10",children:w},`xlabel${w}`)}),Array.from({length:Math.floor((K-L)/m)+1},(f,R)=>{const w=L+R*m;if(Math.abs(w)<m/2)return null;const s=c({x:0,y:w});return l.jsx("text",{x:s.x-15,y:s.y+4,textAnchor:"middle",fontSize:"10",children:w},`ylabel${w}`)}),l.jsx("text",{x:c({x:0,y:0}).x+10,y:c({x:0,y:0}).y-10,fontSize:"10",fill:"#374151",children:"(0,0)"})]})]}),x&&l.jsxs("div",{className:"absolute top-2 left-2 text-xs text-gray-500 bg-white/80 p-2 rounded",children:[l.jsxs("div",{children:["Input: ",x.hasTouch?"👆":"🖱️"," ",x.hasPencil?"✏️":""]}),l.jsxs("div",{children:["Zoom: ",o.zoom.toFixed(2),"x"]}),l.jsxs("div",{children:["Center: (",o.center.x.toFixed(1),", ",o.center.y.toFixed(1),")"]})]})]})}const he=[{id:"ray-tool",name:"Ray Builder",icon:"📏",description:"Create and edit rays to explore slopes and fractions"},{id:"rectangle-tool",name:"Rectangle Selector",icon:"⬜",description:"Create rectangles to explore area and multiplication"}];function fe({className:n=""}){var o;const{activeTool:e,setActiveTool:t}=Q(),r=a=>{t(e===a?null:a)},i=()=>{t(null)};return l.jsxs("div",{className:`flex items-center gap-2 p-2 bg-white border-b border-gray-200 ${n}`,children:[l.jsxs("div",{className:"flex items-center gap-2 mr-4",children:[l.jsx("div",{className:"text-2xl",children:"🟦"}),l.jsx("h1",{className:"text-lg font-semibold text-gray-800",children:"Grix"})]}),l.jsxs("div",{className:"flex items-center gap-1",children:[he.map(a=>l.jsxs("button",{onClick:()=>r(a.id),className:`
              flex items-center gap-2 px-3 py-2 rounded-lg border transition-all
              ${e===a.id?"bg-blue-100 border-blue-300 text-blue-700":"bg-gray-50 border-gray-200 text-gray-700 hover:bg-gray-100"}
            `,title:a.description,children:[l.jsx("span",{className:"text-lg",children:a.icon}),l.jsx("span",{className:"text-sm font-medium",children:a.name})]},a.id)),e&&l.jsx("button",{onClick:i,className:"ml-2 px-3 py-2 rounded-lg border border-gray-200 bg-gray-50 text-gray-700 hover:bg-gray-100 transition-all",title:"Clear tool selection",children:l.jsx("span",{className:"text-sm",children:"✕ Clear"})})]}),l.jsx("div",{className:"ml-auto flex items-center gap-4 text-sm text-gray-500",children:e?l.jsxs("span",{className:"flex items-center gap-1",children:[l.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full"}),((o=he.find(a=>a.id===e))==null?void 0:o.name)||"Active Tool"]}):l.jsxs("span",{className:"flex items-center gap-1",children:[l.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full"}),"Select a tool to begin"]})})]})}class Ae{constructor(){I(this,"id","ray-tool");I(this,"name","Ray Builder");I(this,"context");I(this,"state",{isCreating:!1,startPoint:null,currentRay:null,dragTarget:null})}init(e){this.context=e,e.events.on("tool:changed",this.handleToolChange.bind(this))}destroy(){this.context.events.off("tool:changed",this.handleToolChange.bind(this))}handleToolChange(e){e.current!==this.id&&this.cancelCreation()}cancelCreation(){this.state.currentRay&&this.state.isCreating&&this.context.canvas.removeObject(this.state.currentRay.id),this.state={isCreating:!1,startPoint:null,currentRay:null,dragTarget:null}}generateId(){return`ray_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}snapPoint(e){const t=this.context.state.getState();if(t.snapToGrid){const r=t.gridDensity==="fine"?1:10;return this.context.math.snapToGrid(e,r)}return e}findNearestHandle(e,t=20){const r=this.context.canvas.screenToWorld(e),i=this.context.canvas.getAllObjects();for(const o of i)if(o.type==="ray"){const a=o;this.context.math.distance(r,a.properties.startPoint),this.context.math.distance(r,a.properties.endPoint);const d=this.context.canvas.worldToScreen(a.properties.startPoint),p=this.context.canvas.worldToScreen(a.properties.endPoint),v=this.context.math.distance(e,d),O=this.context.math.distance(e,p);if(v<=t)return{rayId:a.id,handle:"start"};if(O<=t)return{rayId:a.id,handle:"end"}}return null}onPointerDown(e){const t={x:e.x,y:e.y},r=this.snapPoint(this.context.canvas.screenToWorld(t)),i=this.findNearestHandle(t);if(i){const o=this.context.canvas.getObject(i.rayId);if(o){this.state.currentRay=o,this.state.dragTarget=i.handle,this.state.isCreating=!1;return}}if(!this.state.isCreating){this.state.isCreating=!0,this.state.startPoint=r;const o={id:this.generateId(),type:"ray",properties:{startPoint:r,endPoint:{...r},slope:0,yIntercept:r.y},visible:!0,selected:!1};this.state.currentRay=o,this.context.canvas.addObject(o)}}onPointerMove(e){if(!this.state.currentRay)return;const t={x:e.x,y:e.y},r=this.snapPoint(this.context.canvas.screenToWorld(t));if(this.state.isCreating){const i=this.context.math.slope(this.state.currentRay.properties.startPoint,r),o=r.y-i*r.x;this.context.canvas.updateObject(this.state.currentRay.id,{properties:{...this.state.currentRay.properties,endPoint:r,slope:i,yIntercept:isFinite(i)?o:this.state.currentRay.properties.startPoint.y}})}else if(this.state.dragTarget){const i=this.context.canvas.getObject(this.state.currentRay.id);if(!i)return;const o={...i.properties};this.state.dragTarget==="start"?o.startPoint=r:o.endPoint=r;const a=this.context.math.slope(o.startPoint,o.endPoint);o.slope=a,o.yIntercept=isFinite(a)?o.startPoint.y-a*o.startPoint.x:o.startPoint.y,this.context.canvas.updateObject(this.state.currentRay.id,{properties:o})}this.context.events.emit("ray:update",{rayId:this.state.currentRay.id,ray:this.context.canvas.getObject(this.state.currentRay.id)})}onPointerUp(e){if(this.state.isCreating&&this.state.currentRay){const t={x:e.x,y:e.y},r=this.snapPoint(this.context.canvas.screenToWorld(t)),i=this.state.currentRay.properties.startPoint;this.context.math.distance(i,r)<.1?this.context.canvas.removeObject(this.state.currentRay.id):this.context.events.emit("ray:created",{rayId:this.state.currentRay.id,ray:this.state.currentRay})}this.state={isCreating:!1,startPoint:null,currentRay:null,dragTarget:null}}}function ge(){return new Ae}class Me{constructor(){I(this,"id","rectangle-tool");I(this,"name","Rectangle Selector");I(this,"context");I(this,"state",{isCreating:!1,startPoint:null,currentRectangle:null,dragTarget:null,dragOffset:null})}init(e){this.context=e,e.events.on("tool:changed",this.handleToolChange.bind(this))}destroy(){this.context.events.off("tool:changed",this.handleToolChange.bind(this))}handleToolChange(e){e.current!==this.id&&this.cancelCreation()}cancelCreation(){this.state.currentRectangle&&this.state.isCreating&&this.context.canvas.removeObject(this.state.currentRectangle.id),this.state={isCreating:!1,startPoint:null,currentRectangle:null,dragTarget:null,dragOffset:null}}generateId(){return`rect_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}snapPoint(e){const t=this.context.state.getState();if(t.snapToGrid){const r=t.gridDensity==="fine"?1:10;return this.context.math.snapToGrid(e,r)}return e}findRectangleAtPoint(e){const t=this.context.canvas.getAllObjects();for(const r of t)if(r.type==="rectangle"){const i=r,{x:o,y:a,width:d,height:p}=i.properties;if(e.x>=o&&e.x<=o+d&&e.y>=a&&e.y<=a+p)return i}return null}isNearCorner(e,t,r=.5){const{x:i,y:o,width:a,height:d}=t.properties;return[{x:i,y:o},{x:i+a,y:o},{x:i,y:o+d},{x:i+a,y:o+d}].some(v=>this.context.math.distance(e,v)<=r)}onPointerDown(e){const t={x:e.x,y:e.y},r=this.snapPoint(this.context.canvas.screenToWorld(t)),i=this.findRectangleAtPoint(r);if(i)if(this.isNearCorner(r,i)){this.state.currentRectangle=i,this.state.dragTarget="corner",this.state.isCreating=!1;return}else{this.state.currentRectangle=i,this.state.dragTarget="move",this.state.dragOffset={x:r.x-i.properties.x,y:r.y-i.properties.y},this.state.isCreating=!1;return}this.state.isCreating=!0,this.state.startPoint=r;const o={id:this.generateId(),type:"rectangle",properties:{x:r.x,y:r.y,width:0,height:0,area:0},visible:!0,selected:!1};this.state.currentRectangle=o,this.context.canvas.addObject(o)}onPointerMove(e){if(!this.state.currentRectangle)return;const t={x:e.x,y:e.y},r=this.snapPoint(this.context.canvas.screenToWorld(t));if(this.state.isCreating&&this.state.startPoint){const i=Math.min(this.state.startPoint.x,r.x),o=Math.min(this.state.startPoint.y,r.y),a=Math.abs(r.x-this.state.startPoint.x),d=Math.abs(r.y-this.state.startPoint.y),p=a*d;this.context.canvas.updateObject(this.state.currentRectangle.id,{properties:{x:i,y:o,width:a,height:d,area:p}})}else if(this.state.dragTarget==="move"&&this.state.dragOffset){const i=r.x-this.state.dragOffset.x,o=r.y-this.state.dragOffset.y;this.context.canvas.updateObject(this.state.currentRectangle.id,{properties:{...this.state.currentRectangle.properties,x:i,y:o}})}else if(this.state.dragTarget==="corner"){const i=this.context.canvas.getObject(this.state.currentRectangle.id);if(!i)return;const{x:o,y:a,width:d,height:p}=i.properties,v=o+d/2,O=a+p/2;let T=o,M=a,c=d,y=p;r.x>v?c=r.x-o:(T=r.x,c=o+d-r.x),r.y>O?y=r.y-a:(M=r.y,y=a+p-r.y),c=Math.max(.1,c),y=Math.max(.1,y);const E=c*y;this.context.canvas.updateObject(this.state.currentRectangle.id,{properties:{x:T,y:M,width:c,height:y,area:E}})}this.context.events.emit("rectangle:update",{rectangleId:this.state.currentRectangle.id,rectangle:this.context.canvas.getObject(this.state.currentRectangle.id)})}onPointerUp(e){if(this.state.isCreating&&this.state.currentRectangle){const t=this.context.canvas.getObject(this.state.currentRectangle.id);t&&(t.properties.width<.1||t.properties.height<.1?this.context.canvas.removeObject(this.state.currentRectangle.id):this.context.events.emit("rectangle:created",{rectangleId:this.state.currentRectangle.id,rectangle:t}))}this.state={isCreating:!1,startPoint:null,currentRectangle:null,dragTarget:null,dragOffset:null}}}function pe(){return new Me}class ke{constructor(){I(this,"id","area-counter");I(this,"name","Area Counter");I(this,"context");I(this,"badges",new Map);I(this,"badgeElements",new Map)}init(e){this.context=e,e.events.on("rectangle:created",this.handleRectangleCreated.bind(this)),e.events.on("rectangle:update",this.handleRectangleUpdated.bind(this)),e.events.on("object:removed",this.handleObjectRemoved.bind(this)),this.createBadgesForExistingRectangles();const t=e.state.subscribe(r=>{this.updateBadgePositions()});this.unsubscribeFromState=t}destroy(){this.context.events.off("rectangle:created",this.handleRectangleCreated.bind(this)),this.context.events.off("rectangle:update",this.handleRectangleUpdated.bind(this)),this.context.events.off("object:removed",this.handleObjectRemoved.bind(this)),this.unsubscribeFromState&&this.unsubscribeFromState(),this.badgeElements.forEach(e=>{e.remove()}),this.badgeElements.clear(),this.badges.clear()}createBadgesForExistingRectangles(){this.context.canvas.getAllObjects().forEach(t=>{t.type==="rectangle"&&this.createBadge(t)})}handleRectangleCreated(e){this.createBadge(e.rectangle)}handleRectangleUpdated(e){this.updateBadge(e.rectangle)}handleObjectRemoved(e){this.removeBadge(e.objectId)}createBadge(e){const t={rectangleId:e.id,x:e.properties.x,y:e.properties.y,width:e.properties.width,height:e.properties.height,area:e.properties.area,visible:!0};this.badges.set(e.id,t),this.createBadgeElement(t)}updateBadge(e){const t=this.badges.get(e.id);t&&(t.x=e.properties.x,t.y=e.properties.y,t.width=e.properties.width,t.height=e.properties.height,t.area=e.properties.area,this.updateBadgeElement(t))}removeBadge(e){const t=this.badgeElements.get(e);t&&(t.remove(),this.badgeElements.delete(e)),this.badges.delete(e)}createBadgeElement(e){const t=document.createElement("div");t.className="area-badge",t.style.cssText=`
      position: absolute;
      background: rgba(34, 197, 94, 0.9);
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 600;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
      white-space: nowrap;
      pointer-events: none;
      z-index: 1000;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(34, 197, 94, 1);
    `,(document.querySelector("[data-grix-canvas]")||document.body).appendChild(t),this.badgeElements.set(e.rectangleId,t),this.updateBadgeElement(e)}updateBadgeElement(e){const t=this.badgeElements.get(e.rectangleId);if(!t)return;const r=e.x+e.width/2,i=e.y+e.height/2,o=this.context.canvas.worldToScreen({x:r,y:i}),a=this.formatArea(e.area,e.width,e.height);t.textContent=a;const d=t.getBoundingClientRect();t.style.left=`${o.x-d.width/2}px`,t.style.top=`${o.y-d.height/2}px`;const p=this.context.state.getState(),v=30,O=e.width*p.viewport.zoom,T=e.height*p.viewport.zoom;t.style.display=O>=v&&T>=v?"block":"none"}formatArea(e,t,r){const i=Math.abs(t-Math.round(t))<.001,o=Math.abs(r-Math.round(r))<.001;if(i&&o){const a=Math.round(t),d=Math.round(r);return`${a} × ${d} = ${a*d}`}return e>=1e3?`${e.toFixed(0)} sq units`:e>=10?`${e.toFixed(1)} sq units`:`${e.toFixed(2)} sq units`}updateBadgePositions(){this.badges.forEach(e=>{this.updateBadgeElement(e)})}showBadge(e){const t=this.badges.get(e);t&&(t.visible=!0,this.updateBadgeElement(t))}hideBadge(e){const t=this.badges.get(e);if(t){t.visible=!1;const r=this.badgeElements.get(e);r&&(r.style.display="none")}}showAllBadges(){this.badges.forEach((e,t)=>{this.showBadge(t)})}hideAllBadges(){this.badges.forEach((e,t)=>{this.hideBadge(t)})}}function xe(){return new ke}function _e(){const{registerPlugin:n}=Q(),e=u.useRef(!1);return u.useEffect(()=>{if(e.current)return;const t=ge(),r=pe(),i=xe();return n(t),n(r),n(i),e.current=!0,()=>{}},[n]),l.jsxs("div",{className:"flex flex-col h-screen bg-gray-50",children:[l.jsx(fe,{}),l.jsx("div",{className:"flex-1 relative","data-grix-canvas":!0,children:l.jsx(de,{width:window.innerWidth,height:window.innerHeight-60,className:"absolute inset-0"})})]})}function ze(){return l.jsx(le,{children:l.jsx(_e,{})})}const Ie="0.1.0";C.Canvas=de,C.GrixApp=ze,C.PluginManagerProvider=le,C.ToolBar=fe,C.createAreaCounter=xe,C.createRayTool=ge,C.createRectangleTool=pe,C.useCanvasStore=F,C.useInputSystem=ue,C.usePluginManager=Q,C.version=Ie,Object.defineProperty(C,Symbol.toStringTag,{value:"Module"})});
