(function(je,x){typeof exports=="object"&&typeof module<"u"?x(exports,require("react")):typeof define=="function"&&define.amd?define(["exports","react"],x):(je=typeof globalThis<"u"?globalThis:je||self,x(je.GrixUI={},je.React))})(this,function(je,x){"use strict";var zs=Object.defineProperty;var Ds=(je,x,Be)=>x in je?zs(je,x,{enumerable:!0,configurable:!0,writable:!0,value:Be}):je[x]=Be;var ee=(je,x,Be)=>Ds(je,typeof x!="symbol"?x+"":x,Be);var Be={exports:{}},st={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vt;function Yt(){if(vt)return st;vt=1;var i=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function s(n,r,o){var c=null;if(o!==void 0&&(c=""+o),r.key!==void 0&&(c=""+r.key),"key"in r){o={};for(var a in r)a!=="key"&&(o[a]=r[a])}else o=r;return r=o.ref,{$$typeof:i,type:n,key:c,ref:r!==void 0?r:null,props:o}}return st.Fragment=t,st.jsx=s,st.jsxs=s,st}var nt={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var jt;function Xt(){return jt||(jt=1,process.env.NODE_ENV!=="production"&&function(){function i(v){if(v==null)return null;if(typeof v=="function")return v.$$typeof===oe?null:v.displayName||v.name||null;if(typeof v=="string")return v;switch(v){case m:return"Fragment";case y:return"Profiler";case p:return"StrictMode";case A:return"Suspense";case T:return"SuspenseList";case ne:return"Activity"}if(typeof v=="object")switch(typeof v.tag=="number"&&console.error("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),v.$$typeof){case l:return"Portal";case _:return(v.displayName||"Context")+".Provider";case S:return(v._context.displayName||"Context")+".Consumer";case N:var U=v.render;return v=v.displayName,v||(v=U.displayName||U.name||"",v=v!==""?"ForwardRef("+v+")":"ForwardRef"),v;case G:return U=v.displayName||null,U!==null?U:i(v.type)||"Memo";case I:U=v._payload,v=v._init;try{return i(v(U))}catch{}}return null}function t(v){return""+v}function s(v){try{t(v);var U=!1}catch{U=!0}if(U){U=console;var le=U.error,ye=typeof Symbol=="function"&&Symbol.toStringTag&&v[Symbol.toStringTag]||v.constructor.name||"Object";return le.call(U,"The provided key is an unsupported type %s. This value must be coerced to a string before using it here.",ye),t(v)}}function n(v){if(v===m)return"<>";if(typeof v=="object"&&v!==null&&v.$$typeof===I)return"<...>";try{var U=i(v);return U?"<"+U+">":"<...>"}catch{return"<...>"}}function r(){var v=Z.A;return v===null?null:v.getOwner()}function o(){return Error("react-stack-top-frame")}function c(v){if(f.call(v,"key")){var U=Object.getOwnPropertyDescriptor(v,"key").get;if(U&&U.isReactWarning)return!1}return v.key!==void 0}function a(v,U){function le(){pe||(pe=!0,console.error("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://react.dev/link/special-props)",U))}le.isReactWarning=!0,Object.defineProperty(v,"key",{get:le,configurable:!0})}function d(){var v=i(this.type);return we[v]||(we[v]=!0,console.error("Accessing element.ref was removed in React 19. ref is now a regular prop. It will be removed from the JSX Element type in a future release.")),v=this.props.ref,v!==void 0?v:null}function h(v,U,le,ye,Fe,H,Ne,We){return le=H.ref,v={$$typeof:b,type:v,key:U,props:H,_owner:Fe},(le!==void 0?le:null)!==null?Object.defineProperty(v,"ref",{enumerable:!1,get:d}):Object.defineProperty(v,"ref",{enumerable:!1,value:null}),v._store={},Object.defineProperty(v._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:0}),Object.defineProperty(v,"_debugInfo",{configurable:!1,enumerable:!1,writable:!0,value:null}),Object.defineProperty(v,"_debugStack",{configurable:!1,enumerable:!1,writable:!0,value:Ne}),Object.defineProperty(v,"_debugTask",{configurable:!1,enumerable:!1,writable:!0,value:We}),Object.freeze&&(Object.freeze(v.props),Object.freeze(v)),v}function C(v,U,le,ye,Fe,H,Ne,We){var ie=U.children;if(ie!==void 0)if(ye)if(M(ie)){for(ye=0;ye<ie.length;ye++)R(ie[ye]);Object.freeze&&Object.freeze(ie)}else console.error("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else R(ie);if(f.call(U,"key")){ie=i(v);var te=Object.keys(U).filter(function(ge){return ge!=="key"});ye=0<te.length?"{key: someKey, "+te.join(": ..., ")+": ...}":"{key: someKey}",me[ie+ye]||(te=0<te.length?"{"+te.join(": ..., ")+": ...}":"{}",console.error(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,ye,ie,te,ie),me[ie+ye]=!0)}if(ie=null,le!==void 0&&(s(le),ie=""+le),c(U)&&(s(U.key),ie=""+U.key),"key"in U){le={};for(var xe in U)xe!=="key"&&(le[xe]=U[xe])}else le=U;return ie&&a(le,typeof v=="function"?v.displayName||v.name||"Unknown":v),h(v,ie,H,Fe,r(),le,Ne,We)}function R(v){typeof v=="object"&&v!==null&&v.$$typeof===b&&v._store&&(v._store.validated=1)}var P=x,b=Symbol.for("react.transitional.element"),l=Symbol.for("react.portal"),m=Symbol.for("react.fragment"),p=Symbol.for("react.strict_mode"),y=Symbol.for("react.profiler"),S=Symbol.for("react.consumer"),_=Symbol.for("react.context"),N=Symbol.for("react.forward_ref"),A=Symbol.for("react.suspense"),T=Symbol.for("react.suspense_list"),G=Symbol.for("react.memo"),I=Symbol.for("react.lazy"),ne=Symbol.for("react.activity"),oe=Symbol.for("react.client.reference"),Z=P.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,f=Object.prototype.hasOwnProperty,M=Array.isArray,K=console.createTask?console.createTask:function(){return null};P={"react-stack-bottom-frame":function(v){return v()}};var pe,we={},se=P["react-stack-bottom-frame"].bind(P,o)(),B=K(n(o)),me={};nt.Fragment=m,nt.jsx=function(v,U,le,ye,Fe){var H=1e4>Z.recentlyCreatedOwnerStacks++;return C(v,U,le,!1,ye,Fe,H?Error("react-stack-top-frame"):se,H?K(n(v)):B)},nt.jsxs=function(v,U,le,ye,Fe){var H=1e4>Z.recentlyCreatedOwnerStacks++;return C(v,U,le,!0,ye,Fe,H?Error("react-stack-top-frame"):se,H?K(n(v)):B)}}()),nt}var wt;function Ut(){return wt||(wt=1,process.env.NODE_ENV==="production"?Be.exports=Yt():Be.exports=Xt()),Be.exports}var e=Ut();const Je={distance(i,t){const s=t.x-i.x,n=t.y-i.y;return Math.sqrt(s*s+n*n)},slope(i,t){const s=t.x-i.x,n=t.y-i.y;return Math.abs(s)<Number.EPSILON?s===0||s>0?1/0:-1/0:n/s},angle(i,t){const s=t.x-i.x,n=t.y-i.y;return Math.atan2(n,s)},magnitude(i){return Math.sqrt(i.x*i.x+i.y*i.y)},normalize(i){const t=this.magnitude(i);return t===0?{x:0,y:0}:{x:i.x/t,y:i.y/t}},snapToGrid(i,t){return{x:Math.round(i.x/t)*t,y:Math.round(i.y/t)*t}},calculateArea(i){return Math.abs(i.properties.width*i.properties.height)},boundsContainPoint(i,t){return t.x>=i.x&&t.x<=i.x+i.width&&t.y>=i.y&&t.y<=i.y+i.height},boundsIntersect(i,t){return!(i.x+i.width<t.x||t.x+t.width<i.x||i.y+i.height<t.y||t.y+t.height<i.y)},gcd(i,t){for(i=Math.abs(i),t=Math.abs(t);t!==0;){const s=t;t=i%t,i=s}return i},simplifyFraction(i,t){if(t===0)return[i,1];const s=this.gcd(i,t);return[i/s,t/s]},worldToScreen(i,t,s){const n=s.width/2,r=s.height/2,o=(i.x-t.center.x)*t.zoom,c=(i.y-t.center.y)*t.zoom;return{x:n+o,y:r-c}},screenToWorld(i,t,s){const n=s.width/2,r=s.height/2,o=(i.x-n)/t.zoom,c=(r-i.y)/t.zoom;return{x:t.center.x+o,y:t.center.y+c}}},Qe={detectCapabilities(){const i="ontouchstart"in window||navigator.maxTouchPoints>0,t=i&&navigator.maxTouchPoints>1,s=!0,n=window.matchMedia("(hover: hover)").matches;return{hasTouch:i,hasPencil:t,hasKeyboard:s,hasHover:n,maxTouchPoints:navigator.maxTouchPoints||0,supportsPressure:"force"in Touch.prototype,supportsTilt:"altitudeAngle"in Touch.prototype}},normalizePointerEvent(i){let t="mouse";return i.pointerType==="touch"?t="touch":i.pointerType==="pen"&&(t="pen"),{type:t,pressure:i.pressure||0,tiltX:i.tiltX||0,tiltY:i.tiltY||0,x:i.clientX,y:i.clientY,timestamp:i.timeStamp,isPrimary:i.isPrimary,pointerId:i.pointerId}},getTouchTargetSize(i){switch(i){case"pen":return 32;case"touch":return 44;case"mouse":return 24;default:return 44}}};class Ht{constructor(){this.listeners=new Map}on(t,s){this.listeners.has(t)||this.listeners.set(t,[]),this.listeners.get(t).push(s)}off(t,s){const n=this.listeners.get(t);if(n){const r=n.indexOf(s);r>-1&&n.splice(r,1)}}emit(t,s){const n=this.listeners.get(t);n&&n.forEach(r=>{try{r(s)}catch(o){console.error(`Error in event handler for ${t}:`,o)}})}clear(){this.listeners.clear()}getEvents(){return Array.from(this.listeners.keys())}getListenerCount(t){var s;return((s=this.listeners.get(t))==null?void 0:s.length)||0}}const St=i=>{let t;const s=new Set,n=(h,C)=>{const R=typeof h=="function"?h(t):h;if(!Object.is(R,t)){const P=t;t=C??(typeof R!="object"||R===null)?R:Object.assign({},t,R),s.forEach(b=>b(t,P))}},r=()=>t,a={setState:n,getState:r,getInitialState:()=>d,subscribe:h=>(s.add(h),()=>s.delete(h))},d=t=i(n,r,a);return a},Vt=i=>i?St(i):St,Kt=i=>i;function Zt(i,t=Kt){const s=x.useSyncExternalStore(i.subscribe,()=>t(i.getState()),()=>t(i.getInitialState()));return x.useDebugValue(s),s}const Ct=i=>{const t=Vt(i),s=n=>Zt(t,n);return Object.assign(s,t),s},pt=i=>i?Ct(i):Ct,He=class He{constructor(){ee(this,"STORAGE_KEY","grix-app-state");ee(this,"VERSION_KEY","grix-version");ee(this,"SESSION_KEY","grix-session");ee(this,"CURRENT_VERSION","1.0.0");ee(this,"options",{autoSave:!0,saveInterval:2e3,maxStorageSize:10*1024*1024,compressionEnabled:!0});ee(this,"autoSaveTimer",null);ee(this,"pendingSave",!1);ee(this,"sessionId");this.sessionId=this.generateSessionId(),this.initializeStorage(),this.setupAutoSave(),this.setupStorageEventListener()}static getInstance(){return He.instance||(He.instance=new He),He.instance}initializeStorage(){try{const t=localStorage.getItem(this.VERSION_KEY);t?t!==this.CURRENT_VERSION?(this.migrateStorage(t,this.CURRENT_VERSION),localStorage.setItem(this.VERSION_KEY,this.CURRENT_VERSION),console.log(`üîÑ Grix: Storage migrated from ${t} to ${this.CURRENT_VERSION}`)):console.log("‚úÖ Grix: Storage ready (version "+this.CURRENT_VERSION+")"):(localStorage.setItem(this.VERSION_KEY,this.CURRENT_VERSION),localStorage.setItem(this.SESSION_KEY,this.sessionId),console.log("üéØ Grix: Storage initialized for first time"))}catch(t){console.warn("‚ö†Ô∏è Grix: Storage initialization failed:",t)}}async saveState(t){try{const s=this.loadState(),n={objects:t.objects??(s==null?void 0:s.objects)??[],selectedObjects:t.selectedObjects??(s==null?void 0:s.selectedObjects)??[],viewport:t.viewport??(s==null?void 0:s.viewport)??{zoom:20,center:{x:0,y:0}},visualizationSettings:t.visualizationSettings??(s==null?void 0:s.visualizationSettings)??{},activeTool:t.activeTool??(s==null?void 0:s.activeTool)??null,version:this.CURRENT_VERSION,timestamp:Date.now(),sessionId:this.sessionId},r=JSON.stringify(n);return r.length>this.options.maxStorageSize?(console.warn("‚ö†Ô∏è Grix: State too large for storage, compressing..."),!1):(localStorage.setItem(this.STORAGE_KEY,r),console.log("üíæ Grix: State saved successfully"),!0)}catch(s){return console.error("‚ùå Grix: Failed to save state:",s),!1}}loadState(){try{const t=localStorage.getItem(this.STORAGE_KEY);if(!t)return console.log("üì≠ Grix: No saved state found"),null;const s=JSON.parse(t);return this.validateState(s)?(console.log("üìÇ Grix: State loaded successfully"),s):(console.warn("‚ö†Ô∏è Grix: Invalid state structure, ignoring saved state"),null)}catch(t){return console.error("‚ùå Grix: Failed to load state:",t),null}}clearState(){try{return localStorage.removeItem(this.STORAGE_KEY),console.log("üóëÔ∏è Grix: State cleared successfully"),!0}catch(t){return console.error("‚ùå Grix: Failed to clear state:",t),!1}}getStorageInfo(){try{const t=localStorage.getItem(this.STORAGE_KEY),s=t?new Blob([t]).size:0;let n=0;for(let o in localStorage)localStorage.hasOwnProperty(o)&&(n+=localStorage[o].length+o.length);const r=this.loadState();return{isAvailable:typeof Storage<"u",usedSpace:n,totalSpace:5*1024*1024,stateSize:s,lastSaved:(r==null?void 0:r.timestamp)??null}}catch{return{isAvailable:!1,usedSpace:0,totalSpace:0,stateSize:0,lastSaved:null}}}configure(t){this.options={...this.options,...t},t.autoSave!==void 0&&(t.autoSave?this.setupAutoSave():this.stopAutoSave())}saveNow(t){return this.pendingSave=!1,this.saveState(t)}scheduleSave(){this.options.autoSave&&(this.pendingSave=!0)}exportState(){const t=this.loadState();if(!t)return null;const s={...t,exportedAt:new Date().toISOString(),exportVersion:this.CURRENT_VERSION};return JSON.stringify(s,null,2)}async importState(t){try{const s=JSON.parse(t);if(!this.validateState(s))throw new Error("Invalid state structure");return await this.saveState(s)}catch(s){return console.error("‚ùå Grix: Failed to import state:",s),!1}}generateSessionId(){return"session_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}validateState(t){return t&&typeof t=="object"&&Array.isArray(t.objects)&&Array.isArray(t.selectedObjects)&&t.viewport&&typeof t.viewport.zoom=="number"&&t.viewport.center&&typeof t.viewport.center.x=="number"&&typeof t.viewport.center.y=="number"}setupAutoSave(){this.autoSaveTimer&&clearInterval(this.autoSaveTimer),this.options.autoSave&&(this.autoSaveTimer=setInterval(()=>{this.pendingSave&&this.triggerAutoSave()},this.options.saveInterval))}stopAutoSave(){this.autoSaveTimer&&(clearInterval(this.autoSaveTimer),this.autoSaveTimer=null)}triggerAutoSave(){window.dispatchEvent(new CustomEvent("grix:auto-save-requested")),this.pendingSave=!1}setupStorageEventListener(){window.addEventListener("storage",t=>{t.key===this.STORAGE_KEY&&(console.log("üîÑ Grix: State updated by another tab"),window.dispatchEvent(new CustomEvent("grix:state-updated-externally")))})}migrateStorage(t,s){console.log(`üîÑ Grix: Migrating storage from ${t} to ${s}`);const n=this.loadState();n&&(n.version=s,this.saveState(n))}};ee(He,"instance");let ft=He;const re=ft.getInstance(),Ee=pt((i,t)=>({viewport:{center:{x:0,y:0},zoom:20,bounds:{x:-10,y:-10,width:20,height:20}},objects:[],selectedObjects:[],snapToGrid:!0,canvasSize:{width:800,height:600},setViewport:s=>{i(n=>({viewport:{...n.viewport,...s}})),re.scheduleSave()},addObject:s=>{i(n=>({objects:[...n.objects,s]})),re.scheduleSave()},removeObject:s=>{i(n=>({objects:n.objects.filter(r=>r.id!==s),selectedObjects:n.selectedObjects.filter(r=>r!==s)})),re.scheduleSave()},updateObject:(s,n)=>{i(r=>({objects:r.objects.map(o=>o.id===s?{...o,...n}:o)})),re.scheduleSave()},selectObject:(s,n=!1)=>{i(r=>n?{selectedObjects:r.selectedObjects.includes(s)?r.selectedObjects.filter(c=>c!==s):[...r.selectedObjects,s]}:{selectedObjects:[s]})},clearSelection:()=>{i({selectedObjects:[]})},setSnapToGrid:s=>{i({snapToGrid:s})},setCanvasSize:s=>{i({canvasSize:s})},getObject:s=>t().objects.find(n=>n.id===s),getAllObjects:()=>t().objects,getSelectedObjects:()=>{const s=t();return s.objects.filter(n=>s.selectedObjects.includes(n.id))},screenToWorld:s=>{const{viewport:n,canvasSize:r}=t();return Je.screenToWorld(s,n,r)},worldToScreen:s=>{const{viewport:n,canvasSize:r}=t();return Je.worldToScreen(s,n,r)},bringToFront:s=>{i(n=>{const r=Math.max(...n.objects.map(o=>o.zIndex||0));return{objects:n.objects.map(o=>o.id===s?{...o,zIndex:r+1}:o)}})},sendToBack:s=>{i(n=>{const r=Math.min(...n.objects.map(o=>o.zIndex||0));return{objects:n.objects.map(o=>o.id===s?{...o,zIndex:r-1}:o)}})},bringForward:s=>{i(n=>{const r=n.objects.find(a=>a.id===s);if(!r)return n;const o=n.objects.filter(a=>(a.zIndex||0)>(r.zIndex||0));if(o.length===0)return n;const c=Math.min(...o.map(a=>a.zIndex||0));return{objects:n.objects.map(a=>a.id===s?{...a,zIndex:c+.1}:a)}})},sendBackward:s=>{i(n=>{const r=n.objects.find(a=>a.id===s);if(!r)return n;const o=n.objects.filter(a=>(a.zIndex||0)<(r.zIndex||0));if(o.length===0)return n;const c=Math.max(...o.map(a=>a.zIndex||0));return{objects:n.objects.map(a=>a.id===s?{...a,zIndex:c-.1}:a)}})},clearObjects:()=>{i({objects:[],selectedObjects:[]}),re.scheduleSave()},loadState:()=>{const s=re.loadState();s&&i({objects:s.objects,selectedObjects:s.selectedObjects,viewport:s.viewport})},saveState:()=>{const s=t();re.saveState({objects:s.objects,selectedObjects:s.selectedObjects,viewport:s.viewport})}})),Jt=()=>({addObject:i=>Ee.getState().addObject(i),removeObject:i=>Ee.getState().removeObject(i),updateObject:(i,t)=>Ee.getState().updateObject(i,t),getObject:i=>Ee.getState().getObject(i),getAllObjects:()=>Ee.getState().getAllObjects(),screenToWorld:i=>Ee.getState().screenToWorld(i),worldToScreen:i=>Ee.getState().worldToScreen(i)}),Qt=()=>({getState:()=>{const i=Ee.getState();return{viewport:i.viewport,objects:i.objects,selectedObjects:i.selectedObjects,snapToGrid:i.snapToGrid}},setState:i=>{Ee.setState(i)},subscribe:i=>Ee.subscribe(t=>{i({viewport:t.viewport,objects:t.objects,selectedObjects:t.selectedObjects,snapToGrid:t.snapToGrid})})}),Et=x.createContext(null);function it(){const i=x.useContext(Et);if(!i)throw new Error("usePluginManager must be used within PluginManagerProvider");return i}function Mt({children:i}){const[t]=x.useState(()=>new Ht),[s]=x.useState(()=>new Map),[n]=x.useState(()=>new Map),[r,o]=x.useState(null),c=x.useRef(),a=x.useRef(),d=x.useRef();c.current||(c.current=Jt()),a.current||(a.current=Qt()),d.current||(d.current={distance:Je.distance,slope:Je.slope,snapToGrid:Je.snapToGrid,calculateArea:Je.calculateArea});const h=c.current,C=a.current,R=d.current,P=p=>{if(s.has(p.id)){console.warn(`Plugin ${p.id} is already registered`);return}const y={canvas:h,events:t,state:C,math:R};s.set(p.id,p),n.set(p.id,y);try{p.init(y),console.log(`Plugin ${p.id} initialized successfully`)}catch(S){console.error(`Failed to initialize plugin ${p.id}:`,S),s.delete(p.id),n.delete(p.id)}},b=p=>{var S;const y=s.get(p);if(y){try{(S=y.destroy)==null||S.call(y)}catch(_){console.error(`Error destroying plugin ${p}:`,_)}s.delete(p),n.delete(p),r===p&&o(null)}},l=()=>Array.from(s.values());x.useEffect(()=>{t.emit("tool:changed",{previous:null,current:r})},[r,t]),x.useEffect(()=>{const p=N=>A=>{var G,I,ne,oe,Z,f;const T=r?s.get(r):null;if(T)try{switch(N){case"pointer:down":(G=T.onPointerDown)==null||G.call(T,A);break;case"pointer:move":(I=T.onPointerMove)==null||I.call(T,A);break;case"pointer:up":(ne=T.onPointerUp)==null||ne.call(T,A);break}}catch(M){console.error(`Error in plugin ${r} handling ${N}:`,M)}else{const M=C.getState().selectedObjects;try{let K;if(M.length===1){const pe=h.getObject(M[0]);(pe==null?void 0:pe.type)==="ray"?K=s.get("ray-tool"):(pe==null?void 0:pe.type)==="rectangle"?K=s.get("rectangle-tool"):(pe==null?void 0:pe.type)==="circle"?K=s.get("circle-tool"):(pe==null?void 0:pe.type)==="triangle"?K=s.get("triangle-tool"):(pe==null?void 0:pe.type)==="function"&&(K=s.get("function-tool"))}if(K)switch(N){case"pointer:down":(oe=K.onPointerDown)==null||oe.call(K,A);break;case"pointer:move":(Z=K.onPointerMove)==null||Z.call(K,A);break;case"pointer:up":(f=K.onPointerUp)==null||f.call(K,A);break}}catch(K){console.error(`Error in tool handling ${N} for manipulation:`,K)}}},y=p("pointer:down"),S=p("pointer:move"),_=p("pointer:up");return t.on("pointer:down",y),t.on("pointer:move",S),t.on("pointer:up",_),()=>{t.off("pointer:down",y),t.off("pointer:move",S),t.off("pointer:up",_)}},[r,s,t,C,h]);const m={eventBus:t,registerPlugin:P,unregisterPlugin:b,getActivePlugins:l,activeTool:r,setActiveTool:o};return e.jsx(Et.Provider,{value:m,children:i})}function es(){const{eventBus:i}=it();return{handlePointerDown:r=>{i.emit("pointer:down",r)},handlePointerMove:r=>{i.emit("pointer:move",r)},handlePointerUp:r=>{i.emit("pointer:up",r)}}}function kt(i,t,s={}){const[n,r]=x.useState(null),[o,c]=x.useState(new Map),a={enableGestures:!0,touchTargetSize:44,preventScrolling:!0,...s};x.useEffect(()=>{const p=Qe.detectCapabilities();r(p)},[]);const[d,h]=x.useState({isGesturing:!1,startTime:0,startDistance:0,lastTapTime:0,tapCount:0,initialCenter:null,wasRecentlyGesturing:!1}),C=x.useCallback(p=>{const y=Array.from(p.values());if(y.length<2)return 0;const S=y[0],_=y[1];if(!S||!_)return 0;const N=S.x-_.x,A=S.y-_.y;return Math.sqrt(N*N+A*A)},[]),R=x.useCallback(p=>{const y=Array.from(p.values());if(y.length===0)return{x:0,y:0};const S=y.reduce((_,N)=>({x:_.x+N.x,y:_.y+N.y}),{x:0,y:0});return{x:S.x/y.length,y:S.y/y.length}},[]),P=x.useCallback(p=>{var A;if(!i.current)return;a.preventScrolling&&p.preventDefault();const y=i.current.getBoundingClientRect(),S=p.clientX-y.left,_=p.clientY-y.top,N=Qe.normalizePointerEvent(p);N.x=S,N.y=_,c(T=>{const G=new Map(T);if(G.set(p.pointerId,N),a.enableGestures&&G.size>=2){const I=C(G),ne=R(G);h(oe=>({...oe,isGesturing:!0,startTime:p.timeStamp,startDistance:I,initialCenter:ne,wasRecentlyGesturing:!1}))}return G}),i.current.setPointerCapture(p.pointerId),(A=t.onPointerDown)==null||A.call(t,N)},[i,t,a,C]),b=x.useCallback(p=>{var A;if(!i.current)return;const y=i.current.getBoundingClientRect(),S=p.clientX-y.left,_=p.clientY-y.top,N=Qe.normalizePointerEvent(p);N.x=S,N.y=_,c(T=>{var I,ne;const G=new Map(T);if(G.set(p.pointerId,N),a.enableGestures&&G.size>=2){const oe=C(G),Z=R(G);if(d.isGesturing&&d.startDistance>0&&d.initialCenter){const f=oe/d.startDistance,M={x:d.initialCenter.x*.7+Z.x*.3,y:d.initialCenter.y*.7+Z.y*.3};(I=t.onGesture)==null||I.call(t,{type:"pinch",center:M,scale:f,touches:G.size})}}else if(!(G.size===1&&d.wasRecentlyGesturing)){if(G.size===1&&d.isGesturing){const oe=R(G);(ne=t.onGesture)==null||ne.call(t,{type:"pan",center:oe,touches:G.size})}}return G}),(A=t.onPointerMove)==null||A.call(t,N)},[t,a,C,R,d]),l=x.useCallback(p=>{var A;if(!i.current)return;const y=i.current.getBoundingClientRect(),S=p.clientX-y.left,_=p.clientY-y.top,N=Qe.normalizePointerEvent(p);N.x=S,N.y=_,c(T=>{var I;const G=new Map(T);if(G.delete(p.pointerId),G.size<2&&d.isGesturing&&(h(ne=>({...ne,isGesturing:!1,wasRecentlyGesturing:!0,initialCenter:null})),setTimeout(()=>{h(ne=>({...ne,wasRecentlyGesturing:!1}))},100)),a.enableGestures&&G.size===0){const oe=p.timeStamp-d.startTime<200&&!d.wasRecentlyGesturing,Z=p.timeStamp-d.lastTapTime;oe&&!d.isGesturing&&(Z<300?h(f=>({...f,tapCount:f.tapCount+1})):((I=t.onGesture)==null||I.call(t,{type:"tap",center:{x:N.x,y:N.y},touches:1}),h(f=>({...f,tapCount:1,lastTapTime:p.timeStamp})))),h(f=>({...f,isGesturing:!1}))}return G}),i.current&&i.current.releasePointerCapture(p.pointerId),(A=t.onPointerUp)==null||A.call(t,N)},[i,t,a,d]),m=x.useCallback(p=>{var A;if(!i.current)return;const y=i.current.getBoundingClientRect(),S=p.clientX-y.left,_=p.clientY-y.top,N=Qe.normalizePointerEvent(p);N.x=S,N.y=_,c(T=>{const G=new Map(T);return G.delete(p.pointerId),G}),h(T=>({...T,isGesturing:!1})),(A=t.onPointerCancel)==null||A.call(t,N)},[t]);return x.useEffect(()=>{const p=i.current;if(!p)return;p.addEventListener("pointerdown",P),p.addEventListener("pointermove",b),p.addEventListener("pointerup",l),p.addEventListener("pointercancel",m);const y=S=>S.preventDefault();return p.addEventListener("contextmenu",y),()=>{p.removeEventListener("pointerdown",P),p.removeEventListener("pointermove",b),p.removeEventListener("pointerup",l),p.removeEventListener("pointercancel",m),p.removeEventListener("contextmenu",y)}},[i,P,b,l,m]),{capabilities:n,activePointers:Array.from(o.values()),isGesturing:d.isGesturing,touchTargetSize:n?Qe.getTouchTargetSize(n.hasTouch?"touch":"mouse"):a.touchTargetSize}}function Pt(i,t={minSpacing:8,maxSpacing:80,labelMinSpacing:40}){const s=i.zoom;let r=1,o=r*s;for(;o<t.minSpacing&&r<1e4;)r*=Tt(r),o=r*s;for(;o>t.maxSpacing&&r>1e-4;)r/=ts(r),o=r*s;let c=r,a=c*s;for(;a<t.labelMinSpacing&&c<r*100;)c*=Tt(c),a=c*s;const d=Math.max(.1,Math.min(1,(o-t.minSpacing)/(t.maxSpacing-t.minSpacing)));return{gridSize:r,labelStep:c,shouldShowGrid:o>=t.minSpacing,shouldShowLabels:a>=t.labelMinSpacing,opacity:d}}function Tt(i){if(i<1)return i>=.5?2:i>=.2?2.5:(i>=.1,2);if(i<10)return i>=5?2:i>=2?2.5:(i>=1,2);{const t=Math.pow(10,Math.floor(Math.log10(i))),s=i/t;return s>=5?2:s>=2?2.5:(s>=1,2)}}function ts(i){if(i<=1)return i<=.1||i<=.2?2:i<=.5?2.5:(i<=1,2);if(i<=10)return i<=2?2:i<=5?2.5:(i<=10,2);{const t=Math.pow(10,Math.floor(Math.log10(i))),s=i/t;return s<=2?2:s<=5?2.5:(s<=10,2)}}function ss(i,t,s,n,r=!0){const{gridSize:o}=s,c={left:i.center.x-t.width/2/i.zoom,right:i.center.x+t.width/2/i.zoom,top:i.center.y+t.height/2/i.zoom,bottom:i.center.y-t.height/2/i.zoom},a=[],d=[],h=Math.floor(c.left/o)*o,C=Math.ceil(c.right/o)*o;for(let b=h;b<=C;b+=o){const l=n({x:b,y:0}).x,m=Math.abs(b)<o/2,p=Math.abs(b%(o*5))<o/2;a.push({x:l,isAxis:m,isMajor:p,isInteger:!1,value:b})}if(r&&(o>=2||o<1)){const b=Math.floor(c.left),l=Math.ceil(c.right);for(let m=b;m<=l;m+=1)if(Math.abs(m%o)>.001){const p=n({x:m,y:0}).x,y=Math.abs(m)<.5;a.push({x:p,isAxis:y,isMajor:!1,isInteger:!0,value:m})}}const R=Math.floor(c.bottom/o)*o,P=Math.ceil(c.top/o)*o;for(let b=R;b<=P;b+=o){const l=n({x:0,y:b}).y,m=Math.abs(b)<o/2,p=Math.abs(b%(o*5))<o/2;d.push({y:l,isAxis:m,isMajor:p,isInteger:!1,value:b})}if(r&&(o>=2||o<1)){const b=Math.floor(c.bottom),l=Math.ceil(c.top);for(let m=b;m<=l;m+=1)if(Math.abs(m%o)>.001){const p=n({x:0,y:m}).y,y=Math.abs(m)<.5;d.push({y:p,isAxis:y,isMajor:!1,isInteger:!0,value:m})}}return{verticalLines:a,horizontalLines:d}}function ve(i,t=3){if(i==null||isNaN(i))return"0";if(Number.isInteger(i))return i.toString();const s=i.toFixed(t);return parseFloat(s).toString()}function rt(i,t,s){const n=s.x-t.x,r=s.y-t.y,o=Math.sqrt(n*n+r*r);if(o===0)return Math.sqrt((i.x-t.x)**2+(i.y-t.y)**2);const c=Math.max(0,Math.min(1,((i.x-t.x)*n+(i.y-t.y)*r)/(o*o))),a={x:t.x+c*n,y:t.y+c*r};return Math.sqrt((i.x-a.x)**2+(i.y-a.y)**2)}function At(i,t){const[s,n,r]=t,o=(n.y-r.y)*(s.x-r.x)+(r.x-n.x)*(s.y-r.y),c=((n.y-r.y)*(i.x-r.x)+(r.x-n.x)*(i.y-r.y))/o,a=((r.y-s.y)*(i.x-r.x)+(s.x-r.x)*(i.y-r.y))/o,d=1-c-a;return c>=0&&a>=0&&d>=0}function Nt(i,t,s){const n=Math.sqrt((i.x-t.x)**2+(i.y-t.y)**2);return Math.abs(n-s)}function V(i,t){return t>=1?i.toFixed(0):t>=.1?i.toFixed(1):t>=.01?i.toFixed(2):i.toFixed(3)}function et(i,t){if(t!=="adaptive")switch(t){case"whole":return 1;case"half":return .5;case"quarter":return .25;case"tenth":return .1;default:return 1}const s=Pt(i,{minSpacing:8,maxSpacing:80,labelMinSpacing:40});return s.gridSize<=.1?s.gridSize:s.gridSize<=.5?.1:s.gridSize<=2?.25:1}const Ot={showEquivalentFractions:!0,showLengthMultiples:!0,showAreaRectangle:!0,showDivisionMultiples:!0,showRiseRunTriangle:!0,showDistanceMarkers:!0,showAngleArc:!1,showCoordinateProjections:!0,showTangentLines:!1,showFunctionExtensions:!0,showTriangleAngles:!0,showSOHCAHTOA:!1,showTrigValues:!1,showTriangleClassification:!0,showTriangleAltitudes:!1,showSpecialTriangles:!0,showPythagoreanSquares:!1,showDivisionAnswer:!0,showLatticePoints:!1,showReferenceLineY_equals_X:!0,showFactorPairs:!1,showCommutativeProperty:!1,showDistributiveProperty:!1,showPrimeComposite:!1,showGCF:!0,showLCM:!1,fontScale:1,snapPrecision:"whole",coordinateSystem:"cartesian",showPolarGrid:!1,customOrigin:null},De=pt(i=>({...Ot,toggleSetting:t=>{i(s=>({[t]:!s[t]})),re.scheduleSave()},setFontScale:t=>{i({fontScale:t}),re.scheduleSave()},setSnapPrecision:t=>{i({snapPrecision:t}),re.scheduleSave()},setCoordinateSystem:t=>{i({coordinateSystem:t}),re.scheduleSave()},setCustomOrigin:t=>{i({customOrigin:t}),re.scheduleSave()},resetToDefaults:()=>{i(Ot),re.scheduleSave()}}));function ns({viewport:i,canvasSize:t,worldToScreen:s,objects:n=[]}){const r=De(),o=m=>Math.round(m*r.fontScale),c=Pt(i,{minSpacing:8,maxSpacing:80,labelMinSpacing:40}),{verticalLines:a,horizontalLines:d}=ss(i,t,c,s,!1);if(!c.shouldShowGrid)return null;const h=[];if(r.coordinateSystem==="polar"||r.coordinateSystem==="both"){const m=s({x:0,y:0}),p=Math.max(Math.abs(i.center.x)+t.width/(2*i.zoom),Math.abs(i.center.y)+t.height/(2*i.zoom));for(let y=scaledGridSystem.gridSize;y<=p;y+=scaledGridSystem.gridSize){const S=y*i.zoom;S>=10&&h.push(e.jsx("circle",{cx:m.x,cy:m.y,r:S,fill:"none",stroke:"#9CA3AF",strokeWidth:"0.5",opacity:.4},`polar-circle-${y}`))}for(let y=0;y<360;y+=30){const S=y*Math.PI/180,_=m.x+p*i.zoom*Math.cos(S),N=m.y-p*i.zoom*Math.sin(S);h.push(e.jsx("line",{x1:m.x,y1:m.y,x2:_,y2:N,stroke:"#9CA3AF",strokeWidth:"0.5",opacity:.3},`polar-line-${y}`))}}const C=[];n.forEach(m=>{if(m.type==="ray"){const{startPoint:p,endPoint:y}=m.properties;if(Math.abs(p.x)<.001&&Math.abs(p.y)<.001){const S=y.x-p.x,_=y.y-p.y;if(Math.abs(S)>.001){const N=1/S;if(N>0&&N<=1){const A=p.y+N*_,T=s({x:1,y:A});C.push({y:A,screenY:T.y})}}}}});const R=a.map(m=>{const y=Math.abs(m.value-1)<.001&&r.showDivisionAnswer,S=m.isAxis?"#374151":y?"#60A5FA":m.isMajor?"#9CA3AF":"#E5E7EB",_=m.isAxis?2:y?1.5:m.isMajor?1:.5,N=m.isAxis?1:y?.8:m.isMajor?.6*c.opacity:.3*c.opacity;return e.jsx("line",{x1:m.x,y1:0,x2:m.x,y2:t.height,stroke:S,strokeWidth:_,opacity:N},`v${m.value}`)}),P=d.map(m=>e.jsx("line",{x1:0,y1:m.y,x2:t.width,y2:m.y,stroke:m.isAxis?"#374151":m.isMajor?"#9CA3AF":"#E5E7EB",strokeWidth:m.isAxis?2:m.isMajor?1:.5,opacity:m.isAxis?1:m.isMajor?.6*c.opacity:.3*c.opacity},`h${m.value}`)),b=r.showReferenceLineY_equals_X?(()=>{const m={left:i.center.x-t.width/2/i.zoom,right:i.center.x+t.width/2/i.zoom,top:i.center.y+t.height/2/i.zoom,bottom:i.center.y-t.height/2/i.zoom},p=Math.min(m.left,m.bottom),y=Math.max(m.right,m.top),S=s({x:p,y:p}),_=s({x:y,y});return{lineStart:S,lineEnd:_}})():null,l=r.showLatticePoints?(()=>{const m={left:i.center.x-t.width/2/i.zoom,right:i.center.x+t.width/2/i.zoom,top:i.center.y+t.height/2/i.zoom,bottom:i.center.y-t.height/2/i.zoom},p=[],y=Math.max(-20,Math.floor(m.left)),S=Math.min(20,Math.ceil(m.right)),_=Math.max(-20,Math.floor(m.bottom)),N=Math.min(20,Math.ceil(m.top)),A=(S-y+1)*(N-_+1);if(A>200){const T=Math.ceil(Math.sqrt(A/200));for(let G=y;G<=S;G+=T)for(let I=_;I<=N;I+=T){const ne=s({x:G,y:I});ne.x>=-20&&ne.x<=t.width+20&&ne.y>=-20&&ne.y<=t.height+20&&p.push(ne)}}else for(let T=y;T<=S;T++)for(let G=_;G<=N;G++){const I=s({x:T,y:G});I.x>=-20&&I.x<=t.width+20&&I.y>=-20&&I.y<=t.height+20&&p.push(I)}return p})():[];return e.jsxs("g",{className:"grid",children:[(r.coordinateSystem==="polar"||r.coordinateSystem==="both")&&e.jsx("g",{className:"polar-grid",children:h}),(r.coordinateSystem==="cartesian"||r.coordinateSystem==="both")&&e.jsxs("g",{className:"cartesian-grid",children:[R,P]}),l.map((m,p)=>e.jsx("circle",{cx:m.x,cy:m.y,r:"1.5",fill:"#9CA3AF",opacity:"0.3"},`lattice-${p}`)),b&&e.jsx("line",{x1:b.lineStart.x,y1:b.lineStart.y,x2:b.lineEnd.x,y2:b.lineEnd.y,stroke:"#A78BFA",strokeWidth:"1.5",opacity:"0.6",strokeDasharray:"5,5"}),c.shouldShowLabels&&e.jsxs("g",{className:"labels",fontSize:"12",fill:"#374151",children:[a.filter(m=>{const p=Math.abs(m.value%c.labelStep)<c.gridSize/10,y=Math.abs(m.value)>=c.labelStep/2;return p&&y}).filter((m,p,y)=>!y.slice(0,p).some(S=>Math.abs(S.value-m.value)<.001)).map(m=>e.jsx("text",{x:m.x,y:s({x:0,y:0}).y+20,textAnchor:"middle",fontSize:o(11),fontWeight:"500",opacity:Math.max(.7,c.opacity),children:V(m.value,c.gridSize)},`xlabel${m.value}`)),d.filter(m=>{const p=Math.abs(m.value%c.labelStep)<c.gridSize/10,y=Math.abs(m.value)>=c.labelStep/2;return p&&y}).filter((m,p,y)=>!y.slice(0,p).some(S=>Math.abs(S.value-m.value)<.001)).map(m=>e.jsx("text",{x:s({x:0,y:0}).x-15,y:m.y+4,textAnchor:"middle",fontSize:o(11),fontWeight:"500",opacity:Math.max(.7,c.opacity),children:V(m.value,c.gridSize)},`ylabel${m.value}`)),e.jsxs("g",{children:[e.jsx("circle",{cx:s({x:0,y:0}).x,cy:s({x:0,y:0}).y,r:"3",fill:"#374151",opacity:"0.6"}),e.jsx("text",{x:s({x:0,y:0}).x-25,y:s({x:0,y:0}).y-10,fontSize:o(11),fontWeight:"600",fill:"#374151",opacity:Math.max(.8,c.opacity),children:"(0,0)"})]}),r.showDivisionAnswer&&C.map((m,p)=>{const y=s({x:1,y:0}).x;return e.jsxs("g",{children:[e.jsx("circle",{cx:y,cy:m.screenY,r:"4",fill:"white",stroke:"#60A5FA",strokeWidth:"2",opacity:"0.9"}),e.jsxs("text",{x:y+15,y:m.screenY+4,fontSize:o(10),fontWeight:"600",fill:"#60A5FA",opacity:"0.9",children:["y = ",m.y.toFixed(2)]})]},`ray-intersection-${p}`)})]})]})}const lt=[{code:"en",name:"English",nativeName:"English",direction:"ltr"},{code:"es",name:"Spanish",nativeName:"Espa√±ol",direction:"ltr"},{code:"fr",name:"French",nativeName:"Fran√ßais",direction:"ltr"},{code:"de",name:"German",nativeName:"Deutsch",direction:"ltr"},{code:"pt",name:"Portuguese",nativeName:"Portugu√™s",direction:"ltr"},{code:"ja",name:"Japanese",nativeName:"Êó•Êú¨Ë™û",direction:"ltr"},{code:"zh",name:"Chinese",nativeName:"‰∏≠Êñá",direction:"ltr"},{code:"ar",name:"Arabic",nativeName:"ÿßŸÑÿπÿ±ÿ®Ÿäÿ©",direction:"rtl"},{code:"hi",name:"Hindi",nativeName:"‡§π‡§ø‡§®‡•ç‡§¶‡•Ä",direction:"ltr"}],is={"app.name":"Grix","toolbar.build":"Build","toolbar.examples":"Examples","tools.line":"Line Builder","tools.line.description":"Create and edit lines to explore slopes and fractions","tools.rectangle":"Rectangle Builder","tools.rectangle.description":"Create rectangles to explore area and multiplication","tools.circle":"Circle Builder","tools.circle.description":"Create circles to explore circumference and area","tools.triangle":"Triangle Builder","tools.triangle.description":"Create triangles to explore angles and trigonometry","tools.function":"Function Grapher","tools.function.description":"Create function graphs like parabolas, sine waves, and more","settings.title":"Visualization Settings","settings.resetAll":"Reset All","settings.allSettings":"All Settings","settings.sections.originLines":"Origin Lines","settings.sections.originLines.subtitle":"Enhancements for lines from (0,0)","settings.sections.divisionFractions":"Division & Fractions","settings.sections.divisionFractions.subtitle":"Visual fraction and division concepts","settings.sections.gridReference":"Grid & Reference","settings.sections.gridReference.subtitle":"Grid enhancements and reference lines","settings.sections.circlesConcepts":"Circle Concepts","settings.sections.circlesConcepts.subtitle":"Visual features for circles and curves","settings.sections.functionConcepts":"Function Concepts","settings.sections.functionConcepts.subtitle":"Mathematical function visualization features","settings.sections.triangleConcepts":"Triangle Concepts","settings.sections.triangleConcepts.subtitle":"Trigonometry and geometry learning features","settings.sections.rectangleConcepts":"Rectangle Concepts","settings.sections.rectangleConcepts.subtitle":"Educational features for rectangles and areas","settings.sections.display":"Display","settings.sections.display.subtitle":"Adjust visibility for classrooms and large screens","context.details":"Details","context.delete":"Delete","context.close":"Close","context.expand":"Expand","context.collapse":"Collapse","objects.line":"Line","objects.rectangle":"Rectangle","objects.circle":"Circle","objects.triangle":"Triangle","objects.function":"Function","math.slope":"slope","math.area":"area","math.radius":"radius","math.diameter":"diameter","math.circumference":"circumference","math.perimeter":"perimeter","math.angle":"angle","math.degrees":"degrees","actions.title":"Actions & Tools","actions.clearBoard":"Clear Board","actions.clearBoard.description":"Remove all shapes and reset settings","actions.exportSession":"Export Session","actions.exportSession.description":"Save your work as a file","actions.importSession":"Import Session","actions.importSession.description":"Load saved work from file","actions.exportImage":"Export Image","actions.exportImage.description":"Save as PNG (coming soon)","confirm.clearEverything":"Clear Everything?","confirm.clearEverything.message":"This will remove all shapes, reset settings, and clear your saved work. This action cannot be undone.","confirm.cancel":"Cancel","confirm.clearAll":"Clear All","tutorial.welcome.title":"Welcome to Grix! üéØ","tutorial.welcome.content":"Grix is a mathematical visualization platform where you can explore concepts like slopes, fractions, multiplication, and more through interactive graphics.","tutorial.examples.title":"Explore Examples üìö","tutorial.examples.content":"Click the 'Examples' button in the toolbar to load pre-made mathematical demonstrations. Perfect for getting started!","tutorial.settings.title":"Customize Visualizations ‚öôÔ∏è","tutorial.settings.content":"Use the 'Settings' button in the bottom-left to enable different mathematical features like equivalent fractions, area calculations, and more.","tutorial.tools.title":"Interactive Tools üõ†Ô∏è","tutorial.tools.content":"Use the toolbar to draw lines and rectangles. Zoom with Ctrl+scroll wheel, and pan by scrolling. On mobile, use pinch gestures.","tutorial.skip":"Skip Tutorial","tutorial.next":"Next","tutorial.tryExample":"Try an Example!","tutorial.loading":"Loading...","tutorial.step":"Step","tutorial.of":"of","info.about":"About Grix","info.subtitle":"Mathematical Visualization Playground","info.description":"Grix is a playground-first mathematical grid system that scales from 3rd-grade fractions to professional linear algebra. Explore slopes, areas, trigonometry, functions, and more through interactive visual learning.","info.keyFeatures":"Key Features","info.features.interactive":"Interactive mathematical shapes and functions","info.features.realtime":"Real-time visualization of mathematical concepts","info.features.educational":"Educational features for fractions, geometry, and algebra","info.features.touch":"Touch-friendly interface for tablets and mobile devices","info.features.progressive":"Progressive complexity from elementary to advanced math","info.opensource":"Free & Open Source","info.opensource.description":"Grix is completely free to use and open source under the MIT License. Anyone can contribute, modify, or use it for any purpose including commercial.","info.viewGithub":"View on GitHub","info.contact":"Get in Touch","info.contact.description":"Have questions, suggestions, or want to contribute? We'd love to hear from you!","info.madeWith":"Made with ‚ù§Ô∏è for mathematical learning","zoom.zoomIn":"Zoom in (Ctrl+scroll up)","zoom.zoomOut":"Zoom out (Ctrl+scroll down)","zoom.centerView":"Center view (single click) or Reset zoom (double click)","zoom.tip":"Tip:","zoom.tipMessage":"Double-tap this button to reset zoom level too!","error.loadExample":"Failed to load example","error.importFile":"Failed to import state. Please check the file format.","error.readFile":"Failed to read file. Please select a valid Grix export file.","debug.input":"Input","debug.zoom":"Zoom","debug.center":"Center","debug.tool":"Tool","debug.selected":"Selected","debug.panMode":"Pan Mode","debug.object":"object","debug.objects":"objects","common.loading":"Loading...","common.shapes":"shapes","common.shape":"shape","common.onCanvas":"on canvas","common.dismiss":"Dismiss permanently","translation.missing":"Translation needed"},Ft="en";class rs{constructor(){ee(this,"currentLanguage",Ft);ee(this,"translations",new Map);ee(this,"fallbackTranslations",is);ee(this,"isInitialized",!1);this.initialize()}async initialize(){try{await this.loadLanguage(Ft);const t=localStorage.getItem("grix-language");if(t&&lt.some(s=>s.code===t))await this.setLanguage(t);else{const s=navigator.language.split("-")[0];lt.some(n=>n.code===s)&&await this.setLanguage(s)}this.isInitialized=!0,window.dispatchEvent(new CustomEvent("translationsReady"))}catch(t){console.error("Failed to initialize translations:",t),this.isInitialized=!0,window.dispatchEvent(new CustomEvent("translationsReady"))}}async loadLanguage(t){try{if(this.translations.has(t))return!0;const s=await fetch(`/locales/${t}.json`);if(!s.ok)return console.warn(`Translation file for ${t} not found`),!1;const n=await s.json();return this.translations.set(t,n),!0}catch(s){return console.error(`Failed to load language ${t}:`,s),!1}}async setLanguage(t){if(await this.loadLanguage(t)){this.currentLanguage=t,localStorage.setItem("grix-language",t);const n=lt.find(r=>r.code===t);return n&&(document.documentElement.dir=n.direction),window.dispatchEvent(new CustomEvent("languageChanged",{detail:{language:t}})),!0}return!1}getCurrentLanguage(){return this.currentLanguage}getAvailableLanguages(){return lt}translate(t,s){const n=this.translations.get(this.currentLanguage);let r=n==null?void 0:n[t];return r||(r=this.fallbackTranslations[t]),r?(s&&Object.entries(s).forEach(([o,c])=>{r=r.replace(`{${o}}`,String(c))}),r):(console.warn(`Missing translation for key: ${t}`),t)}t(t,s){return this.translate(t,s)}hasTranslation(t){const s=this.translations.get(this.currentLanguage);return!!(s!=null&&s[t]||this.fallbackTranslations[t])}getAllTranslations(){return this.translations.get(this.currentLanguage)||this.fallbackTranslations}}const dt=new rs;function Ge(){const[i,t]=x.useState(dt.getCurrentLanguage()),[,s]=x.useState({});x.useEffect(()=>{const c=d=>{t(d.detail.language),s({})},a=()=>{s({})};return window.addEventListener("languageChanged",c),window.addEventListener("translationsReady",a),()=>{window.removeEventListener("languageChanged",c),window.removeEventListener("translationsReady",a)}},[]);const n=x.useCallback((c,a)=>dt.t(c,a),[i]),r=x.useCallback(async c=>await dt.setLanguage(c),[]),o=x.useCallback(()=>dt.getAvailableLanguages(),[]);return{t:n,language:i,changeLanguage:r,availableLanguages:o()}}function os({viewport:i,onZoomIn:t,onZoomOut:s,onZoomReset:n,onCenterOnly:r}){const{t:o}=Ge(),[c,a]=x.useState(0),d=x.useRef(null),h=()=>{const C=Date.now();C-c<500?(d.current&&(clearTimeout(d.current),d.current=null),n()):d.current=window.setTimeout(()=>{r(),d.current=null},300),a(C)};return x.useEffect(()=>()=>{d.current&&clearTimeout(d.current)},[]),e.jsxs("div",{className:"absolute bottom-4 right-4 flex flex-col gap-2",children:[e.jsx("button",{onClick:t,className:"w-10 h-10 bg-white/90 hover:bg-white border border-gray-300 rounded-lg shadow-md flex items-center justify-center text-gray-700 font-bold transition-colors",title:o("zoom.zoomIn"),disabled:i.zoom>=1e3,children:"+"}),e.jsx("button",{onClick:s,className:"w-10 h-10 bg-white/90 hover:bg-white border border-gray-300 rounded-lg shadow-md flex items-center justify-center text-gray-700 font-bold transition-colors",title:o("zoom.zoomOut"),disabled:i.zoom<=.01,children:"‚àí"}),e.jsx("div",{className:"relative",children:e.jsx("button",{onClick:h,className:"w-10 h-10 bg-white/90 hover:bg-white border border-gray-300 rounded-lg shadow-md flex items-center justify-center text-gray-600 text-lg transition-colors",title:o("zoom.centerView"),children:"üè†"})}),e.jsxs("div",{className:`w-12 h-8 border rounded text-xs flex flex-col items-center justify-center transition-colors ${i.zoom<.5?"bg-red-50 border-red-200 text-red-700":i.zoom>100?"bg-orange-50 border-orange-200 text-orange-700":"bg-white/90 border-gray-300 text-gray-600"}`,children:[e.jsxs("div",{className:"font-semibold",children:[i.zoom>=1?Math.round(i.zoom):i.zoom.toFixed(1),"√ó"]}),i.zoom<.5&&e.jsx("div",{className:"text-[8px] leading-none",children:o("zoom.far")}),i.zoom>100&&e.jsx("div",{className:"text-[8px] leading-none",children:o("zoom.close")})]}),i.zoom<.5||i.zoom>100?e.jsx("button",{onClick:()=>n(),className:"w-10 h-6 bg-blue-500 hover:bg-blue-600 text-white text-xs rounded font-medium transition-colors",title:o("zoom.centerView"),children:o("zoom.fix")}):null]})}function as({objects:i,viewport:t,touchTargetSize:s,worldToScreen:n,selectedObjects:r=[],canvasSize:o}){const c=De(),a=f=>Math.round(f*c.fontScale),d=et(t,c.gridScale,c.snapPrecision),h=d,[C,R]=x.useState(null),[P,b]=x.useState(null),[l,m]=x.useState(null),[p,y]=x.useState(null),[S,_]=x.useState(null),[N,A]=x.useState(null),[T,G]=x.useState(null),[I,ne]=x.useState(null),oe=x.useRef(null);x.useEffect(()=>{const f=M=>{const K=M.target;p&&!(K!=null&&K.closest("circle"))&&y(null)};if(p)return document.addEventListener("touchstart",f),()=>document.removeEventListener("touchstart",f)},[p]),x.useEffect(()=>()=>{oe.current&&clearTimeout(oe.current)},[]);const Z=f=>{var K,pe;const M=r.includes(f.id);switch(f.type){case"ray":const we=n(f.properties.startPoint),se=n(f.properties.endPoint);return e.jsxs("g",{children:[M&&e.jsx("line",{x1:we.x,y1:we.y,x2:se.x,y2:se.y,stroke:"#60A5FA",strokeWidth:6,opacity:.4}),e.jsx("line",{x1:we.x,y1:we.y,x2:se.x,y2:se.y,stroke:M?"#1D4ED8":"#2563eb",strokeWidth:M?3:2}),c.showCoordinateProjections&&Math.abs(f.properties.startPoint.x)<.001&&Math.abs(f.properties.startPoint.y)<.001&&e.jsxs(e.Fragment,{children:[e.jsx("line",{x1:se.x,y1:se.y,x2:se.x,y2:n({x:f.properties.endPoint.x,y:0}).y,stroke:"#9CA3AF",strokeWidth:"1",strokeDasharray:"2,3",opacity:"0.6"}),e.jsx("line",{x1:se.x,y1:se.y,x2:n({x:0,y:f.properties.endPoint.y}).x,y2:se.y,stroke:"#9CA3AF",strokeWidth:"1",strokeDasharray:"2,3",opacity:"0.6"})]}),e.jsxs("g",{children:[e.jsx("circle",{cx:we.x,cy:we.y,r:s/4,fill:M?"#1D4ED8":"#2563eb",stroke:M?"#60A5FA":"none",strokeWidth:M?2:0,style:{cursor:"move"}}),e.jsx("circle",{cx:we.x,cy:we.y,r:Math.max(12,s/2),fill:"transparent",style:{cursor:"move"},onMouseEnter:()=>R(`${f.id}-start`),onMouseLeave:()=>R(null)})]}),e.jsxs("g",{children:[e.jsx("circle",{cx:se.x,cy:se.y,r:s/4,fill:M?"#1D4ED8":"#2563eb",stroke:M?"#60A5FA":"none",strokeWidth:M?2:0,style:{cursor:"move"}}),e.jsx("circle",{cx:se.x,cy:se.y,r:Math.max(12,s/2),fill:"transparent",style:{cursor:"move"},onMouseEnter:()=>R(`${f.id}-end`),onMouseLeave:()=>R(null)})]}),!(Math.abs(f.properties.startPoint.x)<.001&&Math.abs(f.properties.startPoint.y)<.001)&&C===`${f.id}-start`&&e.jsxs("text",{x:we.x-5,y:we.y-10,fontSize:a(10),fontWeight:"500",fill:M?"#1D4ED8":"#2563eb",textAnchor:"middle",opacity:"0.8",style:{pointerEvents:"none"},children:["(",V(f.properties.startPoint.x,h),","," ",V(f.properties.startPoint.y,h),")"]}),C===`${f.id}-end`&&e.jsxs("text",{x:Math.abs(f.properties.startPoint.x)<.001&&Math.abs(f.properties.startPoint.y)<.001?se.x-20:se.x+5,y:(()=>{const D=Math.abs(f.properties.startPoint.x)<.001&&Math.abs(f.properties.startPoint.y)<.001;return se.y-10})(),fontSize:a(10),fontWeight:"500",fill:M?"#1D4ED8":"#2563eb",textAnchor:Math.abs(f.properties.startPoint.x)<.001&&Math.abs(f.properties.startPoint.y)<.001?"end":"middle",opacity:"0.8",style:{pointerEvents:"none"},children:["(",V(f.properties.endPoint.x,h),","," ",V(f.properties.endPoint.y,h),")"]}),(()=>{const D=f.properties.endPoint.x-f.properties.startPoint.x;f.properties.endPoint.y-f.properties.startPoint.y;const g=Math.abs(f.properties.startPoint.x)<.001&&Math.abs(f.properties.startPoint.y)<.001;if(Math.abs(D)>.001){const k=se.x,$=se.y;if(g){const E=f.properties.endPoint.x,O=f.properties.endPoint.y,u=V(O,h),j=V(E,h);return e.jsxs("g",{children:[e.jsx("text",{x:k+15,y:$-25,fontSize:a(9),fontWeight:"500",fill:M?"#1D4ED8":"#2563eb",textAnchor:"middle",opacity:"0.8",children:u}),e.jsx("line",{x1:k+8,y1:$-19,x2:k+22,y2:$-19,stroke:M?"#1D4ED8":"#2563eb",strokeWidth:"1",opacity:"0.8"}),e.jsx("text",{x:k+15,y:$-9,fontSize:a(9),fontWeight:"500",fill:M?"#1D4ED8":"#2563eb",textAnchor:"middle",opacity:"0.8",children:j})]})}else return null}return null})(),(()=>{if(!(Math.abs(f.properties.startPoint.x)<.001&&Math.abs(f.properties.startPoint.y)<.001))return null;const g=f.properties.endPoint.x,k=f.properties.endPoint.y;if(Math.abs(g)<.001&&Math.abs(k)<.001)return null;const $=g,E=k,O={left:t.center.x-o.width/2/t.zoom,right:t.center.x+o.width/2/t.zoom,top:t.center.y+o.height/2/t.zoom,bottom:t.center.y-o.height/2/t.zoom},u=Math.max(Math.abs(O.left),Math.abs(O.right),Math.abs(O.top),Math.abs(O.bottom))*2,j=Math.sqrt($*$+E*E);if(j===0)return null;const w=$/j,z=E/j,F={x:u*w,y:u*z},Y=n(F),J=[];if(Math.abs(g)>.001&&Math.abs(k)>.001){const L=g,W=k;for(let q=2;q<=50;q++){const Q=L*q,be=W*q,ce=Math.round(Q/d)*d,de=Math.round(be/d)*d;if(Math.abs(Q-ce)<d/10&&Math.abs(be-de)<d/10&&ce>0&&de>0&&ce<=Math.min(100,Math.abs(u))&&de<=Math.min(100,Math.abs(u))){const ke=n({x:ce,y:de});ke.x>=-100&&ke.x<=o.width+100&&ke.y>=-100&&ke.y<=o.height+100&&J.push({world:{x:ce,y:de},screen:ke,fraction:{num:V(de,d),den:V(ce,d)}})}}}const X=Math.sqrt(g*g+k*k),ue=[];if(X>0&&c.showLengthMultiples)for(let L=2;L<=5;L++){const W=g*L,q=k*L,Q=n({x:W,y:q});Q.x>=-50&&Q.x<=o.width+50&&Q.y>=-50&&Q.y<=o.height+50&&ue.push({screen:Q,multiple:L})}return e.jsxs("g",{children:[c.showEquivalentFractions&&e.jsx("line",{x1:se.x,y1:se.y,x2:Y.x,y2:Y.y,stroke:M?"#1D4ED8":"#2563eb",strokeWidth:"1",opacity:"0.3",strokeDasharray:"3,3"}),ue.map((L,W)=>e.jsxs("g",{children:[e.jsx("circle",{cx:L.screen.x,cy:L.screen.y,r:"2",fill:M?"#1D4ED8":"#2563eb",opacity:"0.4",style:{pointerEvents:"none"}}),e.jsxs("text",{x:L.screen.x+8,y:L.screen.y-8,fontSize:a(7),fontWeight:"400",fill:M?"#1D4ED8":"#2563eb",textAnchor:"start",opacity:"0.5",style:{pointerEvents:"none"},children:["√ó",L.multiple]})]},`length-${W}`)),c.showAreaRectangle&&(()=>{if(g>0&&k>0){const L=n({x:0,y:0}),W=n({x:g,y:k}),q=Math.abs(W.x-L.x),Q=Math.abs(W.y-L.y),be=Math.min(L.x,W.x),ce=Math.min(L.y,W.y),de=g*k;return e.jsxs("g",{children:[e.jsx("rect",{x:be,y:ce,width:q,height:Q,fill:M?"#1D4ED8":"#2563eb",opacity:"0.08",stroke:M?"#1D4ED8":"#2563eb",strokeWidth:"0.5",strokeOpacity:"0.15"}),e.jsxs("text",{x:be+q/2,y:ce+15,fontSize:a(10),fontWeight:"400",fill:M?"#1D4ED8":"#2563eb",textAnchor:"middle",opacity:"0.6",children:[V(k,h)," √ó"," ",V(g,h)," ="," ",V(de,h)]})]})}return null})(),c.showDivisionMultiples&&c.showDivisionAnswer&&(()=>{if(!(Math.abs(f.properties.startPoint.x)<.001&&Math.abs(f.properties.startPoint.y)<.001)||g<=0)return null;const W=k/g,q=.15,Q=25;if(W<q)return null;const be=n({x:0,y:0}),ce=n({x:1,y:0}),de=[],ke=Math.min(Math.floor(k/W),Q);for(let Te=1;Te<=ke;Te++){const Oe=Te*W,Ae=n({x:0,y:Oe}).y,Ke=Math.abs(Oe-W)<.01;if(!c.showAreaRectangle){const fe=Math.abs(Ae-be.y)/Te,Pe=Math.abs(ce.x-be.x);de.push(e.jsx("rect",{x:be.x,y:Ae,width:Pe,height:fe,fill:M?"#1D4ED8":"#2563eb",opacity:"0.08",stroke:M?"#1D4ED8":"#2563eb",strokeWidth:"0.5",strokeOpacity:"0.15"},`division-box-${Te}`))}de.push(e.jsxs("g",{children:[e.jsx("line",{x1:be.x,y1:Ae,x2:ce.x,y2:Ae,stroke:M?"#1D4ED8":"#2563eb",strokeWidth:"1",opacity:"0.3",strokeDasharray:Ke?"4,2":"2,2"}),!Ke&&e.jsx("text",{x:ce.x+8,y:Ae-5,fontSize:a(8),fontWeight:"400",fill:M?"#1D4ED8":"#2563eb",textAnchor:"start",opacity:"0.5",children:ve(Oe)})]},`division-marker-${Te}`))}return e.jsx("g",{children:de})})(),c.showRiseRunTriangle&&(()=>{if(g>0&&k>0){const L=n({x:0,y:0}),W=n({x:g,y:0}),q=n({x:g,y:k});return e.jsxs("g",{children:[e.jsx("path",{d:`M ${L.x},${L.y} L ${W.x},${W.y} L ${q.x},${q.y} Z`,fill:"none",stroke:M?"#1D4ED8":"#2563eb",strokeWidth:"1",opacity:"0.4",strokeDasharray:"2,2",style:{pointerEvents:"none"}}),e.jsxs("text",{x:W.x+12,y:(W.y+q.y)/2,fontSize:a(9),fontWeight:"500",fill:M?"#1D4ED8":"#2563eb",textAnchor:"start",opacity:"0.7",style:{pointerEvents:"none"},children:["rise: ",V(k,h)]}),e.jsxs("text",{x:(L.x+W.x)/2,y:W.y+10,fontSize:a(9),fontWeight:"500",fill:M?"#1D4ED8":"#2563eb",textAnchor:"middle",opacity:"0.7",style:{pointerEvents:"none"},children:["run: ",V(g,h)]})]})}return null})(),c.showDistanceMarkers&&(()=>{const L=[],W=Math.sqrt(g*g+k*k);if(W>0){const q=n({x:0,y:0});let Q=Math.atan2(k,g);Q<0&&(Q=Q+2*Math.PI);const be=[];for(let de=1;de<=Math.floor(W);de++)be.push({radius:de,isUnit:!0});be.push({radius:W,isUnit:!1}),be.forEach(({radius:de,isUnit:ke},Te)=>{const Oe=de*t.zoom;if(Oe>=15&&Oe<=800&&Math.abs(Q)>.05){const Ae=Q>Math.PI?1:0,fe=`M ${q.x+Oe},${q.y} A ${Oe},${Oe} 0 ${Ae},0 ${q.x+Oe*Math.cos(Q)},${q.y-Oe*Math.sin(Q)}`;L.push(e.jsx("path",{d:fe,fill:"none",stroke:M?"#1D4ED8":"#2563eb",strokeWidth:ke?"1":"1.5",opacity:ke?"0.3":"0.6",strokeDasharray:ke?"2,2":"none"},`radial-${f.id}-${de.toFixed(3)}-${Q.toFixed(3)}-${Te}`))}});const ce=n({x:W,y:0});L.push(e.jsxs("g",{children:[e.jsx("path",{d:`M ${ce.x},${q.y} L ${ce.x-4},${q.y+8} L ${ce.x+4},${q.y+8} Z`,fill:M?"#1D4ED8":"#2563eb",opacity:"0.7"}),e.jsxs("text",{x:ce.x+15,y:q.y-8,fontSize:a(10),fontWeight:"600",fill:M?"#1D4ED8":"#2563eb",textAnchor:"start",opacity:"0.8",children:["d = ",W.toFixed(3).replace(/\.?0+$/,"")]})]},`distance-${f.id}`))}return e.jsx("g",{children:L})})(),c.showAngleArc&&(()=>{let L=Math.atan2(k,g);if(L<0&&(L=L+2*Math.PI),Math.abs(g)>.05||Math.abs(k)>.05){const W=n({x:0,y:0}),q=50,Q=(L*180/Math.PI).toFixed(1),be=L,ce=L>Math.PI?1:0,de=`M ${W.x+q},${W.y} A ${q},${q} 0 ${ce},0 ${W.x+q*Math.cos(be)},${W.y-q*Math.sin(be)}`,ke=L/2,Te=q*.7,Oe=W.x+Te*Math.cos(ke),Ae=W.y-Te*Math.sin(ke);return e.jsxs("g",{children:[e.jsx("path",{d:de,fill:"none",stroke:M?"#1D4ED8":"#2563eb",strokeWidth:"2",opacity:"0.6"}),e.jsxs("text",{x:Oe,y:Ae,fontSize:a(11),fontWeight:"600",fill:M?"#1D4ED8":"#2563eb",textAnchor:"middle",opacity:"0.8",children:["Œ∏ = ",Q,"¬∞"]})]})}return null})(),c.showEquivalentFractions&&J.map((L,W)=>{const Q=Math.abs(L.world.x-1)<.1&&c.showDivisionAnswer,be=Math.abs(L.world.x-g)<.1&&Math.abs(L.world.y-k)<.1;return Q||be?null:e.jsxs("g",{children:[e.jsx("circle",{cx:L.screen.x,cy:L.screen.y,r:"4",fill:"white",stroke:"#22C55E",strokeWidth:"2",opacity:"0.8",style:{pointerEvents:"none"}}),e.jsxs("text",{x:L.screen.x+15,y:L.screen.y+4,fontSize:a(9),fontWeight:"500",fill:"#22C55E",textAnchor:"start",opacity:"0.8",style:{pointerEvents:"none"},children:[L.fraction.num,"/",L.fraction.den]})]},`equiv-${W}`)})]})})()]},f.id);case"rectangle":const B=n({x:f.properties.x,y:f.properties.y+f.properties.height}),me=f.properties.width*t.zoom,v=f.properties.height*t.zoom,U={x:f.properties.x,y:f.properties.y},le={x:f.properties.x+f.properties.width,y:f.properties.y},ye={x:f.properties.x,y:f.properties.y+f.properties.height},Fe={x:f.properties.x+f.properties.width,y:f.properties.y+f.properties.height};return e.jsxs("g",{children:[M&&e.jsx("rect",{x:B.x-3,y:B.y-3,width:me+6,height:v+6,fill:"none",stroke:"#60A5FA",strokeWidth:4,opacity:.5,style:{cursor:"pointer"}}),e.jsx("rect",{x:B.x,y:B.y,width:me,height:v,fill:M?"rgba(34, 197, 94, 0.3)":"rgba(34, 197, 94, 0.2)",stroke:M?"#16A34A":"#22c55e",strokeWidth:M?3:2,style:{cursor:"pointer"}}),e.jsxs("g",{children:[e.jsx("circle",{cx:B.x,cy:B.y,r:Math.max(6,s/6),fill:M?"#16A34A":"#22c55e",stroke:M?"#60A5FA":"none",strokeWidth:M?2:0,style:{cursor:"nw-resize"}}),e.jsx("circle",{cx:B.x,cy:B.y,r:s/2,fill:"transparent",style:{cursor:"nw-resize"}})]}),e.jsxs("g",{children:[e.jsx("circle",{cx:B.x+me,cy:B.y,r:Math.max(6,s/6),fill:M?"#16A34A":"#22c55e",stroke:M?"#60A5FA":"none",strokeWidth:M?2:0,style:{cursor:"ne-resize"}}),e.jsx("circle",{cx:B.x+me,cy:B.y,r:s/2,fill:"transparent",style:{cursor:"ne-resize"}})]}),e.jsxs("g",{children:[e.jsx("circle",{cx:B.x,cy:B.y+v,r:Math.max(6,s/6),fill:M?"#16A34A":"#22c55e",stroke:M?"#60A5FA":"none",strokeWidth:M?2:0,style:{cursor:"sw-resize"}}),e.jsx("circle",{cx:B.x,cy:B.y+v,r:s/2,fill:"transparent",style:{cursor:"sw-resize"}})]}),e.jsxs("g",{children:[e.jsx("circle",{cx:B.x+me,cy:B.y+v,r:Math.max(6,s/6),fill:M?"#16A34A":"#22c55e",stroke:M?"#60A5FA":"none",strokeWidth:M?2:0,style:{cursor:"se-resize"}}),e.jsx("circle",{cx:B.x+me,cy:B.y+v,r:s/2,fill:"transparent",style:{cursor:"se-resize"}})]}),e.jsxs("text",{x:B.x-10,y:B.y-5,fontSize:a(9),fontWeight:"500",fill:"#22c55e",textAnchor:"end",opacity:"0.8",children:["(",V(ye.x,h),","," ",V(ye.y,h),")"]}),e.jsxs("text",{x:B.x+me+10,y:B.y-5,fontSize:a(9),fontWeight:"500",fill:"#22c55e",textAnchor:"start",opacity:"0.8",children:["(",V(Fe.x,h),","," ",V(Fe.y,h),")"]}),e.jsxs("text",{x:B.x-10,y:B.y+v+15,fontSize:a(9),fontWeight:"500",fill:"#22c55e",textAnchor:"end",opacity:"0.8",children:["(",V(U.x,h),","," ",V(U.y,h),")"]}),e.jsxs("text",{x:B.x+me+10,y:B.y+v+15,fontSize:a(9),fontWeight:"500",fill:"#22c55e",textAnchor:"start",opacity:"0.8",children:["(",V(le.x,h),","," ",V(le.y,h),")"]}),e.jsxs("text",{x:B.x+me/2,y:B.y+v/2,fontSize:a(12),fontWeight:"600",fill:"#22c55e",textAnchor:"middle",opacity:"0.9",children:[V(f.properties.height,h)," √ó"," ",V(f.properties.width,h)," ="," ",V(f.properties.area,h)]}),(()=>{const D=f.properties.width,g=f.properties.height,k=f.properties.area;if(D<=0||g<=0||D!==Math.floor(D)||g!==Math.floor(g))return null;const $=[];if(c.showFactorPairs&&k>1&&k<=50){const E=[];for(let O=1;O<=Math.sqrt(k);O++)if(k%O===0){const u=k/O;(O!==D||u!==g)&&E.push({w:O,h:u})}E.forEach((O,u)=>{const j=(u+1)*(me+20),w={x:B.x+j,y:B.y,width:O.w*t.zoom,height:O.h*t.zoom};$.push(e.jsx("rect",{x:w.x,y:w.y,width:w.width,height:w.height,fill:"rgba(168, 85, 247, 0.15)",stroke:"#A855F7",strokeWidth:"1",strokeDasharray:"3,3",opacity:"0.7"},`factor-${u}`))})}if(c.showCommutativeProperty&&D!==g){const E={x:B.x-v-30,y:B.y,width:g*t.zoom,height:D*t.zoom};$.push(e.jsxs("g",{children:[e.jsx("rect",{x:E.x,y:E.y,width:E.width,height:E.height,fill:"rgba(59, 130, 246, 0.15)",stroke:"#3B82F6",strokeWidth:"1",strokeDasharray:"4,2",opacity:"0.7"}),e.jsx("path",{d:`M ${E.x+E.width+5},${E.y+E.height/2} L ${B.x-5},${B.y+v/2}`,stroke:"#3B82F6",strokeWidth:"1",fill:"none",markerEnd:"url(#arrowhead)",opacity:"0.6"})]},"commutative"))}if(c.showPrimeComposite&&k>1&&k<=100){const E=k>1&&![...Array(Math.floor(Math.sqrt(k))+1).keys()].slice(2).some(O=>k%O===0);$.push(e.jsxs("g",{children:[e.jsx("circle",{cx:B.x+me+15,cy:B.y-15,r:"8",fill:E?"#10B981":"#F59E0B",opacity:"0.8"}),e.jsx("text",{x:B.x+me+15,y:B.y-11,fontSize:a(8),fontWeight:"600",fill:"white",textAnchor:"middle",children:E?"P":"C"}),e.jsx("text",{x:B.x+me+30,y:B.y-10,fontSize:a(8),fontWeight:"500",fill:E?"#10B981":"#F59E0B",textAnchor:"start",opacity:"0.8",children:E?"Prime":"Composite"})]},"prime-composite"))}if(c.showGCF&&D>1&&g>1){const E=(u,j)=>j===0?u:E(j,u%j),O=E(D,g);if(O>1){const u=O*t.zoom,j=D/O,w=g/O,z=[];for(let F=0;F<j;F++)for(let Y=0;Y<w;Y++)z.push(e.jsx("rect",{x:B.x+F*u,y:B.y+Y*u,width:u,height:u,fill:"none",stroke:"#10B981",strokeWidth:"1.5",opacity:"0.6"},`gcf-${F}-${Y}`));$.push(e.jsxs("g",{children:[z,e.jsxs("text",{x:B.x+me/2,y:B.y-25,fontSize:a(10),fontWeight:"600",fill:"#10B981",textAnchor:"middle",opacity:"0.9",children:["GCF(",D,", ",g,") = ",O]}),e.jsxs("text",{x:B.x+me/2,y:B.y-10,fontSize:a(8),fontWeight:"500",fill:"#10B981",textAnchor:"middle",opacity:"0.7",children:[w," √ó ",j," squares (side = ",O,")"]})]},"gcf"))}}if(c.showLCM&&D>1&&g>1){const E=(j,w)=>w===0?j:E(w,j%w),u=((j,w)=>j*w/E(j,w))(D,g);if(u>Math.max(D,g)&&u<=100){const j=u*t.zoom,w=u*t.zoom,z=B.x,F=B.y+v-w,Y=u/D,J=u/g,X=[];for(let ue=0;ue<J;ue++)for(let L=0;L<Y;L++){const W=z+L*(D*t.zoom),q=F+ue*(g*t.zoom);X.push(e.jsx("rect",{x:W,y:q,width:D*t.zoom,height:g*t.zoom,fill:"rgba(245, 158, 11, 0.1)",stroke:"#F59E0B",strokeWidth:"1",strokeDasharray:"2,2",opacity:"0.6",pointerEvents:"none"},`shadow-${ue}-${L}`))}$.push(e.jsxs("g",{children:[e.jsx("rect",{x:z,y:F,width:j,height:w,fill:"none",stroke:"#F59E0B",strokeWidth:"2",strokeDasharray:"5,5",opacity:"0.8",pointerEvents:"none"}),X,e.jsxs("text",{x:z+j/2,y:F-15,fontSize:a(10),fontWeight:"600",fill:"#F59E0B",textAnchor:"middle",opacity:"0.9",pointerEvents:"none",children:["LCM(",D,", ",g,") = ",u]}),e.jsxs("text",{x:z+j/2,y:F-2,fontSize:a(8),fontWeight:"500",fill:"#F59E0B",textAnchor:"middle",opacity:"0.7",pointerEvents:"none",children:[Y," √ó ",J," ="," ",Y*J," rectangles"]})]},"lcm"))}}if(c.showDistributiveProperty&&D>2&&g>1){const E=Math.floor(D/2),O=E*t.zoom,u=(D-E)*t.zoom;$.push(e.jsxs("g",{children:[e.jsx("line",{x1:B.x+O,y1:B.y,x2:B.x+O,y2:B.y+v,stroke:"#EF4444",strokeWidth:"2",opacity:"0.8"}),e.jsxs("text",{x:B.x+O/2,y:B.y+v+20,fontSize:a(9),fontWeight:"500",fill:"#EF4444",textAnchor:"middle",opacity:"0.8",children:[g," √ó ",E," = ",g*E]}),e.jsxs("text",{x:B.x+O+u/2,y:B.y+v+20,fontSize:a(9),fontWeight:"500",fill:"#EF4444",textAnchor:"middle",opacity:"0.8",children:[g," √ó ",D-E," = ",g*(D-E)]}),e.jsxs("text",{x:B.x+me/2,y:B.y+v+40,fontSize:a(10),fontWeight:"600",fill:"#EF4444",textAnchor:"middle",opacity:"0.9",children:[g," √ó (",E," + ",D-E,") = ",g*E," ","+ ",g*(D-E)," = ",k]})]},"distributive"))}return $})()]},f.id);case"circle":const H=n(f.properties.center),Ne=f.properties.radius*t.zoom,We=c.showTangentLines&&(l===f.id&&P||p&&p.circleId===f.id);let ie=null;if(We){let D=null;if(p&&p.circleId===f.id?D=p.point:P&&l===f.id&&(D={x:(P.x-o.width/2)/t.zoom+t.center.x,y:-(P.y-o.height/2)/t.zoom+t.center.y}),D){const g=D.x-f.properties.center.x,k=D.y-f.properties.center.y,$=Math.atan2(k,g),E={x:f.properties.center.x+f.properties.radius*Math.cos($),y:f.properties.center.y+f.properties.radius*Math.sin($)},O=k/g,u=isFinite(O)&&O!==0?-1/O:null,j=Math.max(o.width,o.height)/t.zoom,w={x:E.x-j*Math.cos($+Math.PI/2),y:E.y-j*Math.sin($+Math.PI/2)},z={x:E.x+j*Math.cos($+Math.PI/2),y:E.y+j*Math.sin($+Math.PI/2)};ie={point:E,start:w,end:z,slope:u,angle:$}}}return e.jsxs("g",{children:[M&&e.jsx("circle",{cx:H.x,cy:H.y,r:Ne+3,fill:"none",stroke:"#60A5FA",strokeWidth:4,opacity:.5}),e.jsx("circle",{cx:H.x,cy:H.y,r:Ne*1.8,fill:"transparent",style:{cursor:"pointer"},onMouseEnter:()=>{oe.current&&(clearTimeout(oe.current),oe.current=null),m(f.id)},onMouseLeave:()=>{oe.current=setTimeout(()=>{m(null),b(null)},100)},onMouseMove:D=>{var g;if(c.showTangentLines&&l===f.id){const k=(g=D.currentTarget.ownerSVGElement)==null?void 0:g.getBoundingClientRect();k&&b({x:D.clientX-k.left,y:D.clientY-k.top})}},onTouchStart:D=>{var g;if(c.showTangentLines){D.preventDefault();const k=(g=D.currentTarget.ownerSVGElement)==null?void 0:g.getBoundingClientRect();if(k&&D.touches[0]){const $={x:D.touches[0].clientX-k.left,y:D.touches[0].clientY-k.top},E={x:($.x-o.width/2)/t.zoom+t.center.x,y:-($.y-o.height/2)/t.zoom+t.center.y},O=E.x-f.properties.center.x,j=(E.y-f.properties.center.y)/O,w=isFinite(j)?-1/j:null;y({circleId:f.id,point:E,slope:w})}}},onTouchEnd:()=>{setTimeout(()=>y(null),100)}}),e.jsx("circle",{cx:H.x,cy:H.y,r:Ne,fill:M?"rgba(168, 85, 247, 0.15)":"rgba(168, 85, 247, 0.1)",stroke:M?"#7C3AED":"#A855F7",strokeWidth:M?3:2,style:{cursor:"pointer",pointerEvents:"none"}}),ie&&e.jsxs("g",{children:[e.jsx("line",{x1:n(ie.start).x,y1:n(ie.start).y,x2:n(ie.end).x,y2:n(ie.end).y,stroke:"#EF4444",strokeWidth:"2",opacity:"0.7",strokeDasharray:"4,2"}),e.jsx("circle",{cx:n(ie.point).x,cy:n(ie.point).y,r:"3",fill:"#EF4444",opacity:"0.8"}),e.jsx("line",{x1:H.x,y1:H.y,x2:n(ie.point).x,y2:n(ie.point).y,stroke:"#EF4444",strokeWidth:"1",opacity:"0.5",strokeDasharray:"2,2"}),ie.slope!==null&&isFinite(ie.slope)&&e.jsxs("text",{x:n(ie.point).x+15,y:n(ie.point).y-10,fontSize:a(10),fontWeight:"500",fill:"#EF4444",textAnchor:"start",opacity:"0.9",children:["slope = ",ie.slope.toFixed(2)]}),(ie.slope===null||!isFinite(ie.slope))&&e.jsx("text",{x:n(ie.point).x+15,y:n(ie.point).y-10,fontSize:a(10),fontWeight:"500",fill:"#EF4444",textAnchor:"start",opacity:"0.9",children:"slope = ‚àû"})]}),e.jsx("circle",{cx:H.x,cy:H.y,r:s/6,fill:M?"#7C3AED":"#A855F7",stroke:M?"#60A5FA":"none",strokeWidth:M?2:0,style:{cursor:"move"}}),e.jsx("circle",{cx:H.x+Ne,cy:H.y,r:s/6,fill:M?"#7C3AED":"#A855F7",stroke:M?"#60A5FA":"none",strokeWidth:M?2:0,style:{cursor:"ew-resize"}}),e.jsx("line",{x1:H.x,y1:H.y,x2:H.x+Ne,y2:H.y,stroke:M?"#7C3AED":"#A855F7",strokeWidth:"1",opacity:"0.6",strokeDasharray:"2,2"}),e.jsxs("text",{x:H.x,y:H.y-Ne-25,fontSize:a(10),fontWeight:"500",fill:M?"#7C3AED":"#A855F7",textAnchor:"middle",opacity:"0.8",children:["r = ",ve(f.properties.radius)]}),e.jsxs("text",{x:H.x,y:H.y-Ne-15,fontSize:a(9),fontWeight:"400",fill:M?"#7C3AED":"#A855F7",textAnchor:"middle",opacity:"0.7",children:["A = ",ve(f.properties.area)]}),e.jsxs("text",{x:H.x,y:H.y-Ne-5,fontSize:a(9),fontWeight:"400",fill:M?"#7C3AED":"#A855F7",textAnchor:"middle",opacity:"0.7",children:["C = ",ve(f.properties.circumference)]})]},f.id);case"triangle":const te=f.properties.vertices.map(n),[xe,ge,Se]=te,_e=f.properties.vertices,he=(()=>{const[D,g,k]=_e,$=Math.sqrt((g.x-k.x)**2+(g.y-k.y)**2),E=Math.sqrt((D.x-k.x)**2+(D.y-k.y)**2),O=Math.sqrt((D.x-g.x)**2+(D.y-g.y)**2),u=Math.acos((E**2+O**2-$**2)/(2*E*O))*180/Math.PI,j=Math.acos(($**2+O**2-E**2)/(2*$*O))*180/Math.PI,w=180-u-j,z=1;let F="scalene",Y=!1,J=!1,X="";Math.abs(u-90)<z||Math.abs(j-90)<z||Math.abs(w-90)<z?(Y=!0,F="right"):u>90||j>90||w>90?F="obtuse":F="acute",Math.abs($-E)<.1&&Math.abs(E-O)<.1?F="equilateral":(Math.abs($-E)<.1||Math.abs(E-O)<.1||Math.abs($-O)<.1)&&(F="isosceles");const ue=[u,j,w].sort((L,W)=>L-W);return Math.abs(ue[0]-30)<z&&Math.abs(ue[1]-60)<z&&Math.abs(ue[2]-90)<z?(J=!0,X="30-60-90"):Math.abs(ue[0]-45)<z&&Math.abs(ue[1]-45)<z&&Math.abs(ue[2]-90)<z&&(J=!0,X="45-45-90"),{sideA:$,sideB:E,sideC:O,angleA:u,angleB:j,angleC:w,classification:F,isRight:Y,isSpecial:J,specialType:X,area:f.properties.area}})(),ae=(()=>{if(!c.showSOHCAHTOA||!he.isRight)return null;const D=[{index:0,value:he.angleA},{index:1,value:he.angleB},{index:2,value:he.angleC}],g=D.find(j=>Math.abs(j.value-90)<1),k=D.filter(j=>j.value<89);if(!g||k.length<2)return null;const $=k.reduce((j,w)=>w.value>j.value?w:j),E=g.index,O=$.index,u=[0,1,2].find(j=>j!==E&&j!==O);return{referenceAngle:$,rightVertex:E,refVertex:O,thirdVertex:u,hypotenuseStart:O,hypotenuseEnd:u,oppositeStart:E,oppositeEnd:u,adjacentStart:O,adjacentEnd:E}})();return e.jsxs("g",{children:[c.showSpecialTriangles&&he.isSpecial&&e.jsx("path",{d:`M ${xe.x},${xe.y} L ${ge.x},${ge.y} L ${Se.x},${Se.y} Z`,fill:"rgba(255, 215, 0, 0.15)",stroke:"none"}),M&&e.jsx("path",{d:`M ${xe.x},${xe.y} L ${ge.x},${ge.y} L ${Se.x},${Se.y} Z`,fill:"none",stroke:"#60A5FA",strokeWidth:6,opacity:.4}),e.jsx("path",{d:`M ${xe.x},${xe.y} L ${ge.x},${ge.y} L ${Se.x},${Se.y} Z`,fill:M?"rgba(245, 101, 101, 0.15)":"rgba(245, 101, 101, 0.1)",stroke:M?"#DC2626":"#F56565",strokeWidth:M?3:2,style:{cursor:"pointer"},onMouseEnter:()=>{c.showTrigValues&&_(f.id)},onMouseLeave:()=>{_(null),A(null)},onMouseMove:D=>{var g;if(c.showTrigValues&&S===f.id){const k=(g=D.currentTarget.ownerSVGElement)==null?void 0:g.getBoundingClientRect();k&&A({x:D.clientX-k.left,y:D.clientY-k.top})}}}),ae&&e.jsxs("g",{children:[e.jsx("circle",{cx:te[ae.referenceAngle.index].x,cy:te[ae.referenceAngle.index].y,r:"8",fill:"rgba(255, 215, 0, 0.3)",stroke:"#FFA500",strokeWidth:"2"}),e.jsxs("g",{children:[e.jsx("line",{x1:te[ae.hypotenuseStart].x,y1:te[ae.hypotenuseStart].y,x2:te[ae.hypotenuseEnd].x,y2:te[ae.hypotenuseEnd].y,stroke:"#00AA00",strokeWidth:"5",opacity:"0.8"}),e.jsx("text",{x:(te[ae.hypotenuseStart].x+te[ae.hypotenuseEnd].x)/2,y:(te[ae.hypotenuseStart].y+te[ae.hypotenuseEnd].y)/2-15,fontSize:a(11),fontWeight:"700",fill:"#00AA00",textAnchor:"middle",children:"HYPOTENUSE"}),e.jsx("line",{x1:te[ae.oppositeStart].x,y1:te[ae.oppositeStart].y,x2:te[ae.oppositeEnd].x,y2:te[ae.oppositeEnd].y,stroke:"#FF0000",strokeWidth:"4",opacity:"0.8"}),e.jsx("text",{x:(te[ae.oppositeStart].x+te[ae.oppositeEnd].x)/2+15,y:(te[ae.oppositeStart].y+te[ae.oppositeEnd].y)/2,fontSize:a(10),fontWeight:"600",fill:"#FF0000",textAnchor:"middle",children:"OPPOSITE"}),e.jsx("line",{x1:te[ae.adjacentStart].x,y1:te[ae.adjacentStart].y,x2:te[ae.adjacentEnd].x,y2:te[ae.adjacentEnd].y,stroke:"#0000FF",strokeWidth:"4",opacity:"0.8"}),e.jsx("text",{x:(te[ae.adjacentStart].x+te[ae.adjacentEnd].x)/2,y:(te[ae.adjacentStart].y+te[ae.adjacentEnd].y)/2+20,fontSize:a(10),fontWeight:"600",fill:"#0000FF",textAnchor:"middle",children:"ADJACENT"}),e.jsxs("text",{x:te[ae.refVertex].x,y:te[ae.refVertex].y-25,fontSize:a(10),fontWeight:"700",fill:"#FFA500",textAnchor:"middle",children:["Reference Angle:"," ",ae.referenceAngle.value.toFixed(1),"¬∞"]})]})]}),c.showPythagoreanSquares&&he.isRight&&e.jsx("g",{children:(()=>{var Le;const D=(Le=[{index:0,angle:he.angleA},{index:1,angle:he.angleB},{index:2,angle:he.angleC}].find(ze=>Math.abs(ze.angle-90)<1))==null?void 0:Le.index;if(D===void 0)return null;const g=_e[D],k=_e[(D+1)%3],$=_e[(D+2)%3],E=Math.sqrt((g.x-k.x)**2+(g.y-k.y)**2),O=Math.sqrt((g.x-$.x)**2+(g.y-$.y)**2),u=Math.sqrt((k.x-$.x)**2+(k.y-$.y)**2),j={x:(k.x-g.x)/E,y:(k.y-g.y)/E},w={x:($.x-g.x)/O,y:($.y-g.y)/O},z={x:($.x-k.x)/u,y:($.y-k.y)/u},F=(ze,$e,Xe,Ue)=>{const Ze=(ct,qt,gt)=>(ct.x-gt.x)*(qt.y-gt.y)-(qt.x-gt.x)*(ct.y-gt.y),tt=Ze(ze,$e,Xe),at=Ze(ze,Xe,Ue),Re=Ze(ze,Ue,$e),xt=tt<0||at<0||Re<0,Ie=tt>0||at>0||Re>0;return!(xt&&Ie)},Y={x:-j.y,y:j.x},J={x:j.y,y:-j.x},X={x:-w.y,y:w.x},ue={x:w.y,y:-w.x},L={x:-z.y,y:z.x},W={x:z.y,y:-z.x},q={x:g.x+E*Y.x*.1,y:g.y+E*Y.y*.1};g.x+E*J.x*.1,g.y+E*J.y*.1;const Q=F(q,g,k,$)?J:Y,be={x:g.x+O*X.x*.1,y:g.y+O*X.y*.1};g.x+O*ue.x*.1,g.y+O*ue.y*.1;const ce=F(be,g,k,$)?ue:X,de={x:(k.x+$.x)/2,y:(k.y+$.y)/2},ke={x:de.x+u*L.x*.1,y:de.y+u*L.y*.1},Te=F(ke,g,k,$)?W:L,Oe=[g,{x:g.x+E*j.x,y:g.y+E*j.y},{x:g.x+E*j.x+E*Q.x,y:g.y+E*j.y+E*Q.y},{x:g.x+E*Q.x,y:g.y+E*Q.y}],Ae=[g,{x:g.x+O*w.x,y:g.y+O*w.y},{x:g.x+O*w.x+O*ce.x,y:g.y+O*w.y+O*ce.y},{x:g.x+O*ce.x,y:g.y+O*ce.y}],Ke=[k,$,{x:$.x+u*Te.x,y:$.y+u*Te.y},{x:k.x+u*Te.x,y:k.y+u*Te.y}],fe=Oe.map(n),Pe=Ae.map(n),Ce=Ke.map(n);return e.jsxs("g",{children:[e.jsx("path",{d:`M ${fe[0].x},${fe[0].y} L ${fe[1].x},${fe[1].y} L ${fe[2].x},${fe[2].y} L ${fe[3].x},${fe[3].y} Z`,fill:"rgba(59, 130, 246, 0.3)",stroke:"#3B82F6",strokeWidth:"2",opacity:"0.8"}),e.jsxs("text",{x:(fe[0].x+fe[1].x+fe[2].x+fe[3].x)/4,y:(fe[0].y+fe[1].y+fe[2].y+fe[3].y)/4,fontSize:a(10),fontWeight:"600",fill:"#1D4ED8",textAnchor:"middle",children:["a¬≤ = ",(E**2).toFixed(1)]}),e.jsx("path",{d:`M ${Pe[0].x},${Pe[0].y} L ${Pe[1].x},${Pe[1].y} L ${Pe[2].x},${Pe[2].y} L ${Pe[3].x},${Pe[3].y} Z`,fill:"rgba(239, 68, 68, 0.3)",stroke:"#EF4444",strokeWidth:"2",opacity:"0.8"}),e.jsxs("text",{x:(Pe[0].x+Pe[1].x+Pe[2].x+Pe[3].x)/4,y:(Pe[0].y+Pe[1].y+Pe[2].y+Pe[3].y)/4,fontSize:a(10),fontWeight:"600",fill:"#DC2626",textAnchor:"middle",children:["b¬≤ = ",(O**2).toFixed(1)]}),e.jsx("path",{d:`M ${Ce[0].x},${Ce[0].y} L ${Ce[1].x},${Ce[1].y} L ${Ce[2].x},${Ce[2].y} L ${Ce[3].x},${Ce[3].y} Z`,fill:"rgba(34, 197, 94, 0.3)",stroke:"#22C55E",strokeWidth:"2",opacity:"0.8"}),e.jsxs("text",{x:(Ce[0].x+Ce[1].x+Ce[2].x+Ce[3].x)/4,y:(Ce[0].y+Ce[1].y+Ce[2].y+Ce[3].y)/4,fontSize:a(10),fontWeight:"600",fill:"#16A34A",textAnchor:"middle",children:["c¬≤ = ",(u**2).toFixed(1)]}),(()=>{const ze={x:(xe.x+ge.x+Se.x)/3,y:(xe.y+ge.y+Se.y)/3},$e=[...fe,...Pe,...Ce],Xe=Math.min(...$e.map(Ie=>Ie.x)),Ue=Math.max(...$e.map(Ie=>Ie.x)),Ze=Math.min(...$e.map(Ie=>Ie.y)),tt=Math.max(...$e.map(Ie=>Ie.y)),at=[{x:(Xe+Ue)/2,y:tt+40,label:"below"},{x:(Xe+Ue)/2,y:Ze-40,label:"above"},{x:Xe-80,y:(Ze+tt)/2,label:"left"},{x:Ue+80,y:(Ze+tt)/2,label:"right"}];let Re=at[0],xt=1/0;return at.forEach(Ie=>{const ct=Math.sqrt((Ie.x-ze.x)**2+(Ie.y-ze.y)**2);ct<xt&&(xt=ct,Re=Ie)}),e.jsxs("g",{children:[e.jsx("rect",{x:Re.x-85,y:Re.y-20,width:"170",height:"35",fill:"rgba(255, 255, 255, 0.9)",stroke:"#374151",strokeWidth:"1",rx:"6",opacity:"0.95"}),e.jsxs("text",{x:Re.x,y:Re.y-5,fontSize:a(11),fontWeight:"700",fill:"#374151",textAnchor:"middle",opacity:"1",children:[(E**2).toFixed(1)," +"," ",(O**2).toFixed(1)," ="," ",(u**2).toFixed(1)]}),e.jsx("text",{x:Re.x,y:Re.y+10,fontSize:a(10),fontWeight:"600",fill:"#6B7280",textAnchor:"middle",opacity:"1",children:"a¬≤ + b¬≤ = c¬≤"})]})})()]})})()}),c.showTriangleAltitudes&&e.jsx("g",{children:_e.map((D,g)=>{const k=_e[(g+1)%3],$=_e[(g+2)%3],E=$.x-k.x,O=$.y-k.y,u=Math.sqrt(E*E+O*O);if(u===0)return null;const j=((D.x-k.x)*E+(D.y-k.y)*O)/(u*u),w={x:k.x+j*E,y:k.y+j*O},z=n(D),F=n(w);return e.jsxs("g",{children:[e.jsx("line",{x1:z.x,y1:z.y,x2:F.x,y2:F.y,stroke:"#9CA3AF",strokeWidth:"1",strokeDasharray:"3,3",opacity:"0.7"}),e.jsx("circle",{cx:F.x,cy:F.y,r:"2",fill:"#9CA3AF",opacity:"0.7"})]},`altitude-${g}`)})}),te.map((D,g)=>e.jsx("circle",{cx:D.x,cy:D.y,r:s/6,fill:M?"#DC2626":"#F56565",stroke:M?"#60A5FA":"none",strokeWidth:M?2:0,style:{cursor:"move"}},`vertex-${g}`)),c.showTriangleAngles&&e.jsxs("g",{children:[[{vertex:xe,angle:he.angleA,label:"A"},{vertex:ge,angle:he.angleB,label:"B"},{vertex:Se,angle:he.angleC,label:"C"}].map((D,g)=>e.jsxs("text",{x:D.vertex.x+(g===0?-25:g===1?25:0),y:D.vertex.y+(g===2?25:-15),fontSize:a(9),fontWeight:"600",fill:M?"#DC2626":"#F56565",textAnchor:"middle",opacity:"0.9",children:[D.label,": ",D.angle.toFixed(1),"¬∞"]},`angle-${g}`)),e.jsxs("text",{x:(xe.x+ge.x+Se.x)/3,y:(xe.y+ge.y+Se.y)/3+20,fontSize:a(8),fontWeight:"400",fill:M?"#DC2626":"#F56565",textAnchor:"middle",opacity:"0.6",children:["Sum:"," ",(he.angleA+he.angleB+he.angleC).toFixed(1),"¬∞"]})]}),c.showTriangleClassification&&e.jsxs("g",{children:[e.jsx("text",{x:(xe.x+ge.x+Se.x)/3,y:(xe.y+ge.y+Se.y)/3-15,fontSize:a(11),fontWeight:"600",fill:he.isSpecial?"#FFA500":M?"#DC2626":"#F56565",textAnchor:"middle",opacity:"0.9",children:he.isSpecial?he.specialType:he.classification}),he.isSpecial&&e.jsx("text",{x:(xe.x+ge.x+Se.x)/3,y:(xe.y+ge.y+Se.y)/3-2,fontSize:a(9),fontWeight:"500",fill:"#FFA500",textAnchor:"middle",opacity:"0.8",children:"Special Triangle!"})]}),e.jsxs("text",{x:(xe.x+ge.x+Se.x)/3,y:(xe.y+ge.y+Se.y)/3+(c.showTriangleAngles?35:8),fontSize:a(10),fontWeight:"500",fill:M?"#DC2626":"#F56565",textAnchor:"middle",opacity:"0.8",children:["Area = ",ve(he.area)]}),c.showTrigValues&&S===f.id&&N&&e.jsx("g",{children:(()=>{const D=[{label:"A",value:he.angleA,index:0},{label:"B",value:he.angleB,index:1},{label:"C",value:he.angleC,index:2}];let g=D[0],k=1/0;D.forEach(j=>{const w=te[j.index],z=Math.sqrt((N.x-w.x)**2+(N.y-w.y)**2);z<k&&(k=z,g=j)});const $=g.value*Math.PI/180,E=Math.sin($),O=Math.cos($),u=Math.tan($);return e.jsxs("g",{children:[e.jsx("rect",{x:N.x+10,y:N.y-55,width:"140",height:"60",fill:"rgba(255, 255, 255, 0.95)",stroke:"#374151",strokeWidth:"1",rx:"4"}),e.jsxs("text",{x:N.x+80,y:N.y-40,fontSize:a(9),fontWeight:"600",fill:"#374151",textAnchor:"middle",children:["Angle ",g.label,":"," ",g.value.toFixed(1),"¬∞"]}),e.jsxs("text",{x:N.x+80,y:N.y-28,fontSize:a(8),fontWeight:"500",fill:"#374151",textAnchor:"middle",children:["sin = ",E.toFixed(3)]}),e.jsxs("text",{x:N.x+80,y:N.y-16,fontSize:a(8),fontWeight:"500",fill:"#374151",textAnchor:"middle",children:["cos = ",O.toFixed(3)]}),e.jsxs("text",{x:N.x+80,y:N.y-4,fontSize:a(8),fontWeight:"500",fill:"#374151",textAnchor:"middle",children:["tan = ",isFinite(u)?u.toFixed(3):"‚àû"]})]})})()}),e.jsx("text",{x:(xe.x+ge.x)/2,y:(xe.y+ge.y)/2-10,fontSize:a(8),fontWeight:"400",fill:M?"#DC2626":"#F56565",textAnchor:"middle",opacity:"0.6",children:ve(he.sideC)}),e.jsx("text",{x:(ge.x+Se.x)/2+10,y:(ge.y+Se.y)/2,fontSize:a(8),fontWeight:"400",fill:M?"#DC2626":"#F56565",textAnchor:"middle",opacity:"0.6",children:ve(he.sideA)}),e.jsx("text",{x:(xe.x+Se.x)/2-10,y:(xe.y+Se.y)/2,fontSize:a(8),fontWeight:"400",fill:M?"#DC2626":"#F56565",textAnchor:"middle",opacity:"0.6",children:ve(he.sideB)})]},f.id);case"function":const Me=f,qe=Me.properties.points;if(!qe||qe.length<2)return null;const ot=qe.map(n).reduce((D,g,k)=>k===0?`M ${g.x} ${g.y}`:`${D} L ${g.x} ${g.y}`,""),Ye=n({x:Me.properties.domain.min,y:((K=qe[0])==null?void 0:K.y)||0}),ut=n({x:Me.properties.domain.max,y:((pe=qe[qe.length-1])==null?void 0:pe.y)||0});return e.jsxs("g",{children:[c.showFunctionExtensions&&(()=>{const D=(E,O)=>{try{const u=E.replace(/\bx\b/g,`(${O})`).replace(/\^/g,"**").replace(/sin/g,"Math.sin").replace(/cos/g,"Math.cos").replace(/tan/g,"Math.tan").replace(/log/g,"Math.log").replace(/ln/g,"Math.log").replace(/exp/g,"Math.exp").replace(/sqrt/g,"Math.sqrt").replace(/abs/g,"Math.abs").replace(/pi/g,"Math.PI").replace(/e\b/g,"Math.E"),w=new Function("x",`return ${u}`)(O);return typeof w=="number"&&!isNaN(w)&&isFinite(w)?w:null}catch{return null}},g={left:t.center.x-o.width/2/t.zoom,right:t.center.x+o.width/2/t.zoom},k=Me.properties.equation,$=[];if(Me.properties.domain.min>g.left){const E=[],O=Math.max(g.left,Me.properties.domain.min-6),u=(Me.properties.domain.min-O)/15;for(let j=O;j<=Me.properties.domain.min;j+=u){const w=D(k,j);w!==null&&E.push(n({x:j,y:w}))}if(E.length>1){const j=E.reduce((w,z,F)=>w+(F===0?`M ${z.x} ${z.y}`:` L ${z.x} ${z.y}`),"");$.push(j)}}if(Me.properties.domain.max<g.right){const E=[],O=Math.min(g.right,Me.properties.domain.max+6),u=(O-Me.properties.domain.max)/15;for(let j=Me.properties.domain.max;j<=O;j+=u){const w=D(k,j);w!==null&&E.push(n({x:j,y:w}))}if(E.length>1){const j=E.reduce((w,z,F)=>w+(F===0?`M ${z.x} ${z.y}`:` L ${z.x} ${z.y}`),"");$.push(j)}}return e.jsx("g",{children:$.map((E,O)=>e.jsx("path",{d:E,fill:"none",stroke:Me.properties.color||"#2563eb",strokeWidth:1,strokeDasharray:"4,4",opacity:.5,strokeLinecap:"round"},`ext-${O}`))})})(),M&&e.jsx("path",{d:ot,fill:"none",stroke:"#60A5FA",strokeWidth:6,opacity:.4}),e.jsx("path",{d:ot,fill:"none",stroke:"transparent",strokeWidth:12,strokeLinecap:"round",strokeLinejoin:"round",style:{pointerEvents:"stroke"},onMouseEnter:()=>G(f.id),onMouseLeave:()=>{G(null),ne(null)},onMouseMove:D=>{var g;if(T===f.id){const k=(g=D.currentTarget.ownerSVGElement)==null?void 0:g.getBoundingClientRect();if(k){const $=D.clientX-k.left,E=D.clientY-k.top;t.center.x+($-o.width/2)/t.zoom,t.center.y-(E-o.height/2)/t.zoom;let O=null,u=1/0;for(const j of qe){const w=n(j),z=Math.sqrt(($-w.x)**2+(E-w.y)**2);z<u&&(u=z,O=j)}O&&ne(O)}}}}),e.jsx("path",{d:ot,fill:"none",stroke:M?"#1D4ED8":Me.properties.color||"#2563eb",strokeWidth:M?3:Me.properties.strokeWidth||2,strokeLinecap:"round",strokeLinejoin:"round",style:{pointerEvents:"none"}}),M&&e.jsxs("g",{children:[e.jsx("circle",{cx:Ye.x,cy:Ye.y,r:"6",fill:"#1D4ED8",stroke:"white",strokeWidth:"2",opacity:.8}),e.jsx("circle",{cx:ut.x,cy:ut.y,r:"6",fill:"#1D4ED8",stroke:"white",strokeWidth:"2",opacity:.8})]}),T===f.id&&I&&e.jsxs("g",{children:[e.jsx("circle",{cx:n(I).x,cy:n(I).y,r:"4",fill:Me.properties.color||"#2563eb",stroke:"white",strokeWidth:"2"}),e.jsx("rect",{x:n(I).x-70,y:n(I).y-55,width:"140",height:"45",fill:"rgba(255, 255, 255, 0.95)",stroke:"#374151",strokeWidth:"1",rx:"4"}),e.jsxs("text",{x:n(I).x,y:n(I).y-40,fontSize:a(9),fontWeight:"600",fill:"#374151",textAnchor:"middle",children:["(",V(I.x,h),","," ",V(I.y,h),")"]}),e.jsxs("text",{x:n(I).x,y:n(I).y-28,fontSize:a(8),fontWeight:"500",fill:"#374151",textAnchor:"middle",children:["f(",V(I.x,h),") ="," ",V(I.y,h)]}),e.jsxs("text",{x:n(I).x,y:n(I).y-16,fontSize:a(8),fontWeight:"400",fill:"#666",textAnchor:"middle",children:["f(x) = ",Me.properties.equation]})]}),(M||C===f.id)&&e.jsxs("g",{children:[e.jsx("rect",{x:Ye.x-40,y:Ye.y-35,width:"80",height:"25",fill:"rgba(255, 255, 255, 0.95)",stroke:"#374151",strokeWidth:"1",rx:"4"}),e.jsxs("text",{x:Ye.x,y:Ye.y-20,fontSize:a(10),fontWeight:"600",fill:"#374151",textAnchor:"middle",children:["f(x) = ",Me.properties.equation]})]})]},f.id);default:return null}};return e.jsxs(e.Fragment,{children:[e.jsx("defs",{children:e.jsx("marker",{id:"arrowhead",markerWidth:"10",markerHeight:"7",refX:"9",refY:"3.5",orient:"auto",children:e.jsx("polygon",{points:"0 0, 10 3.5, 0 7",fill:"#3B82F6",opacity:"0.6"})})}),e.jsx("g",{className:"objects",children:i.map(Z)})]})}function cs({capabilities:i,viewport:t,activeTool:s,selectedObjectsCount:n}){const{t:r}=Ge();return i?e.jsxs("div",{className:"absolute top-2 left-2 text-xs text-gray-500 bg-white/80 p-2 rounded shadow-sm",children:[e.jsxs("div",{children:[r("debug.input"),": ",i.hasTouch?"üëÜ":"üñ±Ô∏è"," ",i.hasPencil?"‚úèÔ∏è":""]}),e.jsxs("div",{children:[r("debug.zoom"),": ",t.zoom>=1?t.zoom.toFixed(1):t.zoom.toFixed(2),"√ó"]}),e.jsxs("div",{children:[r("debug.center"),": (",t.center.x.toFixed(1),", ",t.center.y.toFixed(1),")"]}),e.jsxs("div",{children:[r("debug.tool"),": ",s||r("debug.panMode")]}),n>0&&e.jsxs("div",{children:[r("debug.selected"),": ",n," ",r(n===1?"debug.object":"debug.objects")]})]}):null}function ls({selectedObject:i,onDelete:t,onUpdate:s,onClose:n}){const r="ontouchstart"in window||navigator.maxTouchPoints>0||window.innerWidth<768,[o,c]=x.useState(()=>{var l;const P=re.loadState(),b=(l=P==null?void 0:P.uiSettings)==null?void 0:l.contextMenuCollapsed;if(b!==void 0)return b;try{const m=localStorage.getItem("grix-ui-collapsed");if(m!==null)return m==="true"}catch{}return r});x.useEffect(()=>{var b;const P=re.loadState();if(((b=P==null?void 0:P.uiSettings)==null?void 0:b.contextMenuCollapsed)===void 0){const l=r,m={...P,uiSettings:{...P==null?void 0:P.uiSettings,contextMenuCollapsed:l}};re.saveState(m),re.scheduleSave(),c(l)}},[r]);const a=()=>{const P=!o;c(P);const b=re.loadState()||{},l={...b,uiSettings:{...b.uiSettings,contextMenuCollapsed:P}};re.saveState(l),re.scheduleSave();try{localStorage.setItem("grix-ui-collapsed",P.toString())}catch{console.warn("Could not save collapsed state to localStorage")}};if(!i)return null;const d=()=>{t(),n()},h=(P,b)=>{try{const l=(N,A)=>{try{const T=N.replace(/\bx\b/g,`(${A})`).replace(/\^/g,"**").replace(/sin/g,"Math.sin").replace(/cos/g,"Math.cos").replace(/tan/g,"Math.tan").replace(/log/g,"Math.log").replace(/ln/g,"Math.log").replace(/exp/g,"Math.exp").replace(/sqrt/g,"Math.sqrt").replace(/abs/g,"Math.abs").replace(/pi/g,"Math.PI").replace(/e\b/g,"Math.E"),I=new Function("x",`return ${T}`)(A);return typeof I=="number"&&!isNaN(I)&&isFinite(I)?I:null}catch{return null}},m=N=>N.includes("sin")||N.includes("cos")||N.includes("tan")?"trigonometric":N.includes("exp")||N.includes("e^")?"exponential":N.includes("log")||N.includes("ln")?"logarithmic":/x\^\d+|x\*\*\d+/.test(N)?"polynomial":"custom",p=P.properties.domain,y=P.properties.resolution||20,S=[],_=(p.max-p.min)/(y*(p.max-p.min));for(let N=p.min;N<=p.max;N+=_){const A=l(b,N);A!==null&&S.push({x:N,y:A})}return{properties:{...P.properties,equation:b,functionType:m(b),points:S}}}catch(l){return console.error("Failed to update function equation:",l),null}},C=()=>{switch(i.type){case"ray":const{startPoint:P,endPoint:b,slope:l}=i.properties,m=Math.abs(P.x)<.001&&Math.abs(P.y)<.001;return e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Line Details"}),e.jsxs("div",{className:"space-y-1 text-xs text-gray-600",children:[e.jsxs("div",{children:["Start: (",V(P.x,1),", ",V(P.y,1),")"]}),e.jsxs("div",{children:["End: (",V(b.x,1),", ",V(b.y,1),")"]}),m&&e.jsxs("div",{children:["Fraction: ",Math.round(b.y),"/",Math.round(b.x)]}),e.jsxs("div",{children:["Slope: ",isFinite(l)?l.toFixed(3):"undefined"]})]})]});case"rectangle":const{x:p,y,width:S,height:_,area:N}=i.properties;return e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Rectangle Details"}),e.jsxs("div",{className:"space-y-1 text-xs text-gray-600",children:[e.jsxs("div",{children:["Position: (",V(p,1),", ",V(y,1),")"]}),e.jsxs("div",{children:["Size: ",V(S,1)," √ó ",V(_,1)]})]})]});case"circle":const{center:A,radius:T,diameter:G,circumference:I,area:ne}=i.properties;return e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Circle Details"}),e.jsxs("div",{className:"space-y-1 text-xs text-gray-600",children:[e.jsxs("div",{children:["Center: (",V(A.x,1),", ",V(A.y,1),")"]}),e.jsxs("div",{children:["Radius: ",ve(T)]}),e.jsxs("div",{children:["Diameter: ",ve(G)]}),e.jsxs("div",{children:["Circumference: ",ve(I)]}),e.jsxs("div",{children:["Area: ",ve(ne)]})]})]});case"triangle":const{vertices:oe,sideA:Z,sideB:f,sideC:M,angleA:K,angleB:pe,angleC:we,area:se,perimeter:B,type:me}=i.properties;return e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Triangle Details"}),e.jsxs("div",{className:"space-y-1 text-xs text-gray-600",children:[e.jsxs("div",{children:["Type: ",me]}),e.jsx("div",{children:"Vertices:"}),e.jsxs("div",{className:"ml-2",children:[e.jsxs("div",{children:["A: (",V(oe[0].x,1),", ",V(oe[0].y,1),")"]}),e.jsxs("div",{children:["B: (",V(oe[1].x,1),", ",V(oe[1].y,1),")"]}),e.jsxs("div",{children:["C: (",V(oe[2].x,1),", ",V(oe[2].y,1),")"]})]}),e.jsxs("div",{children:["Sides: ",ve(Z),", ",ve(f),", ",ve(M)]}),e.jsxs("div",{children:["Angles: ",ve(K),"¬∞, ",ve(pe),"¬∞, ",ve(we),"¬∞"]}),e.jsxs("div",{children:["Area: ",ve(se)]}),e.jsxs("div",{children:["Perimeter: ",ve(B)]})]})]});case"function":const v=i,{equation:U,functionType:le,domain:ye,points:Fe}=v.properties;return e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Function Details"}),e.jsxs("div",{className:"space-y-1 text-xs text-gray-600",children:[e.jsxs("div",{children:["Equation: f(x) = ",U]}),e.jsxs("div",{children:["Type: ",le]}),e.jsxs("div",{children:["Domain: [",V(ye.min,1),", ",V(ye.max,1),"]"]}),e.jsxs("div",{children:["Points: ",Fe.length]})]}),e.jsxs("div",{className:"mt-2 pt-2 border-t border-gray-100",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Edit Equation:"}),e.jsx("input",{type:"text",defaultValue:U,className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"e.g., x^2, sin(x), 2*x + 1",onKeyDown:H=>{if(H.stopPropagation(),H.key==="Enter"){const Ne=H.target.value.trim();if(Ne&&Ne!==U){const We=h(v,Ne);We&&s(i.id,{properties:We.properties})}H.target.blur()}else H.key==="Escape"&&H.target.blur()},onKeyUp:H=>{H.stopPropagation()},onKeyPress:H=>{H.stopPropagation()},onFocus:H=>{H.target.select()}}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Press Enter to apply. Examples: x^2, sin(x), cos(x), log(x), exp(x)"})]})]});default:return null}},R=()=>{switch(i.type){case"ray":return`Line: slope ${ve(i.properties.slope)}`;case"rectangle":const P=i;return`Rectangle: ${ve(P.properties.width)} √ó ${ve(P.properties.height)}`;case"circle":return`Circle: r=${ve(i.properties.radius)}`;case"triangle":return"Triangle";case"function":return`Function: ${i.properties.equation}`;default:return i.type}};return o?e.jsx("div",{className:"fixed top-20 right-4 bg-white border border-gray-200 rounded-lg shadow-lg z-50",children:e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2",children:[e.jsx("button",{onClick:a,className:"text-gray-500 hover:text-gray-700",title:"Expand",children:"‚ñ∂"}),e.jsx("span",{className:"text-sm text-gray-700",children:R()}),e.jsx("button",{onClick:d,className:"ml-2 text-red-600 hover:text-red-700",title:"Delete",children:"üóëÔ∏è"}),e.jsx("button",{onClick:n,className:"text-gray-400 hover:text-gray-600",title:"Close",children:"‚úï"})]})}):e.jsxs("div",{className:"fixed top-20 right-4 bg-white border border-gray-200 rounded-lg shadow-lg p-3 z-50 min-w-48",onKeyDown:P=>{P.stopPropagation()},onKeyUp:P=>{P.stopPropagation()},onKeyPress:P=>{P.stopPropagation()},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-700",children:[i.type.charAt(0).toUpperCase()+i.type.slice(1)," Details"]}),e.jsx("button",{onClick:a,className:"text-gray-400 hover:text-gray-600 text-xs",title:"Collapse",children:"‚ñº"})]}),C(),e.jsxs("div",{className:"mt-3 pt-2 border-t border-gray-100 flex gap-2",children:[e.jsxs("button",{onClick:d,className:"flex items-center gap-1 px-2 py-1 text-xs text-red-600 hover:bg-red-50 rounded transition-colors",children:[e.jsx("span",{children:"üóëÔ∏è"}),"Delete"]}),e.jsxs("button",{onClick:n,className:"flex items-center gap-1 px-2 py-1 text-xs text-gray-600 hover:bg-gray-50 rounded transition-colors",children:[e.jsx("span",{children:"‚úï"}),"Close"]})]})]})}function ds({isOpen:i,onToggle:t}={}){const[s,n]=x.useState(!1),r=i!==void 0?i:s,[o,c]=x.useState("all"),a=x.useRef(null),d=De(),{toggleSetting:h,setFontScale:C,setSnapPrecision:R,setCoordinateSystem:P,resetToDefaults:b}=d,{t:l,language:m,changeLanguage:p,availableLanguages:y}=Ge(),S=()=>{t?t():n(!s)};x.useEffect(()=>{function T(G){a.current&&!a.current.contains(G.target)&&(t?t():n(!1))}if(r)return document.addEventListener("mousedown",T,!0),document.addEventListener("click",T,!0),()=>{document.removeEventListener("mousedown",T,!0),document.removeEventListener("click",T,!0)}},[r,t]);const _=[{title:l("settings.sections.lineBuilder"),subtitle:l("settings.sections.lineBuilder.subtitle"),settings:[{key:"showEquivalentFractions",label:l("settings.equivalentFractions"),description:l("settings.equivalentFractions.description")},{key:"showLengthMultiples",label:l("settings.lengthMultiples"),description:l("settings.lengthMultiples.description")},{key:"showAreaRectangle",label:l("settings.areaRectangle"),description:l("settings.areaRectangle.description")},{key:"showRiseRunTriangle",label:l("settings.riseRunTriangle"),description:l("settings.riseRunTriangle.description")},{key:"showDistanceMarkers",label:l("settings.distanceMarkers"),description:l("settings.distanceMarkers.description")},{key:"showAngleArc",label:l("settings.angleArc"),description:l("settings.angleArc.description")},{key:"showCoordinateProjections",label:l("settings.coordinateProjections"),description:l("settings.coordinateProjections.description")},{key:"showDivisionAnswer",label:l("settings.divisionAnswer"),description:l("settings.divisionAnswer.description")}]},{title:l("settings.sections.rectangleBuilder"),subtitle:l("settings.sections.rectangleBuilder.subtitle"),settings:[{key:"showFactorPairs",label:l("settings.factorPairs"),description:l("settings.factorPairs.description")},{key:"showCommutativeProperty",label:l("settings.commutativeProperty"),description:l("settings.commutativeProperty.description")},{key:"showDistributiveProperty",label:l("settings.distributiveProperty"),description:l("settings.distributiveProperty.description")},{key:"showPrimeComposite",label:l("settings.primeComposite"),description:l("settings.primeComposite.description")},{key:"showGCF",label:l("settings.gcf"),description:l("settings.gcf.description")},{key:"showLCM",label:l("settings.lcm"),description:l("settings.lcm.description")},{key:"showDivisionMultiples",label:l("settings.divisionMultiples"),description:l("settings.divisionMultiples.description")}]},{title:l("settings.sections.circleBuilder"),subtitle:l("settings.sections.circleBuilder.subtitle"),settings:[{key:"showTangentLines",label:l("settings.tangentLines"),description:l("settings.tangentLines.description")}]},{title:l("settings.sections.triangleBuilder"),subtitle:l("settings.sections.triangleBuilder.subtitle"),settings:[{key:"showTriangleAngles",label:l("settings.triangleAngles"),description:l("settings.triangleAngles.description")},{key:"showTriangleClassification",label:l("settings.triangleClassification"),description:l("settings.triangleClassification.description")},{key:"showSpecialTriangles",label:l("settings.specialTriangles"),description:l("settings.specialTriangles.description")},{key:"showSOHCAHTOA",label:l("settings.sohcahtoa"),description:l("settings.sohcahtoa.description")},{key:"showTrigValues",label:l("settings.trigValues"),description:l("settings.trigValues.description")},{key:"showTriangleAltitudes",label:l("settings.triangleAltitudes"),description:l("settings.triangleAltitudes.description")},{key:"showPythagoreanSquares",label:l("settings.pythagoreanSquares"),description:l("settings.pythagoreanSquares.description")}]},{title:l("settings.sections.functionGrapher"),subtitle:l("settings.sections.functionGrapher.subtitle"),settings:[{key:"showFunctionExtensions",label:l("settings.functionExtensions"),description:l("settings.functionExtensions.description")}]},{title:l("settings.sections.gridReference"),subtitle:l("settings.sections.gridReference.subtitle"),settings:[{key:"showLatticePoints",label:l("settings.latticePoints"),description:l("settings.latticePoints.description")},{key:"showReferenceLineY_equals_X",label:l("settings.referenceLineY_equals_X"),description:l("settings.referenceLineY_equals_X.description")}]},{title:l("settings.sections.display"),subtitle:l("settings.sections.display.subtitle"),settings:[]}],N=o==="all"?_:_.filter(T=>T.title.toLowerCase().replace(/[^a-z0-9]/g,"-")===o),A=[{id:"all",name:l("settings.allSettings")},..._.map(T=>({id:T.title.toLowerCase().replace(/[^a-z0-9]/g,"-"),name:T.title}))];return e.jsxs("div",{ref:a,className:"relative",children:[e.jsx("button",{onClick:S,className:"w-12 h-12 bg-white border border-gray-200 rounded-full shadow-lg hover:bg-gray-50 transition-all hover:shadow-xl flex items-center justify-center",title:l("settings.title"),children:e.jsx("span",{className:"text-lg",children:"‚öôÔ∏è"})}),r&&e.jsxs("div",{className:"settings-panel absolute bottom-full left-0 mb-2 bg-white border border-gray-200 rounded-lg shadow-lg w-80 max-h-[28rem] overflow-y-auto z-60",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-100 px-4 py-3 rounded-t-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:l("settings.title")}),e.jsx("button",{onClick:b,className:"text-xs text-blue-600 hover:text-blue-800 font-medium",children:l("settings.resetAll")})]}),e.jsx("div",{className:"px-4 pt-2",children:e.jsx("select",{value:o,onChange:T=>c(T.target.value),className:"w-full text-xs border border-gray-200 rounded px-2 py-1 bg-white",children:A.map(T=>e.jsx("option",{value:T.id,children:T.name},T.id))})})]}),e.jsx("div",{className:"settings-scrollable p-4 space-y-5",children:N.map((T,G)=>e.jsxs("div",{children:[e.jsxs("div",{className:`${G>0?"border-t border-gray-100 pt-4":""} mb-3`,children:[e.jsx("h4",{className:"text-xs font-semibold text-gray-700 uppercase tracking-wide",children:T.title}),T.subtitle&&e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:T.subtitle})]}),e.jsxs("div",{className:"space-y-2.5",children:[T.settings.map(I=>e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[e.jsx("input",{type:"checkbox",checked:d[I.key],onChange:()=>h(I.key),className:"mt-0.5 w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500 focus:ring-2"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 group-hover:text-gray-900",children:I.label}),e.jsx("div",{className:"text-xs text-gray-500 leading-relaxed",children:I.description})]})]},I.key)),T.title===l("settings.sections.display")&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:l("settings.fontSize")}),e.jsxs("span",{className:"text-xs text-gray-500 font-mono",children:[Math.round(d.fontScale*100),"%"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xs text-gray-400",children:"A"}),e.jsx("input",{type:"range",min:"0.8",max:"2.0",step:"0.1",value:d.fontScale,onChange:I=>C(parseFloat(I.target.value)),className:"flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider"}),e.jsx("span",{className:"text-sm text-gray-600",children:"A"})]}),e.jsx("div",{className:"text-xs text-gray-500 leading-relaxed",children:l("settings.fontSize.description")}),e.jsxs("div",{className:"space-y-3 pt-4 border-t border-gray-100",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:l("settings.coordinateSystem")}),e.jsx("div",{className:"space-y-2",children:[{value:"cartesian",label:l("settings.cartesianOnly"),desc:l("settings.cartesianOnly.description")},{value:"polar",label:l("settings.polarOnly"),desc:l("settings.polarOnly.description")},{value:"both",label:l("settings.bothSystems"),desc:l("settings.bothSystems.description")}].map(I=>e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[e.jsx("input",{type:"radio",name:"coordinateSystem",value:I.value,checked:d.coordinateSystem===I.value,onChange:ne=>P(ne.target.value),className:"mt-0.5 w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 group-hover:text-gray-900",children:I.label}),e.jsx("div",{className:"text-xs text-gray-500",children:I.desc})]})]},I.value))})]}),e.jsxs("div",{className:"space-y-3 pt-4 border-t border-gray-100",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:l("settings.snapPrecision")}),e.jsx("div",{className:"space-y-2",children:[{value:"adaptive",label:l("settings.adaptive"),desc:l("settings.adaptive.description")},{value:"whole",label:l("settings.wholeNumbers"),desc:l("settings.wholeNumbers.description")},{value:"half",label:l("settings.halfUnits"),desc:l("settings.halfUnits.description")},{value:"quarter",label:l("settings.quarterUnits"),desc:l("settings.quarterUnits.description")},{value:"tenth",label:l("settings.tenthUnits"),desc:l("settings.tenthUnits.description")}].map(I=>e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[e.jsx("input",{type:"radio",name:"snapPrecision",value:I.value,checked:d.snapPrecision===I.value,onChange:ne=>R(ne.target.value),className:"mt-0.5 w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 group-hover:text-gray-900",children:I.label}),e.jsx("div",{className:"text-xs text-gray-500",children:I.desc})]})]},I.value))}),e.jsx("div",{className:"text-xs text-gray-500 leading-relaxed",children:l("settings.snapPrecision.description")})]}),e.jsxs("div",{className:"space-y-3 pt-4 border-t border-gray-100",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:l("settings.language")}),e.jsx("select",{value:m,onChange:I=>p(I.target.value),className:"w-full text-sm border border-gray-200 rounded px-3 py-2 bg-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:y.map(I=>e.jsxs("option",{value:I.code,children:[I.nativeName," (",I.name,")"]},I.code))}),e.jsx("div",{className:"text-xs text-gray-500 leading-relaxed",children:l("settings.language.description")})]})]})]})]},T.title))}),e.jsx("div",{className:"sticky bottom-0 bg-gray-50 border-t border-gray-100 px-4 py-2 rounded-b-lg",children:e.jsx("p",{className:"text-xs text-gray-500 text-center",children:l("settings.footerText")})})]})]})}const zt="grix-tutorial-completed";function hs(){const[i,t]=x.useState(!1),[s,n]=x.useState(0);x.useEffect(()=>{localStorage.getItem(zt)||t(!0)},[]);const r=[{title:"Welcome to Grix! üéØ",content:"Grix is a mathematical visualization platform where you can explore concepts like slopes, fractions, multiplication, and more through interactive graphics.",highlight:null},{title:"Explore Examples üìö",content:"Click the 'Examples' button in the toolbar to load pre-made mathematical demonstrations. Perfect for getting started!",highlight:"examples"},{title:"Customize Visualizations ‚öôÔ∏è",content:"Use the 'Settings' button in the bottom-left to enable different mathematical features like equivalent fractions, area calculations, and more.",highlight:"settings"},{title:"Interactive Tools üõ†Ô∏è",content:"Use the toolbar to draw lines and rectangles. Zoom with Ctrl+scroll wheel, and pan by scrolling. On mobile, use pinch gestures.",highlight:"toolbar"}],o=()=>{s<r.length-1?n(s+1):a()},c=()=>{a()},a=()=>{localStorage.setItem(zt,"true"),t(!1)},d=()=>{a()};if(!i)return null;const h=r[s],C=s===r.length-1;return e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9999]",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-md mx-4 p-6 relative",children:[e.jsx("div",{className:"flex gap-2 mb-4",children:r.map((R,P)=>e.jsx("div",{className:`h-2 flex-1 rounded-full ${P<=s?"bg-blue-500":"bg-gray-200"}`},P))}),e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-3",children:h.title}),e.jsx("p",{className:"text-gray-600 leading-relaxed mb-6",children:h.content})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:c,className:"flex-1 px-4 py-2 text-gray-600 hover:text-gray-800 font-medium transition-colors",children:"Skip Tutorial"}),C?e.jsx("button",{onClick:d,className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors",children:"Get Started!"}):e.jsx("button",{onClick:o,className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors",children:"Next"})]}),e.jsxs("div",{className:"text-center mt-4 text-sm text-gray-500",children:["Step ",s+1," of ",r.length]}),e.jsx("button",{onClick:c,className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600 text-xl font-bold w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100",title:"Close tutorial",children:"√ó"})]}),h.highlight&&e.jsxs(e.Fragment,{children:[h.highlight==="examples"&&e.jsx("div",{className:"fixed top-0 right-0 z-[10000] pointer-events-none",children:e.jsx("div",{className:"absolute top-2 right-2 w-32 h-12 border-4 border-yellow-400 rounded-lg animate-pulse"})}),h.highlight==="settings"&&e.jsx("div",{className:"fixed bottom-4 left-4 z-[10000] pointer-events-none",children:e.jsx("div",{className:"w-12 h-12 border-4 border-yellow-400 rounded-full animate-pulse"})}),h.highlight==="toolbar"&&e.jsx("div",{className:"fixed top-0 left-0 z-[10000] pointer-events-none",children:e.jsx("div",{className:"absolute top-2 left-32 w-24 h-12 border-4 border-yellow-400 rounded-lg animate-pulse"})})]})]})}function us(){const{t:i}=Ge(),[t,s]=x.useState(!1),n=x.useRef(null);x.useEffect(()=>{function c(a){n.current&&!n.current.contains(a.target)&&s(!1)}if(t)return document.addEventListener("mousedown",c,!0),document.addEventListener("click",c,!0),document.body.style.overflow="hidden",()=>{document.removeEventListener("mousedown",c,!0),document.removeEventListener("click",c,!0),document.body.style.overflow="unset"}},[t]),x.useEffect(()=>{const c=a=>{a.key==="Escape"&&s(!1)};if(t)return document.addEventListener("keydown",c),()=>document.removeEventListener("keydown",c)},[t]);const o=["GetGrix","@","gmail",".","com"].join("");return e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>s(!0),className:"fixed bottom-4 right-20 z-40 w-10 h-10 bg-white border border-gray-200 rounded-full shadow-lg hover:bg-gray-50 transition-all hover:shadow-xl flex items-center justify-center",title:i("info.about"),children:e.jsx("span",{className:"text-sm font-bold text-blue-600",children:"‚ÑπÔ∏è"})}),t&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{ref:n,className:"bg-white rounded-lg shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto info-modal-scrollable",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("svg",{width:"32",height:"32",viewBox:"0 0 32 32",className:"flex-shrink-0",children:[e.jsx("rect",{width:"32",height:"32",fill:"#2563eb",rx:"6"}),e.jsxs("g",{stroke:"#60A5FA",strokeWidth:"0.5",opacity:"0.6",children:[e.jsx("line",{x1:"8",y1:"4",x2:"8",y2:"28"}),e.jsx("line",{x1:"16",y1:"4",x2:"16",y2:"28"}),e.jsx("line",{x1:"24",y1:"4",x2:"24",y2:"28"}),e.jsx("line",{x1:"4",y1:"8",x2:"28",y2:"8"}),e.jsx("line",{x1:"4",y1:"16",x2:"28",y2:"16"}),e.jsx("line",{x1:"4",y1:"24",x2:"28",y2:"24"})]}),e.jsxs("g",{stroke:"#FFFFFF",strokeWidth:"1",children:[e.jsx("line",{x1:"16",y1:"4",x2:"16",y2:"28"}),e.jsx("line",{x1:"4",y1:"16",x2:"28",y2:"16"})]}),e.jsx("line",{x1:"16",y1:"16",x2:"24",y2:"8",stroke:"#22C55E",strokeWidth:"2"}),e.jsx("circle",{cx:"16",cy:"16",r:"2",fill:"#FFFFFF"}),e.jsx("circle",{cx:"24",cy:"8",r:"1.5",fill:"#22C55E"})]}),e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:i("info.about")})]}),e.jsx("button",{onClick:()=>s(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx("span",{className:"text-xl",children:"‚úï"})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:i("info.subtitle")}),e.jsx("p",{className:"text-gray-600 leading-relaxed",children:i("info.description")})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-semibold text-gray-800 mb-2",children:i("info.keyFeatures")}),e.jsxs("ul",{className:"text-gray-600 space-y-1 text-sm",children:[e.jsxs("li",{children:["‚Ä¢ ",i("info.features.interactive")]}),e.jsxs("li",{children:["‚Ä¢ ",i("info.features.realtime")]}),e.jsxs("li",{children:["‚Ä¢ ",i("info.features.educational")]}),e.jsxs("li",{children:["‚Ä¢ ",i("info.features.touch")]}),e.jsxs("li",{children:["‚Ä¢ ",i("info.features.progressive")]})]})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"text-md font-semibold text-green-800 mb-2",children:["üåü ",i("info.opensource")]}),e.jsx("p",{className:"text-green-700 text-sm mb-3",children:i("info.opensource.description")}),e.jsxs("a",{href:"https://github.com/getgrix/grix",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 text-green-700 hover:text-green-800 font-medium text-sm underline",children:[e.jsx("span",{children:"üìÅ"}),i("info.viewGithub")]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-semibold text-gray-800 mb-2",children:i("info.contact")}),e.jsx("p",{className:"text-gray-600 text-sm mb-2",children:i("info.contact.description")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"üìß"}),e.jsx("span",{className:"text-sm text-blue-600 cursor-pointer hover:text-blue-800",onClick:()=>{const c=o;window.location.href=`mailto:${c}?subject=Grix Feedback`},title:"Click to send email",children:o})]})]}),e.jsx("div",{className:"pt-4 border-t border-gray-200",children:e.jsx("p",{className:"text-xs text-gray-500 text-center",children:i("info.madeWith")})})]})]})})]})}function xs({onClearBoard:i,onExportImage:t,onImportState:s,isOpen:n,onToggle:r}){const[o,c]=x.useState(!1),a=n!==void 0?n:o,[d,h]=x.useState(!1),[C,R]=x.useState(null),P=x.useRef(null),b=x.useRef(null),{objects:l,clearObjects:m,clearSelection:p}=Ee(),{resetToDefaults:y}=De(),S=()=>{r?r():c(!o)};x.useEffect(()=>{function Z(f){P.current&&!P.current.contains(f.target)&&(r?r():c(!1),h(!1))}if(a)return document.addEventListener("mousedown",Z,!0),document.addEventListener("click",Z,!0),document.addEventListener("touchstart",Z,!0),document.addEventListener("touchend",Z,!0),()=>{document.removeEventListener("mousedown",Z,!0),document.removeEventListener("click",Z,!0),document.removeEventListener("touchstart",Z,!0),document.removeEventListener("touchend",Z,!0)}},[a,r]),x.useEffect(()=>{if(a){const Z=re.getStorageInfo();R(Z)}},[a]);const _=()=>{r?r():c(!1)},N=()=>{m(),p(),y(),re.clearState(),h(!1),_()},A=()=>{const Z=re.exportState();if(Z){const f=new Blob([Z],{type:"application/json"}),M=URL.createObjectURL(f),K=document.createElement("a");K.href=M,K.download=`grix-session-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(K),K.click(),document.body.removeChild(K),URL.revokeObjectURL(M)}_()},T=()=>{var Z;(Z=b.current)==null||Z.click()},G=async Z=>{var M;const f=(M=Z.target.files)==null?void 0:M[0];if(f){try{const K=await f.text();await re.importState(K)?window.location.reload():alert("Failed to import state. Please check the file format.")}catch{alert("Failed to read file. Please select a valid Grix export file.")}b.current&&(b.current.value=""),_()}},I=()=>{t==null||t(),_()},ne=Z=>{if(Z===0)return"0 B";const f=1024,M=["B","KB","MB","GB"],K=Math.floor(Math.log(Z)/Math.log(f));return parseFloat((Z/Math.pow(f,K)).toFixed(1))+" "+M[K]},oe=Z=>new Date(Z).toLocaleString();return d?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{ref:P,className:"bg-white rounded-lg shadow-xl max-w-sm w-full p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Clear Everything?"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"This will remove all shapes, reset settings, and clear your saved work. This action cannot be undone."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>h(!1),className:"flex-1 px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:N,className:"flex-1 px-4 py-2 text-white bg-red-600 rounded-lg hover:bg-red-700 transition-colors",children:"Clear All"})]})]})}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:S,className:"w-12 h-12 bg-white border border-gray-200 rounded-full shadow-lg hover:bg-gray-50 transition-all hover:shadow-xl flex items-center justify-center",title:"Actions & Tools",children:e.jsx("span",{className:"text-lg",children:"‚ö°"})}),e.jsx("input",{ref:b,type:"file",accept:".json",onChange:G,className:"hidden"}),a&&e.jsxs("div",{ref:P,className:"absolute bottom-full left-0 mb-2 z-50 bg-white border border-gray-200 rounded-lg shadow-xl min-w-64 max-w-80",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-100",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Actions & Tools"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[l.length," shape",l.length!==1?"s":""," on canvas"]})]}),e.jsxs("div",{className:"p-2",children:[e.jsxs("button",{onClick:()=>h(!0),className:"w-full flex items-center gap-3 px-3 py-2 text-left hover:bg-red-50 rounded-lg transition-colors text-red-600",disabled:l.length===0,children:[e.jsx("span",{className:"text-lg",children:"üóëÔ∏è"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:"Clear Board"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Remove all shapes and reset settings"})]})]}),e.jsx("div",{className:"border-t border-gray-100 my-2"}),e.jsxs("button",{onClick:A,className:"w-full flex items-center gap-3 px-3 py-2 text-left hover:bg-gray-50 rounded-lg transition-colors text-gray-700",children:[e.jsx("span",{className:"text-lg",children:"üì§"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:"Export Session"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Save your work as a file"})]})]}),e.jsxs("button",{onClick:T,className:"w-full flex items-center gap-3 px-3 py-2 text-left hover:bg-gray-50 rounded-lg transition-colors text-gray-700",children:[e.jsx("span",{className:"text-lg",children:"üì•"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:"Import Session"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Load saved work from file"})]})]}),e.jsxs("button",{onClick:I,className:"w-full flex items-center gap-3 px-3 py-2 text-left hover:bg-gray-50 rounded-lg transition-colors text-gray-400",disabled:!0,children:[e.jsx("span",{className:"text-lg",children:"üñºÔ∏è"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:"Export Image"}),e.jsx("div",{className:"text-xs text-gray-400",children:"Save as PNG (coming soon)"})]})]}),e.jsx("div",{className:"border-t border-gray-100 my-2"}),C&&e.jsxs("div",{className:"px-3 py-2",children:[e.jsx("div",{className:"text-xs font-medium text-gray-700 mb-2",children:"Storage Status"}),e.jsxs("div",{className:"space-y-1 text-xs text-gray-600",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Session size:"}),e.jsx("span",{children:ne(C.stateSize)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Total used:"}),e.jsx("span",{children:ne(C.usedSpace)})]}),C.lastSaved&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Last saved:"}),e.jsx("span",{children:oe(C.lastSaved)})]})]}),e.jsxs("div",{className:"mt-2 text-xs text-green-600 flex items-center gap-1",children:[e.jsx("span",{children:"‚óè"}),e.jsx("span",{children:"Auto-save enabled"})]})]})]}),e.jsx("div",{className:"px-4 py-2 bg-gray-50 border-t border-gray-100 rounded-b-lg",children:e.jsx("p",{className:"text-xs text-gray-500 text-center",children:"Works offline ‚Ä¢ Auto-saves your progress"})})]})]})}function gs({isVisible:i,onDismiss:t}){const{t:s}=Ge(),[n,r]=x.useState(!1);x.useEffect(()=>{i&&r(!0)},[i]);const o=(c=!1)=>{if(c){const a=re.loadState()||{},d={...a,tutorialSettings:{...a.tutorialSettings,lineToolTutorialSeen:!0}};re.saveState(d),re.scheduleSave()}r(!1),setTimeout(()=>t(),300)};return i?e.jsx("div",{className:"fixed inset-0 bg-gray-900 bg-opacity-20 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:`bg-white rounded-2xl shadow-2xl max-w-md w-full border border-gray-200 transform transition-all duration-300 ${n?"scale-100 opacity-100":"scale-95 opacity-0"}`,children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-purple-700 text-white p-6 rounded-t-2xl relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-black/20"}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("h3",{className:"text-lg font-bold mb-1 text-white drop-shadow-sm",children:s("linetool.firstTime.title")}),e.jsx("p",{className:"text-white/90 text-sm",children:s("linetool.firstTime.subtitle")})]})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsx("div",{className:"flex items-start gap-3",children:e.jsx("span",{className:"text-sm",children:s("linetool.firstTime.feature1")})}),e.jsx("div",{className:"flex items-start gap-3",children:e.jsx("span",{className:"text-sm",children:s("linetool.firstTime.feature2")})}),e.jsx("div",{className:"flex items-start gap-3",children:e.jsx("span",{className:"text-sm",children:s("linetool.firstTime.feature3")})}),e.jsx("div",{className:"flex items-start gap-3",children:e.jsx("span",{className:"text-sm",children:s("linetool.firstTime.feature4")})})]}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 mb-6 border-2 border-dashed border-gray-300",children:e.jsxs("div",{className:"relative w-full h-24 flex items-center justify-center",children:[e.jsxs("svg",{width:"120",height:"80",viewBox:"0 0 120 80",className:"absolute",children:[e.jsxs("g",{stroke:"#E5E7EB",strokeWidth:"0.5",children:[e.jsx("line",{x1:"20",y1:"0",x2:"20",y2:"80"}),e.jsx("line",{x1:"40",y1:"0",x2:"40",y2:"80"}),e.jsx("line",{x1:"60",y1:"0",x2:"60",y2:"80"}),e.jsx("line",{x1:"80",y1:"0",x2:"80",y2:"80"}),e.jsx("line",{x1:"100",y1:"0",x2:"100",y2:"80"}),e.jsx("line",{x1:"0",y1:"20",x2:"120",y2:"20"}),e.jsx("line",{x1:"0",y1:"40",x2:"120",y2:"40"}),e.jsx("line",{x1:"0",y1:"60",x2:"120",y2:"60"})]}),e.jsxs("g",{stroke:"#374151",strokeWidth:"1",children:[e.jsx("line",{x1:"60",y1:"0",x2:"60",y2:"80"}),e.jsx("line",{x1:"0",y1:"40",x2:"120",y2:"40"})]}),e.jsx("circle",{cx:"60",cy:"40",r:"3",fill:"#EF4444",className:"animate-pulse",children:e.jsx("animate",{attributeName:"r",values:"2;4;2",dur:"1.5s",repeatCount:"indefinite"})}),e.jsx("line",{x1:"60",y1:"40",x2:"100",y2:"20",stroke:"#2563eb",strokeWidth:"2"}),e.jsxs("g",{transform:"translate(100, 15)",children:[e.jsx("rect",{x:"-8",y:"-8",width:"16",height:"16",fill:"#60A5FA",rx:"2",opacity:"0.9"}),e.jsx("text",{x:"0",y:"-2",fontSize:"6",fill:"white",textAnchor:"middle",children:"3"}),e.jsx("line",{x1:"-6",y1:"0",x2:"6",y2:"0",stroke:"white",strokeWidth:"0.5"}),e.jsx("text",{x:"0",y:"6",fontSize:"6",fill:"white",textAnchor:"middle",children:"2"})]}),e.jsx("circle",{cx:"80",cy:"30",r:"1.5",fill:"#22C55E",opacity:"0.7"}),e.jsx("circle",{cx:"100",cy:"20",r:"1.5",fill:"#22C55E",opacity:"0.7"})]}),e.jsx("div",{className:"absolute bottom-1 left-1/2 transform -translate-x-1/2",children:e.jsx("span",{className:"text-xs text-gray-600 bg-white px-2 py-1 rounded shadow",children:"Start here: (0,0)"})})]})}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:e.jsx("p",{className:"text-blue-800 text-sm font-medium text-center",children:s("linetool.firstTime.hint")})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>o(!1),className:"flex-1 bg-blue-600 text-white py-3 px-4 rounded-lg font-medium hover:bg-blue-700 transition-colors",children:s("linetool.firstTime.dismiss")}),e.jsx("button",{onClick:()=>o(!0),className:"px-4 py-3 text-gray-500 hover:text-gray-700 text-sm transition-colors",children:s("linetool.firstTime.dontShow")})]})]})]})}):null}function ps({isVisible:i,onDismiss:t}){const{t:s}=Ge(),[n,r]=x.useState(!1);x.useEffect(()=>{i&&r(!0)},[i]);const o=(c=!1)=>{if(c){const a=re.loadState()||{},d={...a,tutorialSettings:{...a.tutorialSettings,homeButtonTutorialSeen:!0}};re.saveState(d),re.scheduleSave()}r(!1),setTimeout(()=>t(),300)};return i?e.jsx("div",{className:"fixed inset-0 bg-gray-900 bg-opacity-20 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:`bg-white rounded-2xl shadow-2xl max-w-md w-full border border-gray-200 transform transition-all duration-300 ${n?"scale-100 opacity-100":"scale-95 opacity-0"}`,children:[e.jsxs("div",{className:"bg-gradient-to-r from-green-600 to-blue-700 text-white p-6 rounded-t-2xl relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-black/20"}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("h3",{className:"text-lg font-bold mb-1 text-white drop-shadow-sm",children:s("homebutton.firstTime.title")}),e.jsx("p",{className:"text-white/90 text-sm",children:s("homebutton.firstTime.subtitle")})]})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-lg",children:"üëÜ"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-1",children:s("homebutton.firstTime.singleClick")}),e.jsx("p",{className:"text-sm text-gray-600",children:s("homebutton.firstTime.singleClickDesc")})]})]})}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-lg",children:"üëÜüëÜ"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-1",children:s("homebutton.firstTime.doubleClick")}),e.jsx("p",{className:"text-sm text-gray-600",children:s("homebutton.firstTime.doubleClickDesc")})]})]})})]}),e.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-green-50 rounded-lg p-4 mb-6 border-2 border-dashed border-blue-300",children:e.jsx("div",{className:"relative w-full h-32 flex items-center justify-center",children:e.jsxs("svg",{width:"200",height:"100",viewBox:"0 0 200 100",className:"absolute",children:[e.jsxs("g",{stroke:"#E5E7EB",strokeWidth:"0.5",children:[[40,60,80,100,120,140,160].map(c=>e.jsx("line",{x1:c,y1:"0",x2:c,y2:"100"},`v${c}`)),[20,40,60,80].map(c=>e.jsx("line",{x1:"0",y1:c,x2:"200",y2:c},`h${c}`))]}),e.jsxs("g",{stroke:"#374151",strokeWidth:"1",children:[e.jsx("line",{x1:"100",y1:"0",x2:"100",y2:"100"}),e.jsx("line",{x1:"0",y1:"50",x2:"200",y2:"50"})]}),e.jsx("circle",{cx:"100",cy:"50",r:"3",fill:"#EF4444"}),e.jsxs("g",{transform:"translate(170, 70)",children:[e.jsx("rect",{x:"-15",y:"-15",width:"30",height:"30",rx:"15",fill:"#2563eb",opacity:"0.9"}),e.jsx("text",{x:"0",y:"5",fontSize:"16",fill:"white",textAnchor:"middle",children:"üè†"}),e.jsxs("circle",{cx:"0",cy:"0",r:"20",fill:"none",stroke:"#2563eb",strokeWidth:"2",opacity:"0.3",children:[e.jsx("animate",{attributeName:"r",values:"15;25;15",dur:"2s",repeatCount:"indefinite"}),e.jsx("animate",{attributeName:"opacity",values:"0.5;0;0.5",dur:"2s",repeatCount:"indefinite"})]})]}),e.jsx("path",{d:"M 130 50 L 110 50 M 110 50 L 115 45 M 110 50 L 115 55",stroke:"#10B981",strokeWidth:"2",fill:"none",strokeDasharray:"2,2",opacity:"0.7"})]})})}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:e.jsx("p",{className:"text-blue-800 text-sm font-medium text-center",children:s("homebutton.firstTime.hint")})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>o(!1),className:"flex-1 bg-blue-600 text-white py-3 px-4 rounded-lg font-medium hover:bg-blue-700 transition-colors",children:s("homebutton.firstTime.dismiss")}),e.jsx("button",{onClick:()=>o(!0),className:"px-4 py-3 text-gray-500 hover:text-gray-700 text-sm transition-colors",children:s("homebutton.firstTime.dontShow")})]})]})]})}):null}function fs({onDismiss:i}){const{worldToScreen:t,objects:s}=Ee(),{t:n}=Ge(),[r,o]=x.useState(!0),c=s.find(P=>P.id.startsWith("ray_default_")),a=(c==null?void 0:c.properties.endPoint)||{x:3,y:9},d={x:a.x,y:a.y-3};x.useEffect(()=>{const P=setTimeout(()=>{h()},3e4),b=()=>{clearTimeout(P),setTimeout(()=>h(),500)};return document.addEventListener("mousedown",b),document.addEventListener("touchstart",b),()=>{clearTimeout(P),document.removeEventListener("mousedown",b),document.removeEventListener("touchstart",b)}},[]);const h=()=>{o(!1),setTimeout(()=>i(),300)};if(!r)return null;const C=t(d),R=window.innerWidth<768;return c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40 bg-black bg-opacity-10",onClick:h}),e.jsx("div",{className:"fixed z-45 pointer-events-none",style:{left:C.x-16,top:C.y-16},children:e.jsxs("div",{className:"relative w-8 h-8",children:[e.jsx("div",{className:"absolute inset-0 bg-yellow-400 rounded-full animate-ping opacity-50"}),e.jsx("div",{className:"absolute inset-1 bg-blue-500 rounded-full animate-ping opacity-40 animation-delay-200"}),e.jsx("div",{className:"absolute inset-2 bg-white rounded-full border-2 border-blue-600 shadow-lg animate-pulse"}),e.jsx("div",{className:"absolute inset-3 bg-blue-600 rounded-full"})]})}),e.jsx("div",{className:`fixed z-50 transition-all duration-300 ease-out ${r?"opacity-100 translate-y-0":"opacity-0 translate-y-4"} ${R?"bottom-20 left-4 right-4":"bottom-8 left-1/2 transform -translate-x-1/2"}`,style:R?{}:{width:"400px",maxWidth:"90vw"},children:e.jsxs("div",{className:"bg-white border border-blue-200 rounded-xl shadow-lg p-4 relative",children:[e.jsx("button",{onClick:h,className:"absolute top-2 right-2 text-gray-400 hover:text-gray-600 text-xl leading-none w-6 h-6 flex items-center justify-center",children:"√ó"}),e.jsxs("div",{className:"pr-8",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse"}),e.jsx("div",{className:"font-semibold text-gray-800 text-sm",children:n("endpoint.tooltip.title")})]}),e.jsx("div",{className:"text-gray-600 text-sm leading-relaxed",children:n("endpoint.tooltip.message")})]}),e.jsx("div",{className:"absolute inset-0 rounded-xl bg-gradient-to-r from-blue-500 to-purple-500 opacity-20 pointer-events-none"})]})})]}):null}const Dt=(i,t)=>{const s=t*Math.PI/180,n=Math.cos(s),r=Math.sin(s);return{x:i.x*n-i.y*r,y:i.x*r+i.y*n}},ms=(i,t)=>({x:i.x*t,y:i.y*t}),It=(i,t)=>{switch(t){case"x":return{x:i.x,y:-i.y};case"y":return{x:-i.x,y:i.y};case"origin":return{x:-i.x,y:-i.y};default:return i}},ys=pt((i,t)=>({isTransforming:!1,activeTransform:null,selectedObject:null,rotateObject:(s,n,r)=>{if(!r){console.log(`No canvas API provided for rotation of ${s}`);return}const o=r.getObject(s);if(o){if(o.type==="ray"){if(Math.abs(o.properties.startPoint.x)<.001&&Math.abs(o.properties.startPoint.y)<.001){const a=Dt(o.properties.endPoint,n);r.updateObject(s,{properties:{...o.properties,endPoint:a}})}}else if(o.type==="rectangle"){const c=o.properties.x+o.properties.width/2,a=o.properties.y+o.properties.height/2,d={x:o.properties.x-c,y:o.properties.y-a},h=Dt(d,n);r.updateObject(s,{properties:{...o.properties,x:h.x+c,y:h.y+a}})}}},scaleObject:(s,n,r)=>{if(!r){console.log(`No canvas API provided for scaling of ${s}`);return}const o=r.getObject(s);if(o)if(o.type==="ray"){if(Math.abs(o.properties.startPoint.x)<.001&&Math.abs(o.properties.startPoint.y)<.001){const a=ms(o.properties.endPoint,n);r.updateObject(s,{properties:{...o.properties,endPoint:a}})}}else o.type==="rectangle"&&r.updateObject(s,{properties:{...o.properties,width:o.properties.width*n,height:o.properties.height*n,area:o.properties.width*n*o.properties.height*n}})},reflectObject:(s,n,r)=>{if(!r){console.log(`No canvas API provided for reflection of ${s}`);return}const o=r.getObject(s);if(o){if(o.type==="ray"){if(Math.abs(o.properties.startPoint.x)<.001&&Math.abs(o.properties.startPoint.y)<.001){const a=It(o.properties.endPoint,n);r.updateObject(s,{properties:{...o.properties,endPoint:a}})}}else if(o.type==="rectangle"){const c=It({x:o.properties.x,y:o.properties.y},n);r.updateObject(s,{properties:{...o.properties,x:c.x,y:c.y}})}}},rotate90:(s,n)=>{t().rotateObject(s,90,n)},rotate180:(s,n)=>{t().rotateObject(s,180,n)},rotate270:(s,n)=>{t().rotateObject(s,270,n)},setActiveTransform:s=>{i({activeTransform:s,isTransforming:s!==null})},setSelectedObject:s=>{i({selectedObject:s})},clearTransform:()=>{i({isTransforming:!1,activeTransform:null,selectedObject:null})}})),Lt=x.createContext(void 0);function bs({children:i}){const[t,s]=x.useState(null);return e.jsx(Lt.Provider,{value:{openMenu:t,setOpenMenu:s},children:i})}function mt(){const i=x.useContext(Lt);if(!i)throw new Error("useMenuState must be used within a MenuStateProvider");return i}function Wt({width:i=800,height:t=600,className:s="",onObjectInteraction:n}){const r=x.useRef(null),{openMenu:o,setOpenMenu:c}=mt(),{viewport:a,setViewport:d,objects:h,selectedObjects:C,snapToGrid:R,canvasSize:P,setCanvasSize:b,removeObject:l,clearSelection:m,selectObject:p,screenToWorld:y,worldToScreen:S,getObject:_,updateObject:N}=Ee(),A=es(),{activeTool:T,setActiveTool:G,eventBus:I}=it(),{rotate90:ne,rotate180:oe,rotate270:Z,scaleObject:f,setSelectedObject:M}=ys(),[K,pe]=x.useState(!1);x.useEffect(()=>{const u=()=>{const z=localStorage.getItem("grix-show-endpoint-tooltip"),F=localStorage.getItem("grix-tutorial-completed");return z==="true"&&F==="true"?setTimeout(()=>{pe(!0)},1e3):null},j=u(),w=z=>{if(z.key==="grix-tutorial-completed"){const F=u();return j&&clearTimeout(j),F}};return window.addEventListener("storage",w),()=>{j&&clearTimeout(j),window.removeEventListener("storage",w)}},[]),x.useEffect(()=>{b({width:i,height:t})},[i,t,b]);const we=x.useRef({isPanning:!1,startPoint:{x:0,y:0},startCenter:{x:0,y:0}}),se=x.useRef({isDown:!1,startPoint:{x:0,y:0},hasMoved:!1,dragThreshold:5,pendingSelection:null}),[B,me]=x.useState(null),[v,U]=x.useState(!1),[le,ye]=x.useState(!1),[Fe,H]=x.useState(!1),[Ne,We]=x.useState(!1),[ie,te]=x.useState(!1),xe=x.useRef(0),ge=x.useRef({worldPoint:{x:0,y:0},timestamp:0,overlappingObjects:[],currentIndex:0}),Se=x.useCallback((u,j=44)=>{const w=j/a.zoom,z=[];for(const F of h){let Y=0,J=1/0,X=!1;switch(F.type){case"ray":const ue=rt(u,F.properties.startPoint,F.properties.endPoint);ue<=w&&(Y=100,J=ue,X=!0);break;case"rectangle":const{x:L,y:W,width:q,height:Q}=F.properties,be=[{start:{x:L,y:W},end:{x:L+q,y:W}},{start:{x:L+q,y:W},end:{x:L+q,y:W+Q}},{start:{x:L+q,y:W+Q},end:{x:L,y:W+Q}},{start:{x:L,y:W+Q},end:{x:L,y:W}}];let ce=1/0;for(const Le of be){const ze=rt(u,Le.start,Le.end);ce=Math.min(ce,ze)}ce<=w?(Y=100,J=ce,X=!0):u.x>=L&&u.x<=L+q&&u.y>=W&&u.y<=W+Q&&(Y=50,J=0,X=!0);break;case"circle":const{center:de,radius:ke}=F.properties,Te=Math.sqrt((u.x-de.x)**2+(u.y-de.y)**2),Oe=Nt(u,de,ke);Oe<=w?(Y=100,J=Oe,X=!0):Te<=ke&&(Y=50,J=ke-Te,X=!0);break;case"triangle":const{vertices:Ae}=F.properties,Ke=[[Ae[0],Ae[1]],[Ae[1],Ae[2]],[Ae[2],Ae[0]]];let fe=1/0;for(const[Le,ze]of Ke){const $e=rt(u,Le,ze);fe=Math.min(fe,$e)}fe<=w?(Y=100,J=fe,X=!0):At(u,Ae)&&(Y=50,J=0,X=!0);break;case"function":const Ce=F.properties.points;if(Ce&&Ce.length>1){let Le=1/0;for(let ze=0;ze<Ce.length-1;ze++){const $e=Ce[ze],Xe=Ce[ze+1],Ue=rt(u,$e,Xe);Le=Math.min(Le,Ue)}Le<=w&&(Y=100,J=Le,X=!0)}break}X&&z.push({object:F,priority:Y,distance:J})}return z.sort((F,Y)=>F.priority!==Y.priority?Y.priority-F.priority:F.distance!==Y.distance?F.distance-Y.distance:(Y.object.zIndex||0)-(F.object.zIndex||0)),z.map(F=>F.object)},[h,a.zoom,rt,At,Nt]),_e=x.useCallback(u=>{const j={x:u.x,y:u.y};se.current={isDown:!0,startPoint:j,hasMoved:!1,dragThreshold:5,pendingSelection:null};const w=y(j),z=Se(w,bt);let F=!1,Y=null;if(z.length>0){F=!0;const J=Date.now(),X=ge.current,ue=Math.abs(w.x-X.worldPoint.x)<.1&&Math.abs(w.y-X.worldPoint.y)<.1,L=J-X.timestamp<500;if(ue&&L&&X.overlappingObjects.length>1){const W=(X.currentIndex+1)%X.overlappingObjects.length,q=X.overlappingObjects[W];Y=z.find(Q=>Q.id===q)||z[0],ge.current={worldPoint:w,timestamp:J,overlappingObjects:X.overlappingObjects,currentIndex:W}}else Y=z[0],ge.current={worldPoint:w,timestamp:J,overlappingObjects:z.map(W=>W.id),currentIndex:0};se.current.pendingSelection={objectId:Y.id,type:Y.type},p(Y.id)}else ge.current={worldPoint:{x:0,y:0},timestamp:0,overlappingObjects:[],currentIndex:0};(!F&&!T||!F&&T)&&m(),(T||F)&&A.handlePointerDown(u),!F&&!T&&(u.type==="touch"||u.type==="mouse")&&(we.current={isPanning:!0,startPoint:{x:u.x,y:u.y},startCenter:{...a.center}})},[a.center,A,T,G,h,y,S,a.zoom]),he=x.useCallback(u=>{const j={x:u.x,y:u.y};if(u.type==="mouse"&&T?me(j):T||me(null),se.current.isDown&&!se.current.hasMoved){const w=Math.abs(u.x-se.current.startPoint.x),z=Math.abs(u.y-se.current.startPoint.y);Math.sqrt(w*w+z*z)>=se.current.dragThreshold&&(se.current.hasMoved=!0,H(!0),se.current.pendingSelection=null)}if(A.handlePointerMove(u),!T&&we.current.isPanning){const w=(u.x-we.current.startPoint.x)/a.zoom,z=(u.y-we.current.startPoint.y)/a.zoom;d({center:{x:we.current.startCenter.x-w,y:we.current.startCenter.y+z}})}},[a.zoom,d,A,T,me]),ae=x.useCallback(u=>{H(!1),se.current={isDown:!1,startPoint:{x:0,y:0},hasMoved:!1,dragThreshold:5,pendingSelection:null},A.handlePointerUp(u),we.current.isPanning=!1},[A,G]),Me=x.useCallback(u=>{switch(u.type){case"pinch":if(u.scale&&u.center){const j=h.length,w=()=>{const q=j>50?100:j>20?200:500;return a.zoom<1?{min:.1,max:Math.min(50,q)}:a.zoom>100?{min:5,max:q}:{min:.1,max:q}},{min:z,max:F}=w();let Y=1;if(u.touches&&u.touches>1){const W=/iPad|iPhone|iPod/.test(navigator.userAgent),q=(()=>{switch(zoomSensitivity){case"low":return W?.15:.25;case"medium":return W?.25:.35;case"high":return W?.4:.5;default:return W?.25:.35}})(),Q=a.zoom<.5||a.zoom>50?.7:1,be=Math.abs(u.scale-1),ce=zoomSensitivity==="high"?.5:.3,de=be>ce?.6:1;Y=q*Q*de}const J=u.scale-1,X=zoomSensitivity==="high"?.01:zoomSensitivity==="low"?.03:.02;if(Math.abs(J)<X)return;const ue=1+J*Y;let L=a.zoom*ue;if(L>F*.9){const W=(L-F*.9)/(F*.1);L=F*.9+F*.1*(1-Math.exp(-W))}if(L<z*1.1){const W=(z*1.1-L)/(z*.1);L=z*1.1-z*.1*(1-Math.exp(-W))}if(L=Math.max(z,Math.min(F,L)),Math.abs(L-a.zoom)>.001){const W=L/a.zoom,q=y(u.center),Q={x:q.x+(a.center.x-q.x)/W,y:q.y+(a.center.y-q.y)/W};d({zoom:L,center:Q})}}break}},[a.zoom,a.center,d,h.length,y]),{capabilities:qe,touchTargetSize:bt}=kt(r,{onPointerDown:_e,onPointerMove:he,onPointerUp:ae,onGesture:Me},{enableGestures:!0,preventScrolling:!0});x.useEffect(()=>{const u=w=>{switch(w.key){case"ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":if(C.length>0){w.preventDefault();const z=w.shiftKey?.1:1;let F=0,Y=0;switch(w.key){case"ArrowUp":Y=z;break;case"ArrowDown":Y=-z;break;case"ArrowLeft":F=-z;break;case"ArrowRight":F=z;break}C.forEach(J=>{const X=_(J);if(X)switch(X.type){case"ray":N(J,{properties:{...X.properties,startPoint:{x:X.properties.startPoint.x+F,y:X.properties.startPoint.y+Y},endPoint:{x:X.properties.endPoint.x+F,y:X.properties.endPoint.y+Y}}});break;case"rectangle":N(J,{properties:{...X.properties,x:X.properties.x+F,y:X.properties.y+Y}});break;case"circle":N(J,{properties:{...X.properties,center:{x:X.properties.center.x+F,y:X.properties.center.y+Y}}});break;case"triangle":const ue=X.properties.vertices.map(q=>({x:q.x+F,y:q.y+Y}));N(J,{properties:{...X.properties,vertices:ue}});break;case"function":const L={min:X.properties.domain.min+F,max:X.properties.domain.max+F},W=X.properties.points.map(q=>({x:q.x+F,y:q.y+Y}));N(J,{properties:{...X.properties,domain:L,points:W}});break}})}break;case"Escape":T&&(I.emit("tool:cancel",{toolId:T}),G(null));break;case"Delete":case"Backspace":C.length>0&&(console.log("Deleting objects:",C),C.forEach(z=>{I.emit("object:removed",{objectId:z}),l(z)}),m(),G(null));break;case"r":case"R":if(C.length>0&&!w.ctrlKey){w.preventDefault();const z={getObject:_,updateObject:N};C.forEach(F=>{w.shiftKey?Z(F,z):ne(F,z)})}break;case"f":case"F":if(C.length>0&&!w.ctrlKey){w.preventDefault();const z={getObject:_,updateObject:N};C.forEach(F=>{oe(F,z)})}break;case"=":case"+":if(C.length>0&&!w.ctrlKey){w.preventDefault();const z={getObject:_,updateObject:N};C.forEach(F=>{f(F,2,z)})}break;case"-":case"_":if(C.length>0&&!w.ctrlKey){w.preventDefault();const z={getObject:_,updateObject:N};C.forEach(F=>{f(F,.5,z)})}break}},j=w=>{m(),G(null)};return document.addEventListener("keydown",u),I.on("tool:creation-complete",j),()=>{document.removeEventListener("keydown",u),I.off("tool:creation-complete",j)}},[T,G,I,C,l,m]),x.useEffect(()=>{C.length===1&&!Fe&&!le?U(!0):(C.length!==1||Fe)&&(U(!1),ye(!1))},[C,Fe,le]),x.useEffect(()=>{o&&v&&U(!1)},[o,v]),x.useEffect(()=>{var u;if(T==="ray-tool"){const j=re.loadState();if(!((u=j==null?void 0:j.tutorialSettings)==null?void 0:u.lineToolTutorialSeen)){const z=setTimeout(()=>{We(!0)},300);return()=>clearTimeout(z)}}},[T]);const ot=x.useCallback(()=>{U(!1),ye(!0)},[]),Ye=x.useCallback(()=>{C.length>0&&(C.forEach(u=>{I.emit("object:removed",{objectId:u}),l(u)}),m())},[C,l,m,I]),ut=x.useCallback((u,j)=>{N(u,j)},[N]),D=x.useCallback(()=>{We(!1)},[]),g=x.useCallback(()=>{te(!1)},[]),k=x.useCallback(()=>{const u=Math.min(1e3,a.zoom*1.4);d({zoom:u})},[a.zoom,d]),$=x.useCallback(()=>{const u=Math.max(.01,a.zoom/1.4);d({zoom:u})},[a.zoom,d]),E=x.useCallback(()=>{d({zoom:20,center:{x:0,y:0}})},[d]),O=x.useCallback(()=>{var u;if(d({center:{x:0,y:0}}),xe.current+=1,xe.current===1){const j=re.loadState();((u=j==null?void 0:j.tutorialSettings)==null?void 0:u.homeButtonTutorialSeen)||setTimeout(()=>{te(!0)},300)}},[d]);return x.useEffect(()=>{const u=w=>{w.preventDefault();const F=Ee.getState().viewport;if(w.ctrlKey||w.metaKey){const Y=w.deltaY>0?.9:1.1,J=Math.max(.01,Math.min(1e3,F.zoom*Y));d({zoom:J})}else{const J=w.shiftKey?w.deltaY:0,X=w.shiftKey?0:w.deltaY,ue=J*1/F.zoom,L=X*1/F.zoom;d({center:{x:F.center.x+ue,y:F.center.y-L}})}},j=r.current;if(j)return j.addEventListener("wheel",u,{passive:!1}),()=>{j.removeEventListener("wheel",u)}},[d]),e.jsxs("div",{className:`relative ${s}`,style:{width:i,height:t},children:[e.jsxs("svg",{ref:r,width:i,height:t,className:"absolute inset-0 bg-white",style:{touchAction:"none"},children:[e.jsx(ns,{viewport:a,canvasSize:{width:i,height:t},worldToScreen:S,objects:h}),e.jsx(as,{objects:h,viewport:a,touchTargetSize:bt,worldToScreen:S,selectedObjects:C,canvasSize:{width:i,height:t}}),T&&B&&!se.current.isDown&&e.jsx("circle",{cx:B.x,cy:B.y,r:"4",fill:"rgba(37, 99, 235, 0.4)",stroke:"#2563eb",strokeWidth:"1",opacity:"0.8",style:{pointerEvents:"none"}})]}),e.jsx(cs,{capabilities:qe,viewport:a,activeTool:T,selectedObjectsCount:C.length}),e.jsx(os,{viewport:a,onZoomIn:k,onZoomOut:$,onZoomReset:E,onCenterOnly:O}),v&&C.length===1&&e.jsx(ls,{selectedObject:h.find(u=>u.id===C[0])||null,onDelete:Ye,onUpdate:ut,onClose:ot}),e.jsxs("div",{className:"fixed bottom-4 left-4 z-50 flex gap-3",children:[e.jsx(ds,{isOpen:o==="settings",onToggle:()=>c(o==="settings"?null:"settings")}),e.jsx(xs,{isOpen:o==="action",onToggle:()=>c(o==="action"?null:"action")})]}),e.jsx(hs,{}),e.jsx(us,{}),e.jsx(gs,{isVisible:Ne,onDismiss:D}),e.jsx(ps,{isVisible:ie,onDismiss:g}),K&&e.jsx(fs,{onDismiss:()=>{pe(!1),localStorage.removeItem("grix-show-endpoint-tooltip")}})]})}const Ve=class Ve{constructor(){ee(this,"examplesData",null);ee(this,"isLoading",!1)}static getInstance(){return Ve.instance||(Ve.instance=new Ve),Ve.instance}async loadExamples(){if(this.examplesData)return this.examplesData;if(this.isLoading)return await new Promise(t=>{const s=()=>{this.isLoading?setTimeout(s,50):t(void 0)};s()}),this.examplesData;this.isLoading=!0;try{const t=await fetch("/examples.json");if(!t.ok)throw new Error(`Failed to load examples: ${t.status}`);const s=await t.json();if(!s.examples||!Array.isArray(s.examples))throw new Error("Invalid examples data: missing examples array");if(!s.categories||!Array.isArray(s.categories))throw new Error("Invalid examples data: missing categories array");for(const n of s.examples)if(!n.id||!n.title||!n.objects||!Array.isArray(n.objects))throw new Error(`Invalid example: ${n.id||"unknown"}`);return this.examplesData=s,this.examplesData}catch(t){return console.error("Failed to load examples:",t),this.examplesData={examples:[],categories:[]},this.examplesData}finally{this.isLoading=!1}}async getExamples(){return(await this.loadExamples()).examples}async getCategories(){return(await this.loadExamples()).categories}async getExampleById(t){return(await this.getExamples()).find(n=>n.id===t)||null}async getExamplesByCategory(t){return(await this.getExamples()).filter(n=>n.category===t)}generateObjectId(){return`example_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}convertExampleObjectToMathObject(t){const s={id:this.generateObjectId(),type:t.type,visible:!0,selected:!1,zIndex:0};switch(t.type){case"ray":return{...s,type:"ray",properties:{startPoint:t.properties.startPoint,endPoint:t.properties.endPoint,slope:(t.properties.endPoint.y-t.properties.startPoint.y)/(t.properties.endPoint.x-t.properties.startPoint.x)}};case"rectangle":return{...s,type:"rectangle",properties:{x:t.properties.x,y:t.properties.y,width:t.properties.width,height:t.properties.height,area:t.properties.width*t.properties.height}};case"circle":const n=t.properties.radius;return{...s,type:"circle",properties:{center:t.properties.center,radius:n,diameter:n*2,circumference:2*Math.PI*n,area:Math.PI*n*n}};case"triangle":return{...s,type:"triangle",properties:{vertices:t.properties.vertices,sideA:t.properties.sideA,sideB:t.properties.sideB,sideC:t.properties.sideC,angleA:t.properties.angleA,angleB:t.properties.angleB,angleC:t.properties.angleC,area:t.properties.area,perimeter:t.properties.perimeter,type:t.properties.type}};default:throw new Error(`Unknown object type: ${t.type}`)}}async applyExample(t){const s=await this.getExampleById(t);if(!s)throw new Error(`Example not found: ${t}`);const n=Ee.getState(),r=De.getState();try{n.getAllObjects().forEach(c=>{n.removeObject(c.id)}),n.clearSelection(),s.viewport&&n.setViewport(s.viewport),Object.entries(s.settings).forEach(([c,a])=>{c in r&&typeof a=="boolean"?(r.toggleSetting(c),r[c]!==a&&r.toggleSetting(c)):c==="snapPrecision"&&typeof a=="string"?r.setSnapPrecision(a):c==="coordinateSystem"&&typeof a=="string"?r.setCoordinateSystem(a):c==="fontScale"&&typeof a=="number"&&r.setFontScale(a)}),s.objects.forEach(c=>{const a=this.convertExampleObjectToMathObject(c);n.addObject(a)}),console.log(`Applied example: ${s.title}`)}catch(o){throw console.error("Failed to apply example:",o),new Error(`Failed to apply example "${s.title}": ${o.message}`)}}async clearCanvas(){const t=Ee.getState(),s=De.getState();t.getAllObjects().forEach(r=>{t.removeObject(r.id)}),t.clearSelection(),t.setViewport({zoom:20,center:{x:0,y:0}}),s.resetToDefaults(),console.log("Canvas cleared and reset to defaults")}async getBeginnerExamples(){return(await this.getExamples()).filter(s=>s.difficulty==="beginner")}async getRandomExampleFromCategory(t){const s=await this.getExamplesByCategory(t);if(s.length===0)return null;const n=Math.floor(Math.random()*s.length);return s[n]}};ee(Ve,"instance");let yt=Ve;const ht=yt.getInstance();function vs(){const{t:i}=Ge(),{openMenu:t,setOpenMenu:s}=mt(),n=t==="examples",[r,o]=x.useState([]),[c,a]=x.useState([]),[d,h]=x.useState("all"),[C,R]=x.useState(!1),[P,b]=x.useState(null),l=x.useRef(null);x.useEffect(()=>{function A(T){l.current&&!l.current.contains(T.target)&&s(null)}if(n)return document.addEventListener("mousedown",A,!0),document.addEventListener("click",A,!0),()=>{document.removeEventListener("mousedown",A,!0),document.removeEventListener("click",A,!0)}},[n,s]),x.useEffect(()=>{(async()=>{try{R(!0),b(null);const[T,G]=await Promise.all([ht.getExamples(),ht.getCategories()]);o(T),a(G)}catch(T){console.error("Failed to load examples:",T),b("Failed to load examples")}finally{R(!1)}})()},[]);const m=async A=>{try{R(!0),b(null),await ht.applyExample(A.id),s(null)}catch(T){console.error("Failed to apply example:",T),b(`Failed to load "${A.title}"`)}finally{R(!1)}},p=async()=>{try{R(!0),b(null),await ht.clearCanvas(),s(null)}catch(A){console.error("Failed to clear canvas:",A),b("Failed to clear canvas")}finally{R(!1)}},y=d==="all"?r:r.filter(A=>A.category===d),S=A=>{switch(A){case"beginner":return"text-green-600 bg-green-50";case"intermediate":return"text-yellow-600 bg-yellow-50";case"advanced":return"text-red-600 bg-red-50";default:return"text-gray-600 bg-gray-50"}},_=A=>{switch(A){case"beginner":return"‚óè";case"intermediate":return"‚óè‚óè";case"advanced":return"‚óè‚óè‚óè";default:return"?"}},N=A=>{const T={fractions:"examples.category.fractions",geometry:"examples.category.geometry",algebra:"examples.category.algebra",trigonometry:"examples.category.trigonometry",calculus:"examples.category.calculus",statistics:"examples.category.statistics",basics:"examples.category.basics",advanced:"examples.category.advanced","number theory":"examples.category.numbertheory",numbertheory:"examples.category.numbertheory","number-theory":"examples.category.numbertheory",precalculus:"examples.category.precalculus","pre-calculus":"examples.category.precalculus",linearalgebra:"examples.category.linearalgebra","linear algebra":"examples.category.linearalgebra","linear-algebra":"examples.category.linearalgebra",discrete:"examples.category.discrete","discrete math":"examples.category.discrete","discrete-math":"examples.category.discrete",discretemath:"examples.category.discrete",probability:"examples.category.probability",functions:"examples.category.functions"},G=A.id.toLowerCase().replace(/[^a-z0-9]/g,""),I=A.name.toLowerCase().replace(/[^a-z0-9]/g,""),ne=T[G]||T[I];if(ne){const oe=i(ne);return oe===ne?A.name:oe}return A.name};return e.jsxs("div",{ref:l,className:"relative z-50",children:[e.jsxs("button",{onClick:()=>s(t==="examples"?null:"examples"),className:"flex items-center gap-2 px-4 py-2 rounded-lg border transition-all bg-gray-50 border-gray-200 text-gray-700 hover:bg-gray-100",title:i("toolbar.examples"),disabled:C,children:[e.jsx("span",{className:"text-lg",children:"üìö"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:i("toolbar.examples")}),e.jsx("span",{className:`text-xs transition-transform ${n?"rotate-180":""}`,children:"‚ñº"})]}),n&&e.jsxs("div",{className:"absolute top-full right-0 mt-2 bg-white border border-gray-200 rounded-lg shadow-lg w-80 max-h-[32rem] overflow-hidden",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-100 px-4 py-3 rounded-t-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:i("tutorial.examples.title")}),e.jsx("button",{onClick:p,className:"text-xs text-red-600 hover:text-red-800 font-medium",disabled:C,children:i("actions.clearBoard")})]}),e.jsx("div",{className:"mt-2",children:e.jsxs("select",{value:d,onChange:A=>h(A.target.value),className:"w-full text-xs border border-gray-200 rounded px-2 py-1 bg-white",disabled:C,children:[e.jsx("option",{value:"all",children:(()=>{const A=i("examples.allCategories");return A==="examples.allCategories"?"All Categories":A})()}),c.map(A=>e.jsx("option",{value:A.id,children:N(A)},A.id))]})})]}),P&&e.jsx("div",{className:"px-4 py-2 bg-red-50 border-b border-red-100",children:e.jsx("p",{className:"text-xs text-red-600",children:P})}),e.jsx("div",{className:"overflow-y-auto max-h-80 examples-scrollable",children:C?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"text-sm text-gray-500",children:i("tutorial.loading")})}):y.length===0?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"text-sm text-gray-500",children:i("examples.noExamples")})}):e.jsx("div",{className:"p-2 space-y-1",children:y.map(A=>e.jsx("button",{onClick:()=>m(A),className:"w-full text-left p-3 rounded-lg hover:bg-gray-50 transition-colors group",disabled:C,children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 group-hover:text-blue-600 truncate",children:A.title}),e.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded font-medium ${S(A.difficulty)}`,title:`${A.difficulty} difficulty`,children:_(A.difficulty)})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1 line-clamp-2",children:A.description}),c.find(T=>T.id===A.category)&&e.jsxs("div",{className:"flex items-center gap-1 mt-2",children:[e.jsx("span",{className:"text-xs text-gray-400",children:(()=>{const T=c.find(G=>G.id===A.category);return T?N(T):""})()}),e.jsx("span",{className:"text-xs text-gray-300",children:"‚Ä¢"}),e.jsxs("span",{className:"text-xs text-gray-400",children:[A.objects.length," object",A.objects.length!==1?"s":""]})]})]})})},A.id))})}),e.jsx("div",{className:"sticky bottom-0 bg-gray-50 border-t border-gray-100 px-4 py-2 rounded-b-lg",children:e.jsx("p",{className:"text-xs text-gray-500 text-center",children:"Click an example to explore mathematical concepts"})})]})]})}function $t({className:i=""}){const{activeTool:t,setActiveTool:s}=it(),{openMenu:n,setOpenMenu:r}=mt(),{t:o}=Ge(),c=n==="build",a=x.useRef(null),d=[{id:"ray-tool",name:o("tools.line"),icon:"üìè",description:o("tools.line.description")},{id:"rectangle-tool",name:o("tools.rectangle"),icon:"‚¨ú",description:o("tools.rectangle.description")},{id:"circle-tool",name:o("tools.circle"),icon:"‚≠ï",description:o("tools.circle.description")},{id:"triangle-tool",name:o("tools.triangle"),icon:"üî∫",description:o("tools.triangle.description")},{id:"function-tool",name:o("tools.function"),icon:"üìà",description:o("tools.function.description")}],h=b=>{s(b),r(null)},C=()=>{s(null),r(null)},R=()=>{r(n==="build"?null:"build")},P=d.find(b=>b.id===t);return x.useEffect(()=>{const b=l=>{a.current&&!a.current.contains(l.target)&&r(null)};if(c)return document.addEventListener("mousedown",b,!0),document.addEventListener("touchstart",b,!0),document.addEventListener("click",b,!0),()=>{document.removeEventListener("mousedown",b,!0),document.removeEventListener("touchstart",b,!0),document.removeEventListener("click",b,!0)}},[c,r]),e.jsxs("div",{className:`flex items-center gap-2 p-2 bg-white border-b border-gray-200 ${i}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mr-4",children:[e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 32 32",className:"flex-shrink-0",children:[e.jsx("rect",{width:"32",height:"32",fill:"#2563eb",rx:"6"}),e.jsxs("g",{stroke:"#60A5FA",strokeWidth:"0.5",opacity:"0.6",children:[e.jsx("line",{x1:"8",y1:"4",x2:"8",y2:"28"}),e.jsx("line",{x1:"16",y1:"4",x2:"16",y2:"28"}),e.jsx("line",{x1:"24",y1:"4",x2:"24",y2:"28"}),e.jsx("line",{x1:"4",y1:"8",x2:"28",y2:"8"}),e.jsx("line",{x1:"4",y1:"16",x2:"28",y2:"16"}),e.jsx("line",{x1:"4",y1:"24",x2:"28",y2:"24"})]}),e.jsxs("g",{stroke:"#FFFFFF",strokeWidth:"1",children:[e.jsx("line",{x1:"16",y1:"4",x2:"16",y2:"28"}),e.jsx("line",{x1:"4",y1:"16",x2:"28",y2:"16"})]}),e.jsx("line",{x1:"16",y1:"16",x2:"24",y2:"8",stroke:"#22C55E",strokeWidth:"2"}),e.jsx("circle",{cx:"16",cy:"16",r:"2",fill:"#FFFFFF"}),e.jsx("circle",{cx:"24",cy:"8",r:"1.5",fill:"#22C55E"})]}),e.jsx("h1",{className:"text-lg font-semibold text-gray-800",children:"Grix"})]}),e.jsxs("div",{className:"relative",ref:a,children:[e.jsxs("button",{onClick:R,className:`
            flex items-center gap-2 px-4 py-2 rounded-lg border transition-all
            ${t?"bg-blue-100 border-blue-300 text-blue-700":"bg-gray-50 border-gray-200 text-gray-700 hover:bg-gray-100"}
          `,children:[e.jsx("span",{className:"text-lg",children:"üèóÔ∏è"}),e.jsx("span",{className:"text-sm font-medium",children:P?P.name:o("toolbar.build")}),e.jsx("span",{className:`text-xs transition-transform ${c?"rotate-180":""}`,children:"‚ñº"})]}),c&&e.jsx("div",{className:"build-dropdown absolute top-full left-0 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg z-50 min-w-48 max-h-80 overflow-y-auto",children:e.jsxs("div",{className:"build-dropdown-scrollable",children:[d.map(b=>e.jsxs("button",{onClick:()=>h(b.id),className:`
                    w-full flex items-center gap-3 px-4 py-3 text-left hover:bg-gray-50 first:rounded-t-lg transition-colors
                    ${t===b.id?"bg-blue-50 text-blue-700":"text-gray-700"}
                  `,title:b.description,children:[e.jsx("span",{className:"text-lg",children:b.icon}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:b.name}),e.jsx("div",{className:"text-xs text-gray-500",children:b.description})]})]},b.id)),t&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-t border-gray-100"}),e.jsxs("button",{onClick:C,className:"w-full flex items-center gap-3 px-4 py-2 text-left hover:bg-gray-50 rounded-b-lg transition-colors text-gray-600",children:[e.jsx("span",{className:"text-lg",children:"‚úï"}),e.jsx("span",{className:"text-sm",children:o("toolbar.panMode")})]})]})]})})]}),e.jsx("div",{className:"ml-auto",children:e.jsx(vs,{})})]})}class Rt extends x.Component{constructor(t){super(t),this.state={hasError:!1}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,s){console.error("Canvas Error Boundary caught an error:",t,s),this.setState({error:t,errorInfo:s})}render(){var t,s;if(this.state.hasError){const n=this.props.fallback;return n?e.jsx(n,{error:this.state.error}):e.jsx("div",{className:"flex items-center justify-center h-full bg-red-50 text-red-700 p-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Something went wrong with the Canvas"}),e.jsxs("details",{className:"text-sm",children:[e.jsx("summary",{className:"cursor-pointer mb-2",children:"Error Details"}),e.jsxs("pre",{className:"whitespace-pre-wrap text-left bg-red-100 p-4 rounded",children:[(t=this.state.error)==null?void 0:t.toString(),(s=this.state.errorInfo)==null?void 0:s.componentStack]})]}),e.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Reload Page"})]})})}return this.props.children}}function js({children:i}){const[t,s]=x.useState(!1),[n,r]=x.useState(navigator.onLine),[o,c]=x.useState(null),{loadState:a,saveState:d}=Ee(),h=De();x.useEffect(()=>{"serviceWorker"in navigator&&C(),R(),P(),b(),l(),s(!0)},[]);const C=async()=>{try{const y=await navigator.serviceWorker.register("/sw.js",{scope:"/"});console.log("üéØ Grix PWA: Service Worker registered successfully:",y.scope),y.addEventListener("updatefound",()=>{const S=y.installing;S&&S.addEventListener("statechange",()=>{S.state==="installed"&&navigator.serviceWorker.controller&&(console.log("üîÑ Grix PWA: New version available"),m())})})}catch(y){console.error("‚ùå Grix PWA: Service Worker registration failed:",y)}},R=()=>{try{const y=re.loadState();if(y)(y.objects||y.viewport)&&a(),y.visualizationSettings&&Object.entries(y.visualizationSettings).forEach(([S,_])=>{S in h&&typeof h[S]==typeof _&&(h[S]=_)}),console.log("üìÇ Grix PWA: Restored saved state from previous session");else{const S=Ee.getState();if(S.objects.length===0){const _={id:`ray_default_${Date.now()}`,type:"ray",properties:{startPoint:{x:0,y:0},endPoint:{x:3,y:9},slope:3,yIntercept:0},visible:!0,selected:!1,zIndex:0};S.addObject(_),console.log("üéØ Grix PWA: Created default line (0,0) to (3,9) for first-time user"),localStorage.setItem("grix-show-endpoint-tooltip","true")}}}catch(y){console.error("‚ùå Grix PWA: Failed to load saved state:",y)}},P=()=>{window.addEventListener("grix:auto-save-requested",()=>{const y=Ee.getState(),S=De.getState();re.saveState({objects:y.objects,selectedObjects:y.selectedObjects,viewport:y.viewport,visualizationSettings:{showEquivalentFractions:S.showEquivalentFractions,showLengthMultiples:S.showLengthMultiples,showAreaRectangle:S.showAreaRectangle,showDivisionMultiples:S.showDivisionMultiples,showRiseRunTriangle:S.showRiseRunTriangle,showDistanceMarkers:S.showDistanceMarkers,showAngleArc:S.showAngleArc,showCoordinateProjections:S.showCoordinateProjections,showDivisionAnswer:S.showDivisionAnswer,showLatticePoints:S.showLatticePoints,showReferenceLineY_equals_X:S.showReferenceLineY_equals_X,showTangentLines:S.showTangentLines,showFunctionExtensions:S.showFunctionExtensions,showTriangleAngles:S.showTriangleAngles,showTriangleClassification:S.showTriangleClassification,showSpecialTriangles:S.showSpecialTriangles,showSOHCAHTOA:S.showSOHCAHTOA,showTrigValues:S.showTrigValues,showTriangleAltitudes:S.showTriangleAltitudes,showPythagoreanSquares:S.showPythagoreanSquares,fontScale:S.fontScale,snapPrecision:S.snapPrecision,coordinateSystem:S.coordinateSystem}})})},b=()=>{const y=()=>{r(!0),console.log("üåê Grix PWA: Back online")},S=()=>{r(!1),console.log("üì± Grix PWA: Now offline")};return window.addEventListener("online",y),window.addEventListener("offline",S),()=>{window.removeEventListener("online",y),window.removeEventListener("offline",S)}},l=()=>{const y=S=>{S.preventDefault(),c(S),console.log("üì± Grix PWA: Install prompt available")};return window.addEventListener("beforeinstallprompt",y),()=>{window.removeEventListener("beforeinstallprompt",y)}},m=()=>{console.log("üîÑ Grix PWA: New version available - refresh to update")},p=async()=>{if(o)try{const y=await o.prompt();console.log("üì± Grix PWA: Install prompt result:",y.outcome),c(null)}catch(y){console.error("‚ùå Grix PWA: Install failed:",y)}};return t?e.jsxs("div",{className:"relative",children:[i,!n&&e.jsx("div",{className:"fixed top-0 left-0 right-0 bg-yellow-500 text-white text-center py-2 z-50",children:e.jsx("span",{className:"text-sm font-medium",children:"üì± You're offline - Grix continues to work with saved data"})}),o&&e.jsxs("div",{className:"fixed bottom-20 right-4 bg-blue-600 text-white p-4 rounded-lg shadow-lg z-40 max-w-sm",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Install Grix App"}),e.jsx("p",{className:"text-sm mb-3",children:"Add Grix to your home screen for quick access and offline use."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>c(null),className:"px-3 py-1 text-sm bg-blue-500 rounded hover:bg-blue-400",children:"Later"}),e.jsx("button",{onClick:p,className:"px-3 py-1 text-sm bg-white text-blue-600 rounded hover:bg-gray-100",children:"Install"})]})]})]}):e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Loading Grix"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Preparing your mathematical playground..."})]})})}class ws{constructor(){ee(this,"id","ray-tool");ee(this,"name","Line Builder");ee(this,"context");ee(this,"state",{isCreating:!1,startPoint:null,currentRay:null,dragTarget:null,dragOffset:null})}init(t){this.context=t,t.events.on("tool:changed",this.handleToolChange.bind(this)),t.events.on("tool:cancel",this.handleToolCancel.bind(this))}destroy(){this.context.events.off("tool:changed",this.handleToolChange.bind(this)),this.context.events.off("tool:cancel",this.handleToolCancel.bind(this))}handleToolChange(t){t.current!==this.id&&this.cancelCreation()}handleToolCancel(t){t.toolId===this.id&&this.cancelCreation()}cancelCreation(){this.state.currentRay&&this.state.isCreating&&this.context.canvas.removeObject(this.state.currentRay.id),this.state={isCreating:!1,startPoint:null,currentRay:null,dragTarget:null,dragOffset:null}}generateId(){return`ray_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}snapPoint(t){const s=this.context.state.getState();if(s.snapToGrid){if(Math.sqrt(t.x*t.x+t.y*t.y)<=.75)return{x:0,y:0};const o=De.getState(),c=et(s.viewport,o.snapPrecision);return this.context.math.snapToGrid(t,c)}return t}findNearestHandle(t,s=20){this.context.canvas.screenToWorld(t);const n=this.context.canvas.getAllObjects();for(const r of n)if(r.type==="ray"){const o=r,c=this.context.canvas.worldToScreen(o.properties.startPoint),a=this.context.canvas.worldToScreen(o.properties.endPoint),d=this.context.math.distance(t,c),h=this.context.math.distance(t,a);if(d<=s)return{rayId:o.id,handle:"start"};if(h<=s)return{rayId:o.id,handle:"end"};const C=8,R=a.x-c.x,P=a.y-c.y,b=Math.sqrt(R*R+P*P);if(b>0){const l=Math.max(0,Math.min(1,((t.x-c.x)*R+(t.y-c.y)*P)/(b*b))),m={x:c.x+l*R,y:c.y+l*P};if(this.context.math.distance(t,m)<=C)return{rayId:o.id,handle:"move"}}}return null}onPointerDown(t){const s={x:t.x,y:t.y},n=this.snapPoint(this.context.canvas.screenToWorld(s)),r=this.findNearestHandle(s);if(r){const o=this.context.canvas.getObject(r.rayId),c=this.context.state.getState().selectedObjects;if(o&&c.includes(r.rayId)){this.state.currentRay=o,this.state.dragTarget=r.handle,this.state.isCreating=!1,r.handle==="move"&&(this.state.dragOffset={x:n.x-o.properties.startPoint.x,y:n.y-o.properties.startPoint.y});return}}if(!this.state.isCreating){if(this.context.state.getState().selectedObjects.some(d=>{const h=this.context.canvas.getObject(d);return(h==null?void 0:h.type)==="ray"}))return;this.state.isCreating=!0,this.state.startPoint=n;const a={id:this.generateId(),type:"ray",properties:{startPoint:n,endPoint:{...n},slope:0,yIntercept:n.y},visible:!0,selected:!1,zIndex:0};this.state.currentRay=a,this.context.canvas.addObject(a)}}onPointerMove(t){if(!this.state.currentRay)return;const s={x:t.x,y:t.y},n=this.snapPoint(this.context.canvas.screenToWorld(s));if(this.state.isCreating){const r=this.context.math.slope(this.state.currentRay.properties.startPoint,n),o=n.y-r*n.x;this.context.canvas.updateObject(this.state.currentRay.id,{properties:{...this.state.currentRay.properties,endPoint:n,slope:r,yIntercept:isFinite(r)?o:this.state.currentRay.properties.startPoint.y}})}else if(this.state.dragTarget){const r=this.context.canvas.getObject(this.state.currentRay.id);if(!r)return;const o={...r.properties};if(this.state.dragTarget==="start")o.startPoint=n;else if(this.state.dragTarget==="end")o.endPoint=n;else if(this.state.dragTarget==="move"&&this.state.dragOffset){const c=n.x-this.state.dragOffset.x-r.properties.startPoint.x,a=n.y-this.state.dragOffset.y-r.properties.startPoint.y;o.startPoint={x:r.properties.startPoint.x+c,y:r.properties.startPoint.y+a},o.endPoint={x:r.properties.endPoint.x+c,y:r.properties.endPoint.y+a}}if(this.state.dragTarget==="start"||this.state.dragTarget==="end"){const c=this.context.math.slope(o.startPoint,o.endPoint);o.slope=c,o.yIntercept=isFinite(c)?o.startPoint.y-c*o.startPoint.x:o.startPoint.y}this.context.canvas.updateObject(this.state.currentRay.id,{properties:o})}this.context.events.emit("ray:update",{rayId:this.state.currentRay.id,ray:this.context.canvas.getObject(this.state.currentRay.id)})}onPointerUp(t){if(this.state.isCreating&&this.state.currentRay){const s={x:t.x,y:t.y},n=this.snapPoint(this.context.canvas.screenToWorld(s)),r=this.state.currentRay.properties.startPoint;this.context.math.distance(r,n)<.1?this.context.canvas.removeObject(this.state.currentRay.id):(this.context.events.emit("ray:created",{rayId:this.state.currentRay.id,ray:this.state.currentRay}),this.context.events.emit("tool:creation-complete",{toolId:this.id,objectId:this.state.currentRay.id}))}this.state={isCreating:!1,startPoint:null,currentRay:null,dragTarget:null,dragOffset:null}}}function Bt(){return new ws}class Ss{constructor(){ee(this,"id","rectangle-tool");ee(this,"name","Rectangle Builder");ee(this,"context");ee(this,"state",{isCreating:!1,startPoint:null,currentRectangle:null,dragTarget:null,dragOffset:null,lockedCorner:null})}init(t){this.context=t,t.events.on("tool:changed",this.handleToolChange.bind(this)),t.events.on("tool:cancel",this.handleToolCancel.bind(this))}destroy(){this.context.events.off("tool:changed",this.handleToolChange.bind(this)),this.context.events.off("tool:cancel",this.handleToolCancel.bind(this))}handleToolChange(t){t.current!==this.id&&this.cancelCreation()}handleToolCancel(t){t.toolId===this.id&&this.cancelCreation()}cancelCreation(){this.state.currentRectangle&&this.state.isCreating&&this.context.canvas.removeObject(this.state.currentRectangle.id),this.state={isCreating:!1,startPoint:null,currentRectangle:null,dragTarget:null,dragOffset:null,lockedCorner:null}}generateId(){return`rect_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}snapPoint(t){const s=this.context.state.getState();if(s.snapToGrid){if(Math.sqrt(t.x*t.x+t.y*t.y)<=.75)return{x:0,y:0};const o=De.getState(),c=et(s.viewport,o.snapPrecision);return this.context.math.snapToGrid(t,c)}return t}findRectangleAtPoint(t){const s=this.context.canvas.getAllObjects();for(const n of s)if(n.type==="rectangle"){const r=n,{x:o,y:c,width:a,height:d}=r.properties;if(t.x>=o&&t.x<=o+a&&t.y>=c&&t.y<=c+d)return r}return null}findNearestCorner(t,s,n=.5){const{x:r,y:o,width:c,height:a}=s.properties,d=[{point:{x:r,y:o},type:"corner-bl"},{point:{x:r+c,y:o},type:"corner-br"},{point:{x:r,y:o+a},type:"corner-tl"},{point:{x:r+c,y:o+a},type:"corner-tr"}];for(const h of d)if(this.context.math.distance(t,h.point)<=n)return h.type;return null}onPointerDown(t){const s={x:t.x,y:t.y},n=this.snapPoint(this.context.canvas.screenToWorld(s)),r=this.findRectangleAtPoint(n);if(r&&this.context.state.getState().selectedObjects.includes(r.id)){const h=this.findNearestCorner(n,r);if(h){this.state.currentRectangle=r,this.state.dragTarget=h,this.state.isCreating=!1;const{x:C,y:R,width:P,height:b}=r.properties;switch(h){case"corner-tl":this.state.lockedCorner={x:C+P,y:R};break;case"corner-tr":this.state.lockedCorner={x:C,y:R};break;case"corner-bl":this.state.lockedCorner={x:C+P,y:R+b};break;case"corner-br":this.state.lockedCorner={x:C,y:R+b};break}return}else{this.state.currentRectangle=r,this.state.dragTarget="move",this.state.dragOffset={x:n.x-r.properties.x,y:n.y-r.properties.y},this.state.isCreating=!1;return}}if(this.context.state.getState().selectedObjects.some(d=>{const h=this.context.canvas.getObject(d);return(h==null?void 0:h.type)==="rectangle"}))return;this.state.isCreating=!0,this.state.startPoint=n;const a={id:this.generateId(),type:"rectangle",properties:{x:n.x,y:n.y,width:0,height:0,area:0},visible:!0,selected:!1,zIndex:0};this.state.currentRectangle=a,this.context.canvas.addObject(a)}onPointerMove(t){if(!this.state.currentRectangle)return;const s={x:t.x,y:t.y},n=this.snapPoint(this.context.canvas.screenToWorld(s));if(this.state.isCreating&&this.state.startPoint){const r=Math.min(this.state.startPoint.x,n.x),o=Math.min(this.state.startPoint.y,n.y),c=Math.abs(n.x-this.state.startPoint.x),a=Math.abs(n.y-this.state.startPoint.y),d=c*a;this.context.canvas.updateObject(this.state.currentRectangle.id,{properties:{x:r,y:o,width:c,height:a,area:d}})}else if(this.state.dragTarget==="move"&&this.state.dragOffset){const r=n.x-this.state.dragOffset.x,o=n.y-this.state.dragOffset.y;this.context.canvas.updateObject(this.state.currentRectangle.id,{properties:{...this.state.currentRectangle.properties,x:r,y:o}})}else if(this.state.dragTarget&&this.state.dragTarget.startsWith("corner-")&&this.state.lockedCorner){const r=this.state.lockedCorner,o=Math.min(n.x,r.x),c=Math.max(n.x,r.x),a=Math.min(n.y,r.y),d=Math.max(n.y,r.y),h=o,C=a,R=c-o,P=d-a,b=Math.max(.1,R),l=Math.max(.1,P),m=b*l;this.context.canvas.updateObject(this.state.currentRectangle.id,{properties:{x:h,y:C,width:b,height:l,area:m}})}this.context.events.emit("rectangle:update",{rectangleId:this.state.currentRectangle.id,rectangle:this.context.canvas.getObject(this.state.currentRectangle.id)})}onPointerUp(t){if(this.state.isCreating&&this.state.currentRectangle){const s=this.context.canvas.getObject(this.state.currentRectangle.id);s&&(s.properties.width<.1||s.properties.height<.1?this.context.canvas.removeObject(this.state.currentRectangle.id):(this.context.events.emit("rectangle:created",{rectangleId:this.state.currentRectangle.id,rectangle:s}),this.context.events.emit("tool:creation-complete",{toolId:this.id,objectId:this.state.currentRectangle.id})))}this.state={isCreating:!1,startPoint:null,currentRectangle:null,dragTarget:null,dragOffset:null,lockedCorner:null}}}function Gt(){return new Ss}class Cs{constructor(){ee(this,"id","circle-tool");ee(this,"name","Circle Builder");ee(this,"context");ee(this,"state",{isCreating:!1,center:null,currentCircle:null,dragTarget:null,dragOffset:null})}init(t){this.context=t,t.events.on("tool:changed",this.handleToolChange.bind(this)),t.events.on("tool:cancel",this.handleToolCancel.bind(this))}destroy(){this.context.events.off("tool:changed",this.handleToolChange.bind(this)),this.context.events.off("tool:cancel",this.handleToolCancel.bind(this))}handleToolChange(t){t.current!==this.id&&this.cancelCreation()}handleToolCancel(t){t.toolId===this.id&&this.cancelCreation()}cancelCreation(){this.state.currentCircle&&this.state.isCreating&&this.context.canvas.removeObject(this.state.currentCircle.id),this.state={isCreating:!1,center:null,currentCircle:null,dragTarget:null,dragOffset:null}}generateId(){return`circle_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}snapPoint(t){const s=this.context.state.getState();if(s.snapToGrid){if(Math.sqrt(t.x*t.x+t.y*t.y)<=.75)return{x:0,y:0};const o=De.getState(),c=et(s.viewport,o.snapPrecision);return this.context.math.snapToGrid(t,c)}return t}calculateCircleProperties(t,s){const n=this.context.math.distance(t,s),r=n*2,o=2*Math.PI*n,c=Math.PI*n*n;return{radius:n,diameter:r,circumference:o,area:c}}findCircleAtPoint(t){const s=this.context.canvas.getAllObjects();for(const n of s)if(n.type==="circle"){const r=n;if(this.context.math.distance(t,r.properties.center)<=r.properties.radius+.5)return r}return null}findNearestHandle(t,s,n=.5){const{center:r,radius:o}=s.properties;if(this.context.math.distance(t,r)<=n)return"center";const c={x:r.x+o,y:r.y};return this.context.math.distance(t,c)<=n?"radius":null}onPointerDown(t){const s={x:t.x,y:t.y},n=this.snapPoint(this.context.canvas.screenToWorld(s)),r=this.findCircleAtPoint(n);if(r&&!this.context.state.getState().selectedObjects.includes(r.id))return;if(r&&this.context.state.getState().selectedObjects.includes(r.id)){const h=this.findNearestHandle(n,r);if(h){this.state.currentCircle=r,this.state.dragTarget=h,this.state.isCreating=!1,h==="center"&&(this.state.dragOffset={x:n.x-r.properties.center.x,y:n.y-r.properties.center.y});return}else{this.state.currentCircle=r,this.state.dragTarget="center",this.state.isCreating=!1,this.state.dragOffset={x:n.x-r.properties.center.x,y:n.y-r.properties.center.y};return}}if(this.context.state.getState().selectedObjects.some(d=>{const h=this.context.canvas.getObject(d);return(h==null?void 0:h.type)==="circle"}))return;this.state.isCreating=!0,this.state.center=n;const a={id:this.generateId(),type:"circle",properties:{center:n,radius:0,diameter:0,circumference:0,area:0},visible:!0,selected:!1,zIndex:0};this.state.currentCircle=a,this.context.canvas.addObject(a)}onPointerMove(t){if(!this.state.currentCircle)return;const s={x:t.x,y:t.y},n=this.snapPoint(this.context.canvas.screenToWorld(s));if(this.state.isCreating&&this.state.center){const r=this.calculateCircleProperties(this.state.center,n);this.context.canvas.updateObject(this.state.currentCircle.id,{properties:{center:this.state.center,...r}})}else if(this.state.dragTarget==="center"&&this.state.dragOffset){const r={x:n.x-this.state.dragOffset.x,y:n.y-this.state.dragOffset.y};this.context.canvas.updateObject(this.state.currentCircle.id,{properties:{...this.state.currentCircle.properties,center:r}})}else if(this.state.dragTarget==="radius"){const r=this.state.currentCircle.properties.center,o=this.calculateCircleProperties(r,n);this.context.canvas.updateObject(this.state.currentCircle.id,{properties:{center:r,...o}})}this.context.events.emit("circle:update",{circleId:this.state.currentCircle.id,circle:this.context.canvas.getObject(this.state.currentCircle.id)})}onPointerUp(t){if(this.state.isCreating&&this.state.currentCircle){const s=this.context.canvas.getObject(this.state.currentCircle.id);s&&(s.properties.radius<.1?this.context.canvas.removeObject(this.state.currentCircle.id):(this.context.events.emit("circle:created",{circleId:this.state.currentCircle.id,circle:s}),this.context.events.emit("tool:creation-complete",{toolId:this.id,objectId:this.state.currentCircle.id})))}this.state={isCreating:!1,center:null,currentCircle:null,dragTarget:null,dragOffset:null}}}function Es(){return new Cs}class Ms{constructor(){ee(this,"id","triangle-tool");ee(this,"name","Triangle Builder");ee(this,"context");ee(this,"state",{isCreating:!1,creationStep:0,vertices:[null,null,null],currentTriangle:null,dragTarget:null,dragOffset:null})}init(t){this.context=t,t.events.on("tool:changed",this.handleToolChange.bind(this)),t.events.on("tool:cancel",this.handleToolCancel.bind(this))}destroy(){this.context.events.off("tool:changed",this.handleToolChange.bind(this)),this.context.events.off("tool:cancel",this.handleToolCancel.bind(this))}handleToolChange(t){t.current!==this.id&&this.cancelCreation()}handleToolCancel(t){t.toolId===this.id&&this.cancelCreation()}cancelCreation(){this.state.currentTriangle&&this.state.isCreating&&this.context.canvas.removeObject(this.state.currentTriangle.id),this.state={isCreating:!1,creationStep:0,vertices:[null,null,null],currentTriangle:null,dragTarget:null,dragOffset:null}}generateId(){return`triangle_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}snapPoint(t){const s=this.context.state.getState();if(s.snapToGrid){if(Math.sqrt(t.x*t.x+t.y*t.y)<=.75)return{x:0,y:0};const o=De.getState(),c=et(s.viewport,o.snapPrecision);return this.context.math.snapToGrid(t,c)}return t}calculateTriangleProperties(t){const[s,n,r]=t,o=this.context.math.distance(n,r),c=this.context.math.distance(s,r),a=this.context.math.distance(s,n),d=Math.acos((c*c+a*a-o*o)/(2*c*a))*180/Math.PI,h=Math.acos((o*o+a*a-c*c)/(2*o*a))*180/Math.PI,C=180-d-h,R=Math.abs((n.x-s.x)*(r.y-s.y)-(r.x-s.x)*(n.y-s.y))/2,P=o+c+a;let b="scalene";const l=.1;return Math.abs(d-90)<l||Math.abs(h-90)<l||Math.abs(C-90)<l?b="right":d>90||h>90||C>90?b="obtuse":d<90&&h<90&&C<90&&(b="acute"),Math.abs(o-c)<l&&Math.abs(c-a)<l?b="equilateral":(Math.abs(o-c)<l||Math.abs(c-a)<l||Math.abs(o-a)<l)&&(b="isosceles"),{sideA:o,sideB:c,sideC:a,angleA:d,angleB:h,angleC:C,area:R,perimeter:P,type:b}}findTriangleAtPoint(t){const s=this.context.canvas.getAllObjects();for(const n of s)if(n.type==="triangle"){const r=n,[o,c,a]=r.properties.vertices,d=(c.y-a.y)*(o.x-a.x)+(a.x-c.x)*(o.y-a.y),h=((c.y-a.y)*(t.x-a.x)+(a.x-c.x)*(t.y-a.y))/d,C=((a.y-o.y)*(t.x-a.x)+(o.x-a.x)*(t.y-a.y))/d,R=1-h-C;if(h>=0&&C>=0&&R>=0)return r}return null}findNearestVertex(t,s,n=.5){const r=s.properties.vertices;for(let o=0;o<r.length;o++)if(this.context.math.distance(t,r[o])<=n)return`vertex${o}`;return null}onPointerDown(t){const s={x:t.x,y:t.y},n=this.snapPoint(this.context.canvas.screenToWorld(s)),r=this.findTriangleAtPoint(n);if(r&&this.context.state.getState().selectedObjects.includes(r.id)){const c=this.findNearestVertex(n,r);if(c){this.state.currentTriangle=r,this.state.dragTarget=c,this.state.isCreating=!1;return}else{this.state.currentTriangle=r,this.state.dragTarget="move";const a={x:(r.properties.vertices[0].x+r.properties.vertices[1].x+r.properties.vertices[2].x)/3,y:(r.properties.vertices[0].y+r.properties.vertices[1].y+r.properties.vertices[2].y)/3};this.state.dragOffset={x:n.x-a.x,y:n.y-a.y},this.state.isCreating=!1;return}}if(!this.state.isCreating){if(this.context.state.getState().selectedObjects.some(h=>{const C=this.context.canvas.getObject(h);return(C==null?void 0:C.type)==="triangle"}))return;this.state.isCreating=!0,this.state.creationStep=0,this.state.vertices=[n,null,null];const a={x:n.x+3,y:n.y};this.state.vertices[1]=a,this.state.creationStep=1;const d={id:this.generateId(),type:"triangle",properties:{vertices:[n,a,n],sideA:0,sideB:0,sideC:0,angleA:0,angleB:0,angleC:0,area:0,perimeter:0,type:"scalene"},visible:!0,selected:!1,zIndex:0};this.state.currentTriangle=d,this.context.canvas.addObject(d)}}onPointerMove(t){if(!this.state.currentTriangle)return;const s={x:t.x,y:t.y},n=this.snapPoint(this.context.canvas.screenToWorld(s));if(this.state.isCreating&&this.state.creationStep===1){const[r,o]=this.state.vertices;if(r&&o){const c={x:o.x,y:n.y},a=[r,o,c],d=this.calculateTriangleProperties(a);this.context.canvas.updateObject(this.state.currentTriangle.id,{properties:{vertices:a,...d}})}}else if(this.state.dragTarget&&this.state.dragTarget.startsWith("vertex")){const r=parseInt(this.state.dragTarget.replace("vertex","")),o=[...this.state.currentTriangle.properties.vertices];o[r]=n;const c=this.calculateTriangleProperties(o);this.context.canvas.updateObject(this.state.currentTriangle.id,{properties:{vertices:o,...c}})}else if(this.state.dragTarget==="move"&&this.state.dragOffset){const r={x:n.x-this.state.dragOffset.x,y:n.y-this.state.dragOffset.y},o={x:(this.state.currentTriangle.properties.vertices[0].x+this.state.currentTriangle.properties.vertices[1].x+this.state.currentTriangle.properties.vertices[2].x)/3,y:(this.state.currentTriangle.properties.vertices[0].y+this.state.currentTriangle.properties.vertices[1].y+this.state.currentTriangle.properties.vertices[2].y)/3},c={x:r.x-o.x,y:r.y-o.y},a=[{x:this.state.currentTriangle.properties.vertices[0].x+c.x,y:this.state.currentTriangle.properties.vertices[0].y+c.y},{x:this.state.currentTriangle.properties.vertices[1].x+c.x,y:this.state.currentTriangle.properties.vertices[1].y+c.y},{x:this.state.currentTriangle.properties.vertices[2].x+c.x,y:this.state.currentTriangle.properties.vertices[2].y+c.y}];this.context.canvas.updateObject(this.state.currentTriangle.id,{properties:{...this.state.currentTriangle.properties,vertices:a}})}this.context.events.emit("triangle:update",{triangleId:this.state.currentTriangle.id,triangle:this.context.canvas.getObject(this.state.currentTriangle.id)})}onPointerUp(t){if(this.state.isCreating&&this.state.currentTriangle&&this.state.creationStep===1){const s=this.context.canvas.getObject(this.state.currentTriangle.id);s&&(s.properties.area<.1?this.context.canvas.removeObject(this.state.currentTriangle.id):(this.context.events.emit("triangle:created",{triangleId:this.state.currentTriangle.id,triangle:s}),this.context.events.emit("tool:creation-complete",{toolId:this.id,objectId:this.state.currentTriangle.id})))}this.state={isCreating:!1,creationStep:0,vertices:[null,null,null],currentTriangle:null,dragTarget:null,dragOffset:null}}}function ks(){return new Ms}class Ps{constructor(){ee(this,"id","function-tool");ee(this,"name","Function Grapher");ee(this,"context");ee(this,"state",{isCreating:!1,currentFunction:null,dragTarget:null,dragOffset:null,equation:"x^2",functionType:"polynomial"})}init(t){this.context=t,t.events.on("tool:changed",this.handleToolChange.bind(this)),t.events.on("tool:cancel",this.handleToolCancel.bind(this))}destroy(){this.context.events.off("tool:changed",this.handleToolChange.bind(this)),this.context.events.off("tool:cancel",this.handleToolCancel.bind(this))}handleToolChange(t){t.current!==this.id&&this.cancelCreation()}handleToolCancel(t){t.toolId===this.id&&this.cancelCreation()}cancelCreation(){this.state.currentFunction&&this.state.isCreating&&this.context.canvas.removeObject(this.state.currentFunction.id),this.state={isCreating:!1,currentFunction:null,dragTarget:null,dragOffset:null,equation:"x^2",functionType:"polynomial"}}generateId(){return`function_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}snapPoint(t){const s=this.context.state.getState();if(s.snapToGrid){const n=De.getState(),r=et(s.viewport,n.snapPrecision);return this.context.math.snapToGrid(t,r)}return t}evaluateFunction(t,s){try{const n=t.replace(/\bx\b/g,`(${s})`).replace(/\^/g,"**").replace(/sin/g,"Math.sin").replace(/cos/g,"Math.cos").replace(/tan/g,"Math.tan").replace(/log/g,"Math.log").replace(/ln/g,"Math.log").replace(/exp/g,"Math.exp").replace(/sqrt/g,"Math.sqrt").replace(/abs/g,"Math.abs").replace(/pi/g,"Math.PI").replace(/e\b/g,"Math.E"),o=new Function("x",`return ${n}`)(s);if(typeof o=="number"&&!isNaN(o)&&isFinite(o))return o}catch{}return null}generateFunctionPoints(t,s,n){const r=[],o=(s.max-s.min)/(n*(s.max-s.min));for(let c=s.min;c<=s.max;c+=o){const a=this.evaluateFunction(t,c);a!==null&&r.push({x:c,y:a})}return r}detectFunctionType(t){return t.includes("sin")||t.includes("cos")||t.includes("tan")?"trigonometric":t.includes("exp")||t.includes("e^")?"exponential":t.includes("log")||t.includes("ln")?"logarithmic":/x\^\d+|x\*\*\d+/.test(t)?"polynomial":"custom"}getDefaultEquation(t){switch(t){case"polynomial":return"x^2";case"trigonometric":return"sin(x)";case"exponential":return"exp(x)";case"logarithmic":return"log(x)";default:return"x^2"}}findFunctionAtPoint(t){const s=this.context.canvas.getAllObjects(),n=.3;for(const r of s)if(r.type==="function"){const o=r;for(let c=0;c<o.properties.points.length-1;c++){const a=o.properties.points[c],d=o.properties.points[c+1];if(!a||!d)continue;const h=d.x-a.x,C=d.y-a.y,R=Math.sqrt(h*h+C*C);if(R===0)continue;const P=Math.max(0,Math.min(1,((t.x-a.x)*h+(t.y-a.y)*C)/(R*R))),b={x:a.x+P*h,y:a.y+P*C};if(Math.sqrt((t.x-b.x)**2+(t.y-b.y)**2)<=n)return o}}return null}onPointerDown(t){const s={x:t.x,y:t.y},n=this.snapPoint(this.context.canvas.screenToWorld(s)),r=this.findFunctionAtPoint(n);if(r&&this.context.state.getState().selectedObjects.includes(r.id)){const c=r.properties.domain,a=this.evaluateFunction(r.properties.equation,c.min),d=this.evaluateFunction(r.properties.equation,c.max);if(a!==null&&Math.abs(n.x-c.min)<.5&&Math.abs(n.y-a)<.5){this.state.currentFunction=r,this.state.dragTarget="domain-start",this.state.isCreating=!1;return}else if(d!==null&&Math.abs(n.x-c.max)<.5&&Math.abs(n.y-d)<.5){this.state.currentFunction=r,this.state.dragTarget="domain-end",this.state.isCreating=!1;return}else{this.state.currentFunction=r,this.state.dragTarget="move",this.state.dragOffset={x:0,y:0},this.state.isCreating=!1;return}}if(!this.state.isCreating){if(this.context.state.getState().selectedObjects.some(R=>{const P=this.context.canvas.getObject(R);return(P==null?void 0:P.type)==="function"}))return;this.state.isCreating=!0,this.state.equation=this.getDefaultEquation(this.state.functionType);const a=8,d={min:n.x-a/2,max:n.x+a/2},h=this.generateFunctionPoints(this.state.equation,d,20),C={id:this.generateId(),type:"function",properties:{equation:this.state.equation,functionType:this.detectFunctionType(this.state.equation),domain:d,points:h,resolution:20,color:"#2563eb",strokeWidth:2},visible:!0,selected:!1,zIndex:0};this.state.currentFunction=C,this.context.canvas.addObject(C)}}onPointerMove(t){if(!this.state.currentFunction)return;const s={x:t.x,y:t.y},n=this.snapPoint(this.context.canvas.screenToWorld(s));if(this.state.dragTarget==="domain-start"){const r={min:Math.min(n.x,this.state.currentFunction.properties.domain.max-.1),max:this.state.currentFunction.properties.domain.max},o=this.generateFunctionPoints(this.state.currentFunction.properties.equation,r,this.state.currentFunction.properties.resolution);this.context.canvas.updateObject(this.state.currentFunction.id,{properties:{...this.state.currentFunction.properties,domain:r,points:o}})}else if(this.state.dragTarget==="domain-end"){const r={min:this.state.currentFunction.properties.domain.min,max:Math.max(n.x,this.state.currentFunction.properties.domain.min+.1)},o=this.generateFunctionPoints(this.state.currentFunction.properties.equation,r,this.state.currentFunction.properties.resolution);this.context.canvas.updateObject(this.state.currentFunction.id,{properties:{...this.state.currentFunction.properties,domain:r,points:o}})}else if(this.state.dragTarget==="move"){if(!this.state.dragOffset){const d=(this.state.currentFunction.properties.domain.min+this.state.currentFunction.properties.domain.max)/2;this.state.dragOffset={x:n.x-d,y:0}}(this.state.currentFunction.properties.domain.min+this.state.currentFunction.properties.domain.max)/2;const r=n.x-this.state.dragOffset.x,o=this.state.currentFunction.properties.domain.max-this.state.currentFunction.properties.domain.min,c={min:r-o/2,max:r+o/2},a=this.generateFunctionPoints(this.state.currentFunction.properties.equation,c,this.state.currentFunction.properties.resolution);this.context.canvas.updateObject(this.state.currentFunction.id,{properties:{...this.state.currentFunction.properties,domain:c,points:a}})}this.context.events.emit("function:update",{functionId:this.state.currentFunction.id,function:this.context.canvas.getObject(this.state.currentFunction.id)})}onPointerUp(t){this.state.isCreating&&this.state.currentFunction&&(this.context.events.emit("function:created",{functionId:this.state.currentFunction.id,function:this.context.canvas.getObject(this.state.currentFunction.id)}),this.context.events.emit("tool:creation-complete",{toolId:this.id,objectId:this.state.currentFunction.id})),this.state={...this.state,isCreating:!1,currentFunction:null,dragTarget:null,dragOffset:null}}}function Ts(){return new Ps}class As{constructor(){ee(this,"id","area-counter");ee(this,"name","Area Counter");ee(this,"context");ee(this,"badges",new Map);ee(this,"badgeElements",new Map)}init(t){this.context=t,t.events.on("rectangle:created",this.handleRectangleCreated.bind(this)),t.events.on("rectangle:update",this.handleRectangleUpdated.bind(this)),t.events.on("object:removed",this.handleObjectRemoved.bind(this)),this.createBadgesForExistingRectangles();const s=t.state.subscribe(n=>{this.updateBadgePositions()});this.unsubscribeFromState=s}destroy(){this.context.events.off("rectangle:created",this.handleRectangleCreated.bind(this)),this.context.events.off("rectangle:update",this.handleRectangleUpdated.bind(this)),this.context.events.off("object:removed",this.handleObjectRemoved.bind(this)),this.unsubscribeFromState&&this.unsubscribeFromState(),this.badgeElements.forEach(t=>{t.remove()}),this.badgeElements.clear(),this.badges.clear()}createBadgesForExistingRectangles(){this.context.canvas.getAllObjects().forEach(s=>{s.type==="rectangle"&&this.createBadge(s)})}handleRectangleCreated(t){this.createBadge(t.rectangle)}handleRectangleUpdated(t){this.updateBadge(t.rectangle)}handleObjectRemoved(t){this.removeBadge(t.objectId)}createBadge(t){const s={rectangleId:t.id,x:t.properties.x,y:t.properties.y,width:t.properties.width,height:t.properties.height,area:t.properties.area,visible:!0};this.badges.set(t.id,s),this.createBadgeElement(s)}updateBadge(t){const s=this.badges.get(t.id);s&&(s.x=t.properties.x,s.y=t.properties.y,s.width=t.properties.width,s.height=t.properties.height,s.area=t.properties.area,this.updateBadgeElement(s))}removeBadge(t){const s=this.badgeElements.get(t);s&&(s.remove(),this.badgeElements.delete(t)),this.badges.delete(t)}createBadgeElement(t){const s=document.createElement("div");s.className="area-badge",s.style.cssText=`
      position: absolute;
      background: rgba(34, 197, 94, 0.9);
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 600;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
      white-space: nowrap;
      pointer-events: none;
      z-index: 1000;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(34, 197, 94, 1);
    `,(document.querySelector("[data-grix-canvas]")||document.body).appendChild(s),this.badgeElements.set(t.rectangleId,s),this.updateBadgeElement(t)}updateBadgeElement(t){const s=this.badgeElements.get(t.rectangleId);if(!s)return;const n=t.x+t.width/2,r=t.y+t.height/2,o=this.context.canvas.worldToScreen({x:n,y:r}),c=this.formatArea(t.area,t.width,t.height);s.textContent=c;const a=s.getBoundingClientRect();s.style.left=`${o.x-a.width/2}px`,s.style.top=`${o.y-a.height/2}px`,s.style.display="none"}formatArea(t,s,n){return""}updateBadgePositions(){this.badges.forEach(t=>{this.updateBadgeElement(t)})}showBadge(t){const s=this.badges.get(t);s&&(s.visible=!0,this.updateBadgeElement(s))}hideBadge(t){const s=this.badges.get(t);if(s){s.visible=!1;const n=this.badgeElements.get(t);n&&(n.style.display="none")}}showAllBadges(){this.badges.forEach((t,s)=>{this.showBadge(s)})}hideAllBadges(){this.badges.forEach((t,s)=>{this.hideBadge(s)})}}function _t(){return new As}function Ns(){const{registerPlugin:i}=it(),t=x.useRef(!1);return x.useEffect(()=>{if(t.current)return;const s=Bt(),n=Gt(),r=Es(),o=ks(),c=Ts(),a=_t();return i(s),i(n),i(r),i(o),i(c),i(a),t.current=!0,()=>{}},[i]),e.jsxs("div",{className:"flex flex-col h-screen bg-gray-50",children:[e.jsx($t,{}),e.jsx("div",{className:"flex-1 relative","data-grix-canvas":!0,children:e.jsx(Wt,{width:window.innerWidth,height:window.innerHeight-60,className:"absolute inset-0"})})]})}function Os(){return e.jsx(Rt,{children:e.jsx(js,{children:e.jsx(bs,{children:e.jsx(Mt,{children:e.jsx(Rt,{children:e.jsx(Ns,{})})})})})})}const Fs="0.1.0";je.Canvas=Wt,je.GrixApp=Os,je.PluginManagerProvider=Mt,je.ToolBar=$t,je.createAreaCounter=_t,je.createRayTool=Bt,je.createRectangleTool=Gt,je.useCanvasStore=Ee,je.useInputSystem=kt,je.usePluginManager=it,je.version=Fs,Object.defineProperty(je,Symbol.toStringTag,{value:"Module"})});
