(function(se,y){typeof exports=="object"&&typeof module<"u"?y(exports,require("react")):typeof define=="function"&&define.amd?define(["exports","react"],y):(se=typeof globalThis<"u"?globalThis:se||self,y(se.GrixUI={},se.React))})(this,function(se,y){"use strict";var Gt=Object.defineProperty;var Yt=(se,y,ge)=>y in se?Gt(se,y,{enumerable:!0,configurable:!0,writable:!0,value:ge}):se[y]=ge;var ee=(se,y,ge)=>Yt(se,typeof y!="symbol"?y+"":y,ge);var ge={exports:{}},Se={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $e;function ct(){if($e)return Se;$e=1;var r=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(n,a,i){var o=null;if(i!==void 0&&(o=""+i),a.key!==void 0&&(o=""+a.key),"key"in a){i={};for(var c in a)c!=="key"&&(i[c]=a[c])}else i=a;return a=i.ref,{$$typeof:r,type:n,key:o,ref:a!==void 0?a:null,props:i}}return Se.Fragment=e,Se.jsx=t,Se.jsxs=t,Se}var Pe={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Re;function lt(){return Re||(Re=1,process.env.NODE_ENV!=="production"&&function(){function r(u){if(u==null)return null;if(typeof u=="function")return u.$$typeof===re?null:u.displayName||u.name||null;if(typeof u=="string")return u;switch(u){case T:return"Fragment";case h:return"Profiler";case l:return"StrictMode";case E:return"Suspense";case W:return"SuspenseList";case _:return"Activity"}if(typeof u=="object")switch(typeof u.tag=="number"&&console.error("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),u.$$typeof){case x:return"Portal";case m:return(u.displayName||"Context")+".Provider";case p:return(u._context.displayName||"Context")+".Consumer";case P:var w=u.render;return u=u.displayName,u||(u=w.displayName||w.name||"",u=u!==""?"ForwardRef("+u+")":"ForwardRef"),u;case A:return w=u.displayName||null,w!==null?w:r(u.type)||"Memo";case F:w=u._payload,u=u._init;try{return r(u(w))}catch{}}return null}function e(u){return""+u}function t(u){try{e(u);var w=!1}catch{w=!0}if(w){w=console;var z=w.error,q=typeof Symbol=="function"&&Symbol.toStringTag&&u[Symbol.toStringTag]||u.constructor.name||"Object";return z.call(w,"The provided key is an unsupported type %s. This value must be coerced to a string before using it here.",q),e(u)}}function n(u){if(u===T)return"<>";if(typeof u=="object"&&u!==null&&u.$$typeof===F)return"<...>";try{var w=r(u);return w?"<"+w+">":"<...>"}catch{return"<...>"}}function a(){var u=H.A;return u===null?null:u.getOwner()}function i(){return Error("react-stack-top-frame")}function o(u){if(X.call(u,"key")){var w=Object.getOwnPropertyDescriptor(u,"key").get;if(w&&w.isReactWarning)return!1}return u.key!==void 0}function c(u,w){function z(){b||(b=!0,console.error("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://react.dev/link/special-props)",w))}z.isReactWarning=!0,Object.defineProperty(u,"key",{get:z,configurable:!0})}function g(){var u=r(this.type);return N[u]||(N[u]=!0,console.error("Accessing element.ref was removed in React 19. ref is now a regular prop. It will be removed from the JSX Element type in a future release.")),u=this.props.ref,u!==void 0?u:null}function f(u,w,z,q,ne,te,xe,ue){return z=te.ref,u={$$typeof:d,type:u,key:w,props:te,_owner:ne},(z!==void 0?z:null)!==null?Object.defineProperty(u,"ref",{enumerable:!1,get:g}):Object.defineProperty(u,"ref",{enumerable:!1,value:null}),u._store={},Object.defineProperty(u._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:0}),Object.defineProperty(u,"_debugInfo",{configurable:!1,enumerable:!1,writable:!0,value:null}),Object.defineProperty(u,"_debugStack",{configurable:!1,enumerable:!1,writable:!0,value:xe}),Object.defineProperty(u,"_debugTask",{configurable:!1,enumerable:!1,writable:!0,value:ue}),Object.freeze&&(Object.freeze(u.props),Object.freeze(u)),u}function S(u,w,z,q,ne,te,xe,ue){var V=w.children;if(V!==void 0)if(q)if(J(V)){for(q=0;q<V.length;q++)j(V[q]);Object.freeze&&Object.freeze(V)}else console.error("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else j(V);if(X.call(w,"key")){V=r(u);var M=Object.keys(w).filter(function(G){return G!=="key"});q=0<M.length?"{key: someKey, "+M.join(": ..., ")+": ...}":"{key: someKey}",B[V+q]||(M=0<M.length?"{"+M.join(": ..., ")+": ...}":"{}",console.error(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,q,V,M,V),B[V+q]=!0)}if(V=null,z!==void 0&&(t(z),V=""+z),o(w)&&(t(w.key),V=""+w.key),"key"in w){z={};for(var L in w)L!=="key"&&(z[L]=w[L])}else z=w;return V&&c(z,typeof u=="function"?u.displayName||u.name||"Unknown":u),f(u,V,te,ne,a(),z,xe,ue)}function j(u){typeof u=="object"&&u!==null&&u.$$typeof===d&&u._store&&(u._store.validated=1)}var R=y,d=Symbol.for("react.transitional.element"),x=Symbol.for("react.portal"),T=Symbol.for("react.fragment"),l=Symbol.for("react.strict_mode"),h=Symbol.for("react.profiler"),p=Symbol.for("react.consumer"),m=Symbol.for("react.context"),P=Symbol.for("react.forward_ref"),E=Symbol.for("react.suspense"),W=Symbol.for("react.suspense_list"),A=Symbol.for("react.memo"),F=Symbol.for("react.lazy"),_=Symbol.for("react.activity"),re=Symbol.for("react.client.reference"),H=R.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,X=Object.prototype.hasOwnProperty,J=Array.isArray,C=console.createTask?console.createTask:function(){return null};R={"react-stack-bottom-frame":function(u){return u()}};var b,N={},ie=R["react-stack-bottom-frame"].bind(R,i)(),D=C(n(i)),B={};Pe.Fragment=T,Pe.jsx=function(u,w,z,q,ne){var te=1e4>H.recentlyCreatedOwnerStacks++;return S(u,w,z,!1,q,ne,te?Error("react-stack-top-frame"):ie,te?C(n(u)):D)},Pe.jsxs=function(u,w,z,q,ne){var te=1e4>H.recentlyCreatedOwnerStacks++;return S(u,w,z,!0,q,ne,te?Error("react-stack-top-frame"):ie,te?C(n(u)):D)}}()),Pe}var We;function dt(){return We||(We=1,process.env.NODE_ENV==="production"?ge.exports=ct():ge.exports=lt()),ge.exports}var s=dt();const ve={distance(r,e){const t=e.x-r.x,n=e.y-r.y;return Math.sqrt(t*t+n*n)},slope(r,e){const t=e.x-r.x,n=e.y-r.y;return Math.abs(t)<Number.EPSILON?t===0||t>0?1/0:-1/0:n/t},angle(r,e){const t=e.x-r.x,n=e.y-r.y;return Math.atan2(n,t)},magnitude(r){return Math.sqrt(r.x*r.x+r.y*r.y)},normalize(r){const e=this.magnitude(r);return e===0?{x:0,y:0}:{x:r.x/e,y:r.y/e}},snapToGrid(r,e){return{x:Math.round(r.x/e)*e,y:Math.round(r.y/e)*e}},calculateArea(r){return Math.abs(r.properties.width*r.properties.height)},boundsContainPoint(r,e){return e.x>=r.x&&e.x<=r.x+r.width&&e.y>=r.y&&e.y<=r.y+r.height},boundsIntersect(r,e){return!(r.x+r.width<e.x||e.x+e.width<r.x||r.y+r.height<e.y||e.y+e.height<r.y)},gcd(r,e){for(r=Math.abs(r),e=Math.abs(e);e!==0;){const t=e;e=r%e,r=t}return r},simplifyFraction(r,e){if(e===0)return[r,1];const t=this.gcd(r,e);return[r/t,e/t]},worldToScreen(r,e,t){const n=t.width/2,a=t.height/2,i=(r.x-e.center.x)*e.zoom,o=(r.y-e.center.y)*e.zoom;return{x:n+i,y:a-o}},screenToWorld(r,e,t){const n=t.width/2,a=t.height/2,i=(r.x-n)/e.zoom,o=(a-r.y)/e.zoom;return{x:e.center.x+i,y:e.center.y+o}}},je={detectCapabilities(){const r="ontouchstart"in window||navigator.maxTouchPoints>0,e=r&&navigator.maxTouchPoints>1,t=!0,n=window.matchMedia("(hover: hover)").matches;return{hasTouch:r,hasPencil:e,hasKeyboard:t,hasHover:n,maxTouchPoints:navigator.maxTouchPoints||0,supportsPressure:"force"in Touch.prototype,supportsTilt:"altitudeAngle"in Touch.prototype}},normalizePointerEvent(r){let e="mouse";return r.pointerType==="touch"?e="touch":r.pointerType==="pen"&&(e="pen"),{type:e,pressure:r.pressure||0,tiltX:r.tiltX||0,tiltY:r.tiltY||0,x:r.clientX,y:r.clientY,timestamp:r.timeStamp,isPrimary:r.isPrimary,pointerId:r.pointerId}},getTouchTargetSize(r){switch(r){case"pen":return 32;case"touch":return 44;case"mouse":return 24;default:return 44}}};class ht{constructor(){this.listeners=new Map}on(e,t){this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(t)}off(e,t){const n=this.listeners.get(e);if(n){const a=n.indexOf(t);a>-1&&n.splice(a,1)}}emit(e,t){const n=this.listeners.get(e);n&&n.forEach(a=>{try{a(t)}catch(i){console.error(`Error in event handler for ${e}:`,i)}})}clear(){this.listeners.clear()}getEvents(){return Array.from(this.listeners.keys())}getListenerCount(e){var t;return((t=this.listeners.get(e))==null?void 0:t.length)||0}}const Le=r=>{let e;const t=new Set,n=(f,S)=>{const j=typeof f=="function"?f(e):f;if(!Object.is(j,e)){const R=e;e=S??(typeof j!="object"||j===null)?j:Object.assign({},e,j),t.forEach(d=>d(e,R))}},a=()=>e,c={setState:n,getState:a,getInitialState:()=>g,subscribe:f=>(t.add(f),()=>t.delete(f))},g=e=r(n,a,c);return c},xt=r=>r?Le(r):Le,ut=r=>r;function pt(r,e=ut){const t=y.useSyncExternalStore(r.subscribe,()=>e(r.getState()),()=>e(r.getInitialState()));return y.useDebugValue(t),t}const Be=r=>{const e=xt(r),t=n=>pt(e,n);return Object.assign(t,e),t},Oe=r=>r?Be(r):Be,de=Oe((r,e)=>({viewport:{center:{x:0,y:0},zoom:20,bounds:{x:-10,y:-10,width:20,height:20}},objects:[],selectedObjects:[],snapToGrid:!0,gridDensity:"fine",canvasSize:{width:800,height:600},setViewport:t=>{r(n=>({viewport:{...n.viewport,...t}}))},addObject:t=>{r(n=>({objects:[...n.objects,t]}))},removeObject:t=>{r(n=>({objects:n.objects.filter(a=>a.id!==t),selectedObjects:n.selectedObjects.filter(a=>a!==t)}))},updateObject:(t,n)=>{r(a=>({objects:a.objects.map(i=>i.id===t?{...i,...n}:i)}))},selectObject:(t,n=!1)=>{r(a=>n?{selectedObjects:a.selectedObjects.includes(t)?a.selectedObjects.filter(o=>o!==t):[...a.selectedObjects,t]}:{selectedObjects:[t]})},clearSelection:()=>{r({selectedObjects:[]})},setSnapToGrid:t=>{r({snapToGrid:t})},setGridDensity:t=>{r({gridDensity:t})},setCanvasSize:t=>{r({canvasSize:t})},getObject:t=>e().objects.find(n=>n.id===t),getAllObjects:()=>e().objects,getSelectedObjects:()=>{const t=e();return t.objects.filter(n=>t.selectedObjects.includes(n.id))},screenToWorld:t=>{const{viewport:n,canvasSize:a}=e();return ve.screenToWorld(t,n,a)},worldToScreen:t=>{const{viewport:n,canvasSize:a}=e();return ve.worldToScreen(t,n,a)},bringToFront:t=>{r(n=>{const a=Math.max(...n.objects.map(i=>i.zIndex||0));return{objects:n.objects.map(i=>i.id===t?{...i,zIndex:a+1}:i)}})},sendToBack:t=>{r(n=>{const a=Math.min(...n.objects.map(i=>i.zIndex||0));return{objects:n.objects.map(i=>i.id===t?{...i,zIndex:a-1}:i)}})},bringForward:t=>{r(n=>{const a=n.objects.find(c=>c.id===t);if(!a)return n;const i=n.objects.filter(c=>(c.zIndex||0)>(a.zIndex||0));if(i.length===0)return n;const o=Math.min(...i.map(c=>c.zIndex||0));return{objects:n.objects.map(c=>c.id===t?{...c,zIndex:o+.1}:c)}})},sendBackward:t=>{r(n=>{const a=n.objects.find(c=>c.id===t);if(!a)return n;const i=n.objects.filter(c=>(c.zIndex||0)<(a.zIndex||0));if(i.length===0)return n;const o=Math.max(...i.map(c=>c.zIndex||0));return{objects:n.objects.map(c=>c.id===t?{...c,zIndex:o-.1}:c)}})}})),gt=()=>({addObject:r=>de.getState().addObject(r),removeObject:r=>de.getState().removeObject(r),updateObject:(r,e)=>de.getState().updateObject(r,e),getObject:r=>de.getState().getObject(r),getAllObjects:()=>de.getState().getAllObjects(),screenToWorld:r=>de.getState().screenToWorld(r),worldToScreen:r=>de.getState().worldToScreen(r)}),ft=()=>({getState:()=>{const r=de.getState();return{viewport:r.viewport,objects:r.objects,selectedObjects:r.selectedObjects,snapToGrid:r.snapToGrid,gridDensity:r.gridDensity}},setState:r=>{de.setState(r)},subscribe:r=>de.subscribe(e=>{r({viewport:e.viewport,objects:e.objects,selectedObjects:e.selectedObjects,snapToGrid:e.snapToGrid,gridDensity:e.gridDensity})})}),Ge=y.createContext(null);function Me(){const r=y.useContext(Ge);if(!r)throw new Error("usePluginManager must be used within PluginManagerProvider");return r}function Ye({children:r}){const[e]=y.useState(()=>new ht),[t]=y.useState(()=>new Map),[n]=y.useState(()=>new Map),[a,i]=y.useState(null),o=y.useRef(),c=y.useRef(),g=y.useRef();o.current||(o.current=gt()),c.current||(c.current=ft()),g.current||(g.current={distance:ve.distance,slope:ve.slope,snapToGrid:ve.snapToGrid,calculateArea:ve.calculateArea});const f=o.current,S=c.current,j=g.current,R=l=>{if(t.has(l.id)){console.warn(`Plugin ${l.id} is already registered`);return}const h={canvas:f,events:e,state:S,math:j};t.set(l.id,l),n.set(l.id,h);try{l.init(h),console.log(`Plugin ${l.id} initialized successfully`)}catch(p){console.error(`Failed to initialize plugin ${l.id}:`,p),t.delete(l.id),n.delete(l.id)}},d=l=>{var p;const h=t.get(l);if(h){try{(p=h.destroy)==null||p.call(h)}catch(m){console.error(`Error destroying plugin ${l}:`,m)}t.delete(l),n.delete(l),a===l&&i(null)}},x=()=>Array.from(t.values());y.useEffect(()=>{e.emit("tool:changed",{previous:null,current:a})},[a,e]),y.useEffect(()=>{const l=P=>E=>{var A,F,_,re,H,X;const W=a?t.get(a):null;if(W)try{switch(P){case"pointer:down":(A=W.onPointerDown)==null||A.call(W,E);break;case"pointer:move":(F=W.onPointerMove)==null||F.call(W,E);break;case"pointer:up":(_=W.onPointerUp)==null||_.call(W,E);break}}catch(J){console.error(`Error in plugin ${a} handling ${P}:`,J)}else{const J=S.getState().selectedObjects;try{let C;if(J.length===1){const b=f.getObject(J[0]);(b==null?void 0:b.type)==="ray"?C=t.get("ray-tool"):(b==null?void 0:b.type)==="rectangle"?C=t.get("rectangle-tool"):(b==null?void 0:b.type)==="circle"?C=t.get("circle-tool"):(b==null?void 0:b.type)==="triangle"&&(C=t.get("triangle-tool"))}if(C)switch(P){case"pointer:down":(re=C.onPointerDown)==null||re.call(C,E);break;case"pointer:move":(H=C.onPointerMove)==null||H.call(C,E);break;case"pointer:up":(X=C.onPointerUp)==null||X.call(C,E);break}}catch(C){console.error(`Error in tool handling ${P} for manipulation:`,C)}}},h=l("pointer:down"),p=l("pointer:move"),m=l("pointer:up");return e.on("pointer:down",h),e.on("pointer:move",p),e.on("pointer:up",m),()=>{e.off("pointer:down",h),e.off("pointer:move",p),e.off("pointer:up",m)}},[a,t,e]);const T={eventBus:e,registerPlugin:R,unregisterPlugin:d,getActivePlugins:x,activeTool:a,setActiveTool:i};return s.jsx(Ge.Provider,{value:T,children:r})}function yt(){const{eventBus:r}=Me();return{handlePointerDown:a=>{r.emit("pointer:down",a)},handlePointerMove:a=>{r.emit("pointer:move",a)},handlePointerUp:a=>{r.emit("pointer:up",a)}}}function _e(r,e,t={}){const[n,a]=y.useState(null),[i,o]=y.useState(new Map),c={enableGestures:!0,touchTargetSize:44,preventScrolling:!0,...t};y.useEffect(()=>{const l=je.detectCapabilities();a(l)},[]);const[g,f]=y.useState({isGesturing:!1,startTime:0,startDistance:0,lastTapTime:0,tapCount:0}),S=y.useCallback(l=>{const h=Array.from(l.values());if(h.length<2)return 0;const p=h[0],m=h[1];if(!p||!m)return 0;const P=p.x-m.x,E=p.y-m.y;return Math.sqrt(P*P+E*E)},[]),j=y.useCallback(l=>{const h=Array.from(l.values());if(h.length===0)return{x:0,y:0};const p=h.reduce((m,P)=>({x:m.x+P.x,y:m.y+P.y}),{x:0,y:0});return{x:p.x/h.length,y:p.y/h.length}},[]),R=y.useCallback(l=>{var E;if(!r.current)return;c.preventScrolling&&l.preventDefault();const h=r.current.getBoundingClientRect(),p=l.clientX-h.left,m=l.clientY-h.top,P=je.normalizePointerEvent(l);P.x=p,P.y=m,o(W=>{const A=new Map(W);if(A.set(l.pointerId,P),c.enableGestures&&A.size>=2){const F=S(A);f(_=>({..._,isGesturing:!0,startTime:l.timeStamp,startDistance:F}))}return A}),r.current.setPointerCapture(l.pointerId),(E=e.onPointerDown)==null||E.call(e,P)},[r,e,c,S]),d=y.useCallback(l=>{var E;if(!r.current)return;const h=r.current.getBoundingClientRect(),p=l.clientX-h.left,m=l.clientY-h.top,P=je.normalizePointerEvent(l);P.x=p,P.y=m,o(W=>{var F,_;const A=new Map(W);if(A.set(l.pointerId,P),c.enableGestures&&A.size>=2){const re=S(A),H=j(A);if(g.isGesturing&&g.startDistance>0){const X=re/g.startDistance;(F=e.onGesture)==null||F.call(e,{type:"pinch",center:H,scale:X,touches:A.size})}}else if(A.size===1&&g.isGesturing){const re=j(A);(_=e.onGesture)==null||_.call(e,{type:"pan",center:re,touches:A.size})}return A}),(E=e.onPointerMove)==null||E.call(e,P)},[e,c,S,j,g]),x=y.useCallback(l=>{var E;if(!r.current)return;const h=r.current.getBoundingClientRect(),p=l.clientX-h.left,m=l.clientY-h.top,P=je.normalizePointerEvent(l);P.x=p,P.y=m,o(W=>{var F;const A=new Map(W);if(A.delete(l.pointerId),c.enableGestures&&A.size===0){const re=l.timeStamp-g.startTime<200,H=l.timeStamp-g.lastTapTime;re&&!g.isGesturing&&(H<300?f(X=>({...X,tapCount:X.tapCount+1})):((F=e.onGesture)==null||F.call(e,{type:"tap",center:{x:P.x,y:P.y},touches:1}),f(X=>({...X,tapCount:1,lastTapTime:l.timeStamp})))),f(X=>({...X,isGesturing:!1}))}return A}),r.current&&r.current.releasePointerCapture(l.pointerId),(E=e.onPointerUp)==null||E.call(e,P)},[r,e,c,g]),T=y.useCallback(l=>{var E;if(!r.current)return;const h=r.current.getBoundingClientRect(),p=l.clientX-h.left,m=l.clientY-h.top,P=je.normalizePointerEvent(l);P.x=p,P.y=m,o(W=>{const A=new Map(W);return A.delete(l.pointerId),A}),f(W=>({...W,isGesturing:!1})),(E=e.onPointerCancel)==null||E.call(e,P)},[e]);return y.useEffect(()=>{const l=r.current;if(!l)return;l.addEventListener("pointerdown",R),l.addEventListener("pointermove",d),l.addEventListener("pointerup",x),l.addEventListener("pointercancel",T);const h=p=>p.preventDefault();return l.addEventListener("contextmenu",h),()=>{l.removeEventListener("pointerdown",R),l.removeEventListener("pointermove",d),l.removeEventListener("pointerup",x),l.removeEventListener("pointercancel",T),l.removeEventListener("contextmenu",h)}},[r,R,d,x,T]),{capabilities:n,activePointers:Array.from(i.values()),isGesturing:g.isGesturing,touchTargetSize:n?je.getTouchTargetSize(n.hasTouch?"touch":"mouse"):c.touchTargetSize}}function Xe(r,e={minSpacing:8,maxSpacing:80,labelMinSpacing:40}){const t=r.zoom;let a=1,i=a*t;for(;i<e.minSpacing&&a<1e4;)a*=qe(a),i=a*t;for(;i>e.maxSpacing&&a>1e-4;)a/=mt(a),i=a*t;let o=a,c=o*t;for(;c<e.labelMinSpacing&&o<a*100;)o*=qe(o),c=o*t;const g=Math.max(.1,Math.min(1,(i-e.minSpacing)/(e.maxSpacing-e.minSpacing)));return{gridSize:a,labelStep:o,shouldShowGrid:i>=e.minSpacing,shouldShowLabels:c>=e.labelMinSpacing,opacity:g}}function qe(r){if(r<1)return r>=.5?2:r>=.2?2.5:(r>=.1,2);if(r<10)return r>=5?2:r>=2?2.5:(r>=1,2);{const e=Math.pow(10,Math.floor(Math.log10(r))),t=r/e;return t>=5?2:t>=2?2.5:(t>=1,2)}}function mt(r){if(r<=1)return r<=.1||r<=.2?2:r<=.5?2.5:(r<=1,2);if(r<=10)return r<=2?2:r<=5?2.5:(r<=10,2);{const e=Math.pow(10,Math.floor(Math.log10(r))),t=r/e;return t<=2?2:t<=5?2.5:(t<=10,2)}}function bt(r,e,t,n,a=!0){const{gridSize:i}=t,o={left:r.center.x-e.width/2/r.zoom,right:r.center.x+e.width/2/r.zoom,top:r.center.y+e.height/2/r.zoom,bottom:r.center.y-e.height/2/r.zoom},c=[],g=[],f=Math.floor(o.left/i)*i,S=Math.ceil(o.right/i)*i;for(let d=f;d<=S;d+=i){const x=n({x:d,y:0}).x,T=Math.abs(d)<i/2,l=Math.abs(d%(i*5))<i/2;c.push({x,isAxis:T,isMajor:l,isInteger:!1,value:d})}if(a&&(i>=2||i<1)){const d=Math.floor(o.left),x=Math.ceil(o.right);for(let T=d;T<=x;T+=1)if(Math.abs(T%i)>.001){const l=n({x:T,y:0}).x,h=Math.abs(T)<.5;c.push({x:l,isAxis:h,isMajor:!1,isInteger:!0,value:T})}}const j=Math.floor(o.bottom/i)*i,R=Math.ceil(o.top/i)*i;for(let d=j;d<=R;d+=i){const x=n({x:0,y:d}).y,T=Math.abs(d)<i/2,l=Math.abs(d%(i*5))<i/2;g.push({y:x,isAxis:T,isMajor:l,isInteger:!1,value:d})}if(a&&(i>=2||i<1)){const d=Math.floor(o.bottom),x=Math.ceil(o.top);for(let T=d;T<=x;T+=1)if(Math.abs(T%i)>.001){const l=n({x:0,y:T}).y,h=Math.abs(T)<.5;g.push({y:l,isAxis:h,isMajor:!1,isInteger:!0,value:T})}}return{verticalLines:c,horizontalLines:g}}function ae(r,e=3){if(Number.isInteger(r))return r.toString();const t=r.toFixed(e);return parseFloat(t).toString()}function Te(r,e,t){const n=t.x-e.x,a=t.y-e.y,i=Math.sqrt(n*n+a*a);if(i===0)return Math.sqrt((r.x-e.x)**2+(r.y-e.y)**2);const o=Math.max(0,Math.min(1,((r.x-e.x)*n+(r.y-e.y)*a)/(i*i))),c={x:e.x+o*n,y:e.y+o*a};return Math.sqrt((r.x-c.x)**2+(r.y-c.y)**2)}function Ue(r,e){const[t,n,a]=e,i=(n.y-a.y)*(t.x-a.x)+(a.x-n.x)*(t.y-a.y),o=((n.y-a.y)*(r.x-a.x)+(a.x-n.x)*(r.y-a.y))/i,c=((a.y-t.y)*(r.x-a.x)+(t.x-a.x)*(r.y-a.y))/i,g=1-o-c;return o>=0&&c>=0&&g>=0}function Ze(r,e,t){const n=Math.sqrt((r.x-e.x)**2+(r.y-e.y)**2);return Math.abs(n-t)}function $(r,e){return e>=1?r.toFixed(0):e>=.1?r.toFixed(1):e>=.01?r.toFixed(2):r.toFixed(3)}function Ee(r,e,t){if(t!=="adaptive")switch(t){case"whole":return 1;case"half":return .5;case"quarter":return .25;case"tenth":return .1;default:return 1}const a=Xe(r,{minSpacing:8,maxSpacing:80,labelMinSpacing:40}).gridSize/e;return a<=.1?a:a<=.5?.1:a<=2?.25:1}const He={showEquivalentFractions:!0,showLengthMultiples:!0,showAreaRectangle:!0,showRiseRunTriangle:!1,showDistanceMarkers:!1,showAngleArc:!1,showDivisionAnswer:!0,showLatticePoints:!1,showIntegerGridLines:!0,showReferenceLineY_equals_X:!0,showFactorPairs:!1,showCommutativeProperty:!1,showDistributiveProperty:!1,showPrimeComposite:!1,showGCF:!0,showLCM:!1,fontScale:1,gridScale:1,snapPrecision:"whole",coordinateSystem:"cartesian",showPolarGrid:!1,customOrigin:null},fe=Oe(r=>({...He,toggleSetting:e=>{r(t=>({[e]:!t[e]}))},setFontScale:e=>{r({fontScale:e})},setGridScale:e=>{r({gridScale:e})},setSnapPrecision:e=>{r({snapPrecision:e})},setCoordinateSystem:e=>{r({coordinateSystem:e})},setCustomOrigin:e=>{r({customOrigin:e})},resetToDefaults:()=>{r(He)}}));function vt({viewport:r,canvasSize:e,worldToScreen:t,objects:n=[]}){const a=fe(),i=l=>Math.round(l*a.fontScale),o=Xe(r,{minSpacing:8,maxSpacing:80,labelMinSpacing:40}),c={gridSize:o.gridSize/a.gridScale,labelStep:o.labelStep/a.gridScale},{verticalLines:g,horizontalLines:f}=bt(r,e,c,t,a.showIntegerGridLines);if(!o.shouldShowGrid)return null;const S=[];if(a.coordinateSystem==="polar"||a.coordinateSystem==="both"){const l=t({x:0,y:0}),h=Math.max(Math.abs(r.center.x)+e.width/(2*r.zoom),Math.abs(r.center.y)+e.height/(2*r.zoom));for(let p=c.gridSize;p<=h;p+=c.gridSize){const m=p*r.zoom;m>=10&&S.push(s.jsx("circle",{cx:l.x,cy:l.y,r:m,fill:"none",stroke:"#9CA3AF",strokeWidth:"0.5",opacity:.4},`polar-circle-${p}`))}for(let p=0;p<360;p+=30){const m=p*Math.PI/180,P=l.x+h*r.zoom*Math.cos(m),E=l.y-h*r.zoom*Math.sin(m);S.push(s.jsx("line",{x1:l.x,y1:l.y,x2:P,y2:E,stroke:"#9CA3AF",strokeWidth:"0.5",opacity:.3},`polar-line-${p}`))}}const j=[];n.forEach(l=>{if(l.type==="ray"){const{startPoint:h,endPoint:p}=l.properties;if(Math.abs(h.x)<.001&&Math.abs(h.y)<.001){const m=p.x-h.x,P=p.y-h.y;if(Math.abs(m)>.001){const E=1/m;if(E>0&&E<=1){const W=h.y+E*P,A=t({x:1,y:W});j.push({y:W,screenY:A.y})}}}}});const R=g.map(l=>{const h=Math.abs(l.value-1)<.001,p=l.isAxis?"#374151":h?"#60A5FA":l.isInteger?"#E5E7EB":l.isMajor?"#9CA3AF":"#E5E7EB",m=l.isAxis?2:h?1.5:l.isInteger?Math.max(1,r.zoom*.05):l.isMajor?1:.5,P=l.isAxis?1:h?.8:l.isInteger?.4:l.isMajor?.6*o.opacity:.3*o.opacity;return s.jsx("line",{x1:l.x,y1:0,x2:l.x,y2:e.height,stroke:p,strokeWidth:m,opacity:P},`v${l.value}`)}),d=f.map(l=>s.jsx("line",{x1:0,y1:l.y,x2:e.width,y2:l.y,stroke:l.isAxis?"#374151":l.isInteger?"#E5E7EB":l.isMajor?"#9CA3AF":"#E5E7EB",strokeWidth:l.isAxis?2:l.isInteger?Math.max(1,r.zoom*.05):l.isMajor?1:.5,opacity:l.isAxis?1:l.isInteger?.4:l.isMajor?.6*o.opacity:.3*o.opacity},`h${l.value}`)),x=a.showReferenceLineY_equals_X?(()=>{const l={left:r.center.x-e.width/2/r.zoom,right:r.center.x+e.width/2/r.zoom,top:r.center.y+e.height/2/r.zoom,bottom:r.center.y-e.height/2/r.zoom},h=Math.min(l.left,l.bottom),p=Math.max(l.right,l.top),m=t({x:h,y:h}),P=t({x:p,y:p});return{lineStart:m,lineEnd:P}})():null,T=a.showLatticePoints?(()=>{const l={left:r.center.x-e.width/2/r.zoom,right:r.center.x+e.width/2/r.zoom,top:r.center.y+e.height/2/r.zoom,bottom:r.center.y-e.height/2/r.zoom},h=[],p=Math.max(-20,Math.floor(l.left)),m=Math.min(20,Math.ceil(l.right)),P=Math.max(-20,Math.floor(l.bottom)),E=Math.min(20,Math.ceil(l.top)),W=(m-p+1)*(E-P+1);if(W>200){const A=Math.ceil(Math.sqrt(W/200));for(let F=p;F<=m;F+=A)for(let _=P;_<=E;_+=A){const re=t({x:F,y:_});re.x>=-20&&re.x<=e.width+20&&re.y>=-20&&re.y<=e.height+20&&h.push(re)}}else for(let A=p;A<=m;A++)for(let F=P;F<=E;F++){const _=t({x:A,y:F});_.x>=-20&&_.x<=e.width+20&&_.y>=-20&&_.y<=e.height+20&&h.push(_)}return h})():[];return s.jsxs("g",{className:"grid",children:[(a.coordinateSystem==="polar"||a.coordinateSystem==="both")&&s.jsx("g",{className:"polar-grid",children:S}),(a.coordinateSystem==="cartesian"||a.coordinateSystem==="both")&&s.jsxs("g",{className:"cartesian-grid",children:[R,d]}),T.map((l,h)=>s.jsx("circle",{cx:l.x,cy:l.y,r:"1.5",fill:"#9CA3AF",opacity:"0.3"},`lattice-${h}`)),x&&s.jsx("line",{x1:x.lineStart.x,y1:x.lineStart.y,x2:x.lineEnd.x,y2:x.lineEnd.y,stroke:"#A78BFA",strokeWidth:"1.5",opacity:"0.6",strokeDasharray:"5,5"}),o.shouldShowLabels&&s.jsxs("g",{className:"labels",fontSize:"12",fill:"#374151",children:[g.filter(l=>{const h=Math.abs(l.value%c.labelStep)<c.gridSize/10,p=Math.abs(l.value)>=c.labelStep/2;return h&&p}).filter((l,h,p)=>!p.slice(0,h).some(m=>Math.abs(m.value-l.value)<.001)).map(l=>s.jsx("text",{x:l.x,y:t({x:0,y:0}).y+20,textAnchor:"middle",fontSize:i(11),fontWeight:"500",opacity:Math.max(.7,o.opacity),children:$(l.value,o.gridSize)},`xlabel${l.value}`)),f.filter(l=>{const h=Math.abs(l.value%c.labelStep)<c.gridSize/10,p=Math.abs(l.value)>=c.labelStep/2;return h&&p}).filter((l,h,p)=>!p.slice(0,h).some(m=>Math.abs(m.value-l.value)<.001)).map(l=>s.jsx("text",{x:t({x:0,y:0}).x-15,y:l.y+4,textAnchor:"middle",fontSize:i(11),fontWeight:"500",opacity:Math.max(.7,o.opacity),children:$(l.value,o.gridSize)},`ylabel${l.value}`)),s.jsxs("g",{children:[s.jsx("circle",{cx:t({x:0,y:0}).x,cy:t({x:0,y:0}).y,r:"3",fill:"#374151",opacity:"0.6"}),s.jsx("text",{x:t({x:0,y:0}).x-25,y:t({x:0,y:0}).y-10,fontSize:i(11),fontWeight:"600",fill:"#374151",opacity:Math.max(.8,o.opacity),children:"(0,0)"})]}),a.showDivisionAnswer&&j.map((l,h)=>{const p=t({x:1,y:0}).x;return s.jsxs("g",{children:[s.jsx("circle",{cx:p,cy:l.screenY,r:"4",fill:"white",stroke:"#60A5FA",strokeWidth:"2",opacity:"0.9"}),s.jsxs("text",{x:p+15,y:l.screenY+4,fontSize:i(10),fontWeight:"600",fill:"#60A5FA",opacity:"0.9",children:["y = ",l.y.toFixed(2)]})]},`ray-intersection-${h}`)})]})]})}function jt({viewport:r,onZoomIn:e,onZoomOut:t,onZoomReset:n,onCenterOnly:a}){const[i,o]=y.useState(0),c=y.useRef(null),g=()=>{const f=Date.now();f-i<500?(c.current&&(clearTimeout(c.current),c.current=null),n()):c.current=window.setTimeout(()=>{a(),c.current=null},300),o(f)};return s.jsxs("div",{className:"absolute bottom-4 right-4 flex flex-col gap-2",children:[s.jsx("button",{onClick:e,className:"w-10 h-10 bg-white/90 hover:bg-white border border-gray-300 rounded-lg shadow-md flex items-center justify-center text-gray-700 font-bold transition-colors",title:"Zoom in (Ctrl+scroll up)",disabled:r.zoom>=1e3,children:"+"}),s.jsx("button",{onClick:t,className:"w-10 h-10 bg-white/90 hover:bg-white border border-gray-300 rounded-lg shadow-md flex items-center justify-center text-gray-700 font-bold transition-colors",title:"Zoom out (Ctrl+scroll down)",disabled:r.zoom<=.01,children:"−"}),s.jsx("button",{onClick:g,className:"w-10 h-10 bg-white/90 hover:bg-white border border-gray-300 rounded-lg shadow-md flex items-center justify-center text-gray-600 text-xs transition-colors",title:"Center view (single click) or Reset zoom (double click)",children:"⌂"}),s.jsxs("div",{className:"w-10 h-6 bg-white/90 border border-gray-300 rounded text-xs flex items-center justify-center text-gray-600",children:[r.zoom>=1?Math.round(r.zoom):r.zoom.toFixed(1),"×"]})]})}function wt({objects:r,viewport:e,touchTargetSize:t,worldToScreen:n,selectedObjects:a=[],canvasSize:i}){const o=fe(),c=d=>Math.round(d*o.fontScale),g=Ee(e,o.gridScale,o.snapPrecision),f=g,[S,j]=y.useState(null),R=d=>{const x=a.includes(d.id);switch(d.type){case"ray":const T=n(d.properties.startPoint),l=n(d.properties.endPoint);return s.jsxs("g",{children:[x&&s.jsx("line",{x1:T.x,y1:T.y,x2:l.x,y2:l.y,stroke:"#60A5FA",strokeWidth:6,opacity:.4}),s.jsx("line",{x1:T.x,y1:T.y,x2:l.x,y2:l.y,stroke:x?"#1D4ED8":"#2563eb",strokeWidth:x?3:2}),s.jsx("circle",{cx:T.x,cy:T.y,r:t/4,fill:x?"#1D4ED8":"#2563eb",stroke:x?"#60A5FA":"none",strokeWidth:x?2:0,style:{cursor:"move"},onMouseEnter:()=>j(`${d.id}-start`),onMouseLeave:()=>j(null)}),s.jsx("circle",{cx:l.x,cy:l.y,r:t/4,fill:x?"#1D4ED8":"#2563eb",stroke:x?"#60A5FA":"none",strokeWidth:x?2:0,style:{cursor:"move"},onMouseEnter:()=>j(`${d.id}-end`),onMouseLeave:()=>j(null)}),!(Math.abs(d.properties.startPoint.x)<.001&&Math.abs(d.properties.startPoint.y)<.001)&&S===`${d.id}-start`&&s.jsxs("text",{x:T.x-5,y:T.y-10,fontSize:c(10),fontWeight:"500",fill:x?"#1D4ED8":"#2563eb",textAnchor:"middle",opacity:"0.8",children:["(",$(d.properties.startPoint.x,f),", ",$(d.properties.startPoint.y,f),")"]}),S===`${d.id}-end`&&s.jsxs("text",{x:Math.abs(d.properties.startPoint.x)<.001&&Math.abs(d.properties.startPoint.y)<.001?l.x-60:l.x+5,y:Math.abs(d.properties.startPoint.x)<.001&&Math.abs(d.properties.startPoint.y)<.001?l.y+4:l.y-10,fontSize:c(10),fontWeight:"500",fill:x?"#1D4ED8":"#2563eb",textAnchor:Math.abs(d.properties.startPoint.x)<.001&&Math.abs(d.properties.startPoint.y)<.001?"end":"middle",opacity:"0.8",children:["(",$(d.properties.endPoint.x,f),", ",$(d.properties.endPoint.y,f),")"]}),(()=>{const C=d.properties.endPoint.x-d.properties.startPoint.x;d.properties.endPoint.y-d.properties.startPoint.y;const b=Math.abs(d.properties.startPoint.x)<.001&&Math.abs(d.properties.startPoint.y)<.001;if(Math.abs(C)>.001){const N=l.x,ie=l.y;if(b){const D=d.properties.endPoint.x,B=d.properties.endPoint.y,u=$(B,f),w=$(D,f);return s.jsxs("g",{children:[s.jsx("text",{x:N+15,y:ie-25,fontSize:c(9),fontWeight:"500",fill:x?"#1D4ED8":"#2563eb",textAnchor:"middle",opacity:"0.8",children:u}),s.jsx("line",{x1:N+8,y1:ie-19,x2:N+22,y2:ie-19,stroke:x?"#1D4ED8":"#2563eb",strokeWidth:"1",opacity:"0.8"}),s.jsx("text",{x:N+15,y:ie-9,fontSize:c(9),fontWeight:"500",fill:x?"#1D4ED8":"#2563eb",textAnchor:"middle",opacity:"0.8",children:w})]})}else return null}return null})(),(()=>{if(!(Math.abs(d.properties.startPoint.x)<.001&&Math.abs(d.properties.startPoint.y)<.001))return null;const b=d.properties.endPoint.x,N=d.properties.endPoint.y;if(Math.abs(b)<.001&&Math.abs(N)<.001)return null;const ie=b,D=N,B={left:e.center.x-i.width/2/e.zoom,right:e.center.x+i.width/2/e.zoom,top:e.center.y+i.height/2/e.zoom,bottom:e.center.y-i.height/2/e.zoom},u=Math.max(Math.abs(B.left),Math.abs(B.right),Math.abs(B.top),Math.abs(B.bottom))*2,w=Math.sqrt(ie*ie+D*D);if(w===0)return null;const z=ie/w,q=D/w,ne={x:u*z,y:u*q},te=n(ne),xe=[];if(Math.abs(b)>.001&&Math.abs(N)>.001){const M=b,L=N;for(let G=2;G<=8;G++){const Q=M*G,le=L*G,oe=Math.round(Q/g)*g,v=Math.round(le/g)*g;if(Math.abs(Q-oe)<g/10&&Math.abs(le-v)<g/10&&oe>0&&v>0&&oe<=Math.min(20,Math.abs(u))&&v<=Math.min(20,Math.abs(u))){const Y=n({x:oe,y:v});Y.x>=-100&&Y.x<=i.width+100&&Y.y>=-100&&Y.y<=i.height+100&&xe.push({world:{x:oe,y:v},screen:Y,fraction:{num:$(v,g),den:$(oe,g)}})}}}const ue=Math.sqrt(b*b+N*N),V=[];if(ue>0&&o.showLengthMultiples)for(let M=2;M<=5;M++){const L=b*M,G=N*M,Q=n({x:L,y:G});Q.x>=-50&&Q.x<=i.width+50&&Q.y>=-50&&Q.y<=i.height+50&&V.push({screen:Q,multiple:M})}return s.jsxs("g",{children:[o.showEquivalentFractions&&s.jsx("line",{x1:l.x,y1:l.y,x2:te.x,y2:te.y,stroke:x?"#1D4ED8":"#2563eb",strokeWidth:"1",opacity:"0.3",strokeDasharray:"3,3"}),V.map((M,L)=>s.jsxs("g",{children:[s.jsx("circle",{cx:M.screen.x,cy:M.screen.y,r:"2",fill:x?"#1D4ED8":"#2563eb",opacity:"0.4"}),s.jsxs("text",{x:M.screen.x+8,y:M.screen.y-8,fontSize:c(7),fontWeight:"400",fill:x?"#1D4ED8":"#2563eb",textAnchor:"start",opacity:"0.5",children:["×",M.multiple]})]},`length-${L}`)),o.showAreaRectangle&&(()=>{if(b>0&&N>0){const M=n({x:0,y:0}),L=n({x:b,y:N}),G=Math.abs(L.x-M.x),Q=Math.abs(L.y-M.y),le=Math.min(M.x,L.x),oe=Math.min(M.y,L.y),v=b*N;return s.jsxs("g",{children:[s.jsx("rect",{x:le,y:oe,width:G,height:Q,fill:x?"#1D4ED8":"#2563eb",opacity:"0.08",stroke:x?"#1D4ED8":"#2563eb",strokeWidth:"0.5",strokeOpacity:"0.15"}),s.jsxs("text",{x:le+G/2,y:oe+15,fontSize:c(10),fontWeight:"400",fill:x?"#1D4ED8":"#2563eb",textAnchor:"middle",opacity:"0.6",children:[$(N,f)," × ",$(b,f)," = ",$(v,f)]}),(()=>{if(!(Math.abs(d.properties.startPoint.x)<.001&&Math.abs(d.properties.startPoint.y)<.001)||b<=0)return null;const O=N/b,k=n({x:1,y:0}),I=[];for(let U=1;U*O<=N;U++){const Z=U*O,ce=n({x:0,y:Z}).y,K=Math.abs(Z-O)<.01;I.push(s.jsxs("g",{children:[s.jsx("line",{x1:M.x,y1:ce,x2:k.x,y2:ce,stroke:x?"#1D4ED8":"#2563eb",strokeWidth:"1",opacity:K?"0":"0.3",strokeDasharray:"2,2"}),!K&&s.jsx("text",{x:k.x+8,y:ce-5,fontSize:c(8),fontWeight:"400",fill:x?"#1D4ED8":"#2563eb",textAnchor:"start",opacity:"0.5",children:ae(Z)})]},`division-marker-${U}`))}return I})()]})}return null})(),o.showRiseRunTriangle&&(()=>{if(b>0&&N>0){const M=n({x:0,y:0}),L=n({x:b,y:0}),G=n({x:b,y:N});return s.jsxs("g",{children:[s.jsx("path",{d:`M ${M.x},${M.y} L ${L.x},${L.y} L ${G.x},${G.y} Z`,fill:"none",stroke:x?"#1D4ED8":"#2563eb",strokeWidth:"1",opacity:"0.4",strokeDasharray:"2,2"}),s.jsxs("text",{x:L.x+12,y:(L.y+G.y)/2,fontSize:c(9),fontWeight:"500",fill:x?"#1D4ED8":"#2563eb",textAnchor:"start",opacity:"0.7",children:["rise: ",$(N,f)]}),s.jsxs("text",{x:(M.x+L.x)/2,y:L.y+8,fontSize:c(9),fontWeight:"500",fill:x?"#1D4ED8":"#2563eb",textAnchor:"middle",opacity:"0.7",children:["run: ",$(b,f)]})]})}return null})(),o.showDistanceMarkers&&(()=>{const M=[],L=Math.sqrt(b*b+N*N);if(L>0){const G=n({x:0,y:0});let Q=Math.atan2(N,b);Q<0&&(Q=Q+2*Math.PI);const le=[];for(let v=1;v<=Math.floor(L);v++)le.push({radius:v,isUnit:!0});le.push({radius:L,isUnit:!1}),le.forEach(({radius:v,isUnit:Y},O)=>{const k=v*e.zoom;if(k>=15&&k<=800&&Math.abs(Q)>.05){const I=Q>Math.PI?1:0,Z=`M ${G.x+k},${G.y} A ${k},${k} 0 ${I},0 ${G.x+k*Math.cos(Q)},${G.y-k*Math.sin(Q)}`;M.push(s.jsx("path",{d:Z,fill:"none",stroke:x?"#1D4ED8":"#2563eb",strokeWidth:Y?"1":"1.5",opacity:Y?"0.3":"0.6",strokeDasharray:Y?"2,2":"none"},`radial-${d.id}-${v.toFixed(3)}-${Q.toFixed(3)}-${O}`))}});const oe=n({x:L,y:0});M.push(s.jsxs("g",{children:[s.jsx("path",{d:`M ${oe.x},${G.y} L ${oe.x-4},${G.y+8} L ${oe.x+4},${G.y+8} Z`,fill:x?"#1D4ED8":"#2563eb",opacity:"0.7"}),s.jsxs("text",{x:oe.x+15,y:G.y-8,fontSize:c(10),fontWeight:"600",fill:x?"#1D4ED8":"#2563eb",textAnchor:"start",opacity:"0.8",children:["d = ",L.toFixed(2)]})]},`distance-${d.id}`))}return s.jsx("g",{children:M})})(),o.showAngleArc&&(()=>{let M=Math.atan2(N,b);if(M<0&&(M=M+2*Math.PI),Math.abs(b)>.05||Math.abs(N)>.05){const L=n({x:0,y:0}),G=50,Q=(M*180/Math.PI).toFixed(1),le=M,oe=M>Math.PI?1:0,v=`M ${L.x+G},${L.y} A ${G},${G} 0 ${oe},0 ${L.x+G*Math.cos(le)},${L.y-G*Math.sin(le)}`,Y=M/2,O=G*.7,k=L.x+O*Math.cos(Y),I=L.y-O*Math.sin(Y);return s.jsxs("g",{children:[s.jsx("path",{d:v,fill:"none",stroke:x?"#1D4ED8":"#2563eb",strokeWidth:"2",opacity:"0.6"}),s.jsxs("text",{x:k,y:I,fontSize:c(11),fontWeight:"600",fill:x?"#1D4ED8":"#2563eb",textAnchor:"middle",opacity:"0.8",children:["θ = ",Q,"°"]})]})}return null})(),o.showEquivalentFractions&&xe.map((M,L)=>{const Q=Math.abs(M.world.x-1)<.1&&o.showDivisionAnswer,le=Math.abs(M.world.x-b)<.1&&Math.abs(M.world.y-N)<.1;return Q||le?null:s.jsxs("g",{children:[s.jsx("circle",{cx:M.screen.x,cy:M.screen.y,r:"4",fill:"white",stroke:"#22C55E",strokeWidth:"2",opacity:"0.8"}),s.jsxs("text",{x:M.screen.x+15,y:M.screen.y+4,fontSize:c(9),fontWeight:"500",fill:"#22C55E",textAnchor:"start",opacity:"0.8",children:[M.fraction.num,"/",M.fraction.den]})]},`equiv-${L}`)})]})})()]},d.id);case"rectangle":const h=n({x:d.properties.x,y:d.properties.y+d.properties.height}),p=d.properties.width*e.zoom,m=d.properties.height*e.zoom,P={x:d.properties.x,y:d.properties.y},E={x:d.properties.x+d.properties.width,y:d.properties.y},W={x:d.properties.x,y:d.properties.y+d.properties.height},A={x:d.properties.x+d.properties.width,y:d.properties.y+d.properties.height};return s.jsxs("g",{children:[x&&s.jsx("rect",{x:h.x-3,y:h.y-3,width:p+6,height:m+6,fill:"none",stroke:"#60A5FA",strokeWidth:4,opacity:.5,style:{cursor:"pointer"}}),s.jsx("rect",{x:h.x,y:h.y,width:p,height:m,fill:x?"rgba(34, 197, 94, 0.3)":"rgba(34, 197, 94, 0.2)",stroke:x?"#16A34A":"#22c55e",strokeWidth:x?3:2,style:{cursor:"pointer"}}),s.jsx("circle",{cx:h.x,cy:h.y,r:t/6,fill:x?"#16A34A":"#22c55e",stroke:x?"#60A5FA":"none",strokeWidth:x?2:0,style:{cursor:"nw-resize"}}),s.jsx("circle",{cx:h.x+p,cy:h.y,r:t/6,fill:x?"#16A34A":"#22c55e",stroke:x?"#60A5FA":"none",strokeWidth:x?2:0,style:{cursor:"ne-resize"}}),s.jsx("circle",{cx:h.x,cy:h.y+m,r:t/6,fill:x?"#16A34A":"#22c55e",stroke:x?"#60A5FA":"none",strokeWidth:x?2:0,style:{cursor:"sw-resize"}}),s.jsx("circle",{cx:h.x+p,cy:h.y+m,r:t/6,fill:x?"#16A34A":"#22c55e",stroke:x?"#60A5FA":"none",strokeWidth:x?2:0,style:{cursor:"se-resize"}}),s.jsxs("text",{x:h.x-10,y:h.y-5,fontSize:c(9),fontWeight:"500",fill:"#22c55e",textAnchor:"end",opacity:"0.8",children:["(",$(W.x,f),", ",$(W.y,f),")"]}),s.jsxs("text",{x:h.x+p+10,y:h.y-5,fontSize:c(9),fontWeight:"500",fill:"#22c55e",textAnchor:"start",opacity:"0.8",children:["(",$(A.x,f),", ",$(A.y,f),")"]}),s.jsxs("text",{x:h.x-10,y:h.y+m+15,fontSize:c(9),fontWeight:"500",fill:"#22c55e",textAnchor:"end",opacity:"0.8",children:["(",$(P.x,f),", ",$(P.y,f),")"]}),s.jsxs("text",{x:h.x+p+10,y:h.y+m+15,fontSize:c(9),fontWeight:"500",fill:"#22c55e",textAnchor:"start",opacity:"0.8",children:["(",$(E.x,f),", ",$(E.y,f),")"]}),s.jsxs("text",{x:h.x+p/2,y:h.y+m/2,fontSize:c(12),fontWeight:"600",fill:"#22c55e",textAnchor:"middle",opacity:"0.9",children:[$(d.properties.height,f)," × ",$(d.properties.width,f)," = ",$(d.properties.area,f)]}),(()=>{const C=d.properties.width,b=d.properties.height,N=d.properties.area;if(C<=0||b<=0||C!==Math.floor(C)||b!==Math.floor(b))return null;const ie=[];if(o.showFactorPairs&&N>1&&N<=50){const D=[];for(let B=1;B<=Math.sqrt(N);B++)if(N%B===0){const u=N/B;(B!==C||u!==b)&&D.push({w:B,h:u})}D.forEach((B,u)=>{const w=(u+1)*(p+20),z={x:h.x+w,y:h.y,width:B.w*e.zoom,height:B.h*e.zoom};ie.push(s.jsx("rect",{x:z.x,y:z.y,width:z.width,height:z.height,fill:"rgba(168, 85, 247, 0.15)",stroke:"#A855F7",strokeWidth:"1",strokeDasharray:"3,3",opacity:"0.7"},`factor-${u}`))})}if(o.showCommutativeProperty&&C!==b){const D={x:h.x-m-30,y:h.y,width:b*e.zoom,height:C*e.zoom};ie.push(s.jsxs("g",{children:[s.jsx("rect",{x:D.x,y:D.y,width:D.width,height:D.height,fill:"rgba(59, 130, 246, 0.15)",stroke:"#3B82F6",strokeWidth:"1",strokeDasharray:"4,2",opacity:"0.7"}),s.jsx("path",{d:`M ${D.x+D.width+5},${D.y+D.height/2} L ${h.x-5},${h.y+m/2}`,stroke:"#3B82F6",strokeWidth:"1",fill:"none",markerEnd:"url(#arrowhead)",opacity:"0.6"})]},"commutative"))}if(o.showPrimeComposite&&N>1&&N<=100){const D=N>1&&![...Array(Math.floor(Math.sqrt(N))+1).keys()].slice(2).some(B=>N%B===0);ie.push(s.jsxs("g",{children:[s.jsx("circle",{cx:h.x+p+15,cy:h.y-15,r:"8",fill:D?"#10B981":"#F59E0B",opacity:"0.8"}),s.jsx("text",{x:h.x+p+15,y:h.y-11,fontSize:c(8),fontWeight:"600",fill:"white",textAnchor:"middle",children:D?"P":"C"}),s.jsx("text",{x:h.x+p+30,y:h.y-10,fontSize:c(8),fontWeight:"500",fill:D?"#10B981":"#F59E0B",textAnchor:"start",opacity:"0.8",children:D?"Prime":"Composite"})]},"prime-composite"))}if(o.showGCF&&C>1&&b>1){const D=(u,w)=>w===0?u:D(w,u%w),B=D(C,b);if(B>1){const u=B*e.zoom,w=C/B,z=b/B,q=[];for(let ne=0;ne<w;ne++)for(let te=0;te<z;te++)q.push(s.jsx("rect",{x:h.x+ne*u,y:h.y+te*u,width:u,height:u,fill:"none",stroke:"#10B981",strokeWidth:"1.5",opacity:"0.6"},`gcf-${ne}-${te}`));ie.push(s.jsxs("g",{children:[q,s.jsxs("text",{x:h.x+p/2,y:h.y-25,fontSize:c(10),fontWeight:"600",fill:"#10B981",textAnchor:"middle",opacity:"0.9",children:["GCF(",C,", ",b,") = ",B]}),s.jsxs("text",{x:h.x+p/2,y:h.y-10,fontSize:c(8),fontWeight:"500",fill:"#10B981",textAnchor:"middle",opacity:"0.7",children:[w," × ",z," = ",w*z," squares"]})]},"gcf"))}}if(o.showLCM&&C>1&&b>1){const D=(w,z)=>z===0?w:D(z,w%z),u=((w,z)=>w*z/D(w,z))(C,b);if(u>Math.max(C,b)&&u<=100){const w=u*e.zoom,z=u*e.zoom,q=h.x,ne=h.y+m-z,te=u/C,xe=u/b,ue=[];for(let V=0;V<xe;V++)for(let M=0;M<te;M++){const L=q+M*(C*e.zoom),G=ne+V*(b*e.zoom);ue.push(s.jsx("rect",{x:L,y:G,width:C*e.zoom,height:b*e.zoom,fill:"rgba(245, 158, 11, 0.1)",stroke:"#F59E0B",strokeWidth:"1",strokeDasharray:"2,2",opacity:"0.6",pointerEvents:"none"},`shadow-${V}-${M}`))}ie.push(s.jsxs("g",{children:[s.jsx("rect",{x:q,y:ne,width:w,height:z,fill:"none",stroke:"#F59E0B",strokeWidth:"2",strokeDasharray:"5,5",opacity:"0.8",pointerEvents:"none"}),ue,s.jsxs("text",{x:q+w/2,y:ne-15,fontSize:c(10),fontWeight:"600",fill:"#F59E0B",textAnchor:"middle",opacity:"0.9",pointerEvents:"none",children:["LCM(",C,", ",b,") = ",u]}),s.jsxs("text",{x:q+w/2,y:ne-2,fontSize:c(8),fontWeight:"500",fill:"#F59E0B",textAnchor:"middle",opacity:"0.7",pointerEvents:"none",children:[te," × ",xe," = ",te*xe," rectangles"]})]},"lcm"))}}if(o.showDistributiveProperty&&C>2&&b>1){const D=Math.floor(C/2),B=D*e.zoom,u=(C-D)*e.zoom;ie.push(s.jsxs("g",{children:[s.jsx("line",{x1:h.x+B,y1:h.y,x2:h.x+B,y2:h.y+m,stroke:"#EF4444",strokeWidth:"2",opacity:"0.8"}),s.jsxs("text",{x:h.x+B/2,y:h.y+m+20,fontSize:c(9),fontWeight:"500",fill:"#EF4444",textAnchor:"middle",opacity:"0.8",children:[b," × ",D," = ",b*D]}),s.jsxs("text",{x:h.x+B+u/2,y:h.y+m+20,fontSize:c(9),fontWeight:"500",fill:"#EF4444",textAnchor:"middle",opacity:"0.8",children:[b," × ",C-D," = ",b*(C-D)]}),s.jsxs("text",{x:h.x+p/2,y:h.y+m+40,fontSize:c(10),fontWeight:"600",fill:"#EF4444",textAnchor:"middle",opacity:"0.9",children:[b," × (",D," + ",C-D,") = ",b*D," + ",b*(C-D)," = ",N]})]},"distributive"))}return ie})()]},d.id);case"circle":const F=n(d.properties.center),_=d.properties.radius*e.zoom;return s.jsxs("g",{children:[x&&s.jsx("circle",{cx:F.x,cy:F.y,r:_+3,fill:"none",stroke:"#60A5FA",strokeWidth:4,opacity:.5}),s.jsx("circle",{cx:F.x,cy:F.y,r:_,fill:x?"rgba(168, 85, 247, 0.15)":"rgba(168, 85, 247, 0.1)",stroke:x?"#7C3AED":"#A855F7",strokeWidth:x?3:2,style:{cursor:"pointer"}}),s.jsx("circle",{cx:F.x,cy:F.y,r:t/6,fill:x?"#7C3AED":"#A855F7",stroke:x?"#60A5FA":"none",strokeWidth:x?2:0,style:{cursor:"move"}}),s.jsx("circle",{cx:F.x+_,cy:F.y,r:t/6,fill:x?"#7C3AED":"#A855F7",stroke:x?"#60A5FA":"none",strokeWidth:x?2:0,style:{cursor:"ew-resize"}}),s.jsx("line",{x1:F.x,y1:F.y,x2:F.x+_,y2:F.y,stroke:x?"#7C3AED":"#A855F7",strokeWidth:"1",opacity:"0.6",strokeDasharray:"2,2"}),s.jsxs("text",{x:F.x,y:F.y-_-25,fontSize:c(10),fontWeight:"500",fill:x?"#7C3AED":"#A855F7",textAnchor:"middle",opacity:"0.8",children:["r = ",ae(d.properties.radius)]}),s.jsxs("text",{x:F.x,y:F.y-_-15,fontSize:c(9),fontWeight:"400",fill:x?"#7C3AED":"#A855F7",textAnchor:"middle",opacity:"0.7",children:["A = ",ae(d.properties.area)]}),s.jsxs("text",{x:F.x,y:F.y-_-5,fontSize:c(9),fontWeight:"400",fill:x?"#7C3AED":"#A855F7",textAnchor:"middle",opacity:"0.7",children:["C = ",ae(d.properties.circumference)]})]},d.id);case"triangle":const re=d.properties.vertices.map(n),[H,X,J]=re;return s.jsxs("g",{children:[x&&s.jsx("path",{d:`M ${H.x},${H.y} L ${X.x},${X.y} L ${J.x},${J.y} Z`,fill:"none",stroke:"#60A5FA",strokeWidth:6,opacity:.4}),s.jsx("path",{d:`M ${H.x},${H.y} L ${X.x},${X.y} L ${J.x},${J.y} Z`,fill:x?"rgba(245, 101, 101, 0.15)":"rgba(245, 101, 101, 0.1)",stroke:x?"#DC2626":"#F56565",strokeWidth:x?3:2,style:{cursor:"pointer"}}),re.map((C,b)=>s.jsx("circle",{cx:C.x,cy:C.y,r:t/6,fill:x?"#DC2626":"#F56565",stroke:x?"#60A5FA":"none",strokeWidth:x?2:0,style:{cursor:"move"}},`vertex-${b}`)),s.jsxs("text",{x:(H.x+X.x+J.x)/3,y:(H.y+X.y+J.y)/3,fontSize:c(10),fontWeight:"500",fill:x?"#DC2626":"#F56565",textAnchor:"middle",opacity:"0.8",children:["A = ",ae(d.properties.area)]}),s.jsx("text",{x:(H.x+X.x)/2,y:(H.y+X.y)/2-10,fontSize:c(8),fontWeight:"400",fill:x?"#DC2626":"#F56565",textAnchor:"middle",opacity:"0.6",children:ae(d.properties.sideC)}),s.jsx("text",{x:(X.x+J.x)/2+10,y:(X.y+J.y)/2,fontSize:c(8),fontWeight:"400",fill:x?"#DC2626":"#F56565",textAnchor:"middle",opacity:"0.6",children:ae(d.properties.sideA)}),s.jsx("text",{x:(H.x+J.x)/2-10,y:(H.y+J.y)/2,fontSize:c(8),fontWeight:"400",fill:x?"#DC2626":"#F56565",textAnchor:"middle",opacity:"0.6",children:ae(d.properties.sideB)})]},d.id);default:return null}};return s.jsxs(s.Fragment,{children:[s.jsx("defs",{children:s.jsx("marker",{id:"arrowhead",markerWidth:"10",markerHeight:"7",refX:"9",refY:"3.5",orient:"auto",children:s.jsx("polygon",{points:"0 0, 10 3.5, 0 7",fill:"#3B82F6",opacity:"0.6"})})}),s.jsx("g",{className:"objects",children:r.map(R)})]})}function Ct({capabilities:r,viewport:e,activeTool:t,selectedObjectsCount:n}){return r?s.jsxs("div",{className:"absolute top-2 left-2 text-xs text-gray-500 bg-white/80 p-2 rounded shadow-sm",children:[s.jsxs("div",{children:["Input: ",r.hasTouch?"👆":"🖱️"," ",r.hasPencil?"✏️":""]}),s.jsxs("div",{children:["Zoom: ",e.zoom>=1?e.zoom.toFixed(1):e.zoom.toFixed(2),"×"]}),s.jsxs("div",{children:["Center: (",e.center.x.toFixed(1),", ",e.center.y.toFixed(1),")"]}),s.jsxs("div",{children:["Tool: ",t||"Pan Mode"]}),n>0&&s.jsxs("div",{children:["Selected: ",n," object",n!==1?"s":""]})]}):null}function St({selectedObject:r,onDelete:e,onClose:t}){if(!r)return null;const n=()=>{e(),t()},a=()=>{switch(r.type){case"ray":const{startPoint:i,endPoint:o,slope:c}=r.properties,g=Math.abs(i.x)<.001&&Math.abs(i.y)<.001;return s.jsxs("div",{className:"space-y-2",children:[s.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Line Details"}),s.jsxs("div",{className:"space-y-1 text-xs text-gray-600",children:[s.jsxs("div",{children:["Start: (",$(i.x,1),", ",$(i.y,1),")"]}),s.jsxs("div",{children:["End: (",$(o.x,1),", ",$(o.y,1),")"]}),g&&s.jsxs("div",{children:["Fraction: ",Math.round(o.y),"/",Math.round(o.x)]}),s.jsxs("div",{children:["Slope: ",isFinite(c)?c.toFixed(3):"undefined"]})]})]});case"rectangle":const{x:f,y:S,width:j,height:R,area:d}=r.properties;return s.jsxs("div",{className:"space-y-2",children:[s.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Rectangle Details"}),s.jsxs("div",{className:"space-y-1 text-xs text-gray-600",children:[s.jsxs("div",{children:["Position: (",$(f,1),", ",$(S,1),")"]}),s.jsxs("div",{children:["Size: ",$(j,1)," × ",$(R,1)]})]})]});case"circle":const{center:x,radius:T,diameter:l,circumference:h,area:p}=r.properties;return s.jsxs("div",{className:"space-y-2",children:[s.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Circle Details"}),s.jsxs("div",{className:"space-y-1 text-xs text-gray-600",children:[s.jsxs("div",{children:["Center: (",$(x.x,1),", ",$(x.y,1),")"]}),s.jsxs("div",{children:["Radius: ",ae(T)]}),s.jsxs("div",{children:["Diameter: ",ae(l)]}),s.jsxs("div",{children:["Circumference: ",ae(h)]}),s.jsxs("div",{children:["Area: ",ae(p)]})]})]});case"triangle":const{vertices:m,sideA:P,sideB:E,sideC:W,angleA:A,angleB:F,angleC:_,area:re,perimeter:H,type:X}=r.properties;return s.jsxs("div",{className:"space-y-2",children:[s.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Triangle Details"}),s.jsxs("div",{className:"space-y-1 text-xs text-gray-600",children:[s.jsxs("div",{children:["Type: ",X]}),s.jsx("div",{children:"Vertices:"}),s.jsxs("div",{className:"ml-2",children:[s.jsxs("div",{children:["A: (",$(m[0].x,1),", ",$(m[0].y,1),")"]}),s.jsxs("div",{children:["B: (",$(m[1].x,1),", ",$(m[1].y,1),")"]}),s.jsxs("div",{children:["C: (",$(m[2].x,1),", ",$(m[2].y,1),")"]})]}),s.jsxs("div",{children:["Sides: ",ae(P),", ",ae(E),", ",ae(W)]}),s.jsxs("div",{children:["Angles: ",ae(A),"°, ",ae(F),"°, ",ae(_),"°"]}),s.jsxs("div",{children:["Area: ",ae(re)]}),s.jsxs("div",{children:["Perimeter: ",ae(H)]})]})]});default:return null}};return s.jsxs("div",{className:"fixed top-20 right-4 bg-white border border-gray-200 rounded-lg shadow-lg p-3 z-50 min-w-48",children:[a(),s.jsxs("div",{className:"mt-3 pt-2 border-t border-gray-100 flex gap-2",children:[s.jsxs("button",{onClick:n,className:"flex items-center gap-1 px-2 py-1 text-xs text-red-600 hover:bg-red-50 rounded transition-colors",children:[s.jsx("span",{children:"🗑️"}),"Delete"]}),s.jsxs("button",{onClick:t,className:"flex items-center gap-1 px-2 py-1 text-xs text-gray-600 hover:bg-gray-50 rounded transition-colors",children:[s.jsx("span",{children:"✕"}),"Close"]})]})]})}function Pt(){const[r,e]=y.useState(!1),t=y.useRef(null),n=fe(),{toggleSetting:a,setFontScale:i,setGridScale:o,setSnapPrecision:c,setCoordinateSystem:g,resetToDefaults:f}=n;y.useEffect(()=>{function j(R){t.current&&!t.current.contains(R.target)&&e(!1)}if(r)return document.addEventListener("mousedown",j,!0),document.addEventListener("click",j,!0),()=>{document.removeEventListener("mousedown",j,!0),document.removeEventListener("click",j,!0)}},[r]);const S=[{title:"Origin Lines",subtitle:"Enhancements for lines from (0,0)",settings:[{key:"showEquivalentFractions",label:"Equivalent Fractions",description:"Green circles showing equivalent fractions"},{key:"showLengthMultiples",label:"Length Multiples",description:"Small dots at 2×, 3×, 4× line length"},{key:"showAreaRectangle",label:"Area Rectangle",description:"Soft rectangle showing multiplication"},{key:"showRiseRunTriangle",label:"Rise/Run Triangle",description:"Triangle showing slope components"},{key:"showDistanceMarkers",label:"Distance Markers",description:"Radial quarter-circles at unit distances"},{key:"showAngleArc",label:"Angle Arc",description:"Arc showing angle from x-axis with measurement"}]},{title:"Division & Fractions",subtitle:"Visual fraction and division concepts",settings:[{key:"showDivisionAnswer",label:"Slope/Division Answer (x=1)",description:"Blue dot showing slope value and division answer at x=1"}]},{title:"Grid & Reference",subtitle:"Grid enhancements and reference lines",settings:[{key:"showLatticePoints",label:"Lattice Points",description:"Dots at all integer coordinates"},{key:"showIntegerGridLines",label:"Integer Grid Lines",description:"Faint lines at whole numbers"},{key:"showReferenceLineY_equals_X",label:"y=x Reference Line",description:"Purple diagonal line for comparison"}]},{title:"Rectangle Concepts",subtitle:"Educational features for rectangles and areas",settings:[{key:"showFactorPairs",label:"Factor Pairs",description:"Show all rectangles with the same area"},{key:"showCommutativeProperty",label:"Commutative Property",description:"Show flipped rectangle (w×h = h×w)"},{key:"showDistributiveProperty",label:"Distributive Property",description:"Split rectangle to show a(b+c) = ab+ac"},{key:"showPrimeComposite",label:"Prime vs Composite",description:"Badge showing if area is prime or composite"},{key:"showGCF",label:"Greatest Common Factor",description:"Largest square tiling both dimensions"},{key:"showLCM",label:"Least Common Multiple",description:"Smallest rectangle fitting both dimensions"}]},{title:"Display",subtitle:"Adjust visibility for classrooms and large screens",settings:[]}];return s.jsxs("div",{ref:t,className:"fixed bottom-4 left-4 z-50",children:[s.jsxs("button",{onClick:()=>e(!r),className:"flex items-center gap-2 px-3 py-2 bg-white border border-gray-200 rounded-lg shadow-sm hover:bg-gray-50 transition-colors",title:"Visualization Settings",children:[s.jsx("span",{className:"text-lg",children:"⚙️"}),s.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Settings"}),s.jsx("span",{className:`text-xs transition-transform ${r?"":"rotate-180"}`,children:"▼"})]}),r&&s.jsxs("div",{className:"settings-panel absolute bottom-full left-0 mb-2 bg-white border border-gray-200 rounded-lg shadow-lg w-80 max-h-[28rem] overflow-y-auto",children:[s.jsx("div",{className:"sticky top-0 bg-white border-b border-gray-100 px-4 py-3 rounded-t-lg",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Visualization Settings"}),s.jsx("button",{onClick:f,className:"text-xs text-blue-600 hover:text-blue-800 font-medium",children:"Reset All"})]})}),s.jsx("div",{className:"settings-scrollable p-4 space-y-5",children:S.map((j,R)=>s.jsxs("div",{children:[s.jsxs("div",{className:`${R>0?"border-t border-gray-100 pt-4":""} mb-3`,children:[s.jsx("h4",{className:"text-xs font-semibold text-gray-700 uppercase tracking-wide",children:j.title}),j.subtitle&&s.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:j.subtitle})]}),s.jsxs("div",{className:"space-y-2.5",children:[j.settings.map(d=>s.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[s.jsx("input",{type:"checkbox",checked:n[d.key],onChange:()=>a(d.key),className:"mt-0.5 w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500 focus:ring-2"}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("div",{className:"text-sm font-medium text-gray-700 group-hover:text-gray-900",children:d.label}),s.jsx("div",{className:"text-xs text-gray-500 leading-relaxed",children:d.description})]})]},d.key)),j.title==="Display"&&s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Font Size"}),s.jsxs("span",{className:"text-xs text-gray-500 font-mono",children:[Math.round(n.fontScale*100),"%"]})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("span",{className:"text-xs text-gray-400",children:"A"}),s.jsx("input",{type:"range",min:"0.8",max:"2.0",step:"0.1",value:n.fontScale,onChange:d=>i(parseFloat(d.target.value)),className:"flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider"}),s.jsx("span",{className:"text-sm text-gray-600",children:"A"})]}),s.jsx("div",{className:"text-xs text-gray-500 leading-relaxed",children:"Increase font size for better visibility on TVs and projectors"}),s.jsxs("div",{className:"space-y-3 pt-4 border-t border-gray-100",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Grid Density"}),s.jsxs("span",{className:"text-xs text-gray-500 font-mono",children:[Math.round(n.gridScale*100),"%"]})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("span",{className:"text-xs text-gray-400",children:"Sparse"}),s.jsx("input",{type:"range",min:"0.2",max:"5.0",step:"0.1",value:n.gridScale,onChange:d=>o(parseFloat(d.target.value)),className:"flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider"}),s.jsx("span",{className:"text-xs text-gray-600",children:"Dense"})]}),s.jsx("div",{className:"text-xs text-gray-500 leading-relaxed",children:"Adjust grid line spacing for different zoom levels and detail needs"})]}),s.jsxs("div",{className:"space-y-3 pt-4 border-t border-gray-100",children:[s.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Coordinate System"}),s.jsx("div",{className:"space-y-2",children:[{value:"cartesian",label:"Cartesian Only",desc:"Standard x-y grid"},{value:"polar",label:"Polar Only",desc:"Circular coordinate system"},{value:"both",label:"Both Systems",desc:"Overlay polar on Cartesian"}].map(d=>s.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[s.jsx("input",{type:"radio",name:"coordinateSystem",value:d.value,checked:n.coordinateSystem===d.value,onChange:x=>g(x.target.value),className:"mt-0.5 w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500"}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("div",{className:"text-sm font-medium text-gray-700 group-hover:text-gray-900",children:d.label}),s.jsx("div",{className:"text-xs text-gray-500",children:d.desc})]})]},d.value))})]}),s.jsxs("div",{className:"space-y-3 pt-4 border-t border-gray-100",children:[s.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Snap Precision"}),s.jsx("div",{className:"space-y-2",children:[{value:"adaptive",label:"Adaptive",desc:"Automatically adjusts based on zoom level"},{value:"whole",label:"Whole Numbers",desc:"Snap to 1, 2, 3, etc."},{value:"half",label:"Half Units",desc:"Snap to 0.5, 1.0, 1.5, etc."},{value:"quarter",label:"Quarter Units",desc:"Snap to 0.25, 0.5, 0.75, etc."},{value:"tenth",label:"Tenth Units",desc:"Snap to 0.1, 0.2, 0.3, etc."}].map(d=>s.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[s.jsx("input",{type:"radio",name:"snapPrecision",value:d.value,checked:n.snapPrecision===d.value,onChange:x=>c(x.target.value),className:"mt-0.5 w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500"}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("div",{className:"text-sm font-medium text-gray-700 group-hover:text-gray-900",children:d.label}),s.jsx("div",{className:"text-xs text-gray-500",children:d.desc})]})]},d.value))}),s.jsx("div",{className:"text-xs text-gray-500 leading-relaxed",children:"Controls where objects can be placed when snap-to-grid is enabled"})]})]})]})]},j.title))}),s.jsx("div",{className:"sticky bottom-0 bg-gray-50 border-t border-gray-100 px-4 py-2 rounded-b-lg",children:s.jsx("p",{className:"text-xs text-gray-500 text-center",children:"Toggle features to explore different mathematical concepts"})})]})]})}const ye=class ye{constructor(){ee(this,"examplesData",null);ee(this,"isLoading",!1)}static getInstance(){return ye.instance||(ye.instance=new ye),ye.instance}async loadExamples(){if(this.examplesData)return this.examplesData;if(this.isLoading)return await new Promise(e=>{const t=()=>{this.isLoading?setTimeout(t,50):e(void 0)};t()}),this.examplesData;this.isLoading=!0;try{const e=await fetch("/examples.json");if(!e.ok)throw new Error(`Failed to load examples: ${e.status}`);const t=await e.json();if(!t.examples||!Array.isArray(t.examples))throw new Error("Invalid examples data: missing examples array");if(!t.categories||!Array.isArray(t.categories))throw new Error("Invalid examples data: missing categories array");for(const n of t.examples)if(!n.id||!n.title||!n.objects||!Array.isArray(n.objects))throw new Error(`Invalid example: ${n.id||"unknown"}`);return this.examplesData=t,this.examplesData}catch(e){return console.error("Failed to load examples:",e),this.examplesData={examples:[],categories:[]},this.examplesData}finally{this.isLoading=!1}}async getExamples(){return(await this.loadExamples()).examples}async getCategories(){return(await this.loadExamples()).categories}async getExampleById(e){return(await this.getExamples()).find(n=>n.id===e)||null}async getExamplesByCategory(e){return(await this.getExamples()).filter(n=>n.category===e)}generateObjectId(){return`example_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}convertExampleObjectToMathObject(e){const t={id:this.generateObjectId(),type:e.type,visible:!0,selected:!1,zIndex:0};switch(e.type){case"ray":return{...t,type:"ray",properties:{startPoint:e.properties.startPoint,endPoint:e.properties.endPoint,slope:(e.properties.endPoint.y-e.properties.startPoint.y)/(e.properties.endPoint.x-e.properties.startPoint.x)}};case"rectangle":return{...t,type:"rectangle",properties:{x:e.properties.x,y:e.properties.y,width:e.properties.width,height:e.properties.height,area:e.properties.width*e.properties.height}};case"circle":return{...t,type:"circle",properties:{center:e.properties.center,radius:e.properties.radius,diameter:e.properties.diameter,circumference:e.properties.circumference,area:e.properties.area}};case"triangle":return{...t,type:"triangle",properties:{vertices:e.properties.vertices,sideA:e.properties.sideA,sideB:e.properties.sideB,sideC:e.properties.sideC,angleA:e.properties.angleA,angleB:e.properties.angleB,angleC:e.properties.angleC,area:e.properties.area,perimeter:e.properties.perimeter,type:e.properties.type}};default:throw new Error(`Unknown object type: ${e.type}`)}}async applyExample(e){const t=await this.getExampleById(e);if(!t)throw new Error(`Example not found: ${e}`);const n=de.getState(),a=fe.getState();try{n.getAllObjects().forEach(o=>{n.removeObject(o.id)}),n.clearSelection(),t.viewport&&n.setViewport(t.viewport),Object.entries(t.settings).forEach(([o,c])=>{o in a&&typeof c=="boolean"?(a.toggleSetting(o),a[o]!==c&&a.toggleSetting(o)):o==="snapPrecision"&&typeof c=="string"?a.setSnapPrecision(c):o==="coordinateSystem"&&typeof c=="string"?a.setCoordinateSystem(c):o==="fontScale"&&typeof c=="number"?a.setFontScale(c):o==="gridScale"&&typeof c=="number"&&a.setGridScale(c)}),t.objects.forEach(o=>{const c=this.convertExampleObjectToMathObject(o);n.addObject(c)}),console.log(`Applied example: ${t.title}`)}catch(i){throw console.error("Failed to apply example:",i),new Error(`Failed to apply example "${t.title}": ${i.message}`)}}async clearCanvas(){const e=de.getState(),t=fe.getState();e.getAllObjects().forEach(a=>{e.removeObject(a.id)}),e.clearSelection(),e.setViewport({zoom:20,center:{x:0,y:0}}),t.resetToDefaults(),console.log("Canvas cleared and reset to defaults")}async getBeginnerExamples(){return(await this.getExamples()).filter(t=>t.difficulty==="beginner")}async getRandomExampleFromCategory(e){const t=await this.getExamplesByCategory(e);if(t.length===0)return null;const n=Math.floor(Math.random()*t.length);return t[n]}};ee(ye,"instance");let Ne=ye;const we=Ne.getInstance();function Mt(){const[r,e]=y.useState(!1),[t,n]=y.useState([]),[a,i]=y.useState([]),[o,c]=y.useState("all"),[g,f]=y.useState(!1),[S,j]=y.useState(null),R=y.useRef(null);y.useEffect(()=>{function p(m){R.current&&!R.current.contains(m.target)&&e(!1)}if(r)return document.addEventListener("mousedown",p,!0),document.addEventListener("click",p,!0),()=>{document.removeEventListener("mousedown",p,!0),document.removeEventListener("click",p,!0)}},[r]),y.useEffect(()=>{(async()=>{try{f(!0),j(null);const[m,P]=await Promise.all([we.getExamples(),we.getCategories()]);n(m),i(P)}catch(m){console.error("Failed to load examples:",m),j("Failed to load examples")}finally{f(!1)}})()},[]);const d=async p=>{try{f(!0),j(null),await we.applyExample(p.id),e(!1)}catch(m){console.error("Failed to apply example:",m),j(`Failed to load "${p.title}"`)}finally{f(!1)}},x=async()=>{try{f(!0),j(null),await we.clearCanvas(),e(!1)}catch(p){console.error("Failed to clear canvas:",p),j("Failed to clear canvas")}finally{f(!1)}},T=o==="all"?t:t.filter(p=>p.category===o),l=p=>{switch(p){case"beginner":return"text-green-600 bg-green-50";case"intermediate":return"text-yellow-600 bg-yellow-50";case"advanced":return"text-red-600 bg-red-50";default:return"text-gray-600 bg-gray-50"}},h=p=>{switch(p){case"beginner":return"●";case"intermediate":return"●●";case"advanced":return"●●●";default:return"?"}};return s.jsxs("div",{ref:R,className:"fixed top-4 right-4 z-50",children:[s.jsxs("button",{onClick:()=>e(!r),className:"flex items-center gap-2 px-3 py-2 bg-white border border-gray-200 rounded-lg shadow-sm hover:bg-gray-50 transition-colors",title:"Mathematical Examples",disabled:g,children:[s.jsx("span",{className:"text-lg",children:"📚"}),s.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Examples"}),s.jsx("span",{className:`text-xs transition-transform ${r?"rotate-180":""}`,children:"▼"})]}),r&&s.jsxs("div",{className:"absolute top-full right-0 mt-2 bg-white border border-gray-200 rounded-lg shadow-lg w-80 max-h-[32rem] overflow-hidden",children:[s.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-100 px-4 py-3 rounded-t-lg",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Mathematical Examples"}),s.jsx("button",{onClick:x,className:"text-xs text-red-600 hover:text-red-800 font-medium",disabled:g,children:"Clear All"})]}),s.jsx("div",{className:"mt-2",children:s.jsxs("select",{value:o,onChange:p=>c(p.target.value),className:"w-full text-xs border border-gray-200 rounded px-2 py-1 bg-white",disabled:g,children:[s.jsx("option",{value:"all",children:"All Categories"}),a.map(p=>s.jsx("option",{value:p.id,children:p.name},p.id))]})})]}),S&&s.jsx("div",{className:"px-4 py-2 bg-red-50 border-b border-red-100",children:s.jsx("p",{className:"text-xs text-red-600",children:S})}),s.jsx("div",{className:"overflow-y-auto max-h-80 examples-scrollable",children:g?s.jsx("div",{className:"flex items-center justify-center py-8",children:s.jsx("div",{className:"text-sm text-gray-500",children:"Loading examples..."})}):T.length===0?s.jsx("div",{className:"flex items-center justify-center py-8",children:s.jsx("div",{className:"text-sm text-gray-500",children:"No examples available"})}):s.jsx("div",{className:"p-2 space-y-1",children:T.map(p=>{var m;return s.jsx("button",{onClick:()=>d(p),className:"w-full text-left p-3 rounded-lg hover:bg-gray-50 transition-colors group",disabled:g,children:s.jsx("div",{className:"flex items-start justify-between",children:s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("h4",{className:"text-sm font-medium text-gray-900 group-hover:text-blue-600 truncate",children:p.title}),s.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded font-medium ${l(p.difficulty)}`,title:`${p.difficulty} difficulty`,children:h(p.difficulty)})]}),s.jsx("p",{className:"text-xs text-gray-500 mt-1 line-clamp-2",children:p.description}),a.find(P=>P.id===p.category)&&s.jsxs("div",{className:"flex items-center gap-1 mt-2",children:[s.jsx("span",{className:"text-xs text-gray-400",children:(m=a.find(P=>P.id===p.category))==null?void 0:m.name}),s.jsx("span",{className:"text-xs text-gray-300",children:"•"}),s.jsxs("span",{className:"text-xs text-gray-400",children:[p.objects.length," object",p.objects.length!==1?"s":""]})]})]})})},p.id)})})}),s.jsx("div",{className:"sticky bottom-0 bg-gray-50 border-t border-gray-100 px-4 py-2 rounded-b-lg",children:s.jsx("p",{className:"text-xs text-gray-500 text-center",children:"Click an example to explore mathematical concepts"})})]})]})}const Ve="grix-tutorial-completed";function Et(){const[r,e]=y.useState(!1),[t,n]=y.useState(0),[a,i]=y.useState(!1);y.useEffect(()=>{localStorage.getItem(Ve)||e(!0)},[]);const o=[{title:"Welcome to Grix! 🎯",content:"Grix is a mathematical visualization platform where you can explore concepts like slopes, fractions, multiplication, and more through interactive graphics.",highlight:null},{title:"Explore Examples 📚",content:"Click the 'Examples' button in the top-right corner to load pre-made mathematical demonstrations. Perfect for getting started!",highlight:"examples"},{title:"Customize Visualizations ⚙️",content:"Use the 'Settings' button in the bottom-left to enable different mathematical features like equivalent fractions, area calculations, and more.",highlight:"settings"},{title:"Interactive Tools 🛠️",content:"Use the toolbar to draw lines and rectangles. Zoom with Ctrl+scroll wheel, and pan by scrolling. On mobile, use pinch gestures.",highlight:"toolbar"}],c=()=>{t<o.length-1?n(t+1):f()},g=()=>{f()},f=()=>{localStorage.setItem(Ve,"true"),e(!1)},S=async()=>{try{i(!0);const d=await we.getBeginnerExamples();d.length>0&&await we.applyExample(d[0].id),f()}catch(d){console.error("Failed to load example:",d),f()}finally{i(!1)}};if(!r)return null;const j=o[t],R=t===o.length-1;return s.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9999]",children:[s.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-md mx-4 p-6 relative",children:[s.jsx("div",{className:"flex gap-2 mb-4",children:o.map((d,x)=>s.jsx("div",{className:`h-2 flex-1 rounded-full ${x<=t?"bg-blue-500":"bg-gray-200"}`},x))}),s.jsxs("div",{className:"text-center",children:[s.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-3",children:j.title}),s.jsx("p",{className:"text-gray-600 leading-relaxed mb-6",children:j.content})]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:g,className:"flex-1 px-4 py-2 text-gray-600 hover:text-gray-800 font-medium transition-colors",disabled:a,children:"Skip Tutorial"}),R?s.jsx("button",{onClick:S,className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors disabled:opacity-50",disabled:a,children:a?"Loading...":"Try an Example!"}):s.jsx("button",{onClick:c,className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors",children:"Next"})]}),s.jsxs("div",{className:"text-center mt-4 text-sm text-gray-500",children:["Step ",t+1," of ",o.length]}),s.jsx("button",{onClick:g,className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600 text-xl font-bold w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100",title:"Close tutorial",children:"×"})]}),j.highlight&&s.jsxs(s.Fragment,{children:[j.highlight==="examples"&&s.jsx("div",{className:"fixed top-4 right-4 z-[10000] pointer-events-none",children:s.jsx("div",{className:"w-24 h-12 border-4 border-yellow-400 rounded-lg animate-pulse"})}),j.highlight==="settings"&&s.jsx("div",{className:"fixed bottom-4 left-4 z-[10000] pointer-events-none",children:s.jsx("div",{className:"w-24 h-12 border-4 border-yellow-400 rounded-lg animate-pulse"})}),j.highlight==="toolbar"&&s.jsx("div",{className:"fixed top-4 left-4 z-[10000] pointer-events-none",children:s.jsx("div",{className:"w-48 h-12 border-4 border-yellow-400 rounded-lg animate-pulse"})})]})]})}const Ke=(r,e)=>{const t=e*Math.PI/180,n=Math.cos(t),a=Math.sin(t);return{x:r.x*n-r.y*a,y:r.x*a+r.y*n}},Tt=(r,e)=>({x:r.x*e,y:r.y*e}),Je=(r,e)=>{switch(e){case"x":return{x:r.x,y:-r.y};case"y":return{x:-r.x,y:r.y};case"origin":return{x:-r.x,y:-r.y};default:return r}},kt=Oe((r,e)=>({isTransforming:!1,activeTransform:null,selectedObject:null,rotateObject:(t,n,a)=>{if(!a){console.log(`No canvas API provided for rotation of ${t}`);return}const i=a.getObject(t);if(i){if(i.type==="ray"){if(Math.abs(i.properties.startPoint.x)<.001&&Math.abs(i.properties.startPoint.y)<.001){const c=Ke(i.properties.endPoint,n);a.updateObject(t,{properties:{...i.properties,endPoint:c}})}}else if(i.type==="rectangle"){const o=i.properties.x+i.properties.width/2,c=i.properties.y+i.properties.height/2,g={x:i.properties.x-o,y:i.properties.y-c},f=Ke(g,n);a.updateObject(t,{properties:{...i.properties,x:f.x+o,y:f.y+c}})}}},scaleObject:(t,n,a)=>{if(!a){console.log(`No canvas API provided for scaling of ${t}`);return}const i=a.getObject(t);if(i)if(i.type==="ray"){if(Math.abs(i.properties.startPoint.x)<.001&&Math.abs(i.properties.startPoint.y)<.001){const c=Tt(i.properties.endPoint,n);a.updateObject(t,{properties:{...i.properties,endPoint:c}})}}else i.type==="rectangle"&&a.updateObject(t,{properties:{...i.properties,width:i.properties.width*n,height:i.properties.height*n,area:i.properties.width*n*i.properties.height*n}})},reflectObject:(t,n,a)=>{if(!a){console.log(`No canvas API provided for reflection of ${t}`);return}const i=a.getObject(t);if(i){if(i.type==="ray"){if(Math.abs(i.properties.startPoint.x)<.001&&Math.abs(i.properties.startPoint.y)<.001){const c=Je(i.properties.endPoint,n);a.updateObject(t,{properties:{...i.properties,endPoint:c}})}}else if(i.type==="rectangle"){const o=Je({x:i.properties.x,y:i.properties.y},n);a.updateObject(t,{properties:{...i.properties,x:o.x,y:o.y}})}}},rotate90:(t,n)=>{e().rotateObject(t,90,n)},rotate180:(t,n)=>{e().rotateObject(t,180,n)},rotate270:(t,n)=>{e().rotateObject(t,270,n)},setActiveTransform:t=>{r({activeTransform:t,isTransforming:t!==null})},setSelectedObject:t=>{r({selectedObject:t})},clearTransform:()=>{r({isTransforming:!1,activeTransform:null,selectedObject:null})}}));function Qe({width:r=800,height:e=600,className:t="",onObjectInteraction:n}){const a=y.useRef(null),{viewport:i,setViewport:o,objects:c,selectedObjects:g,snapToGrid:f,gridDensity:S,canvasSize:j,setCanvasSize:R,removeObject:d,clearSelection:x,selectObject:T,screenToWorld:l,worldToScreen:h,getObject:p,updateObject:m}=de(),P=yt(),{activeTool:E,setActiveTool:W,eventBus:A}=Me(),{rotate90:F,rotate180:_,rotate270:re,scaleObject:H,setSelectedObject:X}=kt();y.useEffect(()=>{R({width:r,height:e})},[r,e,R]);const J=y.useRef({isPanning:!1,startPoint:{x:0,y:0},startCenter:{x:0,y:0}}),C=y.useRef({isDown:!1,startPoint:{x:0,y:0},hasMoved:!1,dragThreshold:5,pendingSelection:null}),[b,N]=y.useState(null),[ie,D]=y.useState(!1),[B,u]=y.useState(!1),w=y.useRef({worldPoint:{x:0,y:0},timestamp:0,overlappingObjects:[],currentIndex:0}),z=y.useCallback((v,Y=.5)=>{const O=[];for(const k of c){let I=0,U=1/0,Z=!1;switch(k.type){case"ray":const ce=Te(v,k.properties.startPoint,k.properties.endPoint);ce<=Y&&(I=100,U=ce,Z=!0);break;case"rectangle":const{x:K,y:he,width:me,height:pe}=k.properties,De=[{start:{x:K,y:he},end:{x:K+me,y:he}},{start:{x:K+me,y:he},end:{x:K+me,y:he+pe}},{start:{x:K+me,y:he+pe},end:{x:K,y:he+pe}},{start:{x:K,y:he+pe},end:{x:K,y:he}}];let Ce=1/0;for(const Ae of De){const Ie=Te(v,Ae.start,Ae.end);Ce=Math.min(Ce,Ie)}Ce<=Y?(I=100,U=Ce,Z=!0):v.x>=K&&v.x<=K+me&&v.y>=he&&v.y<=he+pe&&(I=50,U=0,Z=!0);break;case"circle":const{center:ze,radius:Fe}=k.properties,at=Math.sqrt((v.x-ze.x)**2+(v.y-ze.y)**2),ot=Ze(v,ze,Fe);ot<=Y?(I=100,U=ot,Z=!0):at<=Fe&&(I=50,U=Fe-at,Z=!0);break;case"triangle":const{vertices:be}=k.properties,Lt=[[be[0],be[1]],[be[1],be[2]],[be[2],be[0]]];let ke=1/0;for(const[Ae,Ie]of Lt){const Bt=Te(v,Ae,Ie);ke=Math.min(ke,Bt)}ke<=Y?(I=100,U=ke,Z=!0):Ue(v,be)&&(I=50,U=0,Z=!0);break}Z&&O.push({object:k,priority:I,distance:U})}return O.sort((k,I)=>k.priority!==I.priority?I.priority-k.priority:k.distance!==I.distance?k.distance-I.distance:(I.object.zIndex||0)-(k.object.zIndex||0)),O.map(k=>k.object)},[c,Te,Ue,Ze]),q=y.useCallback(v=>{const Y={x:v.x,y:v.y};C.current={isDown:!0,startPoint:Y,hasMoved:!1,dragThreshold:5,pendingSelection:null};const O=l(Y),I=z(O,.5);let U=!1,Z=null;if(I.length>0){U=!0;const ce=Date.now(),K=w.current,he=Math.abs(O.x-K.worldPoint.x)<.1&&Math.abs(O.y-K.worldPoint.y)<.1,me=ce-K.timestamp<500;if(he&&me&&K.overlappingObjects.length>1){const pe=(K.currentIndex+1)%K.overlappingObjects.length,De=K.overlappingObjects[pe];Z=I.find(Ce=>Ce.id===De)||I[0],w.current={worldPoint:O,timestamp:ce,overlappingObjects:K.overlappingObjects,currentIndex:pe}}else Z=I[0],w.current={worldPoint:O,timestamp:ce,overlappingObjects:I.map(pe=>pe.id),currentIndex:0};C.current.pendingSelection={objectId:Z.id,type:Z.type},T(Z.id)}else w.current={worldPoint:{x:0,y:0},timestamp:0,overlappingObjects:[],currentIndex:0};(!U&&!E||!U&&E)&&x(),(E||U)&&P.handlePointerDown(v),!U&&!E&&(v.type==="touch"||v.type==="mouse")&&(J.current={isPanning:!0,startPoint:{x:v.x,y:v.y},startCenter:{...i.center}})},[i.center,P,E,W,c,l,h,i.zoom]),ne=y.useCallback(v=>{const Y={x:v.x,y:v.y};if(v.type==="mouse"&&E?N(Y):E||N(null),C.current.isDown&&!C.current.hasMoved){const O=Math.abs(v.x-C.current.startPoint.x),k=Math.abs(v.y-C.current.startPoint.y);Math.sqrt(O*O+k*k)>=C.current.dragThreshold&&(C.current.hasMoved=!0,u(!0),C.current.pendingSelection=null)}if(P.handlePointerMove(v),!E&&J.current.isPanning){const O=(v.x-J.current.startPoint.x)/i.zoom,k=(v.y-J.current.startPoint.y)/i.zoom;o({center:{x:J.current.startCenter.x-O,y:J.current.startCenter.y+k}})}},[i.zoom,o,P,E,N]),te=y.useCallback(v=>{u(!1),C.current={isDown:!1,startPoint:{x:0,y:0},hasMoved:!1,dragThreshold:5,pendingSelection:null},P.handlePointerUp(v),J.current.isPanning=!1},[P,W]),xe=y.useCallback(v=>{switch(v.type){case"pinch":if(v.scale&&v.center){const Y=c.length;let O=v.scale;v.touches&&v.touches>1&&(O=1+(v.scale-1)*.25);const k=Y>50?100:Y>20?200:500,U=Math.max(.1,Math.min(k,i.zoom*O));if(Math.abs(U-i.zoom)>.001){const Z=U/i.zoom,ce=l(v.center),K={x:ce.x+(i.center.x-ce.x)/Z,y:ce.y+(i.center.y-ce.y)/Z};o({zoom:U,center:K})}}break}},[i.zoom,i.center,o,c.length,l]),{capabilities:ue,touchTargetSize:V}=_e(a,{onPointerDown:q,onPointerMove:ne,onPointerUp:te,onGesture:xe},{enableGestures:!0,preventScrolling:!0});y.useEffect(()=>{const v=O=>{switch(O.key){case"Escape":E&&(A.emit("tool:cancel",{toolId:E}),W(null));break;case"Delete":case"Backspace":g.length>0&&(console.log("Deleting objects:",g),g.forEach(k=>{A.emit("object:removed",{objectId:k}),d(k)}),x(),W(null));break;case"r":case"R":if(g.length>0&&!O.ctrlKey){O.preventDefault();const k={getObject:p,updateObject:m};g.forEach(I=>{O.shiftKey?re(I,k):F(I,k)})}break;case"f":case"F":if(g.length>0&&!O.ctrlKey){O.preventDefault();const k={getObject:p,updateObject:m};g.forEach(I=>{_(I,k)})}break;case"=":case"+":if(g.length>0&&!O.ctrlKey){O.preventDefault();const k={getObject:p,updateObject:m};g.forEach(I=>{H(I,2,k)})}break;case"-":case"_":if(g.length>0&&!O.ctrlKey){O.preventDefault();const k={getObject:p,updateObject:m};g.forEach(I=>{H(I,.5,k)})}break}},Y=O=>{console.log("Object created, returning to pan mode:",O),x(),W(null)};return document.addEventListener("keydown",v),A.on("tool:creation-complete",Y),()=>{document.removeEventListener("keydown",v),A.off("tool:creation-complete",Y)}},[E,W,A,g,d,x]),y.useEffect(()=>{g.length===1&&!B?D(!0):D(!1)},[g,B]);const M=y.useCallback(()=>{D(!1)},[]),L=y.useCallback(()=>{g.length>0&&(g.forEach(v=>{A.emit("object:removed",{objectId:v}),d(v)}),x())},[g,d,x,A]),G=y.useCallback(()=>{const v=Math.min(1e3,i.zoom*1.4);o({zoom:v})},[i.zoom,o]),Q=y.useCallback(()=>{const v=Math.max(.01,i.zoom/1.4);o({zoom:v})},[i.zoom,o]),le=y.useCallback(()=>{o({zoom:20,center:{x:0,y:0}})},[o]),oe=y.useCallback(()=>{o({center:{x:0,y:0}})},[o]);return y.useEffect(()=>{const v=O=>{O.preventDefault();const I=de.getState().viewport;if(O.ctrlKey||O.metaKey){const U=O.deltaY>0?.9:1.1,Z=Math.max(.01,Math.min(1e3,I.zoom*U));o({zoom:Z})}else{const Z=O.shiftKey?O.deltaY:0,ce=O.shiftKey?0:O.deltaY,K=Z*1/I.zoom,he=ce*1/I.zoom;o({center:{x:I.center.x+K,y:I.center.y-he}})}},Y=a.current;if(Y)return Y.addEventListener("wheel",v,{passive:!1}),()=>{Y.removeEventListener("wheel",v)}},[o]),s.jsxs("div",{className:`relative ${t}`,style:{width:r,height:e},children:[s.jsxs("svg",{ref:a,width:r,height:e,className:"absolute inset-0 bg-white",style:{touchAction:"none"},children:[s.jsx(vt,{viewport:i,canvasSize:{width:r,height:e},worldToScreen:h,objects:c}),s.jsx(wt,{objects:c,viewport:i,touchTargetSize:V,worldToScreen:h,selectedObjects:g,canvasSize:{width:r,height:e}}),E&&b&&!C.current.isDown&&s.jsx("circle",{cx:b.x,cy:b.y,r:"4",fill:"rgba(37, 99, 235, 0.4)",stroke:"#2563eb",strokeWidth:"1",opacity:"0.8",style:{pointerEvents:"none"}})]}),s.jsx(Ct,{capabilities:ue,viewport:i,activeTool:E,selectedObjectsCount:g.length}),s.jsx(jt,{viewport:i,onZoomIn:G,onZoomOut:Q,onZoomReset:le,onCenterOnly:oe}),ie&&g.length===1&&s.jsx(St,{selectedObject:c.find(v=>v.id===g[0])||null,onDelete:L,onClose:M}),s.jsx(Pt,{}),s.jsx(Mt,{}),s.jsx(Et,{})]})}const et=[{id:"ray-tool",name:"Line Builder",icon:"📏",description:"Create and edit lines to explore slopes and fractions"},{id:"rectangle-tool",name:"Rectangle Builder",icon:"⬜",description:"Create rectangles to explore area and multiplication"},{id:"circle-tool",name:"Circle Builder",icon:"⭕",description:"Create circles to explore circumference and area"},{id:"triangle-tool",name:"Triangle Builder",icon:"🔺",description:"Create triangles to explore angles and trigonometry"}];function tt({className:r=""}){const{activeTool:e,setActiveTool:t}=Me(),[n,a]=y.useState(!1),i=y.useRef(null),o=S=>{t(S),a(!1)},c=()=>{t(null),a(!1)},g=()=>{a(!n)},f=et.find(S=>S.id===e);return y.useEffect(()=>{const S=j=>{i.current&&!i.current.contains(j.target)&&a(!1)};return n&&document.addEventListener("mousedown",S),()=>{document.removeEventListener("mousedown",S)}},[n]),s.jsxs("div",{className:`flex items-center gap-2 p-2 bg-white border-b border-gray-200 ${r}`,children:[s.jsxs("div",{className:"flex items-center gap-2 mr-4",children:[s.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 32 32",className:"flex-shrink-0",children:[s.jsx("rect",{width:"32",height:"32",fill:"#2563eb",rx:"6"}),s.jsxs("g",{stroke:"#60A5FA",strokeWidth:"0.5",opacity:"0.6",children:[s.jsx("line",{x1:"8",y1:"4",x2:"8",y2:"28"}),s.jsx("line",{x1:"16",y1:"4",x2:"16",y2:"28"}),s.jsx("line",{x1:"24",y1:"4",x2:"24",y2:"28"}),s.jsx("line",{x1:"4",y1:"8",x2:"28",y2:"8"}),s.jsx("line",{x1:"4",y1:"16",x2:"28",y2:"16"}),s.jsx("line",{x1:"4",y1:"24",x2:"28",y2:"24"})]}),s.jsxs("g",{stroke:"#FFFFFF",strokeWidth:"1",children:[s.jsx("line",{x1:"16",y1:"4",x2:"16",y2:"28"}),s.jsx("line",{x1:"4",y1:"16",x2:"28",y2:"16"})]}),s.jsx("line",{x1:"16",y1:"16",x2:"24",y2:"8",stroke:"#22C55E",strokeWidth:"2"}),s.jsx("circle",{cx:"16",cy:"16",r:"2",fill:"#FFFFFF"}),s.jsx("circle",{cx:"24",cy:"8",r:"1.5",fill:"#22C55E"})]}),s.jsx("h1",{className:"text-lg font-semibold text-gray-800",children:"Grix"})]}),s.jsxs("div",{className:"relative",ref:i,children:[s.jsxs("button",{onClick:g,className:`
            flex items-center gap-2 px-4 py-2 rounded-lg border transition-all
            ${e?"bg-blue-100 border-blue-300 text-blue-700":"bg-gray-50 border-gray-200 text-gray-700 hover:bg-gray-100"}
          `,children:[s.jsx("span",{className:"text-lg",children:"🏗️"}),s.jsx("span",{className:"text-sm font-medium",children:f?f.name:"Build"}),s.jsx("span",{className:`text-xs transition-transform ${n?"rotate-180":""}`,children:"▼"})]}),n&&s.jsxs("div",{className:"absolute top-full left-0 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg z-50 min-w-48",children:[et.map(S=>s.jsxs("button",{onClick:()=>o(S.id),className:`
                  w-full flex items-center gap-3 px-4 py-3 text-left hover:bg-gray-50 first:rounded-t-lg last:rounded-b-lg transition-colors
                  ${e===S.id?"bg-blue-50 text-blue-700":"text-gray-700"}
                `,title:S.description,children:[s.jsx("span",{className:"text-lg",children:S.icon}),s.jsxs("div",{children:[s.jsx("div",{className:"text-sm font-medium",children:S.name}),s.jsx("div",{className:"text-xs text-gray-500",children:S.description})]})]},S.id)),e&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"border-t border-gray-100"}),s.jsxs("button",{onClick:c,className:"w-full flex items-center gap-3 px-4 py-2 text-left hover:bg-gray-50 rounded-b-lg transition-colors text-gray-600",children:[s.jsx("span",{className:"text-lg",children:"✕"}),s.jsx("span",{className:"text-sm",children:"Clear selection"})]})]})]})]})]})}class st extends y.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("Canvas Error Boundary caught an error:",e,t),this.setState({error:e,errorInfo:t})}render(){var e,t;if(this.state.hasError){const n=this.props.fallback;return n?s.jsx(n,{error:this.state.error}):s.jsx("div",{className:"flex items-center justify-center h-full bg-red-50 text-red-700 p-8",children:s.jsxs("div",{className:"text-center",children:[s.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Something went wrong with the Canvas"}),s.jsxs("details",{className:"text-sm",children:[s.jsx("summary",{className:"cursor-pointer mb-2",children:"Error Details"}),s.jsxs("pre",{className:"whitespace-pre-wrap text-left bg-red-100 p-4 rounded",children:[(e=this.state.error)==null?void 0:e.toString(),(t=this.state.errorInfo)==null?void 0:t.componentStack]})]}),s.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Reload Page"})]})})}return this.props.children}}class At{constructor(){ee(this,"id","ray-tool");ee(this,"name","Line Builder");ee(this,"context");ee(this,"state",{isCreating:!1,startPoint:null,currentRay:null,dragTarget:null,dragOffset:null})}init(e){this.context=e,e.events.on("tool:changed",this.handleToolChange.bind(this)),e.events.on("tool:cancel",this.handleToolCancel.bind(this))}destroy(){this.context.events.off("tool:changed",this.handleToolChange.bind(this)),this.context.events.off("tool:cancel",this.handleToolCancel.bind(this))}handleToolChange(e){e.current!==this.id&&this.cancelCreation()}handleToolCancel(e){e.toolId===this.id&&this.cancelCreation()}cancelCreation(){this.state.currentRay&&this.state.isCreating&&this.context.canvas.removeObject(this.state.currentRay.id),this.state={isCreating:!1,startPoint:null,currentRay:null,dragTarget:null,dragOffset:null}}generateId(){return`ray_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}snapPoint(e){const t=this.context.state.getState();if(t.snapToGrid){if(Math.sqrt(e.x*e.x+e.y*e.y)<=.75)return{x:0,y:0};const i=fe.getState(),o=Ee(t.viewport,i.gridScale,i.snapPrecision);return this.context.math.snapToGrid(e,o)}return e}findNearestHandle(e,t=20){this.context.canvas.screenToWorld(e);const n=this.context.canvas.getAllObjects();for(const a of n)if(a.type==="ray"){const i=a,o=this.context.canvas.worldToScreen(i.properties.startPoint),c=this.context.canvas.worldToScreen(i.properties.endPoint),g=this.context.math.distance(e,o),f=this.context.math.distance(e,c);if(g<=t)return{rayId:i.id,handle:"start"};if(f<=t)return{rayId:i.id,handle:"end"};const S=8,j=c.x-o.x,R=c.y-o.y,d=Math.sqrt(j*j+R*R);if(d>0){const x=Math.max(0,Math.min(1,((e.x-o.x)*j+(e.y-o.y)*R)/(d*d))),T={x:o.x+x*j,y:o.y+x*R};if(this.context.math.distance(e,T)<=S)return{rayId:i.id,handle:"move"}}}return null}onPointerDown(e){const t={x:e.x,y:e.y},n=this.snapPoint(this.context.canvas.screenToWorld(t)),a=this.findNearestHandle(t);if(a){const i=this.context.canvas.getObject(a.rayId),o=this.context.state.getState().selectedObjects;if(i&&o.includes(a.rayId)){this.state.currentRay=i,this.state.dragTarget=a.handle,this.state.isCreating=!1,a.handle==="move"&&(this.state.dragOffset={x:n.x-i.properties.startPoint.x,y:n.y-i.properties.startPoint.y});return}}if(!this.state.isCreating){this.state.isCreating=!0,this.state.startPoint=n;const i={id:this.generateId(),type:"ray",properties:{startPoint:n,endPoint:{...n},slope:0,yIntercept:n.y},visible:!0,selected:!1,zIndex:0};this.state.currentRay=i,this.context.canvas.addObject(i)}}onPointerMove(e){if(!this.state.currentRay)return;const t={x:e.x,y:e.y},n=this.snapPoint(this.context.canvas.screenToWorld(t));if(this.state.isCreating){const a=this.context.math.slope(this.state.currentRay.properties.startPoint,n),i=n.y-a*n.x;this.context.canvas.updateObject(this.state.currentRay.id,{properties:{...this.state.currentRay.properties,endPoint:n,slope:a,yIntercept:isFinite(a)?i:this.state.currentRay.properties.startPoint.y}})}else if(this.state.dragTarget){const a=this.context.canvas.getObject(this.state.currentRay.id);if(!a)return;const i={...a.properties};if(this.state.dragTarget==="start")i.startPoint=n;else if(this.state.dragTarget==="end")i.endPoint=n;else if(this.state.dragTarget==="move"&&this.state.dragOffset){const o=n.x-this.state.dragOffset.x-a.properties.startPoint.x,c=n.y-this.state.dragOffset.y-a.properties.startPoint.y;i.startPoint={x:a.properties.startPoint.x+o,y:a.properties.startPoint.y+c},i.endPoint={x:a.properties.endPoint.x+o,y:a.properties.endPoint.y+c}}if(this.state.dragTarget==="start"||this.state.dragTarget==="end"){const o=this.context.math.slope(i.startPoint,i.endPoint);i.slope=o,i.yIntercept=isFinite(o)?i.startPoint.y-o*i.startPoint.x:i.startPoint.y}this.context.canvas.updateObject(this.state.currentRay.id,{properties:i})}this.context.events.emit("ray:update",{rayId:this.state.currentRay.id,ray:this.context.canvas.getObject(this.state.currentRay.id)})}onPointerUp(e){if(this.state.isCreating&&this.state.currentRay){const t={x:e.x,y:e.y},n=this.snapPoint(this.context.canvas.screenToWorld(t)),a=this.state.currentRay.properties.startPoint;this.context.math.distance(a,n)<.1?this.context.canvas.removeObject(this.state.currentRay.id):(this.context.events.emit("ray:created",{rayId:this.state.currentRay.id,ray:this.state.currentRay}),this.context.events.emit("tool:creation-complete",{toolId:this.id,objectId:this.state.currentRay.id}))}this.state={isCreating:!1,startPoint:null,currentRay:null,dragTarget:null,dragOffset:null}}}function rt(){return new At}class Ot{constructor(){ee(this,"id","rectangle-tool");ee(this,"name","Rectangle Builder");ee(this,"context");ee(this,"state",{isCreating:!1,startPoint:null,currentRectangle:null,dragTarget:null,dragOffset:null,lockedCorner:null})}init(e){this.context=e,e.events.on("tool:changed",this.handleToolChange.bind(this)),e.events.on("tool:cancel",this.handleToolCancel.bind(this))}destroy(){this.context.events.off("tool:changed",this.handleToolChange.bind(this)),this.context.events.off("tool:cancel",this.handleToolCancel.bind(this))}handleToolChange(e){e.current!==this.id&&this.cancelCreation()}handleToolCancel(e){e.toolId===this.id&&this.cancelCreation()}cancelCreation(){this.state.currentRectangle&&this.state.isCreating&&this.context.canvas.removeObject(this.state.currentRectangle.id),this.state={isCreating:!1,startPoint:null,currentRectangle:null,dragTarget:null,dragOffset:null,lockedCorner:null}}generateId(){return`rect_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}snapPoint(e){const t=this.context.state.getState();if(t.snapToGrid){if(Math.sqrt(e.x*e.x+e.y*e.y)<=.75)return{x:0,y:0};const i=fe.getState(),o=Ee(t.viewport,i.gridScale,i.snapPrecision);return this.context.math.snapToGrid(e,o)}return e}findRectangleAtPoint(e){const t=this.context.canvas.getAllObjects();for(const n of t)if(n.type==="rectangle"){const a=n,{x:i,y:o,width:c,height:g}=a.properties;if(e.x>=i&&e.x<=i+c&&e.y>=o&&e.y<=o+g)return a}return null}findNearestCorner(e,t,n=.5){const{x:a,y:i,width:o,height:c}=t.properties,g=[{point:{x:a,y:i},type:"corner-bl"},{point:{x:a+o,y:i},type:"corner-br"},{point:{x:a,y:i+c},type:"corner-tl"},{point:{x:a+o,y:i+c},type:"corner-tr"}];for(const f of g)if(this.context.math.distance(e,f.point)<=n)return f.type;return null}onPointerDown(e){const t={x:e.x,y:e.y},n=this.snapPoint(this.context.canvas.screenToWorld(t)),a=this.findRectangleAtPoint(n);if(a&&this.context.state.getState().selectedObjects.includes(a.id)){const c=this.findNearestCorner(n,a);if(c){this.state.currentRectangle=a,this.state.dragTarget=c,this.state.isCreating=!1;const{x:g,y:f,width:S,height:j}=a.properties;switch(c){case"corner-tl":this.state.lockedCorner={x:g+S,y:f};break;case"corner-tr":this.state.lockedCorner={x:g,y:f};break;case"corner-bl":this.state.lockedCorner={x:g+S,y:f+j};break;case"corner-br":this.state.lockedCorner={x:g,y:f+j};break}return}else{this.state.currentRectangle=a,this.state.dragTarget="move",this.state.dragOffset={x:n.x-a.properties.x,y:n.y-a.properties.y},this.state.isCreating=!1;return}}this.state.isCreating=!0,this.state.startPoint=n;const i={id:this.generateId(),type:"rectangle",properties:{x:n.x,y:n.y,width:0,height:0,area:0},visible:!0,selected:!1,zIndex:0};this.state.currentRectangle=i,this.context.canvas.addObject(i)}onPointerMove(e){if(!this.state.currentRectangle)return;const t={x:e.x,y:e.y},n=this.snapPoint(this.context.canvas.screenToWorld(t));if(this.state.isCreating&&this.state.startPoint){const a=Math.min(this.state.startPoint.x,n.x),i=Math.min(this.state.startPoint.y,n.y),o=Math.abs(n.x-this.state.startPoint.x),c=Math.abs(n.y-this.state.startPoint.y),g=o*c;this.context.canvas.updateObject(this.state.currentRectangle.id,{properties:{x:a,y:i,width:o,height:c,area:g}})}else if(this.state.dragTarget==="move"&&this.state.dragOffset){const a=n.x-this.state.dragOffset.x,i=n.y-this.state.dragOffset.y;this.context.canvas.updateObject(this.state.currentRectangle.id,{properties:{...this.state.currentRectangle.properties,x:a,y:i}})}else if(this.state.dragTarget&&this.state.dragTarget.startsWith("corner-")&&this.state.lockedCorner){const a=this.state.lockedCorner,i=Math.min(n.x,a.x),o=Math.max(n.x,a.x),c=Math.min(n.y,a.y),g=Math.max(n.y,a.y),f=i,S=c,j=o-i,R=g-c,d=Math.max(.1,j),x=Math.max(.1,R),T=d*x;this.context.canvas.updateObject(this.state.currentRectangle.id,{properties:{x:f,y:S,width:d,height:x,area:T}})}this.context.events.emit("rectangle:update",{rectangleId:this.state.currentRectangle.id,rectangle:this.context.canvas.getObject(this.state.currentRectangle.id)})}onPointerUp(e){if(this.state.isCreating&&this.state.currentRectangle){const t=this.context.canvas.getObject(this.state.currentRectangle.id);t&&(t.properties.width<.1||t.properties.height<.1?this.context.canvas.removeObject(this.state.currentRectangle.id):(this.context.events.emit("rectangle:created",{rectangleId:this.state.currentRectangle.id,rectangle:t}),this.context.events.emit("tool:creation-complete",{toolId:this.id,objectId:this.state.currentRectangle.id})))}this.state={isCreating:!1,startPoint:null,currentRectangle:null,dragTarget:null,dragOffset:null,lockedCorner:null}}}function nt(){return new Ot}class Nt{constructor(){ee(this,"id","circle-tool");ee(this,"name","Circle Builder");ee(this,"context");ee(this,"state",{isCreating:!1,center:null,currentCircle:null,dragTarget:null,dragOffset:null})}init(e){this.context=e,e.events.on("tool:changed",this.handleToolChange.bind(this)),e.events.on("tool:cancel",this.handleToolCancel.bind(this))}destroy(){this.context.events.off("tool:changed",this.handleToolChange.bind(this)),this.context.events.off("tool:cancel",this.handleToolCancel.bind(this))}handleToolChange(e){e.current!==this.id&&this.cancelCreation()}handleToolCancel(e){e.toolId===this.id&&this.cancelCreation()}cancelCreation(){this.state.currentCircle&&this.state.isCreating&&this.context.canvas.removeObject(this.state.currentCircle.id),this.state={isCreating:!1,center:null,currentCircle:null,dragTarget:null,dragOffset:null}}generateId(){return`circle_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}snapPoint(e){const t=this.context.state.getState();if(t.snapToGrid){if(Math.sqrt(e.x*e.x+e.y*e.y)<=.75)return{x:0,y:0};const i=fe.getState(),o=Ee(t.viewport,i.gridScale,i.snapPrecision);return this.context.math.snapToGrid(e,o)}return e}calculateCircleProperties(e,t){const n=this.context.math.distance(e,t),a=n*2,i=2*Math.PI*n,o=Math.PI*n*n;return{radius:n,diameter:a,circumference:i,area:o}}findCircleAtPoint(e){const t=this.context.canvas.getAllObjects();for(const n of t)if(n.type==="circle"){const a=n;if(this.context.math.distance(e,a.properties.center)<=a.properties.radius+.5)return a}return null}findNearestHandle(e,t,n=.5){const{center:a,radius:i}=t.properties;if(this.context.math.distance(e,a)<=n)return"center";const o={x:a.x+i,y:a.y};return this.context.math.distance(e,o)<=n?"radius":null}onPointerDown(e){const t={x:e.x,y:e.y},n=this.snapPoint(this.context.canvas.screenToWorld(t)),a=this.findCircleAtPoint(n);if(a&&!this.context.state.getState().selectedObjects.includes(a.id))return;if(a&&this.context.state.getState().selectedObjects.includes(a.id)){const c=this.findNearestHandle(n,a);if(c){this.state.currentCircle=a,this.state.dragTarget=c,this.state.isCreating=!1,c==="center"&&(this.state.dragOffset={x:n.x-a.properties.center.x,y:n.y-a.properties.center.y});return}else{this.state.currentCircle=a,this.state.dragTarget="center",this.state.isCreating=!1,this.state.dragOffset={x:n.x-a.properties.center.x,y:n.y-a.properties.center.y};return}}this.state.isCreating=!0,this.state.center=n;const i={id:this.generateId(),type:"circle",properties:{center:n,radius:0,diameter:0,circumference:0,area:0},visible:!0,selected:!1,zIndex:0};this.state.currentCircle=i,this.context.canvas.addObject(i)}onPointerMove(e){if(!this.state.currentCircle)return;const t={x:e.x,y:e.y},n=this.snapPoint(this.context.canvas.screenToWorld(t));if(this.state.isCreating&&this.state.center){const a=this.calculateCircleProperties(this.state.center,n);this.context.canvas.updateObject(this.state.currentCircle.id,{properties:{center:this.state.center,...a}})}else if(this.state.dragTarget==="center"&&this.state.dragOffset){const a={x:n.x-this.state.dragOffset.x,y:n.y-this.state.dragOffset.y};this.context.canvas.updateObject(this.state.currentCircle.id,{properties:{...this.state.currentCircle.properties,center:a}})}else if(this.state.dragTarget==="radius"){const a=this.state.currentCircle.properties.center,i=this.calculateCircleProperties(a,n);this.context.canvas.updateObject(this.state.currentCircle.id,{properties:{center:a,...i}})}this.context.events.emit("circle:update",{circleId:this.state.currentCircle.id,circle:this.context.canvas.getObject(this.state.currentCircle.id)})}onPointerUp(e){if(this.state.isCreating&&this.state.currentCircle){const t=this.context.canvas.getObject(this.state.currentCircle.id);t&&(t.properties.radius<.1?this.context.canvas.removeObject(this.state.currentCircle.id):(this.context.events.emit("circle:created",{circleId:this.state.currentCircle.id,circle:t}),this.context.events.emit("tool:creation-complete",{toolId:this.id,objectId:this.state.currentCircle.id})))}this.state={isCreating:!1,center:null,currentCircle:null,dragTarget:null,dragOffset:null}}}function Dt(){return new Nt}class zt{constructor(){ee(this,"id","triangle-tool");ee(this,"name","Triangle Builder");ee(this,"context");ee(this,"state",{isCreating:!1,creationStep:0,vertices:[null,null,null],currentTriangle:null,dragTarget:null,dragOffset:null})}init(e){this.context=e,e.events.on("tool:changed",this.handleToolChange.bind(this)),e.events.on("tool:cancel",this.handleToolCancel.bind(this))}destroy(){this.context.events.off("tool:changed",this.handleToolChange.bind(this)),this.context.events.off("tool:cancel",this.handleToolCancel.bind(this))}handleToolChange(e){e.current!==this.id&&this.cancelCreation()}handleToolCancel(e){e.toolId===this.id&&this.cancelCreation()}cancelCreation(){this.state.currentTriangle&&this.state.isCreating&&this.context.canvas.removeObject(this.state.currentTriangle.id),this.state={isCreating:!1,creationStep:0,vertices:[null,null,null],currentTriangle:null,dragTarget:null,dragOffset:null}}generateId(){return`triangle_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}snapPoint(e){const t=this.context.state.getState();if(t.snapToGrid){if(Math.sqrt(e.x*e.x+e.y*e.y)<=.75)return{x:0,y:0};const i=fe.getState(),o=Ee(t.viewport,i.gridScale,i.snapPrecision);return this.context.math.snapToGrid(e,o)}return e}calculateTriangleProperties(e){const[t,n,a]=e,i=this.context.math.distance(n,a),o=this.context.math.distance(t,a),c=this.context.math.distance(t,n),g=Math.acos((o*o+c*c-i*i)/(2*o*c))*180/Math.PI,f=Math.acos((i*i+c*c-o*o)/(2*i*c))*180/Math.PI,S=180-g-f,j=Math.abs((n.x-t.x)*(a.y-t.y)-(a.x-t.x)*(n.y-t.y))/2,R=i+o+c;let d="scalene";const x=.1;return Math.abs(g-90)<x||Math.abs(f-90)<x||Math.abs(S-90)<x?d="right":g>90||f>90||S>90?d="obtuse":g<90&&f<90&&S<90&&(d="acute"),Math.abs(i-o)<x&&Math.abs(o-c)<x?d="equilateral":(Math.abs(i-o)<x||Math.abs(o-c)<x||Math.abs(i-c)<x)&&(d="isosceles"),{sideA:i,sideB:o,sideC:c,angleA:g,angleB:f,angleC:S,area:j,perimeter:R,type:d}}findTriangleAtPoint(e){const t=this.context.canvas.getAllObjects();for(const n of t)if(n.type==="triangle"){const a=n,[i,o,c]=a.properties.vertices,g=(o.y-c.y)*(i.x-c.x)+(c.x-o.x)*(i.y-c.y),f=((o.y-c.y)*(e.x-c.x)+(c.x-o.x)*(e.y-c.y))/g,S=((c.y-i.y)*(e.x-c.x)+(i.x-c.x)*(e.y-c.y))/g,j=1-f-S;if(f>=0&&S>=0&&j>=0)return a}return null}findNearestVertex(e,t,n=.5){const a=t.properties.vertices;for(let i=0;i<a.length;i++)if(this.context.math.distance(e,a[i])<=n)return`vertex${i}`;return null}onPointerDown(e){const t={x:e.x,y:e.y},n=this.snapPoint(this.context.canvas.screenToWorld(t)),a=this.findTriangleAtPoint(n);if(a&&this.context.state.getState().selectedObjects.includes(a.id)){const o=this.findNearestVertex(n,a);if(o){this.state.currentTriangle=a,this.state.dragTarget=o,this.state.isCreating=!1;return}else{this.state.currentTriangle=a,this.state.dragTarget="move";const c={x:(a.properties.vertices[0].x+a.properties.vertices[1].x+a.properties.vertices[2].x)/3,y:(a.properties.vertices[0].y+a.properties.vertices[1].y+a.properties.vertices[2].y)/3};this.state.dragOffset={x:n.x-c.x,y:n.y-c.y},this.state.isCreating=!1;return}}if(!this.state.isCreating){this.state.isCreating=!0,this.state.creationStep=0,this.state.vertices=[n,null,null];const i={x:n.x+3,y:n.y};this.state.vertices[1]=i,this.state.creationStep=1;const o={id:this.generateId(),type:"triangle",properties:{vertices:[n,i,n],sideA:0,sideB:0,sideC:0,angleA:0,angleB:0,angleC:0,area:0,perimeter:0,type:"scalene"},visible:!0,selected:!1,zIndex:0};this.state.currentTriangle=o,this.context.canvas.addObject(o)}}onPointerMove(e){if(!this.state.currentTriangle)return;const t={x:e.x,y:e.y},n=this.snapPoint(this.context.canvas.screenToWorld(t));if(this.state.isCreating&&this.state.creationStep===1){const[a,i]=this.state.vertices;if(a&&i){const o={x:i.x,y:n.y},c=[a,i,o],g=this.calculateTriangleProperties(c);this.context.canvas.updateObject(this.state.currentTriangle.id,{properties:{vertices:c,...g}})}}else if(this.state.dragTarget&&this.state.dragTarget.startsWith("vertex")){const a=parseInt(this.state.dragTarget.replace("vertex","")),i=[...this.state.currentTriangle.properties.vertices];i[a]=n;const o=this.calculateTriangleProperties(i);this.context.canvas.updateObject(this.state.currentTriangle.id,{properties:{vertices:i,...o}})}else if(this.state.dragTarget==="move"&&this.state.dragOffset){const a={x:n.x-this.state.dragOffset.x,y:n.y-this.state.dragOffset.y},i={x:(this.state.currentTriangle.properties.vertices[0].x+this.state.currentTriangle.properties.vertices[1].x+this.state.currentTriangle.properties.vertices[2].x)/3,y:(this.state.currentTriangle.properties.vertices[0].y+this.state.currentTriangle.properties.vertices[1].y+this.state.currentTriangle.properties.vertices[2].y)/3},o={x:a.x-i.x,y:a.y-i.y},c=[{x:this.state.currentTriangle.properties.vertices[0].x+o.x,y:this.state.currentTriangle.properties.vertices[0].y+o.y},{x:this.state.currentTriangle.properties.vertices[1].x+o.x,y:this.state.currentTriangle.properties.vertices[1].y+o.y},{x:this.state.currentTriangle.properties.vertices[2].x+o.x,y:this.state.currentTriangle.properties.vertices[2].y+o.y}];this.context.canvas.updateObject(this.state.currentTriangle.id,{properties:{...this.state.currentTriangle.properties,vertices:c}})}this.context.events.emit("triangle:update",{triangleId:this.state.currentTriangle.id,triangle:this.context.canvas.getObject(this.state.currentTriangle.id)})}onPointerUp(e){if(this.state.isCreating&&this.state.currentTriangle&&this.state.creationStep===1){const t=this.context.canvas.getObject(this.state.currentTriangle.id);t&&(t.properties.area<.1?this.context.canvas.removeObject(this.state.currentTriangle.id):(this.context.events.emit("triangle:created",{triangleId:this.state.currentTriangle.id,triangle:t}),this.context.events.emit("tool:creation-complete",{toolId:this.id,objectId:this.state.currentTriangle.id})))}this.state={isCreating:!1,creationStep:0,vertices:[null,null,null],currentTriangle:null,dragTarget:null,dragOffset:null}}}function Ft(){return new zt}class It{constructor(){ee(this,"id","area-counter");ee(this,"name","Area Counter");ee(this,"context");ee(this,"badges",new Map);ee(this,"badgeElements",new Map)}init(e){this.context=e,e.events.on("rectangle:created",this.handleRectangleCreated.bind(this)),e.events.on("rectangle:update",this.handleRectangleUpdated.bind(this)),e.events.on("object:removed",this.handleObjectRemoved.bind(this)),this.createBadgesForExistingRectangles();const t=e.state.subscribe(n=>{this.updateBadgePositions()});this.unsubscribeFromState=t}destroy(){this.context.events.off("rectangle:created",this.handleRectangleCreated.bind(this)),this.context.events.off("rectangle:update",this.handleRectangleUpdated.bind(this)),this.context.events.off("object:removed",this.handleObjectRemoved.bind(this)),this.unsubscribeFromState&&this.unsubscribeFromState(),this.badgeElements.forEach(e=>{e.remove()}),this.badgeElements.clear(),this.badges.clear()}createBadgesForExistingRectangles(){this.context.canvas.getAllObjects().forEach(t=>{t.type==="rectangle"&&this.createBadge(t)})}handleRectangleCreated(e){this.createBadge(e.rectangle)}handleRectangleUpdated(e){this.updateBadge(e.rectangle)}handleObjectRemoved(e){this.removeBadge(e.objectId)}createBadge(e){const t={rectangleId:e.id,x:e.properties.x,y:e.properties.y,width:e.properties.width,height:e.properties.height,area:e.properties.area,visible:!0};this.badges.set(e.id,t),this.createBadgeElement(t)}updateBadge(e){const t=this.badges.get(e.id);t&&(t.x=e.properties.x,t.y=e.properties.y,t.width=e.properties.width,t.height=e.properties.height,t.area=e.properties.area,this.updateBadgeElement(t))}removeBadge(e){const t=this.badgeElements.get(e);t&&(t.remove(),this.badgeElements.delete(e)),this.badges.delete(e)}createBadgeElement(e){const t=document.createElement("div");t.className="area-badge",t.style.cssText=`
      position: absolute;
      background: rgba(34, 197, 94, 0.9);
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 600;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
      white-space: nowrap;
      pointer-events: none;
      z-index: 1000;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(34, 197, 94, 1);
    `,(document.querySelector("[data-grix-canvas]")||document.body).appendChild(t),this.badgeElements.set(e.rectangleId,t),this.updateBadgeElement(e)}updateBadgeElement(e){const t=this.badgeElements.get(e.rectangleId);if(!t)return;const n=e.x+e.width/2,a=e.y+e.height/2,i=this.context.canvas.worldToScreen({x:n,y:a}),o=this.formatArea(e.area,e.width,e.height);t.textContent=o;const c=t.getBoundingClientRect();t.style.left=`${i.x-c.width/2}px`,t.style.top=`${i.y-c.height/2}px`,t.style.display="none"}formatArea(e,t,n){return""}updateBadgePositions(){this.badges.forEach(e=>{this.updateBadgeElement(e)})}showBadge(e){const t=this.badges.get(e);t&&(t.visible=!0,this.updateBadgeElement(t))}hideBadge(e){const t=this.badges.get(e);if(t){t.visible=!1;const n=this.badgeElements.get(e);n&&(n.style.display="none")}}showAllBadges(){this.badges.forEach((e,t)=>{this.showBadge(t)})}hideAllBadges(){this.badges.forEach((e,t)=>{this.hideBadge(t)})}}function it(){return new It}function $t(){const{registerPlugin:r}=Me(),e=y.useRef(!1);return y.useEffect(()=>{if(e.current)return;const t=rt(),n=nt(),a=Dt(),i=Ft(),o=it();return r(t),r(n),r(a),r(i),r(o),e.current=!0,()=>{}},[r]),s.jsxs("div",{className:"flex flex-col h-screen bg-gray-50",children:[s.jsx(tt,{}),s.jsx("div",{className:"flex-1 relative","data-grix-canvas":!0,children:s.jsx(Qe,{width:window.innerWidth,height:window.innerHeight-60,className:"absolute inset-0"})})]})}function Rt(){return s.jsx(st,{children:s.jsx(Ye,{children:s.jsx(st,{children:s.jsx($t,{})})})})}const Wt="0.1.0";se.Canvas=Qe,se.GrixApp=Rt,se.PluginManagerProvider=Ye,se.ToolBar=tt,se.createAreaCounter=it,se.createRayTool=rt,se.createRectangleTool=nt,se.useCanvasStore=de,se.useInputSystem=_e,se.usePluginManager=Me,se.version=Wt,Object.defineProperty(se,Symbol.toStringTag,{value:"Module"})});
